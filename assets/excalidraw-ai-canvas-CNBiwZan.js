const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ar-SA-G6X2FPQ2-DmnyjUFa.js","assets/chunk-SRAX5OIU-CUL6tJFz.js","assets/rolldown-runtime-B6ubh40S.js","assets/az-AZ-76LH7QW2-BiTjbJd6.js","assets/bg-BG-XCXSNQG7-yG22hcKv.js","assets/bn-BD-2XOGV67Q-Bp8dTM9S.js","assets/ca-ES-6MX7JW3Y-0mEDktqi.js","assets/cs-CZ-2BRQDIVT-BH8UfJ0u.js","assets/da-DK-5WZEPLOC-Cgkkc8tw.js","assets/de-DE-XR44H4JA-DCEifZ3F.js","assets/el-GR-BZB4AONW-D49BVoRj.js","assets/en-B4ZKOASM-DZA9jnWW.js","assets/chunk-6U3AYISY-LqBBMT4j.js","assets/es-ES-U4NZUMDT-BhJ6vUTG.js","assets/eu-ES-A7QVB2H4-CMgibXyi.js","assets/fa-IR-HGAKTJCU-DkerD_Hz.js","assets/fi-FI-Z5N7JZ37-C-3DS5NO.js","assets/fr-FR-RHASNOE6-DajaX8dl.js","assets/gl-ES-HMX3MZ6V-DoVdATMk.js","assets/he-IL-6SHJWFNN-ByyciDdT.js","assets/hi-IN-IWLTKZ5I-CwIFuzHN.js","assets/hu-HU-A5ZG7DT2-G9fK6HUG.js","assets/id-ID-SAP4L64H-BpysE6rm.js","assets/it-IT-JPQ66NNP-Dw9mu4Be.js","assets/ja-JP-DBVTYXUO-DlFd5tFM.js","assets/kaa-6HZHGXH3-BQr7t_ee.js","assets/kab-KAB-ZGHBKWFO-oWYVl8Ur.js","assets/kk-KZ-P5N5QNE5-BGnfbRht.js","assets/km-KH-HSX4SM5Z-C1KvKIcs.js","assets/ko-KR-MTYHY66A-IdkAKUIq.js","assets/ku-TR-6OUDTVRD-DN6AmyTq.js","assets/lt-LT-XHIRWOB4-B34s6i2p.js","assets/lv-LV-5QDEKY6T-CF2Azy-W.js","assets/mr-IN-CRQNXWMA-CZpagecR.js","assets/my-MM-5M5IBNSE-CHTcwBRP.js","assets/nb-NO-T6EIAALU-C0-2HgM4.js","assets/nl-NL-IS3SIHDZ-B8AHP4NX.js","assets/nn-NO-6E72VCQL-i112UZUL.js","assets/oc-FR-POXYY2M6-LEhz7Zxh.js","assets/pa-IN-N4M65BXN-GAo7ay4p.js","assets/percentages-BXMCSKIN-1KLGRqIc.js","assets/chunk-Z3N5DIM6-DG5drBhN.js","assets/pl-PL-T2D74RX3-BhPRiil4.js","assets/pt-BR-5N22H2LF-DvXhiViu.js","assets/pt-PT-UZXXM6DQ-vImJ1XNj.js","assets/ro-RO-JPDTUUEW-Dxaxjc0T.js","assets/ru-RU-B4JR7IUQ-DjbjG_gS.js","assets/si-LK-N5RQ5JYF-DZucc4jG.js","assets/sk-SK-C5VTKIMK-BvuwN3Xi.js","assets/sl-SI-NN7IZMDC-BmqkuQL_.js","assets/sv-SE-XGPEYMSR-B49JT1HY.js","assets/ta-IN-2NMHFXQM-Co1_LnJ9.js","assets/th-TH-HPSO5L25-DAJYUzew.js","assets/tr-TR-DEFEU3FU-DFNfH642.js","assets/uk-UA-QMV73CPH-FmM_4KbD.js","assets/vi-VN-M7AON7JQ-HN5ydlSG.js","assets/zh-CN-LNUGB5OW-CmH2BvGG.js","assets/zh-HK-E62DVLB3-CzVyZgtK.js","assets/zh-TW-RAJ6MFWO-C9nUgMc_.js","assets/image-7KUKJ7J4-DkUppARt.js","assets/monaco-BOU7eshl.js","assets/monaco-KC1S3ze4.css","assets/chakra-ui-DL3iEWi3.js","assets/dist-9Gc9wYMS.js","assets/chunk-FX7ZIABN-lkaeJ_Cd.js","assets/chunk-SQ5PDB2P-DyoXY6oy.js","assets/common-utils-6spi2Ajg.js","assets/dist-0fyaNKyr.js","assets/mermaid-b5860b54-Cn3wlJWJ.js","assets/app-HD19YyAJ.js","assets/react-syntax-highlighter-Co-hEK8Y.js","assets/react-markdown-CyVVEHR3.js","assets/react-utils-C9u-5Qte.js","assets/remark-gfm-DTA0tSXW.js","assets/vendor-Ddcx14uX.js","assets/app-542Qqczu.css"])))=>i.map(i=>d[i]);
import{s as e,t}from"./rolldown-runtime-B6ubh40S.js";import{N as n,P as r,w as i}from"./chakra-ui-DL3iEWi3.js";import{o as a}from"./react-syntax-highlighter-Co-hEK8Y.js";import{k as o}from"./react-utils-C9u-5Qte.js";import"./vendor-Ddcx14uX.js";import{n as s}from"./common-utils-6spi2Ajg.js";import{Dn as c}from"./monaco-BOU7eshl.js";import"./react-markdown-CyVVEHR3.js";import"./remark-gfm-DTA0tSXW.js";import{$i as l,$r as u,Ci as d,Cr as f,Hr as p,Si as m,Ti as h,Vr as g,_i as _,ai as v,bi as y,di as b,ea as x,fi as S,gi as ee,mi as te,ni as ne,oi as re,pi as ie,r as ae,ri as oe,ui as se,vi as ce,wi as le,wr as ue,xi as de,yi as fe}from"./app-HD19YyAJ.js";import{t as pe}from"./chunk-SQ5PDB2P-DyoXY6oy.js";import{i as C,n as me,r as he}from"./chunk-SRAX5OIU-CUL6tJFz.js";import{$ as ge,$a as _e,$c as w,$i as ve,$l as ye,$n as be,$o as xe,$r as Se,$s as Ce,$t as we,$u as Te,A as Ee,Aa as De,Ac as Oe,Ai as ke,Al as Ae,An as je,Ao as Me,Ar as Ne,As as Pe,At as Fe,Au as Ie,B as Le,Ba as Re,Bc as T,Bi as ze,Bl as Be,Bn as Ve,Bo as He,Br as Ue,Bs as We,Bt as Ge,Bu as Ke,C as qe,Ca as Je,Cc as Ye,Ci as Xe,Cl as Ze,Cn as Qe,Co as $e,Cr as et,Cs as tt,Ct as nt,Cu as rt,D as it,Da as at,Dc as ot,Di as st,Dl as ct,Dn as lt,Do as ut,Dr as dt,Ds as ft,Dt as pt,Du as mt,E as ht,Ea as gt,Ec as _t,Ei as vt,El as yt,En as bt,Eo as xt,Er as St,Es as Ct,Et as wt,Eu as Tt,F as Et,Fa as Dt,Fc as Ot,Fi as kt,Fl as At,Fn as jt,Fo as Mt,Fr as Nt,Fs as Pt,Ft,Fu as It,G as Lt,Ga as Rt,Gc as zt,Gi as Bt,Gl as Vt,Gn as Ht,Go as Ut,Gr as Wt,Gs as Gt,Gt as Kt,Gu as qt,H as Jt,Ha as Yt,Hc as Xt,Hi as Zt,Hl as Qt,Hn as $t,Ho as en,Hr as tn,Hs as nn,Ht as rn,Hu as an,I as on,Ia as sn,Ic as cn,Ii as ln,Il as un,In as dn,Io as fn,Ir as pn,Is as mn,It as hn,Iu as gn,J as E,Ja as _n,Jc as vn,Ji as yn,Jl as bn,Jn as xn,Jo as Sn,Jr as Cn,Jt as wn,Ju as Tn,K as En,Ka as Dn,Kc as On,Ki as kn,Kl as An,Kn as jn,Ko as Mn,Kr as D,Ks as Nn,Kt as O,Ku as Pn,L as Fn,La as In,Lc as Ln,Li as Rn,Ll as zn,Ln as Bn,Lo as Vn,Lr as Hn,Ls as Un,Lt as Wn,Lu as Gn,M as Kn,Ma as qn,Mc as Jn,Mi as Yn,Ml as Xn,Mn as Zn,Mo as Qn,Mr as $n,Ms as er,Mt as tr,Mu as nr,N as rr,Na as ir,Nc as ar,Ni as or,Nl as sr,Nn as cr,No as k,Nr as lr,Ns as ur,Nt as dr,Nu as fr,O as pr,Oa as mr,Oc as hr,Oi as gr,Ol as _r,On as vr,Oo as yr,Or as br,Os as xr,Ot as Sr,Ou as A,P as Cr,Pa as wr,Pc as Tr,Pi as Er,Pl as Dr,Pn as Or,Po as kr,Pr as Ar,Ps as jr,Pt as Mr,Pu as Nr,Q as Pr,Qa as Fr,Qc as Ir,Qi as Lr,Ql as Rr,Qn as zr,Qo as Br,Qr as Vr,Qs as Hr,Qt as Ur,Qu as Wr,R as Gr,Ra as Kr,Rc as qr,Ri as Jr,Rl as Yr,Rn as j,Ro as Xr,Rr as Zr,Rs as Qr,Rt as $r,Ru as ei,S as ti,Sa as ni,Sc as ri,Si as ii,Sl as ai,Sn as oi,So as si,Sr as ci,Ss as li,St as ui,Su as di,T as fi,Ta as pi,Tc as mi,Ti as hi,Tl as gi,Tn as _i,To as vi,Tr as yi,Ts as bi,Tt as xi,Tu as Si,U as Ci,Ua as wi,Uc as Ti,Ui as Ei,Ul as Di,Un as Oi,Uo as ki,Ur as Ai,Us as ji,Ut as Mi,Uu as Ni,V as Pi,Va as Fi,Vc as Ii,Vi as Li,Vl as Ri,Vn as zi,Vo as Bi,Vr as Vi,Vs as Hi,Vt as Ui,Vu as Wi,W as Gi,Wa as Ki,Wc as qi,Wi as Ji,Wl as Yi,Wn as Xi,Wo as M,Wr as Zi,Ws as Qi,Wt as $i,Wu as ea,X as ta,Xa as na,Xc as ra,Xi as ia,Xl as aa,Xn as oa,Xo as sa,Xr as ca,Xs as la,Xt as ua,Xu as da,Y as fa,Ya as pa,Yc as ma,Yi as ha,Yl as ga,Yn as _a,Yo as N,Yr as va,Ys as ya,Yt as ba,Yu as xa,Z as Sa,Za as Ca,Zc as wa,Zi as Ta,Zl as P,Zn as Ea,Zo as Da,Zr as Oa,Zs as ka,Zt as Aa,Zu as ja,_ as Ma,_a as Na,_c as Pa,_d as Fa,_i as Ia,_l as La,_n as Ra,_o as za,_r as Ba,_s as Va,_t as Ha,_u as Ua,a as Wa,aa as Ga,ac as Ka,ad as F,ai as qa,al as Ja,an as Ya,ao as Xa,ar as Za,as as Qa,at as $a,au as I,b as eo,ba as to,bc as no,bi as ro,bl as io,bn as ao,bo as oo,br as so,bs as co,bt as lo,bu as uo,c as fo,ca as po,cc as mo,cd as ho,ci as go,cl as _o,cn as vo,co as yo,cr as bo,cs as xo,ct as So,cu as Co,d as wo,da as To,dc as Eo,dd as Do,di as Oo,dl as ko,dn as Ao,do as jo,dr as Mo,ds as No,dt as Po,du as Fo,ea as Io,ec as Lo,ed as Ro,ei as zo,el as Bo,en as Vo,eo as Ho,er as Uo,es as Wo,et as Go,eu as Ko,f as qo,fa as Jo,fc as Yo,fd as Xo,fi as Zo,fl as Qo,fn as $o,fo as es,fr as ts,fs as ns,ft as rs,fu as is,g as as,ga as os,gc as ss,gd as L,gi as cs,gl as ls,gn as us,go as ds,gr as fs,gs as ps,gt as ms,gu as hs,h as gs,hc as R,hd as _s,hi as vs,hl as ys,hn as z,ho as bs,hr as xs,hs as Ss,ht as Cs,hu as ws,i as Ts,ia as Es,ic as Ds,id as Os,ii as ks,il as As,in as js,io as Ms,ir as Ns,is as Ps,it as Fs,iu as Is,j as Ls,ja as Rs,jc as zs,ji as Bs,jl as Vs,jn as Hs,jo as Us,jr as Ws,js as Gs,jt as Ks,ju as qs,k as Js,ka as Ys,kc as Xs,ki as Zs,kl as Qs,kn as $s,ko as ec,kr as tc,ks as nc,kt as rc,ku as ic,l as ac,la as oc,lc as sc,ld as cc,li as lc,ll as uc,ln as dc,lo as fc,lr as pc,ls as mc,lt as hc,lu as gc,m as _c,ma as vc,mc as yc,md as bc,mi as xc,ml as Sc,mn as Cc,mo as wc,mr as Tc,ms as Ec,mt as Dc,mu as Oc,n as kc,na as Ac,nc as jc,nd as Mc,ni as Nc,nl as Pc,nn as Fc,nr as Ic,ns as Lc,nt as Rc,nu as zc,o as Bc,oa as Vc,oc as Hc,od as Uc,oi as Wc,ol as Gc,on as Kc,oo as qc,or as Jc,os as Yc,ot as Xc,ou as Zc,p as Qc,pa as B,pc as $c,pd as el,pi as tl,pl as nl,pn as rl,po as V,pr as il,ps as al,pt as ol,pu as sl,q as cl,qa as ll,qc as ul,qi as dl,ql as fl,qn as pl,qo as ml,qr as hl,qs as gl,qt as _l,qu as vl,r as yl,ra as bl,rc as xl,rd as Sl,ri as Cl,rl as wl,rn as Tl,ro as El,rr as Dl,rs as Ol,rt as kl,ru as Al,s as jl,sa as Ml,sc as Nl,sd as Pl,si as Fl,sl as Il,sn as Ll,so as Rl,sr as zl,ss as Bl,st as Vl,su as Hl,t as Ul,ta as Wl,tc as Gl,td as Kl,ti as ql,tl as Jl,tn as Yl,to as Xl,tr as Zl,ts as Ql,tt as $l,tu as eu,u as tu,ua as nu,uc as H,ud as ru,ui as iu,ul as au,un as ou,uo as su,ur as cu,us as lu,ut as uu,uu as du,v as fu,va as pu,vc as mu,vd as hu,vi as gu,vl as _u,vn as vu,vo as yu,vr as bu,vs as xu,vt as U,vu as Su,w as Cu,wa as W,wc as wu,wi as Tu,wl as Eu,wn as Du,wo as Ou,wr as ku,ws as Au,wt as ju,wu as Mu,x as Nu,xa as Pu,xc as Fu,xi as Iu,xl as Lu,xn as Ru,xo as zu,xr as Bu,xs as Vu,xt as Hu,xu as Uu,y as Wu,ya as Gu,yc as Ku,yd as qu,yi as Ju,yl as Yu,yn as Xu,yo as Zu,yr as Qu,ys as $u,yt as ed,yu as td,z as nd,za as rd,zc as id,zi as ad,zl as od,zn as sd,zo as cd,zr as ld,zs as ud,zt as dd,zu as fd}from"./chunk-FX7ZIABN-lkaeJ_Cd.js";import"./dist-9Gc9wYMS.js";import{n as pd}from"./chunk-6U3AYISY-LqBBMT4j.js";import{t as md}from"./chunk-Z3N5DIM6-DG5drBhN.js";import{i as hd,n as gd,r as _d}from"./excalidraw-runtime-BpcmzHJH.js";var vd=se(`CircleDot`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`circle`,{cx:`12`,cy:`12`,r:`1`,key:`41hilf`}]]),yd=se(`Save`,[[`path`,{d:`M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z`,key:`1c8476`}],[`path`,{d:`M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7`,key:`1ydtos`}],[`path`,{d:`M7 3v4a1 1 0 0 0 1 1h7`,key:`t51u73`}]]),G=e(r(),1);function bd({sceneRef:e,excalidrawRef:t,onChange:n}){let{t:r}=u(),{toast:i}=ne(),{openPane:a}=ae(),[o,s]=(0,G.useState)([]),c=(0,G.useCallback)(async a=>{let o={id:Date.now().toString(),role:`user`,content:a,timestamp:Date.now()};s(e=>[...e,o]);let c=(Date.now()+1).toString(),l={id:c,role:`assistant`,content:``,timestamp:Date.now()+1};s(e=>[...e,l]);try{let o=await hd.generateDiagram(a);if(t.current){let r=[...e.current.elements??[],...o];t.current.updateScene({elements:r});let i={elements:r,files:e.current.files};e.current=i,n(i)}s(e=>e.map(e=>e.id===c?{...e,content:r(`excalidraw.diagramGenerated`)}:e)),i({title:r(`excalidraw.generateSuccess`),description:r(`excalidraw.diagramAdded`)})}catch(e){console.error(`Error generating diagram:`,e),s(t=>t.map(t=>t.id===c?{...t,content:e instanceof Error?e.message:r(`excalidraw.generateError`)}:t)),i({title:r(`excalidraw.generateFailed`),description:e instanceof Error?e.message:r(`excalidraw.generateError`),variant:`destructive`})}},[n,i,t,e,r]);return{chatHistory:o,handleAIGenerate:c,openExcalidrawAssistant:(0,G.useCallback)(()=>{a(`excalidraw-agent`,{chatHistory:o,onGenerate:c})},[o,c,a])}}function xd({sceneRef:e,excalidrawRef:t,onChange:n}){let r=f(n);(0,G.useEffect)(()=>{let n={getScene(){return{elements:e.current.elements??[],appState:null,files:e.current.files}},updateScene(n){if(!t.current)return;let i=e.current,a={elements:n.elements??i.elements??[],files:n.files??i.files};t.current.updateScene({elements:a.elements??[]}),e.current=a,r(a)}};return gd(n),()=>_d(n)},[r,e,t])}var K=e(n()),Sd=0;function Cd(e,t){let n=`atom${++Sd}`,r={toString(){return n}};return typeof e==`function`?r.read=e:(r.init=e,r.read=wd,r.write=Td),t&&(r.write=t),r}function wd(e){return e(this)}function Td(e,t,n){return t(this,typeof n==`function`?n(e(this)):n)}var Ed=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,Dd=e=>`init`in e,Od=e=>!!e.write,kd=new WeakMap,Ad=e=>Nd(e)&&!kd.get(e)?.[1],jd=(e,t)=>{let n=kd.get(e);n&&(n[1]=!0,n[0].forEach(e=>e(t)))},Md=e=>{if(kd.has(e))return;let t=[new Set,!1];kd.set(e,t);let n=()=>{t[1]=!0};e.then(n,n),e.onCancel=e=>{t[0].add(e)}},Nd=e=>typeof e?.then==`function`,Pd=e=>`v`in e||`e`in e,Fd=e=>{if(`e`in e)throw e.e;return e.v},Id=(e,t,n)=>{n.p.has(e)||(n.p.add(e),t.then(()=>{n.p.delete(e)},()=>{n.p.delete(e)}))},Ld=(e,t,n,r,i)=>{var a;n.d.set(r,i.n),Ad(n.v)&&Id(t,n.v,i),(a=i.m)==null||a.t.add(t),e&&Vd(e,r,t)},Rd=()=>({D:new Map,H:new Set,M:new Set,L:new Set}),zd=(e,t,n)=>{e[t].add(n)},Bd=(e,t,n)=>{e.D.has(t)||(e.D.set(t,new Set),zd(e,`M`,()=>{var t;(t=n.m)==null||t.l.forEach(t=>zd(e,`M`,t))}))},Vd=(e,t,n)=>{let r=e.D.get(t);r&&r.add(n)},Hd=(e,t)=>e.D.get(t),Ud=e=>{let t,n=!1,r=e=>{try{e()}catch(e){n||=(t=e,!0)}};for(;e.H.size||e.M.size||e.L.size;)e.D.clear(),e.H.forEach(r),e.H.clear(),e.M.forEach(r),e.M.clear(),e.L.forEach(r),e.L.clear();if(n)throw t},Wd=(...[e,t,n,r])=>{let i=(t,n,r)=>{let i=`v`in n,a=n.v,o=Ad(n.v)?n.v:null;if(Nd(r)){Md(r);for(let i of n.d.keys())Id(t,r,e(i));n.v=r}else n.v=r;delete n.e,delete n.x,(!i||!Object.is(a,n.v))&&(++n.n,o&&jd(o,r))},a=(n,r)=>{var o;let s=e(r);if(Pd(s)&&(s.m&&!s.x||Array.from(s.d).every(([e,t])=>a(n,e).n===t)))return s;s.d.clear();let c=!0,l=t=>{if(Ed(r,t)){let n=e(t);if(!Pd(n))if(Dd(t))i(t,n,t.init);else throw Error(`no atom init`);return Fd(n)}let o=a(n,t);try{return Fd(o)}finally{if(c)Ld(n,r,s,t,o);else{let e=Rd();Ld(e,r,s,t,o),d(e,r,s),Ud(e)}}},f,p,m={get signal(){return f||=new AbortController,f.signal},get setSelf(){return!p&&Od(r)&&(p=(...e)=>{if(!c)return u(r,...e)}),p}};try{let e=t(r,l,m);if(i(r,s,e),Nd(e)){(o=e.onCancel)==null||o.call(e,()=>f?.abort());let t=()=>{if(s.m){let e=Rd();d(e,r,s),Ud(e)}};e.then(t,t)}return s}catch(e){return delete s.v,s.e=e,delete s.x,++s.n,s}finally{c=!1}},o=e=>Fd(a(void 0,e)),s=(t,n,r)=>{var i;let a=new Map;for(let t of r.m?.t||[]){let n=e(t);n.m&&a.set(t,n)}for(let t of r.p)a.set(t,e(t));return(i=Hd(t,n))==null||i.forEach(t=>{a.set(t,e(t))}),a},c=(e,t,n)=>{let r=[],i=new Set,o=new Set,c=[[t,n]];for(;c.length>0;){let[t,n]=c[c.length-1];if(o.has(t)){c.pop();continue}if(i.has(t)){r.push([t,n,n.n]),o.add(t),n.x=!0,c.pop();continue}i.add(t);for(let[r,a]of s(e,t,n))t!==r&&!i.has(r)&&c.push([r,a])}zd(e,`H`,()=>{let n=new Set([t]);for(let t=r.length-1;t>=0;--t){let[i,o,s]=r[t],c=!1;for(let e of o.d.keys())if(e!==i&&n.has(e)){c=!0;break}c&&(a(e,i),d(e,i,o),s!==o.n&&(Bd(e,i,o),n.add(i))),delete o.x}})},l=(t,r,...o)=>{let s=!0,u=e=>Fd(a(t,e)),f=(n,...a)=>{let o=e(n);try{if(Ed(r,n)){if(!Dd(n))throw Error(`atom not writable`);let e=o.n,r=a[0];i(n,o,r),d(t,n,o),e!==o.n&&(Bd(t,n,o),c(t,n,o));return}else return l(t,n,...a)}finally{s||Ud(t)}};try{return n(r,u,f,...o)}finally{s=!1}},u=(e,...t)=>{let n=Rd();try{return l(n,e,...t)}finally{Ud(n)}},d=(t,n,r)=>{if(r.m&&!Ad(r.v)){for(let i of r.d.keys())r.m.d.has(i)||(f(t,i,e(i)).t.add(n),r.m.d.add(i));for(let i of r.m.d||[])r.d.has(i)||(r.m.d.delete(i),p(t,i,e(i))?.t.delete(n))}},f=(t,n,i)=>{if(!i.m){a(t,n);for(let r of i.d.keys())f(t,r,e(r)).t.add(n);if(i.m={l:new Set,d:new Set(i.d.keys()),t:new Set},Od(n)){let e=i.m,a,o=(e,t)=>{let r=!0;a=(...t)=>{try{return l(e,n,...t)}finally{r||Ud(e)}};try{return t()}finally{r=!1}};zd(t,`L`,()=>{let i=o(t,()=>r(n,(...e)=>a(...e)));i&&(e.u=e=>o(e,i))})}}return i.m},p=(t,n,r)=>{if(r.m&&!r.m.l.size&&!Array.from(r.m.t).some(t=>e(t).m?.d.has(n))){let i=r.m.u;i&&zd(t,`L`,()=>i(t)),delete r.m;for(let i of r.d.keys())p(t,i,e(i))?.t.delete(n);return}return r.m};return{get:o,set:u,sub:(t,n)=>{let r=Rd(),i=e(t),a=f(r,t,i).l;return a.add(n),Ud(r),()=>{a.delete(n);let e=Rd();p(e,t,i),Ud(e)}},unstable_derive:i=>Wd(...i(e,t,n,r))}},Gd=()=>{let e=new WeakMap;return Wd(t=>{let n=e.get(t);return n||(n={d:new Map,p:new Set,n:0},e.set(t,n)),n},(e,...t)=>e.read(...t),(e,...t)=>e.write(...t),(e,...t)=>e.onMount?.call(e,...t))},Kd,qd=()=>(Kd||=Gd(),Kd),Jd=(0,G.createContext)(void 0),Yd=e=>{let t=(0,G.useContext)(Jd);return e?.store||t||qd()},Xd=e=>typeof e?.then==`function`,Zd=e=>{e.status=`pending`,e.then(t=>{e.status=`fulfilled`,e.value=t},t=>{e.status=`rejected`,e.reason=t})},Qd=G.default.use||(e=>{if(e.status===`pending`)throw e;if(e.status===`fulfilled`)return e.value;throw e.status===`rejected`?e.reason:(Zd(e),e)}),$d=new WeakMap,ef=e=>{let t=$d.get(e);return t||(t=new Promise((n,r)=>{let i=e,a=e=>t=>{i===e&&n(t)},o=e=>t=>{i===e&&r(t)},s=e=>{`onCancel`in e&&typeof e.onCancel==`function`&&e.onCancel(e=>{Xd(e)?($d.set(e,t),i=e,e.then(a(e),o(e)),s(e)):n(e)})};e.then(a(e),o(e)),s(e)}),$d.set(e,t)),t};function tf(e,t){let n=Yd(t),[[r,i,a],o]=(0,G.useReducer)(t=>{let r=n.get(e);return Object.is(t[0],r)&&t[1]===n&&t[2]===e?t:[r,n,e]},void 0,()=>[n.get(e),n,e]),s=r;(i!==n||a!==e)&&(o(),s=n.get(e));let c=t?.delay;return(0,G.useEffect)(()=>{let t=n.sub(e,()=>{if(typeof c==`number`){let t=n.get(e);Xd(t)&&Zd(ef(t)),setTimeout(o,c);return}o()});return o(),t},[n,e,c]),(0,G.useDebugValue)(s),Xd(s)?Qd(ef(s)):s}function nf(e,t){let n=Yd(t);return(0,G.useCallback)((...t)=>n.set(e,...t),[n,e])}function rf(e,t){return[tf(e,t),nf(e,t)]}var af=new WeakMap;function of(e,t){let n=Yd(t),r=sf(n);for(let[i,a]of e)(!r.has(i)||t?.dangerouslyForceHydrate)&&(r.add(i),n.set(i,a))}var sf=e=>{let t=af.get(e);return t||(t=new WeakSet,af.set(e,t)),t};function cf(){return cf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cf.apply(this,arguments)}function lf(){let e=(0,G.createContext)(null);function t({store:t,initialValues:n=[],children:r}){let i=(0,G.useRef)(t);return i.current||=Gd(),of(n,{store:i.current}),(0,K.jsx)(e.Provider,{value:i.current,children:r})}let n=t=>{let n=(0,G.useContext)(e);if(!n)throw Error(`Missing Provider from createIsolation`);return Yd(cf({store:n},t))};return{Provider:t,useStore:n,useAtom:(e,t)=>{let r=n();return rf(e,cf({store:r},t))},useAtomValue:(e,t)=>{let r=n();return tf(e,cf({store:r},t))},useSetAtom:(e,t)=>{let r=n();return nf(e,cf({store:r},t))}}}var{read:uf,write:df}=Cd(null);(0,G.createContext)({scope:void 0,baseStore:void 0});var ff=e(i(),1);function pf(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e?.(r),n===!1||!r.defaultPrevented)return t?.(r)}}function mf(e,t){if(typeof e==`function`)return e(t);e!=null&&(e.current=t)}function hf(...e){return t=>{let n=!1,r=e.map(e=>{let r=mf(e,t);return!n&&typeof r==`function`&&(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){let n=r[t];typeof n==`function`?n():mf(e[t],null)}}}}function gf(...e){return G.useCallback(hf(...e),e)}function _f(e,t=[]){let n=[];function r(t,r){let i=G.createContext(r),a=n.length;n=[...n,r];let o=t=>{let{scope:n,children:r,...o}=t,s=n?.[e]?.[a]||i,c=G.useMemo(()=>o,Object.values(o));return(0,K.jsx)(s.Provider,{value:c,children:r})};o.displayName=t+`Provider`;function s(n,o){let s=o?.[e]?.[a]||i,c=G.useContext(s);if(c)return c;if(r!==void 0)return r;throw Error(`\`${n}\` must be used within \`${t}\``)}return[o,s]}let i=()=>{let t=n.map(e=>G.createContext(e));return function(n){let r=n?.[e]||t;return G.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return i.scopeName=e,[r,vf(i,...t)]}function vf(...e){let t=e[0];if(e.length===1)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return G.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var yf=G.forwardRef((e,t)=>{let{children:n,...r}=e,i=G.Children.toArray(n),a=i.find(Sf);if(a){let e=a.props.children,n=i.map(t=>t===a?G.Children.count(e)>1?G.Children.only(null):G.isValidElement(e)?e.props.children:null:t);return(0,K.jsx)(bf,{...r,ref:t,children:G.isValidElement(e)?G.cloneElement(e,void 0,n):null})}return(0,K.jsx)(bf,{...r,ref:t,children:n})});yf.displayName=`Slot`;var bf=G.forwardRef((e,t)=>{let{children:n,...r}=e;if(G.isValidElement(n)){let e=wf(n),i=Cf(r,n.props);return n.type!==G.Fragment&&(i.ref=t?hf(t,e):e),G.cloneElement(n,i)}return G.Children.count(n)>1?G.Children.only(null):null});bf.displayName=`SlotClone`;var xf=({children:e})=>(0,K.jsx)(K.Fragment,{children:e});function Sf(e){return G.isValidElement(e)&&e.type===xf}function Cf(e,t){let n={...t};for(let r in t){let i=e[r],a=t[r];/^on[A-Z]/.test(r)?i&&a?n[r]=(...e)=>{a(...e),i(...e)}:i&&(n[r]=i):r===`style`?n[r]={...i,...a}:r===`className`&&(n[r]=[i,a].filter(Boolean).join(` `))}return{...e,...n}}function wf(e){let t=Object.getOwnPropertyDescriptor(e.props,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Tf=[`a`,`button`,`div`,`form`,`h2`,`h3`,`img`,`input`,`label`,`li`,`nav`,`ol`,`p`,`span`,`svg`,`ul`].reduce((e,t)=>{let n=G.forwardRef((e,n)=>{let{asChild:r,...i}=e,a=r?yf:t;return typeof window<`u`&&(window[Symbol.for(`radix-ui`)]=!0),(0,K.jsx)(a,{...i,ref:n})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Ef(e,t){e&&ff.flushSync(()=>e.dispatchEvent(t))}function Df(e){let t=G.useRef(e);return G.useEffect(()=>{t.current=e}),G.useMemo(()=>(...e)=>t.current?.(...e),[])}function Of(e,t=globalThis?.document){let n=Df(e);G.useEffect(()=>{let e=e=>{e.key===`Escape`&&n(e)};return t.addEventListener(`keydown`,e,{capture:!0}),()=>t.removeEventListener(`keydown`,e,{capture:!0})},[n,t])}var kf=`DismissableLayer`,Af=`dismissableLayer.update`,jf=`dismissableLayer.pointerDownOutside`,Mf=`dismissableLayer.focusOutside`,Nf,Pf=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ff=G.forwardRef((e,t)=>{let{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:a,onInteractOutside:o,onDismiss:s,...c}=e,l=G.useContext(Pf),[u,d]=G.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=G.useState({}),m=gf(t,e=>d(e)),h=Array.from(l.layers),[g]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),_=h.indexOf(g),v=u?h.indexOf(u):-1,y=l.layersWithOutsidePointerEventsDisabled.size>0,b=v>=_,x=Rf(e=>{let t=e.target,n=[...l.branches].some(e=>e.contains(t));!b||n||(i?.(e),o?.(e),e.defaultPrevented||s?.())},f),S=zf(e=>{let t=e.target;[...l.branches].some(e=>e.contains(t))||(a?.(e),o?.(e),e.defaultPrevented||s?.())},f);return Of(e=>{v===l.layers.size-1&&(r?.(e),!e.defaultPrevented&&s&&(e.preventDefault(),s()))},f),G.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(Nf=f.body.style.pointerEvents,f.body.style.pointerEvents=`none`),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),Bf(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Nf)}},[u,f,n,l]),G.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),Bf())},[u,l]),G.useEffect(()=>{let e=()=>p({});return document.addEventListener(Af,e),()=>document.removeEventListener(Af,e)},[]),(0,K.jsx)(Tf.div,{...c,ref:m,style:{pointerEvents:y?b?`auto`:`none`:void 0,...e.style},onFocusCapture:pf(e.onFocusCapture,S.onFocusCapture),onBlurCapture:pf(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:pf(e.onPointerDownCapture,x.onPointerDownCapture)})});Ff.displayName=kf;var If=`DismissableLayerBranch`,Lf=G.forwardRef((e,t)=>{let n=G.useContext(Pf),r=G.useRef(null),i=gf(t,r);return G.useEffect(()=>{let e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),(0,K.jsx)(Tf.div,{...e,ref:i})});Lf.displayName=If;function Rf(e,t=globalThis?.document){let n=Df(e),r=G.useRef(!1),i=G.useRef(()=>{});return G.useEffect(()=>{let e=e=>{if(e.target&&!r.current){let r=function(){Vf(jf,n,a,{discrete:!0})},a={originalEvent:e};e.pointerType===`touch`?(t.removeEventListener(`click`,i.current),i.current=r,t.addEventListener(`click`,i.current,{once:!0})):r()}else t.removeEventListener(`click`,i.current);r.current=!1},a=window.setTimeout(()=>{t.addEventListener(`pointerdown`,e)},0);return()=>{window.clearTimeout(a),t.removeEventListener(`pointerdown`,e),t.removeEventListener(`click`,i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function zf(e,t=globalThis?.document){let n=Df(e),r=G.useRef(!1);return G.useEffect(()=>{let e=e=>{e.target&&!r.current&&Vf(Mf,n,{originalEvent:e},{discrete:!1})};return t.addEventListener(`focusin`,e),()=>t.removeEventListener(`focusin`,e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Bf(){let e=new CustomEvent(Af);document.dispatchEvent(e)}function Vf(e,t,n,{discrete:r}){let i=n.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?Ef(i,a):i.dispatchEvent(a)}var Hf=0;function Uf(){G.useEffect(()=>{let e=document.querySelectorAll(`[data-radix-focus-guard]`);return document.body.insertAdjacentElement(`afterbegin`,e[0]??Wf()),document.body.insertAdjacentElement(`beforeend`,e[1]??Wf()),Hf++,()=>{Hf===1&&document.querySelectorAll(`[data-radix-focus-guard]`).forEach(e=>e.remove()),Hf--}},[])}function Wf(){let e=document.createElement(`span`);return e.setAttribute(`data-radix-focus-guard`,``),e.tabIndex=0,e.style.outline=`none`,e.style.opacity=`0`,e.style.position=`fixed`,e.style.pointerEvents=`none`,e}var Gf=`focusScope.autoFocusOnMount`,Kf=`focusScope.autoFocusOnUnmount`,qf={bubbles:!1,cancelable:!0},Jf=`FocusScope`,Yf=G.forwardRef((e,t)=>{let{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:a,...o}=e,[s,c]=G.useState(null),l=Df(i),u=Df(a),d=G.useRef(null),f=gf(t,e=>c(e)),p=G.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;G.useEffect(()=>{if(r){let e=function(e){if(p.paused||!s)return;let t=e.target;s.contains(t)?d.current=t:np(d.current,{select:!0})},t=function(e){if(p.paused||!s)return;let t=e.relatedTarget;t!==null&&(s.contains(t)||np(d.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&np(s)};document.addEventListener(`focusin`,e),document.addEventListener(`focusout`,t);let r=new MutationObserver(n);return s&&r.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener(`focusin`,e),document.removeEventListener(`focusout`,t),r.disconnect()}}},[r,s,p.paused]),G.useEffect(()=>{if(s){rp.add(p);let e=document.activeElement;if(!s.contains(e)){let t=new CustomEvent(Gf,qf);s.addEventListener(Gf,l),s.dispatchEvent(t),t.defaultPrevented||(Xf(op(Qf(s)),{select:!0}),document.activeElement===e&&np(s))}return()=>{s.removeEventListener(Gf,l),setTimeout(()=>{let t=new CustomEvent(Kf,qf);s.addEventListener(Kf,u),s.dispatchEvent(t),t.defaultPrevented||np(e??document.body,{select:!0}),s.removeEventListener(Kf,u),rp.remove(p)},0)}}},[s,l,u,p]);let m=G.useCallback(e=>{if(!n&&!r||p.paused)return;let t=e.key===`Tab`&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){let t=e.currentTarget,[r,a]=Zf(t);r&&a?!e.shiftKey&&i===a?(e.preventDefault(),n&&np(r,{select:!0})):e.shiftKey&&i===r&&(e.preventDefault(),n&&np(a,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return(0,K.jsx)(Tf.div,{tabIndex:-1,...o,ref:f,onKeyDown:m})});Yf.displayName=Jf;function Xf(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if(np(r,{select:t}),document.activeElement!==n)return}function Zf(e){let t=Qf(e);return[$f(t,e),$f(t.reverse(),e)]}function Qf(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t=e.tagName===`INPUT`&&e.type===`hidden`;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function $f(e,t){for(let n of e)if(!ep(n,{upTo:t}))return n}function ep(e,{upTo:t}){if(getComputedStyle(e).visibility===`hidden`)return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display===`none`)return!0;e=e.parentElement}return!1}function tp(e){return e instanceof HTMLInputElement&&`select`in e}function np(e,{select:t=!1}={}){if(e&&e.focus){let n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&tp(e)&&t&&e.select()}}var rp=ip();function ip(){let e=[];return{add(t){let n=e[0];t!==n&&n?.pause(),e=ap(e,t),e.unshift(t)},remove(t){e=ap(e,t),e[0]?.resume()}}}function ap(e,t){let n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function op(e){return e.filter(e=>e.tagName!==`A`)}var sp=globalThis?.document?G.useLayoutEffect:()=>{},cp=G.useId||(()=>void 0),lp=0;function up(e){let[t,n]=G.useState(cp());return sp(()=>{e||n(e=>e??String(lp++))},[e]),e||(t?`radix-${t}`:``)}var dp=`Arrow`,fp=G.forwardRef((e,t)=>{let{children:n,width:r=10,height:i=5,...a}=e;return(0,K.jsx)(Tf.svg,{...a,ref:t,width:r,height:i,viewBox:`0 0 30 10`,preserveAspectRatio:`none`,children:e.asChild?n:(0,K.jsx)(`polygon`,{points:`0,0 30,0 15,10`})})});fp.displayName=dp;var pp=fp;function mp(e){let[t,n]=G.useState(void 0);return sp(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{if(!Array.isArray(t)||!t.length)return;let r=t[0],i,a;if(`borderBoxSize`in r){let e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,a=t.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return t.observe(e,{box:`border-box`}),()=>t.unobserve(e)}else n(void 0)},[e]),t}var hp=`Popper`,[gp,_p]=_f(hp),[vp,yp]=gp(hp),bp=e=>{let{__scopePopper:t,children:n}=e,[r,i]=G.useState(null);return(0,K.jsx)(vp,{scope:t,anchor:r,onAnchorChange:i,children:n})};bp.displayName=hp;var xp=`PopperAnchor`,Sp=G.forwardRef((e,t)=>{let{__scopePopper:n,virtualRef:r,...i}=e,a=yp(xp,n),o=G.useRef(null),s=gf(t,o);return G.useEffect(()=>{a.onAnchorChange(r?.current||o.current)}),r?null:(0,K.jsx)(Tf.div,{...i,ref:s})});Sp.displayName=xp;var Cp=`PopperContent`,[wp,Tp]=gp(Cp),Ep=G.forwardRef((e,t)=>{let{__scopePopper:n,side:r=`bottom`,sideOffset:i=0,align:a=`center`,alignOffset:o=0,arrowPadding:s=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:f=`partial`,hideWhenDetached:p=!1,updatePositionStrategy:h=`optimized`,onPlaced:g,...v}=e,b=yp(Cp,n),[x,S]=G.useState(null),te=gf(t,e=>S(e)),[ne,re]=G.useState(null),ie=mp(ne),ae=ie?.width??0,oe=ie?.height??0,se=r+(a===`center`?``:`-`+a),ue=typeof u==`number`?u:{top:0,right:0,bottom:0,left:0,...u},pe=Array.isArray(l)?l:[l],C=pe.length>0,me={padding:ue,boundary:pe.filter(Ap),altBoundary:C},{refs:he,floatingStyles:ge,placement:_e,isPositioned:w,middlewareData:ve}=d({strategy:`fixed`,placement:se,whileElementsMounted:(...e)=>le(...e,{animationFrame:h===`always`}),elements:{reference:b.anchor},middleware:[y({mainAxis:i+oe,alignmentAxis:o}),c&&de({mainAxis:!0,crossAxis:!1,limiter:f===`partial`?fe():void 0,...me}),c&&_({...me}),m({...me,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{let{width:i,height:a}=t.reference,o=e.floating.style;o.setProperty(`--radix-popper-available-width`,`${n}px`),o.setProperty(`--radix-popper-available-height`,`${r}px`),o.setProperty(`--radix-popper-anchor-width`,`${i}px`),o.setProperty(`--radix-popper-anchor-height`,`${a}px`)}}),ne&&ee({element:ne,padding:s}),jp({arrowWidth:ae,arrowHeight:oe}),p&&ce({strategy:`referenceHidden`,...me})]}),[ye,be]=Mp(_e),xe=Df(g);sp(()=>{w&&xe?.()},[w,xe]);let Se=ve.arrow?.x,Ce=ve.arrow?.y,we=ve.arrow?.centerOffset!==0,[Te,Ee]=G.useState();return sp(()=>{x&&Ee(window.getComputedStyle(x).zIndex)},[x]),(0,K.jsx)(`div`,{ref:he.setFloating,"data-radix-popper-content-wrapper":``,style:{...ge,transform:w?ge.transform:`translate(0, -200%)`,minWidth:`max-content`,zIndex:Te,"--radix-popper-transform-origin":[ve.transformOrigin?.x,ve.transformOrigin?.y].join(` `),...ve.hide?.referenceHidden&&{visibility:`hidden`,pointerEvents:`none`}},dir:e.dir,children:(0,K.jsx)(wp,{scope:n,placedSide:ye,onArrowChange:re,arrowX:Se,arrowY:Ce,shouldHideArrow:we,children:(0,K.jsx)(Tf.div,{"data-side":ye,"data-align":be,...v,ref:te,style:{...v.style,animation:w?void 0:`none`}})})})});Ep.displayName=Cp;var Dp=`PopperArrow`,Op={top:`bottom`,right:`left`,bottom:`top`,left:`right`},kp=G.forwardRef(function(e,t){let{__scopePopper:n,...r}=e,i=Tp(Dp,n),a=Op[i.placedSide];return(0,K.jsx)(`span`,{ref:i.onArrowChange,style:{position:`absolute`,left:i.arrowX,top:i.arrowY,[a]:0,transformOrigin:{top:``,right:`0 0`,bottom:`center 0`,left:`100% 0`}[i.placedSide],transform:{top:`translateY(100%)`,right:`translateY(50%) rotate(90deg) translateX(-50%)`,bottom:`rotate(180deg)`,left:`translateY(50%) rotate(-90deg) translateX(50%)`}[i.placedSide],visibility:i.shouldHideArrow?`hidden`:void 0},children:(0,K.jsx)(pp,{...r,ref:t,style:{...r.style,display:`block`}})})});kp.displayName=Dp;function Ap(e){return e!==null}var jp=e=>({name:`transformOrigin`,options:e,fn(t){let{placement:n,rects:r,middlewareData:i}=t,a=i.arrow?.centerOffset!==0,o=a?0:e.arrowWidth,s=a?0:e.arrowHeight,[c,l]=Mp(n),u={start:`0%`,center:`50%`,end:`100%`}[l],d=(i.arrow?.x??0)+o/2,f=(i.arrow?.y??0)+s/2,p=``,m=``;return c===`bottom`?(p=a?u:`${d}px`,m=`${-s}px`):c===`top`?(p=a?u:`${d}px`,m=`${r.floating.height+s}px`):c===`right`?(p=`${-s}px`,m=a?u:`${f}px`):c===`left`&&(p=`${r.floating.width+s}px`,m=a?u:`${f}px`),{data:{x:p,y:m}}}});function Mp(e){let[t,n=`center`]=e.split(`-`);return[t,n]}var Np=bp,Pp=Sp,Fp=Ep,Ip=kp,Lp=e(i(),1),Rp=`Portal`,zp=G.forwardRef((e,t)=>{let{container:n,...r}=e,[i,a]=G.useState(!1);sp(()=>a(!0),[]);let o=n||i&&globalThis?.document?.body;return o?Lp.createPortal((0,K.jsx)(Tf.div,{...r,ref:t}),o):null});zp.displayName=Rp;function Bp(e,t){return G.useReducer((e,n)=>t[e][n]??e,e)}var Vp=e=>{let{present:t,children:n}=e,r=Hp(t),i=typeof n==`function`?n({present:r.isPresent}):G.Children.only(n),a=gf(r.ref,Wp(i));return typeof n==`function`||r.isPresent?G.cloneElement(i,{ref:a}):null};Vp.displayName=`Presence`;function Hp(e){let[t,n]=G.useState(),r=G.useRef({}),i=G.useRef(e),a=G.useRef(`none`),[o,s]=Bp(e?`mounted`:`unmounted`,{mounted:{UNMOUNT:`unmounted`,ANIMATION_OUT:`unmountSuspended`},unmountSuspended:{MOUNT:`mounted`,ANIMATION_END:`unmounted`},unmounted:{MOUNT:`mounted`}});return G.useEffect(()=>{let e=Up(r.current);a.current=o===`mounted`?e:`none`},[o]),sp(()=>{let t=r.current,n=i.current;if(n!==e){let r=a.current,o=Up(t);e?s(`MOUNT`):o===`none`||t?.display===`none`?s(`UNMOUNT`):s(n&&r!==o?`ANIMATION_OUT`:`UNMOUNT`),i.current=e}},[e,s]),sp(()=>{if(t){let e,n=t.ownerDocument.defaultView??window,o=a=>{let o=Up(r.current).includes(a.animationName);if(a.target===t&&o&&(s(`ANIMATION_END`),!i.current)){let r=t.style.animationFillMode;t.style.animationFillMode=`forwards`,e=n.setTimeout(()=>{t.style.animationFillMode===`forwards`&&(t.style.animationFillMode=r)})}},c=e=>{e.target===t&&(a.current=Up(r.current))};return t.addEventListener(`animationstart`,c),t.addEventListener(`animationcancel`,o),t.addEventListener(`animationend`,o),()=>{n.clearTimeout(e),t.removeEventListener(`animationstart`,c),t.removeEventListener(`animationcancel`,o),t.removeEventListener(`animationend`,o)}}else s(`ANIMATION_END`)},[t,s]),{isPresent:[`mounted`,`unmountSuspended`].includes(o),ref:G.useCallback(e=>{e&&(r.current=getComputedStyle(e)),n(e)},[])}}function Up(e){return e?.animationName||`none`}function Wp(e){let t=Object.getOwnPropertyDescriptor(e.props,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,`ref`)?.get,n=t&&`isReactWarning`in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function Gp({prop:e,defaultProp:t,onChange:n=()=>{}}){let[r,i]=Kp({defaultProp:t,onChange:n}),a=e!==void 0,o=a?e:r,s=Df(n);return[o,G.useCallback(t=>{if(a){let n=typeof t==`function`?t(e):t;n!==e&&s(n)}else i(t)},[a,e,i,s])]}function Kp({defaultProp:e,onChange:t}){let n=G.useState(e),[r]=n,i=G.useRef(r),a=Df(t);return G.useEffect(()=>{i.current!==r&&(a(r),i.current=r)},[r,i,a]),n}var qp=`Popover`,[Jp,Yp]=_f(qp,[_p]),Xp=_p(),[Zp,Qp]=Jp(qp),$p=e=>{let{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:a,modal:o=!1}=e,s=Xp(t),c=G.useRef(null),[l,u]=G.useState(!1),[d=!1,f]=Gp({prop:r,defaultProp:i,onChange:a});return(0,K.jsx)(Np,{...s,children:(0,K.jsx)(Zp,{scope:t,contentId:up(),triggerRef:c,open:d,onOpenChange:f,onOpenToggle:G.useCallback(()=>f(e=>!e),[f]),hasCustomAnchor:l,onCustomAnchorAdd:G.useCallback(()=>u(!0),[]),onCustomAnchorRemove:G.useCallback(()=>u(!1),[]),modal:o,children:n})})};$p.displayName=qp;var em=`PopoverAnchor`,tm=G.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=Qp(em,n),a=Xp(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:s}=i;return G.useEffect(()=>(o(),()=>s()),[o,s]),(0,K.jsx)(Pp,{...a,...r,ref:t})});tm.displayName=em;var nm=`PopoverTrigger`,rm=G.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=Qp(nm,n),a=Xp(n),o=gf(t,i.triggerRef),s=(0,K.jsx)(Tf.button,{type:`button`,"aria-haspopup":`dialog`,"aria-expanded":i.open,"aria-controls":i.contentId,"data-state":_m(i.open),...r,ref:o,onClick:pf(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?s:(0,K.jsx)(Pp,{asChild:!0,...a,children:s})});rm.displayName=nm;var im=`PopoverPortal`,[am,om]=Jp(im,{forceMount:void 0}),sm=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,a=Qp(im,t);return(0,K.jsx)(am,{scope:t,forceMount:n,children:(0,K.jsx)(Vp,{present:n||a.open,children:(0,K.jsx)(zp,{asChild:!0,container:i,children:r})})})};sm.displayName=im;var cm=`PopoverContent`,lm=G.forwardRef((e,t)=>{let n=om(cm,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,a=Qp(cm,e.__scopePopover);return(0,K.jsx)(Vp,{present:r||a.open,children:a.modal?(0,K.jsx)(um,{...i,ref:t}):(0,K.jsx)(dm,{...i,ref:t})})});lm.displayName=cm;var um=G.forwardRef((e,t)=>{let n=Qp(cm,e.__scopePopover),r=G.useRef(null),i=gf(t,r),a=G.useRef(!1);return G.useEffect(()=>{let e=r.current;if(e)return x(e)},[]),(0,K.jsx)(l,{as:yf,allowPinchZoom:!0,children:(0,K.jsx)(fm,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:pf(e.onCloseAutoFocus,e=>{e.preventDefault(),a.current||n.triggerRef.current?.focus()}),onPointerDownOutside:pf(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=t.button===0&&t.ctrlKey===!0;a.current=t.button===2||n},{checkForDefaultPrevented:!1}),onFocusOutside:pf(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),dm=G.forwardRef((e,t)=>{let n=Qp(cm,e.__scopePopover),r=G.useRef(!1),i=G.useRef(!1);return(0,K.jsx)(fm,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(r.current||n.triggerRef.current?.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(r.current=!0,t.detail.originalEvent.type===`pointerdown`&&(i.current=!0));let a=t.target;n.triggerRef.current?.contains(a)&&t.preventDefault(),t.detail.originalEvent.type===`focusin`&&i.current&&t.preventDefault()}})}),fm=G.forwardRef((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:a,disableOutsidePointerEvents:o,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:u,...d}=e,f=Qp(cm,n),p=Xp(n);return Uf(),(0,K.jsx)(Yf,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:a,children:(0,K.jsx)(Ff,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>f.onOpenChange(!1),children:(0,K.jsx)(Fp,{"data-state":_m(f.open),role:`dialog`,id:f.contentId,...p,...d,ref:t,style:{...d.style,"--radix-popover-content-transform-origin":`var(--radix-popper-transform-origin)`,"--radix-popover-content-available-width":`var(--radix-popper-available-width)`,"--radix-popover-content-available-height":`var(--radix-popper-available-height)`,"--radix-popover-trigger-width":`var(--radix-popper-anchor-width)`,"--radix-popover-trigger-height":`var(--radix-popper-anchor-height)`}})})})}),pm=`PopoverClose`,mm=G.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=Qp(pm,n);return(0,K.jsx)(Tf.button,{type:`button`,...r,ref:t,onClick:pf(e.onClick,()=>i.onOpenChange(!1))})});mm.displayName=pm;var hm=`PopoverArrow`,gm=G.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=Xp(n);return(0,K.jsx)(Ip,{...i,...r,ref:t})});gm.displayName=hm;function _m(e){return e?`open`:`closed`}var vm=$p,ym=rm,bm=sm,xm=lm,Sm=gm,Cm=e(t(((e,t)=>{(function(){var n=this,r={};e===void 0?n.fuzzy=r:t.exports=r,r.simpleFilter=function(e,t){return t.filter(function(t){return r.test(e,t)})},r.test=function(e,t){return r.match(e,t)!==null},r.match=function(e,t,n){n||={};var r=0,i=[],a=t.length,o=0,s=0,c=n.pre||``,l=n.post||``,u=n.caseSensitive&&t||t.toLowerCase(),d;e=n.caseSensitive&&e||e.toLowerCase();for(var f=0;f<a;f++)d=t[f],u[f]===e[r]?(d=c+d+l,r+=1,s+=1+s):s=0,o+=s,i[i.length]=d;return r===e.length?(o=u===e?1/0:o,{rendered:i.join(``),score:o}):null},r.filter=function(e,t,n){return!t||t.length===0?[]:typeof e==`string`?(n||={},t.reduce(function(t,i,a,o){var s=i;n.extract&&(s=n.extract(i));var c=r.match(e,s,n);return c!=null&&(t[t.length]={string:c.rendered,score:c.score,index:a,original:i}),t},[]).sort(function(e,t){return t.score-e.score||e.index-t.index})):t}})()}))(),1),wm=e(hu(),1),Tm=e(p(),1),{useDebugValue:Em}=G.default,{useSyncExternalStoreWithSelector:Dm}=Tm.default,Om=e=>e;function km(e,t=Om,n){let r=Dm(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Em(r),r}var Am=e=>{let t=typeof e==`function`?g(e):e,n=(e,n)=>km(t,e,n);return Object.assign(n,t),n},jm=e=>e?Am(e):Am,Mm,Nm=typeof window<`u`&&((Mm=window.document)!=null&&Mm.createElement||window.navigator?.product===`ReactNative`)?G.useLayoutEffect:G.useEffect;function Pm(){let e=jm(e=>({current:[],version:0,set:e}));return{In:({children:t})=>{let n=e(e=>e.set),r=e(e=>e.version);return Nm(()=>{n(e=>({version:e.version+1}))},[]),Nm(()=>(n(({current:e})=>({current:[...e,t]})),()=>n(({current:e})=>({current:e.filter(e=>e!==t)}))),[t,r]),null},Out:()=>{let t=e(e=>e.current);return G.createElement(G.Fragment,null,t)}}}function Fm(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e?.(r),n===!1||!r.defaultPrevented)return t?.(r)}}function Im(e,t=[]){let n=[];function r(t,r){let i=(0,G.createContext)(r),a=n.length;n=[...n,r];function o(t){let{scope:n,children:r,...o}=t,s=n?.[e][a]||i,c=(0,G.useMemo)(()=>o,Object.values(o));return(0,G.createElement)(s.Provider,{value:c},r)}function s(n,o){let s=(0,G.useContext)(o?.[e][a]||i);if(s)return s;if(r!==void 0)return r;throw Error(`\`${n}\` must be used within \`${t}\``)}return o.displayName=t+`Provider`,[o,s]}let i=()=>{let t=n.map(e=>(0,G.createContext)(e));return function(n){let r=n?.[e]||t;return(0,G.useMemo)(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return i.scopeName=e,[r,Lm(i,...t)]}function Lm(...e){let t=e[0];if(e.length===1)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return(0,G.useMemo)(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}function Rm(e,t){typeof e==`function`?e(t):e!=null&&(e.current=t)}function zm(...e){return t=>e.forEach(e=>Rm(e,t))}function Bm(...e){return(0,G.useCallback)(zm(...e),e)}var Vm=(0,G.forwardRef)((e,t)=>{let{children:n,...r}=e,i=G.Children.toArray(n),o=i.find(Wm);if(o){let e=o.props.children,n=i.map(t=>t===o?G.Children.count(e)>1?G.Children.only(null):(0,G.isValidElement)(e)?e.props.children:null:t);return(0,G.createElement)(Hm,a({},r,{ref:t}),(0,G.isValidElement)(e)?(0,G.cloneElement)(e,void 0,n):null)}return(0,G.createElement)(Hm,a({},r,{ref:t}),n)});Vm.displayName=`Slot`;var Hm=(0,G.forwardRef)((e,t)=>{let{children:n,...r}=e;return(0,G.isValidElement)(n)?(0,G.cloneElement)(n,{...Gm(r,n.props),ref:zm(t,n.ref)}):G.Children.count(n)>1?G.Children.only(null):null});Hm.displayName=`SlotClone`;var Um=({children:e})=>(0,G.createElement)(G.Fragment,null,e);function Wm(e){return(0,G.isValidElement)(e)&&e.type===Um}function Gm(e,t){let n={...t};for(let r in t){let i=e[r],a=t[r];/^on[A-Z]/.test(r)?i&&a?n[r]=(...e)=>{a(...e),i(...e)}:i&&(n[r]=i):r===`style`?n[r]={...i,...a}:r===`className`&&(n[r]=[i,a].filter(Boolean).join(` `))}return{...e,...n}}function Km(e){let t=e+`CollectionProvider`,[n,r]=Im(t),[i,a]=n(t,{collectionRef:{current:null},itemMap:new Map}),o=e=>{let{scope:t,children:n}=e,r=G.useRef(null),a=G.useRef(new Map).current;return G.createElement(i,{scope:t,itemMap:a,collectionRef:r},n)},s=e+`CollectionSlot`,c=G.forwardRef((e,t)=>{let{scope:n,children:r}=e,i=Bm(t,a(s,n).collectionRef);return G.createElement(Vm,{ref:i},r)}),l=e+`CollectionItemSlot`,u=`data-radix-collection-item`,d=G.forwardRef((e,t)=>{let{scope:n,children:r,...i}=e,o=G.useRef(null),s=Bm(t,o),c=a(l,n);return G.useEffect(()=>(c.itemMap.set(o,{ref:o,...i}),()=>void c.itemMap.delete(o))),G.createElement(Vm,{[u]:``,ref:s},r)});function f(t){let n=a(e+`CollectionConsumer`,t);return G.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])}return[{Provider:o,Slot:c,ItemSlot:d},f,r]}var qm=globalThis!=null&&globalThis.document?G.useLayoutEffect:()=>{},Jm=G.useId||(()=>void 0),Ym=0;function Xm(e){let[t,n]=G.useState(Jm());return qm(()=>{e||n(e=>e??String(Ym++))},[e]),e||(t?`radix-${t}`:``)}i();var Zm=[`a`,`button`,`div`,`h2`,`h3`,`img`,`label`,`li`,`nav`,`ol`,`p`,`span`,`svg`,`ul`].reduce((e,t)=>{let n=(0,G.forwardRef)((e,n)=>{let{asChild:r,...i}=e,o=r?Vm:t;return(0,G.useEffect)(()=>{window[Symbol.for(`radix-ui`)]=!0},[]),(0,G.createElement)(o,a({},i,{ref:n}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Qm(e){let t=(0,G.useRef)(e);return(0,G.useEffect)(()=>{t.current=e}),(0,G.useMemo)(()=>(...e)=>t.current?.call(t,...e),[])}function $m({prop:e,defaultProp:t,onChange:n=()=>{}}){let[r,i]=eh({defaultProp:t,onChange:n}),a=e!==void 0,o=a?e:r,s=Qm(n);return[o,(0,G.useCallback)(t=>{if(a){let n=typeof t==`function`?t(e):t;n!==e&&s(n)}else i(t)},[a,e,i,s])]}function eh({defaultProp:e,onChange:t}){let n=(0,G.useState)(e),[r]=n,i=(0,G.useRef)(r),a=Qm(t);return(0,G.useEffect)(()=>{i.current!==r&&(a(r),i.current=r)},[r,i,a]),n}var th=(0,G.createContext)(void 0);function nh(e){let t=(0,G.useContext)(th);return e||t||`ltr`}var rh=`rovingFocusGroup.onEntryFocus`,ih={bubbles:!1,cancelable:!0},ah=`RovingFocusGroup`,[oh,sh,ch]=Km(ah),[lh,uh]=Im(ah,[ch]),[dh,fh]=lh(ah),ph=(0,G.forwardRef)((e,t)=>(0,G.createElement)(oh.Provider,{scope:e.__scopeRovingFocusGroup},(0,G.createElement)(oh.Slot,{scope:e.__scopeRovingFocusGroup},(0,G.createElement)(mh,a({},e,{ref:t}))))),mh=(0,G.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:l,onEntryFocus:u,...d}=e,f=(0,G.useRef)(null),p=Bm(t,f),m=nh(o),[h=null,g]=$m({prop:s,defaultProp:c,onChange:l}),[_,v]=(0,G.useState)(!1),y=Qm(u),b=sh(n),x=(0,G.useRef)(!1),[S,ee]=(0,G.useState)(0);return(0,G.useEffect)(()=>{let e=f.current;if(e)return e.addEventListener(rh,y),()=>e.removeEventListener(rh,y)},[y]),(0,G.createElement)(dh,{scope:n,orientation:r,dir:m,loop:i,currentTabStopId:h,onItemFocus:(0,G.useCallback)(e=>g(e),[g]),onItemShiftTab:(0,G.useCallback)(()=>v(!0),[]),onFocusableItemAdd:(0,G.useCallback)(()=>ee(e=>e+1),[]),onFocusableItemRemove:(0,G.useCallback)(()=>ee(e=>e-1),[])},(0,G.createElement)(Zm.div,a({tabIndex:_||S===0?-1:0,"data-orientation":r},d,{ref:p,style:{outline:`none`,...e.style},onMouseDown:Fm(e.onMouseDown,()=>{x.current=!0}),onFocus:Fm(e.onFocus,e=>{let t=!x.current;if(e.target===e.currentTarget&&t&&!_){let t=new CustomEvent(rh,ih);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=b().filter(e=>e.focusable);bh([e.find(e=>e.active),e.find(e=>e.id===h),...e].filter(Boolean).map(e=>e.ref.current))}}x.current=!1}),onBlur:Fm(e.onBlur,()=>v(!1))})))}),hh=`RovingFocusGroupItem`,gh=(0,G.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,...s}=e,c=Xm(),l=o||c,u=fh(hh,n),d=u.currentTabStopId===l,f=sh(n),{onFocusableItemAdd:p,onFocusableItemRemove:m}=u;return(0,G.useEffect)(()=>{if(r)return p(),()=>m()},[r,p,m]),(0,G.createElement)(oh.ItemSlot,{scope:n,id:l,focusable:r,active:i},(0,G.createElement)(Zm.span,a({tabIndex:d?0:-1,"data-orientation":u.orientation},s,{ref:t,onMouseDown:Fm(e.onMouseDown,e=>{r?u.onItemFocus(l):e.preventDefault()}),onFocus:Fm(e.onFocus,()=>u.onItemFocus(l)),onKeyDown:Fm(e.onKeyDown,e=>{if(e.key===`Tab`&&e.shiftKey){u.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=yh(e,u.orientation,u.dir);if(t!==void 0){e.preventDefault();let n=f().filter(e=>e.focusable).map(e=>e.ref.current);if(t===`last`)n.reverse();else if(t===`prev`||t===`next`){t===`prev`&&n.reverse();let r=n.indexOf(e.currentTarget);n=u.loop?xh(n,r+1):n.slice(r+1)}setTimeout(()=>bh(n))}})})))}),_h={ArrowLeft:`prev`,ArrowUp:`prev`,ArrowRight:`next`,ArrowDown:`next`,PageUp:`first`,Home:`first`,PageDown:`last`,End:`last`};function vh(e,t){return t===`rtl`?e===`ArrowLeft`?`ArrowRight`:e===`ArrowRight`?`ArrowLeft`:e:e}function yh(e,t,n){let r=vh(e.key,n);if(!(t===`vertical`&&[`ArrowLeft`,`ArrowRight`].includes(r))&&!(t===`horizontal`&&[`ArrowUp`,`ArrowDown`].includes(r)))return _h[r]}function bh(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function xh(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var Sh=ph,Ch=gh,wh=i();function Th(e,t){return(0,G.useReducer)((e,n)=>t[e][n]??e,e)}var Eh=e=>{let{present:t,children:n}=e,r=Dh(t),i=typeof n==`function`?n({present:r.isPresent}):G.Children.only(n),a=Bm(r.ref,i.ref);return typeof n==`function`||r.isPresent?(0,G.cloneElement)(i,{ref:a}):null};Eh.displayName=`Presence`;function Dh(e){let[t,n]=(0,G.useState)(),r=(0,G.useRef)({}),i=(0,G.useRef)(e),a=(0,G.useRef)(`none`),[o,s]=Th(e?`mounted`:`unmounted`,{mounted:{UNMOUNT:`unmounted`,ANIMATION_OUT:`unmountSuspended`},unmountSuspended:{MOUNT:`mounted`,ANIMATION_END:`unmounted`},unmounted:{MOUNT:`mounted`}});return(0,G.useEffect)(()=>{let e=Oh(r.current);a.current=o===`mounted`?e:`none`},[o]),qm(()=>{let t=r.current,n=i.current;if(n!==e){let r=a.current,o=Oh(t);e?s(`MOUNT`):o===`none`||t?.display===`none`?s(`UNMOUNT`):s(n&&r!==o?`ANIMATION_OUT`:`UNMOUNT`),i.current=e}},[e,s]),qm(()=>{if(t){let e=e=>{let n=Oh(r.current).includes(e.animationName);e.target===t&&n&&(0,wh.flushSync)(()=>s(`ANIMATION_END`))},n=e=>{e.target===t&&(a.current=Oh(r.current))};return t.addEventListener(`animationstart`,n),t.addEventListener(`animationcancel`,e),t.addEventListener(`animationend`,e),()=>{t.removeEventListener(`animationstart`,n),t.removeEventListener(`animationcancel`,e),t.removeEventListener(`animationend`,e)}}else s(`ANIMATION_END`)},[t,s]),{isPresent:[`mounted`,`unmountSuspended`].includes(o),ref:(0,G.useCallback)(e=>{e&&(r.current=getComputedStyle(e)),n(e)},[])}}function Oh(e){return e?.animationName||`none`}var kh=`Tabs`,[Ah,jh]=Im(kh,[uh]),Mh=uh(),[Nh,Ph]=Ah(kh),Fh=(0,G.forwardRef)((e,t)=>{let{__scopeTabs:n,value:r,onValueChange:i,defaultValue:o,orientation:s=`horizontal`,dir:c,activationMode:l=`automatic`,...u}=e,d=nh(c),[f,p]=$m({prop:r,onChange:i,defaultProp:o});return(0,G.createElement)(Nh,{scope:n,baseId:Xm(),value:f,onValueChange:p,orientation:s,dir:d,activationMode:l},(0,G.createElement)(Zm.div,a({dir:d,"data-orientation":s},u,{ref:t})))}),Ih=`TabsList`,Lh=(0,G.forwardRef)((e,t)=>{let{__scopeTabs:n,loop:r=!0,...i}=e,o=Ph(Ih,n);return(0,G.createElement)(Sh,a({asChild:!0},Mh(n),{orientation:o.orientation,dir:o.dir,loop:r}),(0,G.createElement)(Zm.div,a({role:`tablist`,"aria-orientation":o.orientation},i,{ref:t})))}),Rh=`TabsTrigger`,zh=(0,G.forwardRef)((e,t)=>{let{__scopeTabs:n,value:r,disabled:i=!1,...o}=e,s=Ph(Rh,n),c=Mh(n),l=Hh(s.baseId,r),u=Uh(s.baseId,r),d=r===s.value;return(0,G.createElement)(Ch,a({asChild:!0},c,{focusable:!i,active:d}),(0,G.createElement)(Zm.button,a({type:`button`,role:`tab`,"aria-selected":d,"aria-controls":u,"data-state":d?`active`:`inactive`,"data-disabled":i?``:void 0,disabled:i,id:l},o,{ref:t,onMouseDown:Fm(e.onMouseDown,e=>{!i&&e.button===0&&e.ctrlKey===!1?s.onValueChange(r):e.preventDefault()}),onKeyDown:Fm(e.onKeyDown,e=>{[` `,`Enter`].includes(e.key)&&s.onValueChange(r)}),onFocus:Fm(e.onFocus,()=>{let e=s.activationMode!==`manual`;!d&&!i&&e&&s.onValueChange(r)})})))}),Bh=`TabsContent`,Vh=(0,G.forwardRef)((e,t)=>{let{__scopeTabs:n,value:r,forceMount:i,children:o,...s}=e,c=Ph(Bh,n),l=Hh(c.baseId,r),u=Uh(c.baseId,r),d=r===c.value,f=(0,G.useRef)(d);return(0,G.useEffect)(()=>{let e=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,G.createElement)(Eh,{present:i||d},({present:n})=>(0,G.createElement)(Zm.div,a({"data-state":d?`active`:`inactive`,"data-orientation":c.orientation,role:`tabpanel`,"aria-labelledby":l,hidden:!n,id:u,tabIndex:0},s,{ref:t,style:{...e.style,animationDuration:f.current?`0s`:void 0}}),n&&o))});function Hh(e,t){return`${e}-trigger-${t}`}function Uh(e,t){return`${e}-content-${t}`}var Wh=Fh,Gh=Lh,Kh=zh,qh=Vh,Jh=e(o(),1);function Yh(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}Yh({},`LaserPointer`,()=>ug);function Xh([e,t,n],[r,i,a]){return[e+r,t+i,n+a]}function Zh([e,t,n],[r,i,a]){return[e-r,t-i,n-a]}function Qh([e,t,n],r){return[e*r,t*r,n*r]}function $h([e,t,n]){return[e/Math.sqrt(e**2+t**2),t/Math.sqrt(e**2+t**2),n]}function eg([e,t,n],r){return[Math.cos(r)*e-Math.sin(r)*t,Math.sin(r)*e+Math.cos(r)*t,n]}function tg(e,t,n){return Xh(e,Qh(Zh(t,e),n))}function ng(e,t,n){return Math.atan2(n[1]-e[1],n[0]-e[0])-Math.atan2(t[1]-e[1],t[0]-e[0])}function rg(e){return Math.atan2(Math.sin(e),Math.cos(e))}function ig([e,t]){return Math.sqrt(e**2+t**2)}function ag([e,t],[n,r]){return Math.sqrt((n-e)**2+(r-t)**2)}function og(e){if(e.length<2)return 0;let t=0;for(let n=1;n<=e.length-1;n++)t+=ag(e[n-1],e[n]);return t+=ag(e[e.length-2],e[e.length-1]),t}var sg=(e,t,n)=>Math.max(t,Math.min(n,e));function cg(e,t,n){let r=ag(t,n);if(r===0)return ag(e,t);let i=sg(((e[0]-t[0])*(n[0]-t[0])+(e[1]-t[1])*(n[1]-t[1]))/r**2,0,1);return ag([t[0]+i*(n[0]-t[0]),t[1]+i*(n[1]-t[1]),e[2]],e)}function lg(e,t){if(t===0||e.length<=2)return e;let n=e[0],r=e[e.length-1],[i,a]=e.reduce(([e,t],i,a)=>{let o=cg(i,n,r);return o>e?[o,a]:[e,t]},[0,-1]);if(i>=t){let i=e[a];return[...lg([n,...e.slice(1,a),i],t).slice(0,-1),i,...lg([i,...e.slice(a,-1),r],t).slice(1)]}else return[n,r]}var ug=class e{static#e=this.defaults={size:2,streamline:.45,simplify:.1,simplifyPhase:`output`,keepHead:!1,sizeMapping:()=>1};static#t=this.constants={cornerDetectionMaxAngle:75,cornerDetectionVariance:e=>e>35?.5:1,maxTailLength:50};constructor(t){this.originalPoints=[],this.stablePoints=[],this.tailPoints=[],this.isFresh=!0,this.options=Object.assign({},e.defaults,t)}get lastPoint(){return this.tailPoints[this.tailPoints.length-1]??this.stablePoints[this.stablePoints.length-1]}addPoint(t){let n=this.originalPoints[this.originalPoints.length-1];if(!(n&&n[0]===t[0]&&n[1]===t[1])){if(this.originalPoints.push(t),this.isFresh){this.isFresh=!1,this.stablePoints.push(t);return}this.options.streamline>0&&(t=tg(this.lastPoint,t,1-this.options.streamline)),this.tailPoints.push(t),og(this.tailPoints)>e.constants.maxTailLength&&this.stabilizeTail()}}close(){this.stabilizeTail()}stabilizeTail(){if(this.options.simplify>0&&this.options.simplifyPhase==`tail`)throw Error(`Not implemented yet`);this.stablePoints.push(...this.tailPoints),this.tailPoints=[]}getSize(e,t,n,r,i){return(e??this.options.size)*this.options.sizeMapping({pressure:t,runningLength:i,currentIndex:n,totalLength:r})}getStrokeOutline(t){if(this.isFresh)return[];let n=[...this.stablePoints,...this.tailPoints];this.options.simplify>0&&this.options.simplifyPhase===`input`&&(n=lg(n,this.options.simplify));let r=n.length;if(r===0)return[];if(r===1){let e=n[0],i=this.getSize(t,e[2],0,r,0);if(i<.5)return[];let a=[];for(let t=0;t<=Math.PI*2;t+=Math.PI/16)a.push(Xh(e,Qh(eg([1,0,0],t),i)));return a.push(Xh(e,Qh([1,0,0],this.getSize(t,e[2],0,r,0)))),a}if(r===2){let e=n[0],i=n[1],a=this.getSize(t,e[2],0,r,0),o=this.getSize(t,i[2],0,r,0);if(a<.5||o<.5)return[];let s=[],c=ng(e,[e[0],e[1]-100,e[2]],i);for(let t=c;t<=Math.PI+c;t+=Math.PI/16)s.push(Xh(e,Qh(eg([1,0,0],t),a)));for(let e=Math.PI+c;e<=Math.PI*2+c;e+=Math.PI/16)s.push(Xh(i,Qh(eg([1,0,0],e),o)));return s.push(s[0]),s}let i=[],a=[],o=0,s=0,c=0,l=0;for(let u=1;u<r-1;u++){let d=n[u-1],f=n[u],p=n[u+1],m=f[2],h=ag(d,f);l+=h,o=s+(h-s)*.2;let g=this.getSize(t,m,u,r,l);if(g===0){c=u+1;continue}let _=$h(Zh(d,f)),v=$h(Zh(p,f)),y=eg(_,Math.PI/2),b=eg(_,-Math.PI/2),x=eg(v,Math.PI/2),S=eg(v,-Math.PI/2),ee=Xh(f,Qh(y,g)),te=Xh(f,Qh(b,g)),ne=Xh(f,Qh(x,g)),re=Xh(f,Qh(S,g)),ie=Xh(y,S),ae=Xh(b,x),oe=Xh(f,Qh(ig(ie)===0?_:$h(ie),g)),se=Xh(f,Qh(ig(ae)===0?v:$h(ae),g)),ce=rg(ng(f,d,p)),le=e.constants.cornerDetectionMaxAngle/180*Math.PI*e.constants.cornerDetectionVariance(o);if(Math.abs(ce)<le){let e=Math.abs(rg(Math.PI-ce));if(e===0)continue;if(ce<0){a.push(te,se);for(let t=0;t<=e;t+=e/4)i.push(Xh(f,eg(Qh(y,g),t)));for(let t=e;t>=0;t-=e/4)a.push(Xh(f,eg(Qh(y,g),t)));a.push(se,ne)}else{i.push(ee,oe);for(let t=0;t<=e;t+=e/4)a.push(Xh(f,eg(Qh(y,-g),-t)));for(let t=e;t>=0;t-=e/4)i.push(Xh(f,eg(Qh(y,-g),-t)));i.push(oe,re)}}else i.push(oe),a.push(se);s=o}if(c>=r-2)if(this.options.keepHead){let e=n[r-1],t=[];for(let n=0;n<=Math.PI*2;n+=Math.PI/16)t.push(Xh(e,Qh(eg([1,0,0],n),this.options.size)));return t.push(Xh(e,Qh([1,0,0],this.options.size))),t}else return[];let u=n[c],d=n[c+1],f=n[r-2],p=n[r-1],m=$h(Zh(d,u)),h=$h(Zh(f,p)),g=eg(m,-Math.PI/2),_=eg(h,Math.PI/2),v=this.getSize(t,u[2],0,r,0),y=[],b=this.options.keepHead?this.options.size:this.getSize(t,f[2],r-2,r,l),x=[];if(v>1){for(let e=0;e<=Math.PI;e+=Math.PI/16)y.unshift(Xh(u,eg(Qh(g,v),-e)));y.unshift(Xh(u,Qh(g,-v)))}else y.push(u);for(let e=0;e<=Math.PI*3;e+=Math.PI/16)x.push(Xh(p,eg(Qh(_,-b),-e)));let S=[...y,...i,...x.reverse(),...a.reverse()];return y.length>0&&S.push(y[0]),this.options.simplify>0&&this.options.simplifyPhase===`output`?lg(S,this.options.simplify):S}},dg=i(),fg=i(),pg=i(),mg=i(),hg=i(),gg=e(hu(),1),_g=e(hu(),1),vg=i(),yg=e(hu(),1),bg=lf(),{useAtom:xg,useSetAtom:Sg,useAtomValue:Cg,useStore:wg}=bg,Tg=bg.Provider,Eg=Gd(),Dg=me({"./locales/ar-SA.json":()=>c(()=>import(`./ar-SA-G6X2FPQ2-DmnyjUFa.js`),__vite__mapDeps([0,1,2])),"./locales/az-AZ.json":()=>c(()=>import(`./az-AZ-76LH7QW2-BiTjbJd6.js`),__vite__mapDeps([3,1,2])),"./locales/bg-BG.json":()=>c(()=>import(`./bg-BG-XCXSNQG7-yG22hcKv.js`),__vite__mapDeps([4,1,2])),"./locales/bn-BD.json":()=>c(()=>import(`./bn-BD-2XOGV67Q-Bp8dTM9S.js`),__vite__mapDeps([5,1,2])),"./locales/ca-ES.json":()=>c(()=>import(`./ca-ES-6MX7JW3Y-0mEDktqi.js`),__vite__mapDeps([6,1,2])),"./locales/cs-CZ.json":()=>c(()=>import(`./cs-CZ-2BRQDIVT-BH8UfJ0u.js`),__vite__mapDeps([7,1,2])),"./locales/da-DK.json":()=>c(()=>import(`./da-DK-5WZEPLOC-Cgkkc8tw.js`),__vite__mapDeps([8,1,2])),"./locales/de-DE.json":()=>c(()=>import(`./de-DE-XR44H4JA-DCEifZ3F.js`),__vite__mapDeps([9,1,2])),"./locales/el-GR.json":()=>c(()=>import(`./el-GR-BZB4AONW-D49BVoRj.js`),__vite__mapDeps([10,1,2])),"./locales/en.json":()=>c(()=>import(`./en-B4ZKOASM-DZA9jnWW.js`),__vite__mapDeps([11,12,1,2])),"./locales/es-ES.json":()=>c(()=>import(`./es-ES-U4NZUMDT-BhJ6vUTG.js`),__vite__mapDeps([13,1,2])),"./locales/eu-ES.json":()=>c(()=>import(`./eu-ES-A7QVB2H4-CMgibXyi.js`),__vite__mapDeps([14,1,2])),"./locales/fa-IR.json":()=>c(()=>import(`./fa-IR-HGAKTJCU-DkerD_Hz.js`),__vite__mapDeps([15,1,2])),"./locales/fi-FI.json":()=>c(()=>import(`./fi-FI-Z5N7JZ37-C-3DS5NO.js`),__vite__mapDeps([16,1,2])),"./locales/fr-FR.json":()=>c(()=>import(`./fr-FR-RHASNOE6-DajaX8dl.js`),__vite__mapDeps([17,1,2])),"./locales/gl-ES.json":()=>c(()=>import(`./gl-ES-HMX3MZ6V-DoVdATMk.js`),__vite__mapDeps([18,1,2])),"./locales/he-IL.json":()=>c(()=>import(`./he-IL-6SHJWFNN-ByyciDdT.js`),__vite__mapDeps([19,1,2])),"./locales/hi-IN.json":()=>c(()=>import(`./hi-IN-IWLTKZ5I-CwIFuzHN.js`),__vite__mapDeps([20,1,2])),"./locales/hu-HU.json":()=>c(()=>import(`./hu-HU-A5ZG7DT2-G9fK6HUG.js`),__vite__mapDeps([21,1,2])),"./locales/id-ID.json":()=>c(()=>import(`./id-ID-SAP4L64H-BpysE6rm.js`),__vite__mapDeps([22,1,2])),"./locales/it-IT.json":()=>c(()=>import(`./it-IT-JPQ66NNP-Dw9mu4Be.js`),__vite__mapDeps([23,1,2])),"./locales/ja-JP.json":()=>c(()=>import(`./ja-JP-DBVTYXUO-DlFd5tFM.js`),__vite__mapDeps([24,1,2])),"./locales/kaa.json":()=>c(()=>import(`./kaa-6HZHGXH3-BQr7t_ee.js`),__vite__mapDeps([25,1,2])),"./locales/kab-KAB.json":()=>c(()=>import(`./kab-KAB-ZGHBKWFO-oWYVl8Ur.js`),__vite__mapDeps([26,1,2])),"./locales/kk-KZ.json":()=>c(()=>import(`./kk-KZ-P5N5QNE5-BGnfbRht.js`),__vite__mapDeps([27,1,2])),"./locales/km-KH.json":()=>c(()=>import(`./km-KH-HSX4SM5Z-C1KvKIcs.js`),__vite__mapDeps([28,1,2])),"./locales/ko-KR.json":()=>c(()=>import(`./ko-KR-MTYHY66A-IdkAKUIq.js`),__vite__mapDeps([29,1,2])),"./locales/ku-TR.json":()=>c(()=>import(`./ku-TR-6OUDTVRD-DN6AmyTq.js`),__vite__mapDeps([30,1,2])),"./locales/lt-LT.json":()=>c(()=>import(`./lt-LT-XHIRWOB4-B34s6i2p.js`),__vite__mapDeps([31,1,2])),"./locales/lv-LV.json":()=>c(()=>import(`./lv-LV-5QDEKY6T-CF2Azy-W.js`),__vite__mapDeps([32,1,2])),"./locales/mr-IN.json":()=>c(()=>import(`./mr-IN-CRQNXWMA-CZpagecR.js`),__vite__mapDeps([33,1,2])),"./locales/my-MM.json":()=>c(()=>import(`./my-MM-5M5IBNSE-CHTcwBRP.js`),__vite__mapDeps([34,1,2])),"./locales/nb-NO.json":()=>c(()=>import(`./nb-NO-T6EIAALU-C0-2HgM4.js`),__vite__mapDeps([35,1,2])),"./locales/nl-NL.json":()=>c(()=>import(`./nl-NL-IS3SIHDZ-B8AHP4NX.js`),__vite__mapDeps([36,1,2])),"./locales/nn-NO.json":()=>c(()=>import(`./nn-NO-6E72VCQL-i112UZUL.js`),__vite__mapDeps([37,1,2])),"./locales/oc-FR.json":()=>c(()=>import(`./oc-FR-POXYY2M6-LEhz7Zxh.js`),__vite__mapDeps([38,1,2])),"./locales/pa-IN.json":()=>c(()=>import(`./pa-IN-N4M65BXN-GAo7ay4p.js`),__vite__mapDeps([39,1,2])),"./locales/percentages.json":()=>c(()=>import(`./percentages-BXMCSKIN-1KLGRqIc.js`),__vite__mapDeps([40,1,2,41])),"./locales/pl-PL.json":()=>c(()=>import(`./pl-PL-T2D74RX3-BhPRiil4.js`),__vite__mapDeps([42,1,2])),"./locales/pt-BR.json":()=>c(()=>import(`./pt-BR-5N22H2LF-DvXhiViu.js`),__vite__mapDeps([43,1,2])),"./locales/pt-PT.json":()=>c(()=>import(`./pt-PT-UZXXM6DQ-vImJ1XNj.js`),__vite__mapDeps([44,1,2])),"./locales/ro-RO.json":()=>c(()=>import(`./ro-RO-JPDTUUEW-Dxaxjc0T.js`),__vite__mapDeps([45,1,2])),"./locales/ru-RU.json":()=>c(()=>import(`./ru-RU-B4JR7IUQ-DjbjG_gS.js`),__vite__mapDeps([46,1,2])),"./locales/si-LK.json":()=>c(()=>import(`./si-LK-N5RQ5JYF-DZucc4jG.js`),__vite__mapDeps([47,1,2])),"./locales/sk-SK.json":()=>c(()=>import(`./sk-SK-C5VTKIMK-BvuwN3Xi.js`),__vite__mapDeps([48,1,2])),"./locales/sl-SI.json":()=>c(()=>import(`./sl-SI-NN7IZMDC-BmqkuQL_.js`),__vite__mapDeps([49,1,2])),"./locales/sv-SE.json":()=>c(()=>import(`./sv-SE-XGPEYMSR-B49JT1HY.js`),__vite__mapDeps([50,1,2])),"./locales/ta-IN.json":()=>c(()=>import(`./ta-IN-2NMHFXQM-Co1_LnJ9.js`),__vite__mapDeps([51,1,2])),"./locales/th-TH.json":()=>c(()=>import(`./th-TH-HPSO5L25-DAJYUzew.js`),__vite__mapDeps([52,1,2])),"./locales/tr-TR.json":()=>c(()=>import(`./tr-TR-DEFEU3FU-DFNfH642.js`),__vite__mapDeps([53,1,2])),"./locales/uk-UA.json":()=>c(()=>import(`./uk-UA-QMV73CPH-FmM_4KbD.js`),__vite__mapDeps([54,1,2])),"./locales/vi-VN.json":()=>c(()=>import(`./vi-VN-M7AON7JQ-HN5ydlSG.js`),__vite__mapDeps([55,1,2])),"./locales/zh-CN.json":()=>c(()=>import(`./zh-CN-LNUGB5OW-CmH2BvGG.js`),__vite__mapDeps([56,1,2])),"./locales/zh-HK.json":()=>c(()=>import(`./zh-HK-E62DVLB3-CzVyZgtK.js`),__vite__mapDeps([57,1,2])),"./locales/zh-TW.json":()=>c(()=>import(`./zh-TW-RAJ6MFWO-C9nUgMc_.js`),__vite__mapDeps([58,1,2]))}),Og=85,kg={code:`en`,label:`English`},Ag=[kg,...[{code:`ar-SA`,label:``,rtl:!0},{code:`bg-BG`,label:``},{code:`ca-ES`,label:`Catal`},{code:`cs-CZ`,label:`esky`},{code:`de-DE`,label:`Deutsch`},{code:`el-GR`,label:``},{code:`es-ES`,label:`Espaol`},{code:`eu-ES`,label:`Euskara`},{code:`fa-IR`,label:``,rtl:!0},{code:`fi-FI`,label:`Suomi`},{code:`fr-FR`,label:`Franais`},{code:`gl-ES`,label:`Galego`},{code:`he-IL`,label:``,rtl:!0},{code:`hi-IN`,label:``},{code:`hu-HU`,label:`Magyar`},{code:`id-ID`,label:`Bahasa Indonesia`},{code:`it-IT`,label:`Italiano`},{code:`ja-JP`,label:``},{code:`kab-KAB`,label:`Taqbaylit`},{code:`kk-KZ`,label:` `},{code:`ko-KR`,label:``},{code:`ku-TR`,label:`Kurd`},{code:`lt-LT`,label:`Lietuvi`},{code:`lv-LV`,label:`Latvieu`},{code:`my-MM`,label:`Burmese`},{code:`nb-NO`,label:`Norsk bokml`},{code:`nl-NL`,label:`Nederlands`},{code:`nn-NO`,label:`Norsk nynorsk`},{code:`oc-FR`,label:`Occitan`},{code:`pa-IN`,label:``},{code:`pl-PL`,label:`Polski`},{code:`pt-BR`,label:`Portugus Brasileiro`},{code:`pt-PT`,label:`Portugus`},{code:`ro-RO`,label:`Romn`},{code:`ru-RU`,label:``},{code:`sk-SK`,label:`Slovenina`},{code:`sv-SE`,label:`Svenska`},{code:`sl-SI`,label:`Slovenina`},{code:`tr-TR`,label:`Trke`},{code:`uk-UA`,label:``},{code:`zh-CN`,label:``},{code:`zh-TW`,label:``},{code:`vi-VN`,label:`Ting Vit`},{code:`mr-IN`,label:``}].filter(e=>md[e.code]>=Og).sort((e,t)=>e.label>t.label?1:-1)],jg=`__test__`;pe.DEV&&Ag.unshift({code:jg,label:`test language`},{code:`${jg}.rtl`,label:`test language (rtl)`,rtl:!0});var Mg=kg,Ng={},Pg=async e=>{if(Mg=e,document.documentElement.dir=Mg.rtl?`rtl`:`ltr`,document.documentElement.lang=Mg.code,e.code.startsWith(jg))Ng={};else try{Ng=await Dg(`./locales/${Mg.code}.json`)}catch(t){console.error(`Failed to load language ${e.code}:`,t.message),Ng=pd}Eg.set(Lg,e.code)},Fg=()=>Mg,Ig=(e,t)=>{for(let n=0;n<t.length;++n){let r=t[n];if(e[r]===void 0)return;e=e[r]}if(typeof e==`string`)return e},q=(e,t,n)=>{if(Mg.code.startsWith(jg))return`\u202A[[${t?`${e}(${JSON.stringify(t).slice(1,-1)})`:e}]]\u202C`;let r=e.split(`.`),i=Ig(Ng,r)||Ig(pd,r)||n;if(i===void 0){let t=`Can't find translation for ${e}`;if(pe.PROD)return console.warn(t),``;throw Error(t)}if(t)for(let e in t)i=i.replace(`{{${e}}}`,String(t[e]));return i},Lg=Cd(kg.code),Rg=()=>({t:q,langCode:Cg(Lg)}),zg=({size:e=`1em`,circleWidth:t=8,synchronized:n=!1,className:r=``})=>{let i=-(G.useRef(Date.now()).current%1600);return(0,K.jsx)(`div`,{className:`Spinner ${r}`,children:(0,K.jsx)(`svg`,{viewBox:`0 0 100 100`,style:{width:e,height:e,"--spinner-delay":n?`${i}ms`:0},children:(0,K.jsx)(`circle`,{cx:`50`,cy:`50`,r:50-t/2,strokeWidth:t,fill:`none`,strokeMiterlimit:`10`})})})},Bg=({delay:e,theme:t})=>{let[n,r]=(0,G.useState)(!!e);return(0,G.useEffect)(()=>{if(!e)return;let t=setTimeout(()=>{r(!1)},e);return()=>clearTimeout(t)},[e]),n?null:(0,K.jsxs)(`div`,{className:L(`LoadingMessage`,{"LoadingMessage--dark":t===R.DARK}),children:[(0,K.jsx)(`div`,{children:(0,K.jsx)(zg,{})}),(0,K.jsx)(`div`,{className:`LoadingMessage-text`,children:q(`labels.loadingScene`)})]})},Vg=e=>{let[t,n]=(0,G.useState)(!0);return(0,G.useEffect)(()=>{let t=async()=>{await Pg(r),n(!1)},r=Ag.find(t=>t.code===e.langCode)||kg;t()},[e.langCode]),t?(0,K.jsx)(Bg,{theme:e.theme}):e.children},J=G.forwardRef(({size:e=`medium`,visible:t=!0,className:n=``,...r},i)=>{let{id:a}=xD(),o=G.useRef(null);G.useImperativeHandle(i,()=>o.current);let s=`ToolIcon_size_${e}`,[c,l]=(0,G.useState)(!1),u=(0,G.useRef)(!0),d=async e=>{let t=`onClick`in r&&r.onClick?.(e);if(Fe(t))try{l(!0),await t}catch(e){if(e instanceof En)console.warn(e);else throw e}finally{u.current&&l(!1)}};(0,G.useEffect)(()=>(u.current=!0,()=>{u.current=!1}),[]);let f=(0,G.useRef)(null);if(r.type===`button`||r.type===`icon`||r.type===`submit`){let e=r.type===`icon`?`button`:r.type;return(0,K.jsxs)(`button`,{className:L(`ToolIcon_type_button`,s,n,t&&!r.hidden?`ToolIcon_type_button--show`:`ToolIcon_type_button--hide`,{ToolIcon:!r.hidden,"ToolIcon--selected":r.selected,"ToolIcon--plain":r.type===`icon`}),style:r.style,"data-testid":r[`data-testid`],hidden:r.hidden,title:r.title,"aria-label":r[`aria-label`],type:e,onClick:d,ref:o,disabled:c||r.isLoading||!!r.disabled,children:[(r.icon||r.label)&&(0,K.jsxs)(`div`,{className:`ToolIcon__icon`,"aria-hidden":`true`,"aria-disabled":!!r.disabled,children:[r.icon||r.label,r.keyBindingLabel&&(0,K.jsx)(`span`,{className:`ToolIcon__keybinding`,children:r.keyBindingLabel}),r.isLoading&&(0,K.jsx)(zg,{})]}),r.showAriaLabel&&(0,K.jsxs)(`div`,{className:`ToolIcon__label`,children:[r[`aria-label`],` `,c&&(0,K.jsx)(zg,{})]}),r.children]})}return(0,K.jsxs)(`label`,{className:L(`ToolIcon`,n),title:r.title,onPointerDown:e=>{f.current=e.pointerType||null,r.onPointerDown?.({pointerType:e.pointerType||null})},onPointerUp:()=>{requestAnimationFrame(()=>{f.current=null})},children:[(0,K.jsx)(`input`,{className:`ToolIcon_type_radio ${s}`,type:`radio`,name:r.name,"aria-label":r[`aria-label`],"aria-keyshortcuts":r[`aria-keyshortcuts`],"data-testid":r[`data-testid`],id:`${a}-${r.id}`,onChange:()=>{r.onChange?.({pointerType:f.current})},checked:r.checked,ref:o}),(0,K.jsxs)(`div`,{className:`ToolIcon__icon`,children:[r.icon,r.keyBindingLabel&&(0,K.jsx)(`span`,{className:`ToolIcon__keybinding`,children:r.keyBindingLabel})]})]})});J.displayName=`ToolButton`;var Hg=(e,t,n)=>{let r=new Set(V(e.filter(e=>M(e)),t).map(e=>e.id)),i={},a=n.scene.getNonDeletedElementsMap(),o=new Set;for(let t of r){let n=Mt(e,t);for(let e of n)if(!o.has(e.id)){if(Ba(e)){let t=ai(e,a);t&&(i[t.id]=!0)}else i[e.id]=!0;o.add(e.id)}}let s=!0,c=e.map(e=>{if(t.selectedElementIds[e.id]){let t=Ba(e)?ai(e,a):null;return e.frameId&&r.has(e.frameId)?(s=!1,i[e.id]=!0,e):t?.frameId&&r.has(t?.frameId)?e:(e.boundElements&&e.boundElements.forEach(t=>{let r=n.scene.getNonDeletedElementsMap().get(t.id);r&&B(r)&&(W(r,{startBinding:e.id===r.startBinding?.elementId?null:r.startBinding,endBinding:e.id===r.endBinding?.elementId?null:r.endBinding}),W(r,{points:r.points}))}),A(e,{isDeleted:!0}))}return e.frameId&&r.has(e.frameId)?(s=!1,Ba(e)||(i[e.id]=!0),A(e,{frameId:null})):Ba(e)&&t.selectedElementIds[e.containerId]?A(e,{isDeleted:!0}):e}),l=t.editingGroupId;if(s&&t.editingGroupId){let e=jo(c,t.editingGroupId).filter(e=>!e.isDeleted);if(e.length>1)e[0]&&(i[e[0].id]=!0);else{l=null,e[0]&&(i[e[0].id]=!0);let n=e[0];if(n){let e=n.groupIds.findIndex(e=>e===t.editingGroupId),r=n.groupIds[e+1];if(r){let e=jo(c,r).filter(e=>!e.isDeleted);e.length>1&&(l=r,e.forEach(e=>{i[e.id]=!0}))}}}}return{elements:c,appState:{...t,...Rl({selectedElementIds:i,editingGroupId:l},c,t,null)}}},Ug=(e,t)=>{if(e.editingGroupId){let n=jo(U(t),e.editingGroupId);if(n.length)return{...e,selectedElementIds:{[n[0].id]:!0}}}return e},Wg=j({name:`deleteSelectedElements`,label:`labels.delete`,icon:Bs,trackEvent:{category:`element`,action:`delete`},perform:(e,t,n,r)=>{if(t.editingLinearElement){let{elementId:n,selectedPointsIndices:i,startBindingElement:a,endBindingElement:o}=t.editingLinearElement,s=r.scene.getNonDeletedElementsMap(),c=F.getElement(n,s);if(!c||i==null)return!1;if(c.points.length<2){let n=e.map(e=>e.id===c.id?A(e,{isDeleted:!0}):e);return{elements:n,appState:{...Ug(t,n),editingLinearElement:null},captureUpdate:N.IMMEDIATELY}}let l={startBindingElement:i?.includes(0)?null:a,endBindingElement:i?.includes(c.points.length-1)?null:o};return F.deletePoints(c,i),{elements:e,appState:{...t,editingLinearElement:{...t.editingLinearElement,...l,selectedPointsIndices:i?.[0]>0?[i[0]-1]:[0]}},captureUpdate:N.IMMEDIATELY}}let{elements:i,appState:a}=Hg(e,t,r);return _i(i,i.filter(e=>e.isDeleted)),a=Ug(a,i),{elements:i,appState:{...a,activeTool:fo(t,{type:`selection`}),multiElement:null,activeEmbeddable:null},captureUpdate:js(U(e),t)?N.IMMEDIATELY:N.EVENTUALLY}},keyTest:(e,t,n)=>(e.key===D.BACKSPACE||e.key===D.DELETE)&&!e[D.CTRL_OR_CMD],PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsx)(J,{type:`button`,icon:Bs,title:q(`labels.delete`),"aria-label":q(`labels.delete`),onClick:()=>n(null),visible:js(U(e),t)})}),Gg=(e,t)=>e.frameId===t||e.id===t,Kg=(e,t,n)=>{let r=[],i=[],a=null,o=-1,s=P(n||V(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0}));for(;++o<e.length;){let t=e[o];s.get(t.id)?(i.length&&(r=r.concat(i),i=[]),r.push(o),a=o+1):t.isDeleted&&a===o?(a=o+1,i.push(o)):i=[]}return r},qg=e=>{let t=0;return e.reduce((n,r,i)=>(i>0&&e[i-1]!==r-1&&(t=++t),(n[t]||(n[t]=[])).push(r),n),[])},Jg=(e,t,n)=>{if(`containerId`in e&&e.containerId){let r=Zs.getScene(e).getElement(e.containerId);if(r)return n===`left`?Math.min(t.indexOf(r),t.indexOf(e)):Math.max(t.indexOf(r),t.indexOf(e))}else{let r=e.boundElements?.find(e=>e.type!==`arrow`)?.id;if(r){let i=Zs.getScene(e).getElement(r);if(i)return n===`left`?Math.min(t.indexOf(i),t.indexOf(e)):Math.max(t.indexOf(i),t.indexOf(e))}}},Yg=(e,t)=>{let n=-1,r=-1;return e.forEach((e,i)=>{Gg(e,t)&&(n===-1&&(n=i),r=i)}),n===-1?[]:e.slice(n,r+1)},Xg=(e,t,n,r,i)=>{let a=t[n],o=t=>t.isDeleted?!1:i?t.frameId===i:e.editingGroupId?t.groupIds.includes(e.editingGroupId):!0,s=r===`left`?au(t,e=>o(e),Math.max(0,n-1)):ps(t,e=>o(e),n+1),c=t[s];if(!c)return-1;if(e.editingGroupId){if(a?.groupIds.join(``)===c?.groupIds.join(``))return Jg(c,t,r)??s;if(!c?.groupIds.includes(e.editingGroupId))return-1}if(!i&&(c.frameId||M(c))){let e=Yg(t,c.frameId||c.id);return r===`left`?t.indexOf(e[0]):t.indexOf(e[e.length-1])}if(!c.groupIds.length)return Jg(c,t,r)??s;let l=jo(t,e.editingGroupId?c.groupIds[c.groupIds.indexOf(e.editingGroupId)-1]:c.groupIds[c.groupIds.length-1]);return l.length?r===`left`?t.indexOf(l[0]):t.indexOf(l[l.length-1]):s},Zg=(e,t)=>t.reduce((t,n)=>{let r=e[n];return t.set(r.id,r),t},new Map),Qg=(e,t,n)=>{let r=Kg(e,t),i=Zg(e,r),a=qg(r);n===`right`&&(a=a.reverse());let o=new Set(r.filter(t=>M(e[t])).map(t=>e[t].id));return a.forEach((r,i)=>{let a=r[0],s=r[r.length-1],c=n===`left`?a:s,l=r.some(t=>{let n=e[t];return n.frameId&&o.has(n.frameId)})?null:e[c]?.frameId,u=Xg(t,e,c,n,l);if(u===-1||c===u)return;let d=n===`left`?e.slice(0,u):e.slice(0,a),f=e.slice(a,s+1),p=n===`left`?e.slice(u,a):e.slice(s+1,u+1),m=n===`left`?e.slice(s+1):e.slice(u+1);e=n===`left`?[...d,...f,...p,...m]:[...d,...p,...f,...m]}),Rt(e,i),e},$g=(e,t,n,r,i)=>{let a=Kg(e,t,i),o=Zg(e,a),s=[],c,l;if(n===`left`){if(r)c=ps(e,e=>Gg(e,r));else if(t.editingGroupId){let n=jo(e,t.editingGroupId);if(!n.length)return e;c=e.indexOf(n[0])}else c=0;l=a[a.length-1]}else{if(r)l=au(e,e=>Gg(e,r));else if(t.editingGroupId){let n=jo(e,t.editingGroupId);if(!n.length)return e;l=e.indexOf(n[n.length-1])}else l=e.length-1;c=a[0]}c===-1&&(c=0);for(let t=c;t<l+1;t++)a.includes(t)||s.push(e[t]);let u=Array.from(o.values()),d=e.slice(0,c),f=e.slice(l+1),p=n===`left`?[...d,...u,...s,...f]:[...d,...s,...u,...f];return Rt(p,o),p};function e_(e,t,n,r){let i=P(V(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0})),a={regularElements:[],frameChildren:new Map},o=new Set;for(let t of e)i.has(t.id)&&M(t)&&o.add(t.id);for(let t of e)if(i.has(t.id))if(M(t)||t.frameId&&o.has(t.frameId))a.regularElements.push(t);else if(!t.frameId)a.regularElements.push(t);else{let e=a.frameChildren.get(t.frameId)||[];e.push(t),a.frameChildren.set(t.frameId,e)}let s=e,c=Array.from(a.frameChildren.entries());for(let[i,a]of c)s=r(e,t,n,i,a);return r(s,t,n,null,a.regularElements)}var t_=(e,t)=>Qg(e,t,`left`),n_=(e,t)=>Qg(e,t,`right`),r_=(e,t)=>e_(e,t,`left`,$g),i_=(e,t)=>e_(e,t,`right`,$g),a_=j({name:`sendBackward`,label:`labels.sendBackward`,keywords:[`move down`,`zindex`,`layer`],icon:Mn,trackEvent:{category:`element`},perform:(e,t)=>({elements:t_(e,t),appState:t,captureUpdate:N.IMMEDIATELY}),keyPriority:40,keyTest:e=>e[D.CTRL_OR_CMD]&&!e.shiftKey&&e.code===E.BRACKET_LEFT,PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(`button`,{type:`button`,className:`zIndexButton`,onClick:()=>e(null),title:`${q(`labels.sendBackward`)} \u2014 ${k(`CtrlOrCmd+[`)}`,children:Mn})}),o_=j({name:`bringForward`,label:`labels.bringForward`,keywords:[`move up`,`zindex`,`layer`],icon:Qt,trackEvent:{category:`element`},perform:(e,t)=>({elements:n_(e,t),appState:t,captureUpdate:N.IMMEDIATELY}),keyPriority:40,keyTest:e=>e[D.CTRL_OR_CMD]&&!e.shiftKey&&e.code===E.BRACKET_RIGHT,PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(`button`,{type:`button`,className:`zIndexButton`,onClick:()=>e(null),title:`${q(`labels.bringForward`)} \u2014 ${k(`CtrlOrCmd+]`)}`,children:Qt})}),s_=j({name:`sendToBack`,label:`labels.sendToBack`,keywords:[`move down`,`zindex`,`layer`],icon:zs,trackEvent:{category:`element`},perform:(e,t)=>({elements:r_(e,t),appState:t,captureUpdate:N.IMMEDIATELY}),keyTest:e=>hs?e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.BRACKET_LEFT:e[D.CTRL_OR_CMD]&&e.shiftKey&&e.code===E.BRACKET_LEFT,PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(`button`,{type:`button`,className:`zIndexButton`,onClick:()=>e(null),title:`${q(`labels.sendToBack`)} \u2014 ${k(hs?`CtrlOrCmd+Alt+[`:`CtrlOrCmd+Shift+[`)}`,children:zs})}),c_=j({name:`bringToFront`,label:`labels.bringToFront`,keywords:[`move up`,`zindex`,`layer`],icon:kr,trackEvent:{category:`element`},perform:(e,t)=>({elements:i_(e,t),appState:t,captureUpdate:N.IMMEDIATELY}),keyTest:e=>hs?e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.BRACKET_RIGHT:e[D.CTRL_OR_CMD]&&e.shiftKey&&e.code===E.BRACKET_RIGHT,PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(`button`,{type:`button`,className:`zIndexButton`,onClick:t=>e(null),title:`${q(`labels.bringToFront`)} \u2014 ${k(hs?`CtrlOrCmd+Alt+]`:`CtrlOrCmd+Shift+]`)}`,children:kr})}),l_=j({name:`selectAll`,label:`labels.selectAll`,icon:Jt,trackEvent:{category:`canvas`},viewMode:!1,perform:(e,t,n,r)=>{if(t.editingLinearElement)return!1;let i=e.filter(e=>!e.isDeleted&&!(H(e)&&e.containerId)&&!e.locked).reduce((e,t)=>(e[t.id]=!0,e),{});return{appState:{...t,...Rl({editingGroupId:null,selectedElementIds:i},U(e),t,r),selectedLinearElement:Object.keys(i).length===1&&fc(e[0])?new F(e[0]):null},captureUpdate:N.IMMEDIATELY}},keyTest:e=>e[D.CTRL_OR_CMD]&&e.key===D.A}),u_=e=>{let t=e.slice(),n=new Set,r=e=>{let t=e[0]?.groupIds?.join(``),n=[e[0]],i=[];for(let r of e.slice(1))r.groupIds?.join(``)===t?n.push(r):i.push(r);return i.length?[...n,...r(i)]:n},i=new Map;return t.forEach((e,a)=>{if(!i.has(e.id))if(e.groupIds?.length){let o=e.groupIds[e.groupIds.length-1],s=t.slice(a).filter(e=>{let t=e?.groupIds?.some(e=>e===o);return t&&i.set(e.id,!0),t});for(let e of r(s))n.add(e)}else n.add(e)}),n.size===e.length?[...n]:(console.error(`normalizeGroupElementOrder: lost some elements... bailing!`),e)},d_=e=>{let t=nc(e),n=e.slice(),r=new Set;return n.forEach((e,i)=>{e&&(e.boundElements?.length?(r.add(e),n[i]=null,e.boundElements.forEach(e=>{let i=t.get(e.id);i&&e.type===`text`&&(r.add(i[0]),n[i[1]]=null)})):e.type===`text`&&e.containerId&&t.get(e.containerId)?.[0].boundElements?.find(t=>t.id===e.id)||(r.add(e),n[i]=null))}),r.size===e.length?[...r]:(console.error(`normalizeBoundElementsOrder: lost some elements... bailing!`),e)},f_=e=>d_(u_(e)),p_=j({name:`duplicateSelection`,label:`labels.duplicateSelection`,icon:Ea,trackEvent:{category:`element`},perform:(e,t,n,r)=>{if(t.editingLinearElement)try{return{elements:e,appState:F.duplicateSelectedPoints(t,r.scene.getNonDeletedElementsMap()),captureUpdate:N.IMMEDIATELY}}catch{return!1}let i=m_(e,t);if(r.props.onDuplicate&&i.elements){let t=r.props.onDuplicate(i.elements,e);t&&(i.elements=t)}return{...i,captureUpdate:N.IMMEDIATELY}},keyTest:e=>e[D.CTRL_OR_CMD]&&e.key===D.D,PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsx)(J,{type:`button`,icon:Ea,title:`${q(`labels.duplicateSelection`)} \u2014 ${k(`CtrlOrCmd+D`)}`,"aria-label":q(`labels.duplicateSelection`),onClick:()=>n(null),visible:js(U(e),t)})}),m_=(e,t)=>{let n=new Map,r=[],i=[],a=new Map,o=new Map,s=P(e),c=e=>{let s=Wa(e).reduce((e,s)=>{if(u.has(s.id))return e;u.set(s.id,!0);let c=ru(t.editingGroupId,n,s,{x:s.x+20/2,y:s.y+20/2});return u.set(c.id,!0),o.set(c.id,c),a.set(s.id,c.id),i.push(s),r.push(c),e.push(c),e},[]);return Array.isArray(e)?s:s[0]||null};e=f_(e);let l=P(V(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0})),u=new Map,d=e.slice(),f=(e,t)=>{as(e!==-1,`targetIndex === -1 `),!(!Array.isArray(t)&&!t)&&d.splice(e+1,0,...Wa(t))},p=new Set(e.filter(e=>l.has(e.id)&&M(e)).map(e=>e.id));for(let n of e){if(u.has(n.id)||!l.has(n.id))continue;let r=Dl(t,n);if(r){let t=jo(e,r).flatMap(t=>M(t)?[...Mt(e,t.id),t]:[t]);f(au(d,e=>e.groupIds?.includes(r)),c(t));continue}if(!(n.frameId&&p.has(n.frameId))){if(M(n)){let t=n.id,r=Mt(e,t);f(au(d,e=>e.frameId===t||e.id===t),c([...r,n]));continue}if(Ou(n)){let e=w(n,s),t=au(d,e=>e.id===n.id||`containerId`in e&&e.containerId===n.id);e?f(t,c([n,e])):f(t,c(n));continue}if(Ba(n)){let e=ai(n,s),t=au(d,t=>t.id===n.id||t.id===e?.id);e?f(t,c([e,n])):f(t,c(n));continue}f(au(d,e=>e.id===n.id),c(n))}}Bi(d,i,a),Qc(d,i,a),Co(d,i,a);let m=lu(r);return{elements:d,appState:{...t,...Rl({editingGroupId:t.editingGroupId,selectedElementIds:m.reduce((e,t)=>(Ba(t)||(e[t.id]=!0),e),{})},U(d),t,null)}}},h_=new Set([`command_palette`,`export`]),Y=(e,t,n,r)=>{try{if(typeof window>`u`||pe.VITE_WORKER_ID||pe.VITE_APP_ENABLE_TRACKING!==`true`||!h_.has(e)||pe.DEV)return;pe.PROD||console.info(`trackEvent`,{category:e,action:t,label:n,value:r}),window.sa_event&&window.sa_event(t,{category:e,label:n,value:r})}catch(e){console.error(`error during analytics`,e)}},g_=(0,G.forwardRef)((e,t)=>{let{title:n,className:r,testId:i,active:a,standalone:o,icon:s,onClick:c}=e;return(0,K.jsx)(`button`,{type:`button`,ref:t,title:n,"data-testid":i,className:L(r,{standalone:o,active:a}),onClick:c,children:s},n)}),__=e=>(0,K.jsx)(`div`,{className:`buttonList`,children:e.options.map(t=>e.type===`button`?(0,K.jsx)(g_,{icon:t.icon,title:t.text,testId:t.testId,active:t.active??e.value===t.value,onClick:n=>e.onClick(t.value,n)},t.text):(0,K.jsxs)(`label`,{className:L({active:e.value===t.value}),title:t.text,children:[(0,K.jsx)(`input`,{type:`radio`,name:e.group,onChange:()=>e.onChange(t.value),checked:e.value===t.value,"data-testid":t.testId}),t.icon]},t.text))}),v_=({onChange:e,type:t,activeColor:n,topPicks:r})=>{let i;return t===`elementStroke`&&(i=bl),t===`elementBackground`&&(i=ho),t===`canvasBackground`&&(i=Cn),r&&(i=r),i?(0,K.jsx)(`div`,{className:`color-picker__top-picks`,children:i.map(t=>(0,K.jsx)(`button`,{className:L(`color-picker__button`,{active:t===n,"is-transparent":t===`transparent`||!t}),style:{"--swatch-color":t},type:`button`,title:t,onClick:()=>e(t),"data-testid":`color-top-pick-${t}`,children:(0,K.jsx)(`div`,{className:`color-picker__button-outline`})},t))}):(console.error(`Invalid type for TopPicks`),null)},y_=()=>(0,K.jsx)(`div`,{style:{width:1,height:`1rem`,backgroundColor:`var(--default-border-color)`,margin:`0 auto`}}),b_=({palette:e,color:t})=>{for(let[n,r]of Object.entries(e))if(Array.isArray(r)){let e=r.indexOf(t);if(e>-1)return{colorName:n,shade:e}}else if(r===t)return{colorName:n,shade:null};return null},x_=[[`q`,`w`,`e`,`r`,`t`],[`a`,`s`,`d`,`f`,`g`],[`z`,`x`,`c`,`v`,`b`]].flat(),S_=({color:e,palette:t})=>!Object.values(t).flat().includes(e),C_=(e,t,n)=>{let r={elementBackground:`backgroundColor`,elementStroke:`strokeColor`},i=e.filter(e=>{if(e.isDeleted)return!1;let i=e[r[t]];return S_({color:i,palette:n})}),a=new Map;return i.forEach(e=>{let n=e[r[t]];a.has(n)?a.set(n,a.get(n)+1):a.set(n,1)}),[...a.entries()].sort((e,t)=>t[1]-e[1]).map(e=>e[0]).slice(0,5)},w_=Cd(null),T_=(e,t,n)=>(e*299+t*587+n*114)/1e3>=160?`black`:`white`,E_=(e,t)=>{if(t){let t=new Option().style;if(t.color=e,t.color){let e=t.color.replace(/^(rgb|rgba)\(/,``).replace(/\)$/,``).replace(/\s/g,``).split(`,`);return T_(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]))}}return e===`transparent`?`black`:T_(parseInt(e.substring(1,3),16),parseInt(e.substring(3,5),16),parseInt(e.substring(5,7),16))},D_=({color:e,keyLabel:t,isCustomColor:n=!1,isShade:r=!1})=>(0,K.jsxs)(`div`,{className:`color-picker__button__hotkey-label`,style:{color:E_(e,n)},children:[r&&``,t]}),O_=({hex:e,onChange:t,palette:n})=>{let r=b_({color:e||`transparent`,palette:n}),[i,a]=xg(w_),o=(0,G.useRef)(null);if((0,G.useEffect)(()=>{o.current&&i===`shades`&&o.current.focus()},[r,i]),r){let{colorName:e,shade:s}=r,c=n[e];if(Array.isArray(c))return(0,K.jsx)(`div`,{className:`color-picker-content--default shades`,children:c.map((n,r)=>(0,K.jsxs)(`button`,{ref:r===s&&i===`shades`?o:void 0,tabIndex:-1,type:`button`,className:L(`color-picker__button color-picker__button--large`,{active:r===s}),"aria-label":`Shade`,title:`${e} - ${r+1}`,style:n?{"--swatch-color":n}:void 0,onClick:()=>{t(n),a(`shades`)},children:[(0,K.jsx)(`div`,{className:`color-picker__button-outline`}),(0,K.jsx)(D_,{color:n,keyLabel:r+1,isShade:!0})]},r))})}return(0,K.jsxs)(`div`,{className:`color-picker-content--default`,style:{position:`relative`},tabIndex:-1,children:[(0,K.jsx)(`button`,{type:`button`,tabIndex:-1,className:`color-picker__button color-picker__button--large color-picker__button--no-focus-visible`}),(0,K.jsx)(`div`,{tabIndex:-1,style:{position:`absolute`,top:0,left:0,right:0,bottom:0,display:`flex`,alignItems:`center`,justifyContent:`center`,textAlign:`center`,fontSize:`0.75rem`},children:q(`colorPicker.noShades`)})]})},k_=({palette:e,color:t,onChange:n,label:r,activeShade:i})=>{let a=b_({color:t||`transparent`,palette:e}),[o,s]=xg(w_),c=(0,G.useRef)(null);return(0,G.useEffect)(()=>{c.current&&o===`baseColors`&&c.current.focus()},[a?.colorName,o]),(0,K.jsx)(`div`,{className:`color-picker-content--default`,children:Object.entries(e).map(([e,t],r)=>{let o=(Array.isArray(t)?t[i]:t)||`transparent`,l=x_[r],u=q(`colors.${e.replace(/\d+/,``)}`,null,``);return(0,K.jsxs)(`button`,{ref:a?.colorName===e?c:void 0,tabIndex:-1,type:`button`,className:L(`color-picker__button color-picker__button--large`,{active:a?.colorName===e,"is-transparent":o===`transparent`||!o}),onClick:()=>{n(o),s(`baseColors`)},title:`${u}${o.startsWith(`#`)?` ${o}`:``} \u2014 ${l}`,"aria-label":`${u} \u2014 ${l}`,style:o?{"--swatch-color":o}:void 0,"data-testid":`color-${e}`,children:[(0,K.jsx)(`div`,{className:`color-picker__button-outline`}),(0,K.jsx)(D_,{color:o,keyLabel:l})]},e)})})},A_=({colors:e,color:t,onChange:n,label:r})=>{let[i,a]=xg(w_),o=(0,G.useRef)(null);return(0,G.useEffect)(()=>{o.current&&o.current.focus()},[t,i]),(0,K.jsx)(`div`,{className:`color-picker-content--default`,children:e.map((e,i)=>(0,K.jsxs)(`button`,{ref:t===e?o:void 0,tabIndex:-1,type:`button`,className:L(`color-picker__button color-picker__button--large`,{active:t===e,"is-transparent":e===`transparent`||!e}),onClick:()=>{n(e),a(`custom`)},title:e,"aria-label":r,style:{"--swatch-color":e},children:[(0,K.jsx)(`div`,{className:`color-picker__button-outline`}),(0,K.jsx)(D_,{color:e,keyLabel:i+1,isCustomColor:!0})]},i))})},j_=(e,t,n)=>{let r=Math.ceil(n/5);switch(t??=-1,e){case`ArrowLeft`:{let e=t-1;return e<0?n-1:e}case`ArrowRight`:return(t+1)%n;case`ArrowDown`:{let e=t+5;return e>=n?t%5:e}case`ArrowUp`:{let e=t-5,i=e<0?5*r+e:e;return i>=n?void 0:i}}},M_=({e,colorObj:t,onChange:n,palette:r,customColors:i,setActiveColorPickerSection:a,activeShade:o})=>{if(t?.shade!=null&&[`Digit1`,`Digit2`,`Digit3`,`Digit4`,`Digit5`].includes(e.code)&&e.shiftKey){let i=Number(e.code.slice(-1))-1;return n(r[t.colorName][i]),a(`shades`),!0}if([`1`,`2`,`3`,`4`,`5`].includes(e.key)&&i[Number(e.key)-1])return n(i[Number(e.key)-1]),a(`custom`),!0;if(x_.includes(e.key)){let t=x_.indexOf(e.key),i=r[Object.keys(r)[t]];return n(Array.isArray(i)?i[o]:i),a(`baseColors`),!0}return!1},N_=({event:e,activeColorPickerSection:t,palette:n,color:r,onChange:i,customColors:a,setActiveColorPickerSection:o,updateData:s,activeShade:c,onEyeDropperToggle:l,onEscape:u})=>{if(e[D.CTRL_OR_CMD])return!1;if(e.key===D.ESCAPE)return u(e),!0;if(e.key===D.ALT)return l(!0),!0;if(e.key===D.I)return l(),!0;let d=b_({color:r,palette:n});if(e.key===D.TAB){let s={custom:!!a.length,baseColors:!0,shades:d?.shade!=null,hex:!0},c=Object.entries(s).reduce((e,[t,n])=>(n&&e.push(t),e),[]),l=c.indexOf(t),u=e.shiftKey?-1:1,f=c[l+u>c.length-1?0:l+u<0?c.length-1:l+u];return f&&o(f),f===`custom`?i(a[0]):f===`baseColors`&&(Object.entries(n).find(([e,t])=>Array.isArray(t)?t.includes(r):t===r?e:null)||i(Dt.black)),e.preventDefault(),e.stopPropagation(),!0}if(M_({e,colorObj:d,onChange:i,palette:n,customColors:a,setActiveColorPickerSection:o,activeShade:c}))return!0;if(t===`shades`&&d){let{shade:t}=d,r=j_(e.key,t,5);if(r!==void 0)return i(n[d.colorName][r]),!0}if(t===`baseColors`&&d){let{colorName:t}=d,r=Object.keys(n),a=r.indexOf(t),o=j_(e.key,a,r.length);if(o!==void 0){let e=n[r[o]];return i(Array.isArray(e)?e[c]:e),!0}}if(t===`custom`){let t=a.indexOf(r),n=j_(e.key,t,a.length);if(n!==void 0){let e=a[n];return i(e),!0}}return!1},P_=({children:e})=>(0,K.jsx)(`div`,{className:`color-picker__heading`,children:e}),F_=({color:e,onChange:t,label:n,type:r,elements:i,palette:a,updateData:o,children:s,onEyeDropperToggle:c,onEscape:l})=>{let[u]=G.useState(()=>r===`canvasBackground`?[]:C_(i,r,a)),[d,f]=xg(w_),p=b_({color:e,palette:a});(0,G.useEffect)(()=>{if(!d){let t=S_({color:e,palette:a});f(t&&!u.includes(e)?`hex`:t?`custom`:p?.shade==null?`baseColors`:`shades`)}},[d,e,a,f,p,u]);let[m,h]=(0,G.useState)(p?.shade??(r===`elementBackground`?1:4));(0,G.useEffect)(()=>{p?.shade!=null&&h(p.shade);let e=e=>{e.key===D.ALT&&c(!1)};return document.addEventListener(`keyup`,e,{capture:!0}),()=>{document.removeEventListener(`keyup`,e,{capture:!0})}},[p,c]);let g=G.useRef(null);return(0,K.jsx)(`div`,{role:`dialog`,"aria-modal":`true`,"aria-label":q(`labels.colorPicker`),children:(0,K.jsxs)(`div`,{ref:g,onKeyDown:n=>{N_({event:n,activeColorPickerSection:d,palette:a,color:e,onChange:t,onEyeDropperToggle:c,customColors:u,setActiveColorPickerSection:f,updateData:o,activeShade:m,onEscape:l})&&(n.preventDefault(),n.stopPropagation())},className:`color-picker-content properties-content`,tabIndex:-1,children:[!!u.length&&(0,K.jsxs)(`div`,{children:[(0,K.jsx)(P_,{children:q(`colorPicker.mostUsedCustomColors`)}),(0,K.jsx)(A_,{colors:u,color:e,label:q(`colorPicker.mostUsedCustomColors`),onChange:t})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(P_,{children:q(`colorPicker.colors`)}),(0,K.jsx)(k_,{color:e,label:n,palette:a,onChange:t,activeShade:m})]}),(0,K.jsxs)(`div`,{children:[(0,K.jsx)(P_,{children:q(`colorPicker.shades`)}),(0,K.jsx)(O_,{hex:e,onChange:t,palette:a})]}),s]})})},I_=G.createContext(null),L_=()=>G.useContext(I_),R_=e=>{let[t,n]=(0,G.useState)(null),r=bD(),{theme:i}=L_(),{container:a}=xD();return(0,G.useLayoutEffect)(()=>{t&&(t.className=``,t.classList.add(`excalidraw`,...e?.className?.split(/\s+/)||[]),t.classList.toggle(`excalidraw--mobile`,r.editor.isMobile),t.classList.toggle(`theme--dark`,i===R.DARK))},[t,i,r.editor.isMobile,e?.className]),(0,G.useLayoutEffect)(()=>{let t=e?.parentSelector?a?.querySelector(e.parentSelector):document.body;if(!t)return;let r=document.createElement(`div`);return t.appendChild(r),n(r),()=>{t.removeChild(r)}},[a,e?.parentSelector]),t};function z_(e,t,n){(0,G.useEffect)(()=>{function r(r){let i=r;if(!e.current)return;let a=n?.(i,e.current);if(a!==!0){if(a===!1)return t(i);e.current.contains(i.target)||!document.documentElement.contains(i.target)||i.target.closest(`[data-radix-portal]`)||i.target===document.documentElement&&document.body.style.pointerEvents===`none`||i.target.closest(`[data-prevent-outside-click]`)||t(i)}}return document.addEventListener(`pointerdown`,r),document.addEventListener(`touchstart`,r),()=>{document.removeEventListener(`pointerdown`,r),document.removeEventListener(`touchstart`,r)}},[e,t,n])}var B_=e=>{let t=(0,G.useRef)(e);return Object.assign(t.current,e),t.current},V_=Cd(null),H_=({onCancel:e,onChange:t,onSelect:n,colorPickerType:r})=>{let i=R_({className:`excalidraw-eye-dropper-backdrop`,parentSelector:`.excalidraw-eye-dropper-container`}),a=L_(),o=SD(),s=vD(),c=B_({app:s,onCancel:e,onChange:t,onSelect:n,selectedElements:V(o,a)}),{container:l}=xD();(0,G.useEffect)(()=>{let e=u.current;if(!e||!s.canvas||!i)return;let t=!1,n=s.canvas.getContext(`2d`),o=({clientX:e,clientY:t})=>{let r=n.getImageData((e-a.offsetLeft)*window.devicePixelRatio,(t-a.offsetTop)*window.devicePixelRatio,1,1).data;return bn(r[0],r[1],r[2])},d=({clientX:n,clientY:i,altKey:a})=>{e.style.top=`${i+20}px`,e.style.left=`${n+20}px`;let s=o({clientX:n,clientY:i});t&&c.onChange(r,s,c.selectedElements,{altKey:a}),e.style.background=s},f=()=>{c.onCancel()},p=(e,t)=>{c.onSelect(e,t)},m=e=>{t=!0,e.stopImmediatePropagation()},h=e=>{t=!1,l?.focus(),e.stopImmediatePropagation(),e.preventDefault(),p(o(e),e)},g=e=>{e.key===D.ESCAPE&&(e.preventDefault(),e.stopImmediatePropagation(),f())};return i.tabIndex=-1,i.focus(),d({clientX:c.app.lastViewportPosition.x,clientY:c.app.lastViewportPosition.y,altKey:!1}),i.addEventListener(`keydown`,g),i.addEventListener(`pointerdown`,m),i.addEventListener(`pointerup`,h),window.addEventListener(`pointermove`,d,{passive:!0}),window.addEventListener(`blur`,f),()=>{t=!1,i.removeEventListener(`keydown`,g),i.removeEventListener(`pointerdown`,m),i.removeEventListener(`pointerup`,h),window.removeEventListener(`pointermove`,d),window.removeEventListener(`blur`,f)}},[c,s.canvas,i,r,l,a.offsetLeft,a.offsetTop]);let u=(0,G.useRef)(null);return z_(u,()=>{e()},e=>!!e.target.closest(`.excalidraw-eye-dropper-trigger, .excalidraw-eye-dropper-backdrop`)),i?(0,fg.createPortal)((0,K.jsx)(`div`,{ref:u,className:`excalidraw-eye-dropper-preview`}),i):null},U_=({color:e,onChange:t,label:n,colorPickerType:r})=>{let i=bD(),[a,o]=(0,G.useState)(e),[s,c]=xg(w_);(0,G.useEffect)(()=>{o(e)},[e]);let l=(0,G.useCallback)(e=>{let n=e.toLowerCase(),r=q_(n);r&&t(r),o(n)},[t]),u=(0,G.useRef)(null),d=(0,G.useRef)(null);(0,G.useEffect)(()=>{u.current&&u.current.focus()},[s]);let[f,p]=xg(V_);return(0,G.useEffect)(()=>()=>{p(null)},[p]),(0,K.jsxs)(`div`,{className:`color-picker__input-label`,children:[(0,K.jsx)(`div`,{className:`color-picker__input-hash`,children:`#`}),(0,K.jsx)(`input`,{ref:s===`hex`?u:void 0,style:{border:0,padding:0},spellCheck:!1,className:`color-picker-input`,"aria-label":n,onChange:e=>{l(e.target.value)},value:(a||``).replace(/^#/,``),onBlur:()=>{o(e)},tabIndex:-1,onFocus:()=>c(`hex`),onKeyDown:e=>{e.key!==D.TAB&&(e.key===D.ESCAPE&&d.current?.focus(),e.stopPropagation())}}),!i.editor.isMobile&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`div`,{style:{width:`1px`,height:`1.25rem`,backgroundColor:`var(--default-border-color)`}}),(0,K.jsx)(`div`,{ref:d,className:L(`excalidraw-eye-dropper-trigger`,{selected:f}),onClick:()=>p(e=>e?null:{keepOpenOnAlt:!1,onSelect:e=>t(e),colorPickerType:r}),title:`${q(`labels.eyeDropper`)} \u2014 ${D.I.toLocaleUpperCase()} or ${k(`Alt`)} `,children:Se})]})]})},W_=G.forwardRef(({children:e,padding:t,className:n,style:r},i)=>(0,K.jsx)(`div`,{className:L(`Island`,n),style:{"--padding":t,...r},ref:i,children:e})),G_=G.forwardRef(({className:e,container:t,children:n,style:r,onClose:i,onKeyDown:a,onFocusOutside:o,onPointerLeave:s,onPointerDownOutside:c},l)=>{let u=bD();return(0,K.jsx)(bm,{container:t,children:(0,K.jsxs)(xm,{ref:l,className:L(`focus-visible-none`,e),"data-prevent-outside-click":!0,side:u.editor.isMobile&&!u.viewport.isLandscape?`bottom`:`right`,align:u.editor.isMobile&&!u.viewport.isLandscape?`center`:`start`,alignOffset:-16,sideOffset:20,style:{zIndex:`var(--zIndex-popup)`},onPointerLeave:s,onKeyDown:a,onFocusOutside:o,onPointerDownOutside:c,onCloseAutoFocus:e=>{e.stopPropagation(),e.preventDefault(),t&&!Lo(document.activeElement)&&t.focus(),i()},children:[(0,K.jsx)(W_,{padding:3,style:r,children:n}),(0,K.jsx)(Sm,{width:20,height:10,style:{fill:`var(--popup-bg-color)`,filter:`drop-shadow(rgba(0, 0, 0, 0.05) 0px 3px 2px)`}})]})})}),K_=e=>{let t=new Option().style;return t.color=e,!!t.color},q_=e=>To(e)?e:K_(`#${e}`)?`#${e}`:K_(e)?e:null,J_=({type:e,color:t,onChange:n,label:r,elements:i,palette:a=Dt,updateData:o})=>{let{container:s}=xD(),[,c]=xg(w_),[l,u]=xg(V_),d=(0,K.jsxs)(`div`,{children:[(0,K.jsx)(P_,{children:q(`colorPicker.hexCode`)}),(0,K.jsx)(U_,{color:t,label:r,onChange:e=>{n(e)},colorPickerType:e})]}),f=(0,G.useRef)(null),p=()=>{f.current?.querySelector(`.color-picker-content`)?.focus()};return(0,K.jsx)(G_,{container:s,style:{maxWidth:`13rem`},onFocusOutside:e=>{p(),e.preventDefault()},onPointerDownOutside:e=>{l&&e.preventDefault()},onClose:()=>{o({openPopup:null}),c(null)},children:a?(0,K.jsx)(F_,{palette:a,color:t,onChange:e=>{n(e)},onEyeDropperToggle:t=>{u(r=>t?(r||={keepOpenOnAlt:!0,onSelect:n,colorPickerType:e},r.keepOpenOnAlt=!0,r):t===!1||r?null:{keepOpenOnAlt:!1,onSelect:n,colorPickerType:e})},onEscape:e=>{l?u(null):o({openPopup:null})},label:r,type:e,elements:i,updateData:o,children:d}):d})},Y_=({label:e,color:t,type:n})=>(0,K.jsx)(ym,{type:`button`,className:L(`color-picker__button active-color properties-trigger`,{"is-transparent":t===`transparent`||!t}),"aria-label":e,style:t?{"--swatch-color":t}:void 0,title:q(n===`elementStroke`?`labels.showStroke`:`labels.showBackground`),children:(0,K.jsx)(`div`,{className:`color-picker__button-outline`})}),X_=({type:e,color:t,onChange:n,label:r,elements:i,palette:a=Dt,topPicks:o,updateData:s,appState:c})=>(0,K.jsx)(`div`,{children:(0,K.jsxs)(`div`,{role:`dialog`,"aria-modal":`true`,className:`color-picker-container`,children:[(0,K.jsx)(v_,{activeColor:t,onChange:n,type:e,topPicks:o}),(0,K.jsx)(y_,{}),(0,K.jsxs)(vm,{open:c.openPopup===e,onOpenChange:t=>{s({openPopup:t?e:null})},children:[(0,K.jsx)(Y_,{color:t,label:r,type:e}),c.openPopup===e&&(0,K.jsx)(J_,{type:e,color:t,onChange:n,label:r,elements:i,palette:a,updateData:s})]})]})}),Z_=({icon:e})=>(0,K.jsx)(`span`,{style:{width:`1em`,margin:`0 0.5ex 0 0.5ex`,display:`inline-block`,lineHeight:0,verticalAlign:`middle`},children:e}),Q_=({label:e,open:t,openTrigger:n,children:r,className:i})=>(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`div`,{style:{cursor:`pointer`,display:`flex`,justifyContent:`space-between`,alignItems:`center`},className:i,onClick:n,children:[e,(0,K.jsx)(Z_,{icon:t?Br:Yi})]}),t&&(0,K.jsx)(`div`,{style:{display:`flex`,flexDirection:`column`},children:r})]}),$_=Cd(!1);function ev({options:e,value:t,label:n,onChange:r,onClose:i,numberOfOptionsToAlwaysShow:a=e.length}){let o=bD(),s=n=>{let o=e.find(e=>e.keyBinding===n.key.toLowerCase());if(!(n.metaKey||n.altKey||n.ctrlKey)&&o)r(o.value),n.preventDefault();else if(n.key===D.TAB){let i=e.findIndex(e=>e.value===t);r(e[n.shiftKey?(e.length+i-1)%e.length:(i+1)%e.length].value)}else if(Pi(n.key)){let i=Fg().rtl,o=e.findIndex(e=>e.value===t);if(o!==-1){let t=e.length,s=o;switch(n.key){case i?D.ARROW_LEFT:D.ARROW_RIGHT:s=(o+1)%t;break;case i?D.ARROW_RIGHT:D.ARROW_LEFT:s=(t+o-1)%t;break;case D.ARROW_DOWN:s=(o+(a??1))%t;break;case D.ARROW_UP:s=(t+o-(a??1))%t;break}r(e[s].value)}n.preventDefault()}else (n.key===D.ESCAPE||n.key===D.ENTER)&&(n.preventDefault(),i());n.nativeEvent.stopImmediatePropagation(),n.stopPropagation()},[c,l]=xg($_),u=G.useMemo(()=>e.slice(0,a),[e,a]),d=G.useMemo(()=>e.slice(a),[e,a]);(0,G.useEffect)(()=>{u.some(e=>e.value===t)||l(!0)},[t,u,l]);let f=e=>(0,K.jsx)(`div`,{className:`picker-content`,children:e.map((e,n)=>(0,K.jsxs)(`button`,{type:`button`,className:L(`picker-option`,{active:t===e.value}),onClick:t=>{r(e.value)},title:`${e.text} ${e.keyBinding&&`\u2014 ${e.keyBinding.toUpperCase()}`}`,"aria-label":e.text||`none`,"aria-keyshortcuts":e.keyBinding||void 0,ref:n=>{t===e.value&&setTimeout(()=>{n?.focus()},0)},children:[e.icon,e.keyBinding&&(0,K.jsx)(`span`,{className:`picker-keybinding`,children:e.keyBinding})]},e.text))});return(0,K.jsx)(xm,{side:o.editor.isMobile&&!o.viewport.isLandscape?`top`:`bottom`,align:`start`,sideOffset:12,style:{zIndex:`var(--zIndex-popup)`},onKeyDown:s,children:(0,K.jsxs)(`div`,{className:`picker`,role:`dialog`,"aria-modal":`true`,"aria-label":n,children:[f(u),d.length>0&&(0,K.jsx)(Q_,{label:q(`labels.more_options`),open:c,openTrigger:()=>{l(e=>!e)},className:`picker-collapsible`,children:f(d)})]})})}function tv({value:e,label:t,options:n,onChange:r,group:i=``,numberOfOptionsToAlwaysShow:a}){let[o,s]=G.useState(!1),c=G.useRef(null);return(0,K.jsx)(`div`,{children:(0,K.jsxs)(vm,{open:o,onOpenChange:e=>s(e),children:[(0,K.jsx)(ym,{name:i,type:`button`,"aria-label":t,onClick:()=>s(!o),ref:c,className:o?`active`:``,children:n.find(t=>t.value===e)?.icon}),o&&(0,K.jsx)(ev,{options:n,value:e,label:t,onChange:r,onClose:()=>{s(!1)},numberOfOptionsToAlwaysShow:a})]})})}var nv=G.forwardRef(({className:e,placeholder:t,onChange:n},r)=>(0,K.jsxs)(`div`,{className:L(`QuickSearch__wrapper`,e),children:[wo,(0,K.jsx)(`input`,{ref:r,className:`QuickSearch__input`,type:`text`,placeholder:t,onChange:e=>n(e.target.value.trim().toLowerCase())})]})),rv=({className:e,placeholder:t,children:n})=>{let r=!G.Children.count(n);return(0,K.jsx)(`div`,{className:L(`ScrollableList__wrapper`,e),role:`menu`,children:r?(0,K.jsx)(`div`,{className:`empty`,children:t}):n})},iv=({children:e,className:t=``,style:n,title:r})=>(0,K.jsxs)(`div`,{className:`dropdown-menu-group ${t}`,style:n,children:[r&&(0,K.jsx)(`p`,{className:`dropdown-menu-group-title`,children:r}),e]}),av=iv;iv.displayName=`DropdownMenuGroup`;var ov=G.createContext({}),sv=(e=``,t=!1,n=!1)=>`dropdown-menu-item dropdown-menu-item-base ${e}
  ${t?`dropdown-menu-item--selected`:``} ${n?`dropdown-menu-item--hovered`:``}`.trim(),cv=(e,t)=>{let n=(0,G.useContext)(ov);return st(e,e=>{let r=new CustomEvent(`menu.itemSelect`,{bubbles:!0,cancelable:!0});t?.(r),r.defaultPrevented||n.onSelect?.(r)})},lv=({textStyle:e,icon:t,shortcut:n,children:r})=>{let i=bD();return(0,K.jsxs)(K.Fragment,{children:[t&&(0,K.jsx)(`div`,{className:`dropdown-menu-item__icon`,children:t}),(0,K.jsx)(`div`,{style:e,className:`dropdown-menu-item__text`,children:r}),n&&!i.editor.isMobile&&(0,K.jsx)(`div`,{className:`dropdown-menu-item__shortcut`,children:n})]})},uv=({icon:e,value:t,order:n,children:r,shortcut:i,className:a,hovered:o,selected:s,textStyle:c,onSelect:l,onClick:u,...d})=>{let f=cv(u,l),p=(0,G.useRef)(null);return(0,G.useEffect)(()=>{o&&(n===0?p.current?.scrollIntoView({block:`end`}):p.current?.scrollIntoView({block:`nearest`}))},[o,n]),(0,K.jsx)(`button`,{...d,ref:p,value:t,onClick:f,className:sv(a,s,o),title:d.title??d[`aria-label`],children:(0,K.jsx)(lv,{textStyle:c,icon:e,shortcut:i,children:r})})};uv.displayName=`DropdownMenuItem`;var dv={GREEN:`green`,RED:`red`,BLUE:`blue`},fv=({type:e=dv.BLUE,children:t})=>{let{theme:n}=CD(),r={display:`inline-flex`,marginLeft:`auto`,padding:`2px 4px`,borderRadius:6,fontSize:9,fontFamily:`Cascadia, monospace`,border:n===R.LIGHT?`1.5px solid white`:`none`};switch(e){case dv.GREEN:Object.assign(r,{backgroundColor:`var(--background-color-badge)`,color:`var(--color-badge)`});break;case dv.RED:Object.assign(r,{backgroundColor:`pink`,color:`darkred`});break;case dv.BLUE:default:Object.assign(r,{background:`var(--color-promo)`,color:`var(--color-surface-lowest)`})}return(0,K.jsx)(`div`,{className:`DropDownMenuItemBadge`,style:r,children:t})};fv.displayName=`DropdownMenuItemBadge`,uv.Badge=fv;var pv=uv,mv=({event:e,inputRef:t,hoveredFont:n,filteredFonts:r,onClose:i,onSelect:a,onHover:o})=>{if(!e[D.CTRL_OR_CMD]&&e.shiftKey&&e.key.toLowerCase()===D.F)return t.current?.focus(),!0;if(e.key===D.ESCAPE)return i(),!0;if(e.key===D.ENTER)return n?.value&&a(n.value),!0;if(e.key===D.ARROW_DOWN)return n?.next?o(n.next.value):r[0]?.value&&o(r[0].value),!0;if(e.key===D.ARROW_UP)return n?.prev?o(n.prev.value):r[r.length-1]?.value&&o(r[r.length-1].value),!0},hv=G.memo(({selectedFontFamily:e,hoveredFontFamily:t,onSelect:n,onHover:r,onLeave:i,onOpen:a,onClose:o})=>{let{container:s}=xD(),{fonts:c}=vD(),{showDeprecatedFonts:l}=yD(),[u,d]=(0,G.useState)(``),f=(0,G.useRef)(null),p=(0,G.useMemo)(()=>Array.from(Qu.registered.entries()).filter(([e,{metadata:t}])=>!t.serverSide&&!t.fallback).map(([e,{metadata:t,fontFaces:n}])=>{let r={value:e,icon:t.icon??Xs,text:n[0]?.fontFace?.family??`Unknown`};return t.deprecated&&Object.assign(r,{deprecated:t.deprecated,badge:{type:dv.RED,placeholder:q(`fontList.badge.old`)}}),r}).sort((e,t)=>e.text.toLowerCase()>t.text.toLowerCase()?1:-1),[]),m=(0,G.useMemo)(()=>new Set(c.getSceneFamilies()),[e]),h=(0,G.useMemo)(()=>p.filter(e=>m.has(e.value)),[p,m]),g=(0,G.useMemo)(()=>p.filter(e=>!m.has(e.value)&&(l||!e.deprecated)),[p,m,l]),_=(0,G.useMemo)(()=>an([...h,...g].filter(e=>e.text?.toLowerCase().includes(u))),[h,g,u]),v=(0,G.useMemo)(()=>{let n;return t?n=_.find(e=>e.value===t):e&&(n=_.find(t=>t.value===e)),!n&&u&&(_[0]?.value?r(_[0].value):i()),n},[t,e,u,_,r,i]),y=(0,G.useCallback)(e=>{mv({event:e,inputRef:f,hoveredFont:v,filteredFonts:_,onSelect:n,onHover:r,onClose:o})&&(e.preventDefault(),e.stopPropagation())},[v,_,n,r,o]);(0,G.useEffect)(()=>(a(),()=>{o()}),[]);let b=(0,G.useMemo)(()=>_.filter(e=>m.has(e.value)),[_,m]),x=(0,G.useMemo)(()=>_.filter(e=>!m.has(e.value)),[_,m]),S=(t,i)=>(0,K.jsxs)(pv,{icon:t.icon,value:t.value,order:i,textStyle:{fontFamily:Ql({fontFamily:t.value})},hovered:t.value===v?.value,selected:t.value===e,tabIndex:t.value===e?0:-1,onClick:e=>{n(Number(e.currentTarget.value))},onMouseMove:()=>{v?.value!==t.value&&r(t.value)},children:[t.text,t.badge&&(0,K.jsx)(fv,{type:t.badge.type,children:t.badge.placeholder})]},t.value),ee=[];return b.length&&ee.push((0,K.jsx)(av,{title:q(`fontList.sceneFonts`),children:b.map(S)},`group_1`)),x.length&&ee.push((0,K.jsx)(av,{title:q(`fontList.availableFonts`),children:x.map((e,t)=>S(e,t+b.length))},`group_2`)),(0,K.jsxs)(G_,{className:`properties-content`,container:s,style:{width:`15rem`},onClose:o,onPointerLeave:i,onKeyDown:y,children:[(0,K.jsx)(nv,{ref:f,placeholder:q(`quickSearch.placeholder`),onChange:jl(d,20)}),(0,K.jsx)(rv,{className:`dropdown-menu fonts manual-hover`,placeholder:q(`fontList.empty`),children:ee.length?ee:null})]})},(e,t)=>e.selectedFontFamily===t.selectedFontFamily&&e.hoveredFontFamily===t.hoveredFontFamily),gv=({selectedFontFamily:e})=>{let t=(0,G.useMemo)(()=>!!(e&&!yv(e)),[e]);return(0,K.jsx)(ym,{asChild:!0,children:(0,K.jsx)(`div`,{children:(0,K.jsx)(g_,{standalone:!0,icon:gs,title:q(`labels.showFonts`),className:`properties-trigger`,testId:`font-family-show-fonts`,active:t,onClick:()=>{}})})})},_v=[{value:Ya.Excalifont,icon:Bu,text:q(`labels.handDrawn`),testId:`font-family-hand-drawn`},{value:Ya.Nunito,icon:Xs,text:q(`labels.normal`),testId:`font-family-normal`},{value:Ya[`Comic Shanns`],icon:Jr,text:q(`labels.code`),testId:`font-family-code`}],vv=new Set(_v.map(e=>e.value)),yv=e=>e?vv.has(e):!1,bv=G.memo(({isOpened:e,selectedFontFamily:t,hoveredFontFamily:n,onSelect:r,onHover:i,onLeave:a,onPopupChange:o})=>{let s=(0,G.useMemo)(()=>_v,[]),c=(0,G.useCallback)(e=>{e&&r(e)},[r]);return(0,K.jsxs)(`div`,{role:`dialog`,"aria-modal":`true`,className:`FontPicker__container`,children:[(0,K.jsx)(__,{type:`button`,options:s,value:t,onClick:c}),(0,K.jsx)(y_,{}),(0,K.jsxs)(vm,{open:e,onOpenChange:o,children:[(0,K.jsx)(gv,{selectedFontFamily:t}),e&&(0,K.jsx)(hv,{selectedFontFamily:t,hoveredFontFamily:n,onSelect:c,onHover:i,onLeave:a,onOpen:()=>o(!0),onClose:()=>o(!1)})]})]})},(e,t)=>e.isOpened===t.isOpened&&e.selectedFontFamily===t.selectedFontFamily&&e.hoveredFontFamily===t.hoveredFontFamily),xv=({updateData:e,appState:t,elements:n,testId:r})=>{let i=G.useRef(null),a=G.useRef(null),o=wv(n,t,e=>e.opacity,!0,t.currentItemOpacity);return(0,G.useEffect)(()=>{if(i.current&&a.current){let e=i.current,t=a.current,n=e.offsetWidth,r=o/100*(n-15)+15/2;t.style.left=`${r}px`,e.style.background=`linear-gradient(to right, var(--color-slider-track) 0%, var(--color-slider-track) ${o}%, var(--button-bg) ${o}%, var(--button-bg) 100%)`}},[o]),(0,K.jsxs)(`label`,{className:`control-label`,children:[q(`labels.opacity`),(0,K.jsxs)(`div`,{className:`range-wrapper`,children:[(0,K.jsx)(`input`,{ref:i,type:`range`,min:`0`,max:`100`,step:`10`,onChange:t=>{e(+t.target.value)},value:o,className:`range-input`,"data-testid":r}),(0,K.jsx)(`div`,{className:`value-bubble`,ref:a,children:o===0?null:o}),(0,K.jsx)(`div`,{className:`zero-label`,children:`0`})]})]})},Sv=.1,Cv=(e,t,n,r=!1)=>{let i=P(V(e,t,{includeBoundTextElement:r}));return e.map(e=>i.get(e.id)||e.id===t.editingTextElement?.id?n(e):e)},wv=function(e,t,n,r,i){let a=t.editingTextElement,o=U(e),s=null;return a&&(s=n(a)),s||=js(o,t)?Nr(r===!0?o:o.filter(e=>r(e)),t,n)??(typeof i==`function`?i(!0):i):typeof i==`function`?i(!1):i,s},Tv=(e,t)=>Ba(t)||!t.autoResize?t:W(t,{x:e.textAlign===`left`?e.x:e.x+(e.width-t.width)/(e.textAlign===`center`?2:1),y:e.y+(e.height-t.height)/2},!1),Ev=(e,t,n,r,i)=>{let a=new Set,o=Cv(e,t,e=>{if(H(e)){let t=r(e);a.add(t);let i=A(e,{fontSize:t});return pu(i,n.scene.getContainerElement(e),n.scene.getNonDeletedElementsMap()),i=Tv(e,i),i}return e},!0),s=P(o);return V(e,t,{includeBoundTextElement:!0}).forEach(e=>{H(e)&&ao(e,s)}),{elements:o,appState:{...t,currentItemFontSize:a.size===1?[...a][0]:i??t.currentItemFontSize},captureUpdate:N.IMMEDIATELY}};j({name:`changeStrokeColor`,label:`labels.stroke`,trackEvent:!1,perform:(e,t,n)=>({...n.currentItemStrokeColor&&{elements:Cv(e,t,e=>Tc(e.type)?A(e,{strokeColor:n.currentItemStrokeColor}):e,!0)},appState:{...t,...n},captureUpdate:n.currentItemStrokeColor?N.IMMEDIATELY:N.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:n,appProps:r})=>(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`h3`,{"aria-hidden":`true`,children:q(`labels.stroke`)}),(0,K.jsx)(X_,{topPicks:bl,palette:Hc,type:`elementStroke`,label:q(`labels.stroke`),color:wv(e,t,e=>e.strokeColor,!0,t.currentItemStrokeColor),onChange:e=>n({currentItemStrokeColor:e}),elements:e,appState:t,updateData:n})]})}),j({name:`changeBackgroundColor`,label:`labels.changeBackground`,trackEvent:!1,perform:(e,t,n)=>({...n.currentItemBackgroundColor&&{elements:Cv(e,t,e=>A(e,{backgroundColor:n.currentItemBackgroundColor}))},appState:{...t,...n},captureUpdate:n.currentItemBackgroundColor?N.IMMEDIATELY:N.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:n,appProps:r})=>(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`h3`,{"aria-hidden":`true`,children:q(`labels.background`)}),(0,K.jsx)(X_,{topPicks:ho,palette:Wo,type:`elementBackground`,label:q(`labels.background`),color:wv(e,t,e=>e.backgroundColor,!0,t.currentItemBackgroundColor),onChange:e=>n({currentItemBackgroundColor:e}),elements:e,appState:t,updateData:n})]})}),j({name:`changeFillStyle`,label:`labels.fill`,trackEvent:!1,perform:(e,t,n,r)=>(Y(`element`,`changeFillStyle`,`${n} (${r.device.editor.isMobile?`mobile`:`desktop`})`),{elements:Cv(e,t,e=>A(e,{fillStyle:n})),appState:{...t,currentItemFillStyle:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>{let r=V(e,t),i=r.length>0&&r.every(e=>e.fillStyle===`zigzag`);return(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.fill`)}),(0,K.jsx)(__,{type:`button`,options:[{value:`hachure`,text:`${q(i?`labels.zigzag`:`labels.hachure`)} (${k(`Alt-Click`)})`,icon:i?kl:xc,active:i?!0:void 0,testId:`fill-hachure`},{value:`cross-hatch`,text:q(`labels.crossHatch`),icon:mt,testId:`fill-cross-hatch`},{value:`solid`,text:q(`labels.solid`),icon:Bc,testId:`fill-solid`}],value:wv(e,t,e=>e.fillStyle,e=>e.hasOwnProperty(`fillStyle`),e=>e?null:t.currentItemFillStyle),onClick:(e,t)=>{n(t.altKey&&e===`hachure`&&r.every(e=>e.fillStyle===`hachure`)?`zigzag`:e)}})]})}}),j({name:`changeStrokeWidth`,label:`labels.strokeWidth`,trackEvent:!1,perform:(e,t,n)=>({elements:Cv(e,t,e=>A(e,{strokeWidth:n})),appState:{...t,currentItemStrokeWidth:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.strokeWidth`)}),(0,K.jsx)(__,{group:`stroke-width`,options:[{value:Du.thin,text:q(`labels.thin`),icon:Vi,testId:`strokeWidth-thin`},{value:Du.bold,text:q(`labels.bold`),icon:bu,testId:`strokeWidth-bold`},{value:Du.extraBold,text:q(`labels.extraBold`),icon:Sr,testId:`strokeWidth-extraBold`}],value:wv(e,t,e=>e.strokeWidth,e=>e.hasOwnProperty(`strokeWidth`),e=>e?null:t.currentItemStrokeWidth),onChange:e=>n(e)})]})}),j({name:`changeSloppiness`,label:`labels.sloppiness`,trackEvent:!1,perform:(e,t,n)=>({elements:Cv(e,t,e=>A(e,{seed:ve(),roughness:n})),appState:{...t,currentItemRoughness:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.sloppiness`)}),(0,K.jsx)(__,{group:`sloppiness`,options:[{value:0,text:q(`labels.architect`),icon:fu},{value:1,text:q(`labels.artist`),icon:je},{value:2,text:q(`labels.cartoonist`),icon:wn}],value:wv(e,t,e=>e.roughness,e=>e.hasOwnProperty(`roughness`),e=>e?null:t.currentItemRoughness),onChange:e=>n(e)})]})}),j({name:`changeStrokeStyle`,label:`labels.strokeStyle`,trackEvent:!1,perform:(e,t,n)=>({elements:Cv(e,t,e=>A(e,{strokeStyle:n})),appState:{...t,currentItemStrokeStyle:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.strokeStyle`)}),(0,K.jsx)(__,{group:`strokeStyle`,options:[{value:`solid`,text:q(`labels.strokeStyle_solid`),icon:Vi},{value:`dashed`,text:q(`labels.strokeStyle_dashed`),icon:_e},{value:`dotted`,text:q(`labels.strokeStyle_dotted`),icon:$n}],value:wv(e,t,e=>e.strokeStyle,e=>e.hasOwnProperty(`strokeStyle`),e=>e?null:t.currentItemStrokeStyle),onChange:e=>n(e)})]})}),j({name:`changeOpacity`,label:`labels.opacity`,trackEvent:!1,perform:(e,t,n)=>({elements:Cv(e,t,e=>A(e,{opacity:n}),!0),appState:{...t,currentItemOpacity:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsx)(xv,{updateData:n,elements:e,appState:t,testId:`opacity`})}),j({name:`changeFontSize`,label:`labels.fontSize`,trackEvent:!1,perform:(e,t,n,r)=>Ev(e,t,r,()=>n,n),PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.fontSize`)}),(0,K.jsx)(__,{group:`font-size`,options:[{value:16,text:q(`labels.small`),icon:An,testId:`fontSize-small`},{value:20,text:q(`labels.medium`),icon:qi,testId:`fontSize-medium`},{value:28,text:q(`labels.large`),icon:_r,testId:`fontSize-large`},{value:36,text:q(`labels.veryLarge`),icon:Ir,testId:`fontSize-veryLarge`}],value:wv(e,t,e=>{if(H(e))return e.fontSize;let t=w(e,r.scene.getNonDeletedElementsMap());return t?t.fontSize:null},e=>H(e)||w(e,r.scene.getNonDeletedElementsMap())!==null,e=>e?null:t.currentItemFontSize||20),onChange:e=>n(e)})]})});var Dv=j({name:`decreaseFontSize`,label:`labels.decreaseFontSize`,icon:gl,trackEvent:!1,perform:(e,t,n,r)=>Ev(e,t,r,e=>Math.round(1/(1+Sv)*e.fontSize)),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&(e.key===D.CHEVRON_LEFT||e.key===D.COMMA)}),Ov=j({name:`increaseFontSize`,label:`labels.increaseFontSize`,icon:gl,trackEvent:!1,perform:(e,t,n,r)=>Ev(e,t,r,e=>Math.round(e.fontSize*(1+Sv))),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&(e.key===D.CHEVRON_RIGHT||e.key===D.PERIOD)});j({name:`changeFontFamily`,label:`labels.fontFamily`,trackEvent:!1,perform:(e,t,n,r)=>{let{cachedElements:i,resetAll:a,resetContainers:o,...s}=n;if(a)return{elements:Cv(e,t,e=>{let t=i?.get(e.id);return t?A(e,{...t}):e},!0),appState:{...t,...s},captureUpdate:N.NEVER};let{currentItemFontFamily:c,currentHoveredFontFamily:l}=n,u=N.EVENTUALLY,d,f=!1;if(c)d=c,u=N.IMMEDIATELY;else if(l){d=l,u=N.EVENTUALLY;let n=V(e,t,{includeBoundTextElement:!0}).filter(e=>H(e));if(n.length>200)f=!0;else{let e=0,t=0;for(;e<n.length&&t<5e3;){let r=n[e];t+=r?.originalText.length||0,e++}t>5e3&&(f=!0)}}let p={appState:{...t,...s},captureUpdate:u};if(d&&!f){let n=new Map,a=new Set,s=!1,u=Array.from(Qu.loadedFontsCache.values()),f=Object.entries(Ya).find(([e,t])=>t===d)?.[0];l&&f&&u.some(e=>e.startsWith(f))&&(s=!0),Object.assign(p,{elements:Cv(e,t,e=>{if(H(e)&&(e.fontFamily!==d||c)){let t=A(e,{fontFamily:d,lineHeight:mu(d)}),c=i?.get(e.containerId||``)||{},l=r.scene.getContainerElement(e);return o&&l&&c&&W(l,{...c},!1),s||(a=new Set([...a,...Array.from(t.originalText)])),n.set(t,l),t}return e},!0)});let m=`10px ${Ql({fontFamily:d})}`,h=Array.from(a.values()).join();if(s||window.document.fonts.check(m,h))for(let[e,t]of n)pu(e,t,r.scene.getNonDeletedElementsMap(),!1);else window.document.fonts.load(m,h).then(e=>{for(let[e,t]of n){let n=r.scene.getElement(e.id),i=t?r.scene.getElement(t.id):null;n&&pu(n,i,r.scene.getNonDeletedElementsMap(),!1)}r.fonts.onLoaded(e)})}return p},PanelComponent:({elements:e,appState:t,app:n,updateData:r})=>{let i=(0,G.useRef)(new Map),a=(0,G.useRef)(null),[o,s]=(0,G.useState)({}),c=(0,G.useRef)(!0),l=(0,G.useMemo)(()=>{let r=(e,n)=>wv(e,t,e=>{if(H(e))return e.fontFamily;let t=w(e,n);return t?t.fontFamily:null},e=>H(e)||w(e,n)!==null,e=>e?null:t.currentItemFontFamily||Ks);return o.openPopup===`fontFamily`&&t.openPopup===`fontFamily`?r(Array.from(i.current?.values()??[]),i.current):!o.openPopup&&t.openPopup!==`fontFamily`?r(e,n.scene.getNonDeletedElementsMap()):a.current},[o.openPopup,t,e,n.scene]);return(0,G.useEffect)(()=>{a.current=l},[l]),(0,G.useEffect)(()=>{Object.keys(o).length&&(r(o),s({}))},[o]),(0,G.useEffect)(()=>(c.current=!1,()=>{c.current=!0}),[]),(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.fontFamily`)}),(0,K.jsx)(bv,{isOpened:t.openPopup===`fontFamily`,selectedFontFamily:l,hoveredFontFamily:t.currentHoveredFontFamily,onSelect:e=>{s({openPopup:null,currentHoveredFontFamily:null,currentItemFontFamily:e}),i.current.clear()},onHover:e=>{s({currentHoveredFontFamily:e,cachedElements:new Map(i.current),resetContainers:!0})},onLeave:()=>{s({currentHoveredFontFamily:null,cachedElements:new Map(i.current),resetAll:!0})},onPopupChange:a=>{if(a){i.current.clear();let{editingTextElement:r}=t;if(r?.type===`text`){let e=n.scene.getElement(r.id);i.current.set(r.id,A(e||r,{},!0))}else{let n=V(e,t,{includeBoundTextElement:!0});for(let e of n)i.current.set(e.id,A(e,{},!0))}s({openPopup:`fontFamily`})}else{let e={openPopup:null,currentHoveredFontFamily:null,cachedElements:new Map(i.current),resetAll:!0};c.current?r({...o,...e}):s(e),i.current.clear()}}})]})}}),j({name:`changeTextAlign`,label:`Change text alignment`,trackEvent:!1,perform:(e,t,n,r)=>({elements:Cv(e,t,e=>{if(H(e)){let t=A(e,{textAlign:n});return pu(t,r.scene.getContainerElement(e),r.scene.getNonDeletedElementsMap()),t}return e},!0),appState:{...t,currentItemTextAlign:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>{let i=r.scene.getNonDeletedElementsMap();return(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.textAlign`)}),(0,K.jsx)(__,{group:`text-align`,options:[{value:`left`,text:q(`labels.left`),icon:Xa,testId:`align-left`},{value:`center`,text:q(`labels.center`),icon:zn,testId:`align-horizontal-center`},{value:`right`,text:q(`labels.right`),icon:He,testId:`align-right`}],value:wv(e,t,e=>{if(H(e))return e.textAlign;let t=w(e,i);return t?t.textAlign:null},e=>H(e)||w(e,i)!==null,e=>e?null:t.currentItemTextAlign),onChange:e=>n(e)})]})}}),j({name:`changeVerticalAlign`,label:`Change vertical alignment`,trackEvent:{category:`element`},perform:(e,t,n,r)=>({elements:Cv(e,t,e=>{if(H(e)){let t=A(e,{verticalAlign:n});return pu(t,r.scene.getContainerElement(e),r.scene.getNonDeletedElementsMap()),t}return e},!0),appState:{...t},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(`fieldset`,{children:(0,K.jsx)(__,{group:`text-align`,options:[{value:ri.TOP,text:q(`labels.alignTop`),icon:(0,K.jsx)(ec,{theme:t.theme}),testId:`align-top`},{value:ri.MIDDLE,text:q(`labels.centerVertically`),icon:(0,K.jsx)(Yn,{theme:t.theme}),testId:`align-middle`},{value:ri.BOTTOM,text:q(`labels.alignBottom`),icon:(0,K.jsx)(Ye,{theme:t.theme}),testId:`align-bottom`}],value:wv(e,t,e=>{if(H(e)&&e.containerId)return e.verticalAlign;let t=w(e,r.scene.getNonDeletedElementsMap());return t?t.verticalAlign:null},e=>H(e)||w(e,r.scene.getNonDeletedElementsMap())!==null,e=>e?null:ri.MIDDLE),onChange:e=>n(e)})})}),j({name:`changeRoundness`,label:`Change edge roundness`,trackEvent:!1,perform:(e,t,n)=>({elements:Cv(e,t,e=>B(e)?e:A(e,{roundness:n===`round`?{type:Ar(e.type)?Pc.ADAPTIVE_RADIUS:Pc.PROPORTIONAL_RADIUS}:null})),appState:{...t,currentItemRoundness:n},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>{let r=Nc(U(e),t).some(e=>e.roundness?.type===Pc.LEGACY);return(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.edges`)}),(0,K.jsx)(__,{group:`edges`,options:[{value:`sharp`,text:q(`labels.sharp`),icon:Ra},{value:`round`,text:q(`labels.round`),icon:Rs}],value:wv(e,t,e=>r?null:e.roundness?`round`:`sharp`,e=>!Lc(e)&&e.hasOwnProperty(`roundness`),e=>e?null:t.currentItemRoundness),onChange:e=>n(e)})]})}});var kv=e=>[{value:null,text:q(`labels.arrowhead_none`),keyBinding:`q`,icon:Gi},{value:`arrow`,text:q(`labels.arrowhead_arrow`),keyBinding:`w`,icon:(0,K.jsx)(ha,{flip:e})},{value:`triangle`,text:q(`labels.arrowhead_triangle`),icon:(0,K.jsx)(ss,{flip:e}),keyBinding:`e`},{value:`triangle_outline`,text:q(`labels.arrowhead_triangle_outline`),icon:(0,K.jsx)(wi,{flip:e}),keyBinding:`r`},{value:`circle`,text:q(`labels.arrowhead_circle`),keyBinding:`a`,icon:(0,K.jsx)(Ze,{flip:e})},{value:`circle_outline`,text:q(`labels.arrowhead_circle_outline`),keyBinding:`s`,icon:(0,K.jsx)(Gu,{flip:e})},{value:`diamond`,text:q(`labels.arrowhead_diamond`),icon:(0,K.jsx)(po,{flip:e}),keyBinding:`d`},{value:`diamond_outline`,text:q(`labels.arrowhead_diamond_outline`),icon:(0,K.jsx)(Xo,{flip:e}),keyBinding:`f`},{value:`bar`,text:q(`labels.arrowhead_bar`),keyBinding:`z`,icon:(0,K.jsx)($r,{flip:e})},{value:`crowfoot_one`,text:q(`labels.arrowhead_crowfoot_one`),icon:(0,K.jsx)(mo,{flip:e}),keyBinding:`c`},{value:`crowfoot_many`,text:q(`labels.arrowhead_crowfoot_many`),icon:(0,K.jsx)(va,{flip:e}),keyBinding:`x`},{value:`crowfoot_one_or_many`,text:q(`labels.arrowhead_crowfoot_one_or_many`),icon:(0,K.jsx)(xe,{flip:e}),keyBinding:`v`}];j({name:`changeArrowhead`,label:`Change arrowheads`,trackEvent:!1,perform:(e,t,n)=>({elements:Cv(e,t,e=>{if(fc(e)){let{position:t,type:r}=n;if(t===`start`)return A(e,{startArrowhead:r});if(t===`end`)return A(e,{endArrowhead:r})}return e}),appState:{...t,[n.position===`start`?`currentItemStartArrowhead`:`currentItemEndArrowhead`]:n.type},captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n})=>{let r=Fg().rtl;return(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.arrowheads`)}),(0,K.jsxs)(`div`,{className:`iconSelectList buttonList`,children:[(0,K.jsx)(tv,{label:`arrowhead_start`,options:kv(!r),value:wv(e,t,e=>fc(e)&&vu(e.type)?e.startArrowhead:t.currentItemStartArrowhead,!0,t.currentItemStartArrowhead),onChange:e=>n({position:`start`,type:e}),numberOfOptionsToAlwaysShow:4}),(0,K.jsx)(tv,{label:`arrowhead_end`,group:`arrowheads`,options:kv(!!r),value:wv(e,t,e=>fc(e)&&vu(e.type)?e.endArrowhead:t.currentItemEndArrowhead,!0,t.currentItemEndArrowhead),onChange:e=>n({position:`end`,type:e}),numberOfOptionsToAlwaysShow:4})]})]})}}),j({name:`changeArrowType`,label:`Change arrow types`,trackEvent:!1,perform:(e,t,n,r)=>{let i=Cv(e,t,i=>{if(!Lc(i))return i;let a=A(i,{roundness:n===nu.round?{type:Pc.PROPORTIONAL_RADIUS}:null,elbowed:n===nu.elbow,points:n===nu.elbow||i.elbowed?[i.points[0],i.points[i.points.length-1]]:i.points});if(B(a)){let n=r.scene.getNonDeletedElementsMap();r.dismissLinearEditor();let i=F.getPointAtIndexGlobalCoordinates(a,0,n),o=F.getPointAtIndexGlobalCoordinates(a,-1,n),s=!a.startBinding&&on(ws(i),e,n,t.zoom,!1,!0),c=!a.endBinding&&on(ws(o),e,n,t.zoom,!1,!0),l=s||a.startBinding&&n.get(a.startBinding.elementId),u=c||a.endBinding&&n.get(a.endBinding.elementId),d=s?xu(a,s,`start`):i,f=c?xu(a,c,`end`):o;s&&ml(a,s,`start`,n),c&&ml(a,c,`end`,n),W(a,{points:[d,f].map(e=>I(e[0]-a.x,e[1]-a.y)),...l&&a.startBinding?{startBinding:{...a.startBinding,...cd(a,l,`start`,n)}}:{},...u&&a.endBinding?{endBinding:{...a.endBinding,...cd(a,u,`end`,n)}}:{}}),F.updateEditorMidPointsCache(a,n,r.state)}return a}),a={...t,currentItemArrowType:n},o=t.selectedLinearElement?.elementId;if(o){let e=i.find(e=>e.id===o);e&&(a.selectedLinearElement=new F(e))}return{elements:i,appState:a,captureUpdate:N.IMMEDIATELY}},PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.arrowtypes`)}),(0,K.jsx)(__,{group:`arrowtypes`,options:[{value:nu.sharp,text:q(`labels.arrowtype_sharp`),icon:wl,testId:`sharp-arrow`},{value:nu.round,text:q(`labels.arrowtype_round`),icon:wc,testId:`round-arrow`},{value:nu.elbow,text:q(`labels.arrowtype_elbowed`),icon:Ds,testId:`elbow-arrow`}],value:wv(e,t,e=>Lc(e)?e.elbowed?nu.elbow:e.roundness?nu.round:nu.sharp:null,e=>Lc(e),e=>e?null:t.currentItemArrowType),onChange:e=>n(e)})]})});var Av=({viewportX:e,viewportY:t,nextZoom:n},r)=>{let i=e-r.offsetLeft,a=t-r.offsetTop,o=r.zoom.value,s=r.scrollX+(i-i/o),c=r.scrollY+(a-a/o),l=-(i-i/n),u=-(a-a/n);return{scrollX:s+l,scrollY:c+u,zoom:{value:n}}},jv=()=>{let e=document.querySelector(`.excalidraw-tooltip`);if(e)return e;let t=document.createElement(`div`);return document.body.appendChild(t),t.classList.add(`excalidraw-tooltip`),t},Mv=(e,t,n=`bottom`)=>{let r=e.getBoundingClientRect(),i=window.innerWidth,a=window.innerHeight,o=t.left+t.width/2-r.width/2;o<0?o=5:o+r.width>=i&&(o=i-r.width-5);let s;n===`bottom`?(s=t.top+t.height+5,s+r.height>=a&&(s=t.top-r.height-5)):(s=t.top-r.height-5,s<0&&(s=t.top+t.height+5)),Object.assign(e.style,{top:`${s}px`,left:`${o}px`})},Nv=(e,t,n,r)=>{t.classList.add(`excalidraw-tooltip--visible`),t.style.minWidth=r?`50ch`:`10ch`,t.style.maxWidth=r?`50ch`:`15ch`,t.textContent=n,Mv(t,e.getBoundingClientRect())},Pv=({children:e,label:t,long:n=!1,style:r,disabled:i})=>((0,G.useEffect)(()=>()=>jv().classList.remove(`excalidraw-tooltip--visible`),[]),i?null:(0,K.jsx)(`div`,{className:`excalidraw-tooltip-wrapper`,onPointerEnter:e=>Nv(e.currentTarget,jv(),t,n),onPointerLeave:()=>jv().classList.remove(`excalidraw-tooltip--visible`),style:r,children:e}));j({name:`changeViewBackgroundColor`,label:`labels.canvasBackground`,paletteName:`Change canvas background color`,trackEvent:!1,predicate:(e,t,n,r)=>!!r.props.UIOptions.canvasActions.changeViewBackgroundColor&&!t.viewModeEnabled,perform:(e,t,n)=>({appState:{...t,...n},captureUpdate:n.viewBackgroundColor?N.IMMEDIATELY:N.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:n,appProps:r})=>(0,K.jsx)(X_,{palette:null,topPicks:Cn,label:q(`labels.canvasBackground`),type:`canvasBackground`,color:t.viewBackgroundColor,onChange:e=>n({viewBackgroundColor:e}),"data-testid":`canvas-background-picker`,elements:e,appState:t,updateData:n})});var Fv=j({name:`clearCanvas`,label:`labels.clearCanvas`,paletteName:`Clear canvas`,icon:Bs,trackEvent:{category:`canvas`},predicate:(e,t,n,r)=>!!r.props.UIOptions.canvasActions.clearCanvas&&!t.viewModeEnabled&&t.openDialog?.name!==`elementLinkSelector`,perform:(e,t,n,r)=>(r.imageCache.clear(),{elements:e.map(e=>A(e,{isDeleted:!0})),appState:{...Ii(),files:{},theme:t.theme,penMode:t.penMode,penDetected:t.penDetected,exportBackground:t.exportBackground,exportEmbedScene:t.exportEmbedScene,gridSize:t.gridSize,gridStep:t.gridStep,gridModeEnabled:t.gridModeEnabled,stats:t.stats,pasteDialog:t.pasteDialog,activeTool:t.activeTool.type===`image`?{...t.activeTool,type:`selection`}:t.activeTool},captureUpdate:N.IMMEDIATELY})}),Iv=j({name:`zoomIn`,label:`buttons.zoomIn`,viewMode:!0,icon:dc,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>({appState:{...t,...Av({viewportX:t.width/2+t.offsetLeft,viewportY:t.height/2+t.offsetTop,nextZoom:Ne(t.zoom.value+Sa)},t),userToFollow:null},captureUpdate:N.EVENTUALLY}),PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(J,{type:`button`,className:`zoom-in-button zoom-button`,icon:dc,title:`${q(`buttons.zoomIn`)} \u2014 ${k(`CtrlOrCmd++`)}`,"aria-label":q(`buttons.zoomIn`),disabled:t.zoom.value>=30,onClick:()=>{e(null)}}),keyTest:e=>(e.code===E.EQUAL||e.code===E.NUM_ADD)&&(e[D.CTRL_OR_CMD]||e.shiftKey)}),Lv=j({name:`zoomOut`,label:`buttons.zoomOut`,icon:Gn,viewMode:!0,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>({appState:{...t,...Av({viewportX:t.width/2+t.offsetLeft,viewportY:t.height/2+t.offsetTop,nextZoom:Ne(t.zoom.value-Sa)},t),userToFollow:null},captureUpdate:N.EVENTUALLY}),PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(J,{type:`button`,className:`zoom-out-button zoom-button`,icon:Gn,title:`${q(`buttons.zoomOut`)} \u2014 ${k(`CtrlOrCmd+-`)}`,"aria-label":q(`buttons.zoomOut`),disabled:t.zoom.value<=Xu,onClick:()=>{e(null)}}),keyTest:e=>(e.code===E.MINUS||e.code===E.NUM_SUBTRACT)&&(e[D.CTRL_OR_CMD]||e.shiftKey)}),Rv=j({name:`resetZoom`,label:`buttons.resetZoom`,icon:qa,viewMode:!0,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>({appState:{...t,...Av({viewportX:t.width/2+t.offsetLeft,viewportY:t.height/2+t.offsetTop,nextZoom:Ne(1)},t),userToFollow:null},captureUpdate:N.EVENTUALLY}),PanelComponent:({updateData:e,appState:t})=>(0,K.jsx)(Pv,{label:q(`buttons.resetZoom`),style:{height:`100%`},children:(0,K.jsxs)(J,{type:`button`,className:`reset-zoom-button zoom-button`,title:q(`buttons.resetZoom`),"aria-label":q(`buttons.resetZoom`),onClick:()=>{e(null)},children:[(t.zoom.value*100).toFixed(0),`%`]})}),keyTest:e=>(e.code===E.ZERO||e.code===E.NUM_ZERO)&&(e[D.CTRL_OR_CMD]||e.shiftKey)}),zv=(e,t,n=1)=>{let[r,i,a,o]=e,s=a-r,c=t.width/s,l=o-i,u=t.height/l,d=Math.min(c,u)*Be(n,.1,1);return Math.min(d,1)},Bv=({bounds:e,appState:t,canvasOffsets:n,fitToViewport:r=!1,viewportZoomFactor:i=1,minZoom:a=-1/0,maxZoom:o=1/0})=>{i=Be(i,Xu,30);let[s,c,l,u]=e,d=(s+l)/2,f=(c+u)/2,p=n?.left??0,m=n?.top??0,h=n?.right??0,g=n?.bottom??0,_=t.width-p-h,v=t.height-m-g,y;if(r){let e=l-s,t=u-c;y=Math.min(_/e,v/t)*i}else y=zv(e,{width:_,height:v},i);let b=Ne(Be(Es(y,Sa,`floor`),a,o)),x=Te({scenePoint:{x:d,y:f},viewportDimensions:{width:t.width,height:t.height},offsets:n,zoom:{value:b}});return{appState:{...t,scrollX:x.scrollX,scrollY:x.scrollY,zoom:{value:b}},captureUpdate:N.EVENTUALLY}},Vv=({canvasOffsets:e,targetElements:t,appState:n,fitToViewport:r,viewportZoomFactor:i,minZoom:a,maxZoom:o})=>Bv({canvasOffsets:e,bounds:Ts(U(t)),appState:n,fitToViewport:r,viewportZoomFactor:i,minZoom:a,maxZoom:o});j({name:`zoomToFitSelectionInViewport`,label:`labels.zoomToFitViewport`,icon:Eo,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t);return Vv({targetElements:i.length?i:e,appState:{...t,userToFollow:null},fitToViewport:!1,canvasOffsets:r.getEditorUIOffsets()})},keyTest:e=>e.code===E.TWO&&e.shiftKey&&!e.altKey&&!e[D.CTRL_OR_CMD]}),j({name:`zoomToFitSelection`,label:`helpDialog.zoomToSelection`,icon:Eo,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t);return Vv({targetElements:i.length?i:e,appState:{...t,userToFollow:null},fitToViewport:!0,canvasOffsets:r.getEditorUIOffsets()})},keyTest:e=>e.code===E.THREE&&e.shiftKey&&!e.altKey&&!e[D.CTRL_OR_CMD]}),j({name:`zoomToFit`,label:`helpDialog.zoomToFit`,icon:Eo,viewMode:!0,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>Vv({targetElements:e,appState:{...t,userToFollow:null},fitToViewport:!1,canvasOffsets:r.getEditorUIOffsets()}),keyTest:e=>e.code===E.ONE&&e.shiftKey&&!e.altKey&&!e[D.CTRL_OR_CMD]});var Hv=j({name:`toggleTheme`,label:(e,t)=>t.theme===R.DARK?`buttons.lightMode`:`buttons.darkMode`,keywords:[`toggle`,`dark`,`light`,`mode`,`theme`],icon:e=>e.theme===R.LIGHT?Vl:cs,viewMode:!0,trackEvent:{category:`canvas`},perform:(e,t,n)=>({appState:{...t,theme:n||(t.theme===R.LIGHT?R.DARK:R.LIGHT)},captureUpdate:N.EVENTUALLY}),keyTest:e=>e.altKey&&e.shiftKey&&e.code===E.D,predicate:(e,t,n,r)=>!!r.props.UIOptions.canvasActions.toggleTheme});j({name:`toggleEraserTool`,label:`toolBar.eraser`,trackEvent:{category:`toolbar`},perform:(e,t)=>{let n;return n=aa(t)?fo(t,{...t.activeTool.lastActiveTool||{type:`selection`},lastActiveToolBeforeEraser:null}):fo(t,{type:`eraser`,lastActiveToolBeforeEraser:t.activeTool}),{appState:{...t,selectedElementIds:{},selectedGroupIds:{},activeEmbeddable:null,activeTool:n},captureUpdate:N.IMMEDIATELY}},keyTest:e=>e.key===D.E});var Uv=j({name:`toggleHandTool`,label:`toolBar.hand`,paletteName:`Toggle hand tool`,trackEvent:{category:`toolbar`},icon:ar,viewMode:!1,perform:(e,t,n,r)=>{let i;return On(t)?i=fo(t,{...t.activeTool.lastActiveTool||{type:`selection`},lastActiveToolBeforeEraser:null}):(i=fo(t,{type:`hand`,lastActiveToolBeforeEraser:t.activeTool}),z(r.interactiveCanvas,T.GRAB)),{appState:{...t,selectedElementIds:{},selectedGroupIds:{},activeEmbeddable:null,activeTool:i},captureUpdate:N.IMMEDIATELY}},keyTest:e=>!e.altKey&&!e[D.CTRL_OR_CMD]&&e.key===D.H}),Wv=j({name:`finalize`,label:``,trackEvent:!1,perform:(e,t,n,r)=>{let{interactiveCanvas:i,focusContainer:a,scene:o}=r,s=o.getNonDeletedElementsMap();if(t.editingLinearElement){let{elementId:n,startBindingElement:r,endBindingElement:i}=t.editingLinearElement,a=F.getElement(n,s);if(a)return Zi(a)&&Kn(a,r,i,s,o),{elements:a.points.length<2||es(a)?e.filter(e=>e.id!==a.id):void 0,appState:{...t,cursorButton:`up`,editingLinearElement:null},captureUpdate:N.IMMEDIATELY}}let c=e,l=t.pendingImageElementId&&o.getElement(t.pendingImageElementId);l&&W(l,{isDeleted:!0},!1),window.document.activeElement instanceof HTMLElement&&a();let u=t.multiElement?t.multiElement:t.newElement?.type===`freedraw`?t.newElement:null;if(u){if(u.type!==`freedraw`&&t.lastPointerDownWith!==`touch`){let{points:e,lastCommittedPoint:t}=u;(!t||e[e.length-1]!==t)&&W(u,{points:u.points.slice(0,-1)})}es(u)&&(c=c.filter(e=>e.id!==u.id));let n=jt(u.points,t.zoom.value);if((u.type===`line`||u.type===`freedraw`)&&n){let e=u.points,t=e[0];W(u,{points:e.map((n,r)=>r===e.length-1?I(t[0],t[1]):n)})}if(Zi(u)&&!n&&u.points.length>1){let[n,r]=F.getPointAtIndexGlobalCoordinates(u,-1,P(e));br(u,t,{x:n,y:r},s,e)}}(!t.activeTool.locked&&t.activeTool.type!==`freedraw`||!u)&&_l(i);let d;return d=t.activeTool.type===`eraser`?fo(t,{...t.activeTool.lastActiveTool||{type:`selection`},lastActiveToolBeforeEraser:null}):fo(t,{type:`selection`}),{elements:c,appState:{...t,cursorButton:`up`,activeTool:(t.activeTool.locked||t.activeTool.type===`freedraw`)&&u?t.activeTool:d,activeEmbeddable:null,newElement:null,selectionElement:null,multiElement:null,editingTextElement:null,startBoundElement:null,suggestedBindings:[],selectedElementIds:u&&!t.activeTool.locked&&t.activeTool.type!==`freedraw`?{...t.selectedElementIds,[u.id]:!0}:t.selectedElementIds,selectedLinearElement:u&&fc(u)?new F(u):t.selectedLinearElement,pendingImageElementId:null},captureUpdate:N.IMMEDIATELY}},keyTest:(e,t)=>e.key===D.ESCAPE&&(t.editingLinearElement!==null||!t.newElement&&t.multiElement===null)||(e.key===D.ESCAPE||e.key===D.ENTER)&&t.multiElement!==null,PanelComponent:({appState:e,updateData:t,data:n})=>(0,K.jsx)(J,{type:`button`,icon:Jo,title:q(`buttons.done`),"aria-label":q(`buttons.done`),onClick:t,visible:e.multiElement!=null,size:n?.size||`medium`,style:{pointerEvents:`all`}})}),Gv=e=>{let{id:t}=xD(),[n,r]=(0,G.useState)(e.value);return(0,K.jsxs)(`div`,{className:`ProjectName`,children:[(0,K.jsx)(`label`,{className:`ProjectName-label`,htmlFor:`filename`,children:`${e.label}:`}),(0,K.jsx)(`input`,{type:`text`,className:`TextInput`,onBlur:t=>{e.ignoreFocus||si(t.target);let n=t.target.value;n!==e.value&&e.onChange(n)},onKeyDown:e=>{if(e.key===D.ENTER){if(e.preventDefault(),e.nativeEvent.isComposing||e.keyCode===229)return;e.currentTarget.blur()}},id:`${t}-filename`,value:n,onChange:e=>r(e.target.value)})]})},Kv=e=>{let t=e.title||(e.value===R.DARK?q(`buttons.lightMode`):q(`buttons.darkMode`));return(0,K.jsx)(J,{type:`icon`,icon:e.value===R.LIGHT?qv.MOON:qv.SUN,title:t,"aria-label":t,onClick:()=>e.onChange(e.value===R.DARK?R.LIGHT:R.DARK),"data-testid":`toggle-dark-mode`})},qv={SUN:(0,K.jsx)(`svg`,{width:`512`,height:`512`,className:`rtl-mirror`,viewBox:`0 0 512 512`,children:(0,K.jsx)(`path`,{fill:`currentColor`,d:`M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z`})}),MOON:(0,K.jsx)(`svg`,{width:`512`,height:`512`,className:`rtl-mirror`,viewBox:`0 0 512 512`,children:(0,K.jsx)(`path`,{fill:`currentColor`,d:`M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z`})})},Jv=(e,{selectedElementIds:t},n)=>{e=U(e);let r=n&&js(e,{selectedElementIds:t}),i=null,a=r?V(e,{selectedElementIds:t},{includeBoundTextElement:!0}):e;return r&&(a.length===1&&M(a[0])?(i=a[0],a=Ha(e,i)):a.length>1&&(a=V(e,{selectedElementIds:t},{includeBoundTextElement:!0,includeElementsInFrames:!0}))),{exportingFrame:i,exportedElements:jn(a)}},Yv=async(e,t,n,r,{exportBackground:i,exportPadding:a=10,viewBackgroundColor:o,name:s=n.name||`Untitled`,fileHandle:l=null,exportingFrame:u=null})=>{if(t.length===0)throw Error(q(`alerts.cannotExportEmptyCanvas`));if(e===`svg`||e===`clipboard-svg`){let c=Ua(t,{exportBackground:i,exportWithDarkMode:n.exportWithDarkMode,viewBackgroundColor:o,exportPadding:a,exportScale:n.exportScale,exportEmbedScene:n.exportEmbedScene&&e===`svg`},r,{exportingFrame:u});if(e===`svg`)return Bl(c.then(e=>new Blob([e.outerHTML],{type:rn.svg})),{description:`Export to SVG`,name:s,extension:n.exportEmbedScene?`excalidraw.svg`:`svg`,mimeTypes:[Mc.svg],fileHandle:l});if(e===`clipboard-svg`){let e=await c.then(e=>e.outerHTML);try{await Gt(e)}catch{throw Error(q(`errors.copyToSystemClipboardFailed`))}return}}let d=Sc(t,n,r,{exportBackground:i,viewBackgroundColor:o,exportPadding:a,exportingFrame:u});if(e===`png`){let e=Mu(d);return n.exportEmbedScene&&(e=e.then(e=>c(async()=>{let{encodePngMetadata:e}=await import(`./image-7KUKJ7J4-DkUppARt.js`);return{encodePngMetadata:e}},__vite__mapDeps([59,60,2,61,62,63,64,65,1,66])).then(({encodePngMetadata:i})=>i({blob:e,metadata:Ko(t,n,r,`local`)})))),Bl(e,{description:`Export to PNG`,name:s,extension:n.exportEmbedScene?`excalidraw.png`:`png`,mimeTypes:[Mc.png],fileHandle:l})}else if(e===`clipboard`)try{await Gr(Mu(d))}catch(e){throw console.warn(e),e.name===`CANVAS_POSSIBLY_TOO_BIG`?Error(q(`canvasError.canvasTooBig`)):qc&&e.name===`TypeError`?Error(`${q(`alerts.couldNotCopyToClipboard`)}

${q(`hints.firefox_clipboard_write`)}`):Error(q(`alerts.couldNotCopyToClipboard`))}else throw Error(`Unsupported export type`)},Xv=async(e,t,n,r)=>{let{exportBackground:i,viewBackgroundColor:a,fileHandle:o}=t,s=Qe(o);if(!o||!Go(s))throw Error(`fileHandle should exist and should be of type svg or png when resaving`);t={...t,exportEmbedScene:!0};let{exportedElements:c,exportingFrame:l}=Jv(e,t,!1);return await Yv(s,c,t,n,{exportBackground:i,viewBackgroundColor:a,name:r,fileHandle:o,exportingFrame:l}),{fileHandle:o}},Zv=({children:e,checked:t,onChange:n,className:r})=>(0,K.jsxs)(`div`,{className:L(`Checkbox`,r,{"is-checked":t}),onClick:e=>{n(!t,e),e.currentTarget.querySelector(`.Checkbox-box`).focus()},children:[(0,K.jsx)(`button`,{type:`button`,className:`Checkbox-box`,role:`checkbox`,"aria-checked":t,children:Cu}),(0,K.jsx)(`div`,{className:`Checkbox-label`,children:e})]}),Qv=j({name:`changeProjectName`,label:`labels.fileTitle`,trackEvent:!1,perform:(e,t,n)=>({appState:{...t,name:n},captureUpdate:N.EVENTUALLY}),PanelComponent:({appState:e,updateData:t,appProps:n,data:r,app:i})=>(0,K.jsx)(Gv,{label:q(`labels.fileTitle`),value:i.getName(),onChange:e=>t(e),ignoreFocus:r?.ignoreFocus??!1})}),$v=j({name:`changeExportScale`,label:`imageExportDialog.scale`,trackEvent:{category:`export`,action:`scale`},perform:(e,t,n)=>({appState:{...t,exportScale:n},captureUpdate:N.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:n})=>{let r=U(e),i=js(r,t)?V(r,t):r;return(0,K.jsx)(K.Fragment,{children:cl.map(e=>{let[r,a]=Iu(i,10,e),o=`${q(`imageExportDialog.label.scale`)} ${e}x (${r}x${a})`;return(0,K.jsx)(J,{size:`small`,type:`radio`,icon:`${e}x`,name:`export-canvas-scale`,title:o,"aria-label":o,id:`export-canvas-scale`,checked:e===t.exportScale,onChange:()=>n(e)},e)})})}}),ey=j({name:`changeExportBackground`,label:`imageExportDialog.label.withBackground`,trackEvent:{category:`export`,action:`toggleBackground`},perform:(e,t,n)=>({appState:{...t,exportBackground:n},captureUpdate:N.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>(0,K.jsx)(Zv,{checked:e.exportBackground,onChange:e=>t(e),children:q(`imageExportDialog.label.withBackground`)})}),ty=j({name:`changeExportEmbedScene`,label:`imageExportDialog.tooltip.embedScene`,trackEvent:{category:`export`,action:`embedScene`},perform:(e,t,n)=>({appState:{...t,exportEmbedScene:n},captureUpdate:N.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>(0,K.jsxs)(Zv,{checked:e.exportEmbedScene,onChange:e=>t(e),children:[q(`imageExportDialog.label.embedScene`),(0,K.jsx)(Pv,{label:q(`imageExportDialog.tooltip.embedScene`),long:!0,children:(0,K.jsx)(`div`,{className:`excalidraw-tooltip-icon`,children:Ol})})]})}),ny=j({name:`saveToActiveFile`,label:`buttons.save`,icon:ac,trackEvent:{category:`export`},predicate:(e,t,n,r)=>!!r.props.UIOptions.canvasActions.saveToActiveFile&&!!t.fileHandle&&!t.viewModeEnabled,perform:async(e,t,n,r)=>{let i=!!t.fileHandle;try{let{fileHandle:n}=Wl(t.fileHandle)?await Xv(e,t,r.files,r.getName()):await Qr(e,t,r.files,r.getName());return{captureUpdate:N.EVENTUALLY,appState:{...t,fileHandle:n,toast:i?{message:n?.name?q(`toast.fileSavedToFilename`).replace(`{filename}`,`"${n.name}"`):q(`toast.fileSaved`)}:null}}}catch(e){return e?.name===`AbortError`?console.warn(e):console.error(e),{captureUpdate:N.EVENTUALLY}}},keyTest:e=>e.key===D.S&&e[D.CTRL_OR_CMD]&&!e.shiftKey}),ry=j({name:`saveFileToDisk`,label:`exportDialog.disk_title`,icon:ac,viewMode:!0,trackEvent:{category:`export`},perform:async(e,t,n,r)=>{try{let{fileHandle:n}=await Qr(e,{...t,fileHandle:null},r.files,r.getName());return{captureUpdate:N.EVENTUALLY,appState:{...t,openDialog:null,fileHandle:n,toast:{message:q(`toast.fileSaved`)}}}}catch(e){return e?.name===`AbortError`?console.warn(e):console.error(e),{captureUpdate:N.EVENTUALLY}}},keyTest:e=>e.key===D.S&&e.shiftKey&&e[D.CTRL_OR_CMD],PanelComponent:({updateData:e})=>(0,K.jsx)(J,{type:`button`,icon:Ru,title:q(`buttons.saveAs`),"aria-label":q(`buttons.saveAs`),showAriaLabel:bD().editor.isMobile,hidden:!_s,onClick:()=>e(null),"data-testid":`save-as-button`})}),iy=j({name:`loadScene`,label:`buttons.load`,trackEvent:{category:`export`},predicate:(e,t,n,r)=>!!r.props.UIOptions.canvasActions.loadScene&&!t.viewModeEnabled,perform:async(e,t,n,r)=>{try{let{elements:n,appState:r,files:i}=await Wr(t,e);return{elements:n,appState:r,files:i,captureUpdate:N.IMMEDIATELY}}catch(n){return n?.name===`AbortError`?(console.warn(n),!1):{elements:e,appState:{...t,errorMessage:n.message},files:r.files,captureUpdate:N.EVENTUALLY}}},keyTest:e=>e[D.CTRL_OR_CMD]&&e.key===D.O}),ay=j({name:`exportWithDarkMode`,label:`imageExportDialog.label.darkMode`,trackEvent:{category:`export`,action:`toggleTheme`},perform:(e,t,n)=>({appState:{...t,exportWithDarkMode:n},captureUpdate:N.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>(0,K.jsx)(`div`,{style:{display:`flex`,justifyContent:`flex-end`,marginTop:`-45px`,marginBottom:`10px`},children:(0,K.jsx)(Kv,{value:e.exportWithDarkMode?R.DARK:R.LIGHT,onChange:e=>{t(e===R.DARK)},title:q(`imageExportDialog.label.darkMode`)})})}),oy=`{}`,sy=j({name:`copyStyles`,label:`labels.copyStyles`,icon:dr,trackEvent:{category:`element`},perform:(e,t,n,r)=>{let i=[],a=e.find(e=>t.selectedElementIds[e.id]);if(i.push(a),a&&Ou(a)){let e=w(a,r.scene.getNonDeletedElementsMap());i.push(e)}return a&&(oy=JSON.stringify(i)),{appState:{...t,toast:{message:q(`toast.copyStyles`)}},captureUpdate:N.EVENTUALLY}},keyTest:e=>e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.C}),cy=j({name:`pasteStyles`,label:`labels.pasteStyles`,icon:dr,trackEvent:{category:`element`},perform:(e,t,n,r)=>{let i=JSON.parse(oy),a=i[0],o=i[1];if(!Vs(a))return{elements:e,captureUpdate:N.EVENTUALLY};let s=V(e,t,{includeBoundTextElement:!0}),c=s.map(e=>e.id);return{elements:e.map(e=>{if(c.includes(e.id)){let t=a;if(H(e)&&e.containerId&&(t=o),!t)return e;let n=A(e,{backgroundColor:t?.backgroundColor,strokeWidth:t?.strokeWidth,strokeColor:t?.strokeColor,strokeStyle:t?.strokeStyle,fillStyle:t?.fillStyle,opacity:t?.opacity,roughness:t?.roughness,roundness:t.roundness?Ma(t.roundness.type,e)?t.roundness:$s(e):null});if(H(n)){let e=t.fontSize||20,i=t.fontFamily||Ks;n=A(n,{fontSize:e,fontFamily:i,textAlign:t.textAlign||`left`,lineHeight:t.lineHeight||mu(i)});let a=null;n.containerId&&(a=s.find(e=>H(n)&&e.id===n.containerId)||null),pu(n,a,r.scene.getNonDeletedElementsMap())}return n.type===`arrow`&&Lc(t)&&(n=A(n,{startArrowhead:t.startArrowhead,endArrowhead:t.endArrowhead})),M(e)&&(n=A(n,{roundness:null,backgroundColor:`transparent`})),n}return e}),captureUpdate:N.IMMEDIATELY}},keyTest:e=>e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.V});j({name:`toggleCanvasMenu`,label:`buttons.menu`,trackEvent:{category:`menu`},perform:(e,t)=>({appState:{...t,openMenu:t.openMenu===`canvas`?null:`canvas`},captureUpdate:N.EVENTUALLY}),PanelComponent:({appState:e,updateData:t})=>(0,K.jsx)(J,{type:`button`,icon:ic,"aria-label":q(`buttons.menu`),onClick:t,selected:e.openMenu===`canvas`})}),j({name:`toggleEditMenu`,label:`buttons.edit`,trackEvent:{category:`menu`},perform:(e,t)=>({appState:{...t,openMenu:t.openMenu===`shape`?null:`shape`},captureUpdate:N.EVENTUALLY}),PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsx)(J,{visible:St(t,U(e)),type:`button`,icon:Io,"aria-label":q(`buttons.edit`),onClick:n,selected:t.openMenu===`shape`})});var ly=j({name:`toggleShortcuts`,label:`welcomeScreen.defaults.helpHint`,icon:ci,viewMode:!0,trackEvent:{category:`menu`,action:`toggleHelpDialog`},perform:(e,t,n,{focusContainer:r})=>(t.openDialog?.name===`help`&&r(),{appState:{...t,openDialog:t.openDialog?.name===`help`?null:{name:`help`}},captureUpdate:N.EVENTUALLY}),keyTest:e=>e.key===D.QUESTION_MARK}),uy=e=>{if(e.length>=2){let t=e[0].groupIds;for(let n of t)if(e.reduce((e,t)=>e&&Xi(t,n),!0))return!0}return!1},dy=(e,t,n)=>{let r=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0});return r.length>=2&&!uy(r)&&!Fc(r)},fy=j({name:`group`,label:`labels.group`,icon:e=>(0,K.jsx)(Za,{theme:e.theme}),trackEvent:{category:`element`},perform:(e,t,n,r)=>{let i=Vn(r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0}));if(i.length<2)return{appState:t,elements:e,captureUpdate:N.EVENTUALLY};let a=ki(t);if(a.length===1){let n=a[0],r=new Set(jo(e,n).map(e=>e.id)),o=new Set(i.map(e=>e.id));if(new Set([...Array.from(r),...Array.from(o)]).size===r.size)return{appState:t,elements:e,captureUpdate:N.EVENTUALLY}}let o=[...e];new Set(i.map(e=>e.frameId)).size>1&&oo(i).forEach((e,t)=>{Pu(e,r.scene.getNonDeletedElementsMap())});let s=Xc(),c=P(i);o=o.map(e=>c.get(e.id)?A(e,{groupIds:ln(e.groupIds,s,t.editingGroupId)}):e);let l=jo(o,s),u=l[l.length-1],d=o.lastIndexOf(u),f=o.slice(d+1),p=Rt([...o.slice(0,d).filter(e=>!Xi(e,s)),...l,...f],P(l));return{appState:{...t,...hi(s,{...t,selectedGroupIds:{}},U(o))},elements:p,captureUpdate:N.IMMEDIATELY}},predicate:(e,t,n,r)=>dy(e,t,r),keyTest:e=>!e.shiftKey&&e[D.CTRL_OR_CMD]&&e.key===D.G,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!dy(e,t,r),type:`button`,icon:(0,K.jsx)(Za,{theme:t.theme}),onClick:()=>n(null),title:`${q(`labels.group`)} \u2014 ${k(`CtrlOrCmd+G`)}`,"aria-label":q(`labels.group`),visible:js(U(e),t)})}),py=j({name:`ungroup`,label:`labels.ungroup`,icon:e=>(0,K.jsx)(pl,{theme:e.theme}),trackEvent:{category:`element`},perform:(e,t,n,r)=>{let i=ki(t),a=P(e);if(i.length===0)return{appState:t,elements:e,captureUpdate:N.EVENTUALLY};let o=[...e],s=[];o=o.map(e=>{Ba(e)&&s.push(e.id);let n=al(e.groupIds,t.selectedGroupIds);return n.length===e.groupIds.length?e:A(e,{groupIds:n})});let c=Rl(t,U(o),t,null),l=r.scene.getSelectedElements(t),u=new Set(l.filter(e=>e.frameId).map(e=>e.frameId));return sa(e).filter(e=>u.has(e.id)).forEach(e=>{e&&(o=Un(o,ol(o,e,t,a),e,r))}),c.selectedElementIds=Object.entries(c.selectedElementIds).reduce((e,[t,n])=>(n&&!s.includes(t)&&(e[t]=!0),e),{}),{appState:{...t,...c},elements:o,captureUpdate:N.IMMEDIATELY}},keyTest:e=>e.shiftKey&&e[D.CTRL_OR_CMD]&&e.key===D.G.toUpperCase(),predicate:(e,t)=>ki(t).length>0,PanelComponent:({elements:e,appState:t,updateData:n})=>(0,K.jsx)(J,{type:`button`,hidden:ki(t).length===0,icon:(0,K.jsx)(pl,{theme:t.theme}),onClick:()=>n(null),title:`${q(`labels.ungroup`)} \u2014 ${k(`CtrlOrCmd+Shift+G`)}`,"aria-label":q(`labels.ungroup`),visible:js(U(e),t)})}),my=(e,t,n,r,i,a,o)=>{e.beginPath(),e.moveTo(t+a,n),e.lineTo(t+r-a,n),e.quadraticCurveTo(t+r,n,t+r,n+a),e.lineTo(t+r,n+i-a),e.quadraticCurveTo(t+r,n+i,t+r-a,n+i),e.lineTo(t+a,n+i),e.quadraticCurveTo(t,n+i,t,n+i-a),e.lineTo(t,n+a),e.quadraticCurveTo(t,n,t+a,n),e.closePath(),e.fill(),o&&(e.strokeStyle=o),e.stroke()};function hy(e){let t=0;if(e.length===0)return t;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);t=(t<<5)-t+r}return t}var gy=(e,t)=>`hsl(${Math.abs(hy(t?.id||e))%37*10}, 100%, 83%)`,_y=e=>{let t=e?.trim()?.codePointAt(0);return(t?String.fromCodePoint(t):`?`).toUpperCase()},vy=({context:e,renderConfig:t,appState:n,normalizedWidth:r,normalizedHeight:i})=>{for(let[a,o]of t.remotePointerViewportCoords){let{x:s,y:c}=o,l=n.collaborators.get(a);s-=n.offsetLeft,c-=n.offsetTop;let u=s<0||s>r-11||c<0||c>i-14;s=Math.max(s,0),s=Math.min(s,r-11),c=Math.max(c,0),c=Math.min(c,i-14);let d=gy(a,l);e.save(),e.strokeStyle=d,e.fillStyle=d;let f=t.remotePointerUserStates.get(a),p=u||f===`idle`||f===`away`;p&&(e.globalAlpha=.3),t.remotePointerButton.get(a)===`down`&&(e.beginPath(),e.arc(s,c,15,0,2*Math.PI,!1),e.lineWidth=3,e.strokeStyle=`#ffffff88`,e.stroke(),e.closePath(),e.beginPath(),e.arc(s,c,15,0,2*Math.PI,!1),e.lineWidth=1,e.strokeStyle=d,e.stroke(),e.closePath());let m=n.theme===R.DARK?`#2f6330`:Vo,h=l?.isSpeaking;h&&(e.fillStyle=m,e.strokeStyle=m,e.lineWidth=10,e.lineJoin=`round`,e.beginPath(),e.moveTo(s,c),e.lineTo(s+0,c+14),e.lineTo(s+4,c+9),e.lineTo(s+11,c+8),e.closePath(),e.stroke(),e.fill()),e.fillStyle=mn,e.strokeStyle=mn,e.lineWidth=6,e.lineJoin=`round`,e.beginPath(),e.moveTo(s,c),e.lineTo(s+0,c+14),e.lineTo(s+4,c+9),e.lineTo(s+11,c+8),e.closePath(),e.stroke(),e.fill(),e.fillStyle=d,e.strokeStyle=d,e.lineWidth=2,e.lineJoin=`round`,e.beginPath(),p?(e.moveTo(s-1,c-1),e.lineTo(s-1,c+15),e.lineTo(s+5,c+10),e.lineTo(s+12,c+9),e.closePath(),e.fill()):(e.moveTo(s,c),e.lineTo(s+0,c+14),e.lineTo(s+4,c+9),e.lineTo(s+11,c+8),e.closePath(),e.fill(),e.stroke());let g=t.remotePointerUsernames.get(a)||``;if(!u&&g){e.font=`600 12px sans-serif`;let t=(h?s+0:s)+11/2,n=(h?c+0:c)+14+2,r=e.measureText(g),i=r.actualBoundingBoxDescent+r.actualBoundingBoxAscent,a=Math.max(i,12),o=t-1,l=n-1,u=r.width+2+10+2,f=a+2+6+2;e.roundRect?(e.beginPath(),e.roundRect(o,l,u,f,8),e.fillStyle=d,e.fill(),e.strokeStyle=`#ffffff`,e.stroke(),h&&(e.beginPath(),e.roundRect(o-2,l-2,u+4,f+4,8),e.strokeStyle=m,e.stroke())):my(e,o,l,u,f,8,`#ffffff`),e.fillStyle=`#1e1e1e`,e.fillText(g,t+5+1,n+3+r.actualBoundingBoxAscent+Math.floor((a-i)/2)+2),h&&(e.fillStyle=m,e.fillRect(o+u+8,l+(f/2-8/2),2,8),e.fillRect(o+u+8+5,l+(f/2-16/2),2,16),e.fillRect(o+u+8+10,l+(f/2-8/2),2,8))}e.restore(),e.closePath()}},yy=({color:e,onClick:t,name:n,src:r,className:i})=>{let a=_y(n),[o,s]=(0,G.useState)(!1),c=!o&&r,l=c?void 0:{background:e};return(0,K.jsx)(`div`,{className:L(`Avatar`,i),style:l,onClick:t,children:c?(0,K.jsx)(`img`,{className:`Avatar-img`,src:r,alt:a,referrerPolicy:`no-referrer`,onError:()=>s(!0)}):a})};j({name:`goToCollaborator`,label:`Go to a collaborator`,viewMode:!0,trackEvent:{category:`collab`},perform:(e,t,n)=>!n.socketId||t.userToFollow?.socketId===n.socketId||n.isCurrentUser?{appState:{...t,userToFollow:null},captureUpdate:N.EVENTUALLY}:{appState:{...t,userToFollow:{socketId:n.socketId,username:n.username||``},openMenu:t.openMenu===`canvas`?null:t.openMenu},captureUpdate:N.EVENTUALLY},PanelComponent:({updateData:e,data:t,appState:n})=>{let{socketId:r,collaborator:i,withName:a,isBeingFollowed:o}=t,s=gy(r,i),c=L({"is-followed":o,"is-current-user":i.isCurrentUser===!0,"is-speaking":i.isSpeaking,"is-in-call":i.isInCall,"is-muted":i.isMuted}),l=i.isInCall?i.isSpeaking?(0,K.jsxs)(`div`,{className:`UserList__collaborator-status-icon-speaking-indicator`,title:q(`userList.hint.isSpeaking`),children:[(0,K.jsx)(`div`,{}),(0,K.jsx)(`div`,{}),(0,K.jsx)(`div`,{})]}):i.isMuted?(0,K.jsx)(`div`,{className:`UserList__collaborator-status-icon-microphone-muted`,title:q(`userList.hint.micMuted`),children:ou}):(0,K.jsx)(`div`,{title:q(`userList.hint.inCall`),children:Mi}):null;return a?(0,K.jsxs)(`div`,{className:`dropdown-menu-item dropdown-menu-item-base UserList__collaborator ${c}`,style:{"--avatar-size":`1.5rem`},onClick:()=>e(i),children:[(0,K.jsx)(yy,{color:s,onClick:()=>{},name:i.username||``,src:i.avatarUrl,className:c}),(0,K.jsx)(`div`,{className:`UserList__collaborator-name`,children:i.username}),(0,K.jsxs)(`div`,{className:`UserList__collaborator-status-icons`,"aria-hidden":!0,children:[o&&(0,K.jsx)(`div`,{className:`UserList__collaborator-status-icon-is-followed`,title:q(`userList.hint.followStatus`),children:lo}),l]})]}):(0,K.jsxs)(`div`,{className:`UserList__collaborator UserList__collaborator--avatar-only ${c}`,children:[(0,K.jsx)(yy,{color:s,onClick:()=>{e(i)},name:i.username||``,src:i.avatarUrl,className:c}),l&&(0,K.jsx)(`div`,{className:`UserList__collaborator-status-icon`,children:l})]})}});var by=j({name:`addToLibrary`,trackEvent:{category:`element`},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});for(let e of $o)if(i.some(t=>t.type===e))return{captureUpdate:N.EVENTUALLY,appState:{...t,errorMessage:q(`errors.libraryElementTypeError.${e}`)}};return r.library.getLatestLibrary().then(e=>r.library.setLibrary([{id:Xc(),status:`unpublished`,elements:i.map(Ge),created:Date.now()},...e])).then(()=>({captureUpdate:N.EVENTUALLY,appState:{...t,toast:{message:q(`toast.addedToLibrary`)}}})).catch(e=>({captureUpdate:N.EVENTUALLY,appState:{...t,errorMessage:e.message}}))},label:`labels.addToLibrary`}),xy=(e,t,n,r)=>{let i=Cc(e,t),a=fs(e);return i.flatMap(e=>{let t=Sy(e,a,n);return e.map(n=>{let i=W(n,{x:n.x+t.x,y:n.y+t.y});return ao(n,r.getNonDeletedElementsMap(),{simultaneouslyUpdated:e}),i})})},Sy=(e,t,{axis:n,position:r})=>{let i=fs(e),[a,o]=n===`x`?[`minX`,`maxX`]:[`minY`,`maxY`],s={x:0,y:0};return r===`start`?{...s,[n]:t[a]-i[a]}:r===`end`?{...s,[n]:t[o]-i[o]}:{...s,[n]:(t[a]+t[o])/2-(i[a]+i[o])/2}},Cy=(e,t)=>{let n=t.scene.getSelectedElements(e);return n.length>1&&!n.some(e=>M(e))},wy=(e,t,n,r)=>{let i=P(xy(n.scene.getSelectedElements(t),P(e),r,n.scene));return ja(e.map(e=>i.get(e.id)||e),t,n)};j({name:`alignTop`,label:`labels.alignTop`,icon:ze,trackEvent:{category:`element`},predicate:(e,t,n,r)=>Cy(t,r),perform:(e,t,n,r)=>({appState:t,elements:wy(e,t,r,{position:`start`,axis:`y`}),captureUpdate:N.IMMEDIATELY}),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&e.key===D.ARROW_UP,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Cy(t,r),type:`button`,icon:ze,onClick:()=>n(null),title:`${q(`labels.alignTop`)} \u2014 ${k(`CtrlOrCmd+Shift+Up`)}`,"aria-label":q(`labels.alignTop`),visible:js(U(e),t)})}),j({name:`alignBottom`,label:`labels.alignBottom`,icon:Va,trackEvent:{category:`element`},predicate:(e,t,n,r)=>Cy(t,r),perform:(e,t,n,r)=>({appState:t,elements:wy(e,t,r,{position:`end`,axis:`y`}),captureUpdate:N.IMMEDIATELY}),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&e.key===D.ARROW_DOWN,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Cy(t,r),type:`button`,icon:Va,onClick:()=>n(null),title:`${q(`labels.alignBottom`)} \u2014 ${k(`CtrlOrCmd+Shift+Down`)}`,"aria-label":q(`labels.alignBottom`),visible:js(U(e),t)})}),j({name:`alignLeft`,label:`labels.alignLeft`,icon:ko,trackEvent:{category:`element`},predicate:(e,t,n,r)=>Cy(t,r),perform:(e,t,n,r)=>({appState:t,elements:wy(e,t,r,{position:`start`,axis:`x`}),captureUpdate:N.IMMEDIATELY}),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&e.key===D.ARROW_LEFT,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Cy(t,r),type:`button`,icon:ko,onClick:()=>n(null),title:`${q(`labels.alignLeft`)} \u2014 ${k(`CtrlOrCmd+Shift+Left`)}`,"aria-label":q(`labels.alignLeft`),visible:js(U(e),t)})}),j({name:`alignRight`,label:`labels.alignRight`,icon:sl,trackEvent:{category:`element`},predicate:(e,t,n,r)=>Cy(t,r),perform:(e,t,n,r)=>({appState:t,elements:wy(e,t,r,{position:`end`,axis:`x`}),captureUpdate:N.IMMEDIATELY}),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&e.key===D.ARROW_RIGHT,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Cy(t,r),type:`button`,icon:sl,onClick:()=>n(null),title:`${q(`labels.alignRight`)} \u2014 ${k(`CtrlOrCmd+Shift+Right`)}`,"aria-label":q(`labels.alignRight`),visible:js(U(e),t)})}),j({name:`alignVerticallyCentered`,label:`labels.centerVertically`,icon:ms,trackEvent:{category:`element`},predicate:(e,t,n,r)=>Cy(t,r),perform:(e,t,n,r)=>({appState:t,elements:wy(e,t,r,{position:`center`,axis:`y`}),captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Cy(t,r),type:`button`,icon:ms,onClick:()=>n(null),title:q(`labels.centerVertically`),"aria-label":q(`labels.centerVertically`),visible:js(U(e),t)})}),j({name:`alignHorizontallyCentered`,label:`labels.centerHorizontally`,icon:Pe,trackEvent:{category:`element`},predicate:(e,t,n,r)=>Cy(t,r),perform:(e,t,n,r)=>({appState:t,elements:wy(e,t,r,{position:`center`,axis:`x`}),captureUpdate:N.IMMEDIATELY}),PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Cy(t,r),type:`button`,icon:Pe,onClick:()=>n(null),title:q(`labels.centerHorizontally`),"aria-label":q(`labels.centerHorizontally`),visible:js(U(e),t)})});var Ty=(e,t,n)=>{let[r,i,a,o]=n.axis===`x`?[`minX`,`midX`,`maxX`,`width`]:[`minY`,`midY`,`maxY`,`height`],s=fs(e),c=Cc(e,t).map(e=>[e,fs(e)]).sort((e,t)=>e[1][i]-t[1][i]),l=0;for(let e of c)l+=e[1][o];let u=(s[o]-l)/(c.length-1);if(u<0){let e=c.findIndex(e=>e[1][r]===s[r]),t=c.findIndex(e=>e[1][a]===s[a]),o=(c[t][1][i]-c[e][1][i])/(c.length-1),l=c[e][1][i];return c.flatMap(([r,a],s)=>{let c={x:0,y:0};return s!==e&&s!==t&&(l+=o,c[n.axis]=l-a[i]),r.map(e=>A(e,{x:e.x+c.x,y:e.y+c.y}))})}let d=s[r];return c.flatMap(([e,t])=>{let i={x:0,y:0};return i[n.axis]=d-t[r],d+=u,d+=t[o],e.map(e=>A(e,{x:e.x+i.x,y:e.y+i.y}))})},Ey=(e,t)=>{let n=t.scene.getSelectedElements(e);return n.length>1&&!n.some(e=>M(e))},Dy=(e,t,n,r)=>{let i=P(Ty(n.scene.getSelectedElements(t),n.scene.getNonDeletedElementsMap(),r));return ja(e.map(e=>i.get(e.id)||e),t,n)};j({name:`distributeHorizontally`,label:`labels.distributeHorizontally`,trackEvent:{category:`element`},perform:(e,t,n,r)=>({appState:t,elements:Dy(e,t,r,{space:`between`,axis:`x`}),captureUpdate:N.IMMEDIATELY}),keyTest:e=>!e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.H,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Ey(t,r),type:`button`,icon:Ln,onClick:()=>n(null),title:`${q(`labels.distributeHorizontally`)} \u2014 ${k(`Alt+H`)}`,"aria-label":q(`labels.distributeHorizontally`),visible:js(U(e),t)})}),j({name:`distributeVertically`,label:`labels.distributeVertically`,trackEvent:{category:`element`},perform:(e,t,n,r)=>({appState:t,elements:Dy(e,t,r,{space:`between`,axis:`y`}),captureUpdate:N.IMMEDIATELY}),keyTest:e=>!e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.V,PanelComponent:({elements:e,appState:t,updateData:n,app:r})=>(0,K.jsx)(J,{hidden:!Ey(t,r),type:`button`,icon:$e,onClick:()=>n(null),title:`${q(`labels.distributeVertically`)} \u2014 ${k(`Alt+V`)}`,"aria-label":q(`labels.distributeVertically`),visible:js(U(e),t)})});var Oy=j({name:`flipHorizontal`,label:`labels.flipHorizontal`,icon:vc,trackEvent:{category:`element`},perform:(e,t,n,r)=>({elements:ja(Ay(e,r.scene.getNonDeletedElementsMap(),t,`horizontal`,r),t,r),appState:t,captureUpdate:N.IMMEDIATELY}),keyTest:e=>e.shiftKey&&e.code===E.H}),ky=j({name:`flipVertical`,label:`labels.flipVertical`,icon:_u,trackEvent:{category:`element`},perform:(e,t,n,r)=>({elements:ja(Ay(e,r.scene.getNonDeletedElementsMap(),t,`vertical`,r),t,r),appState:t,captureUpdate:N.IMMEDIATELY}),keyTest:e=>e.shiftKey&&e.code===E.V&&!e[D.CTRL_OR_CMD]}),Ay=(e,t,n,r,i)=>{let a=P(jy(V(U(e),n,{includeBoundTextElement:!0,includeElementsInFrames:!0}),t,n,r,i));return e.map(e=>a.get(e.id)||e)},jy=(e,t,n,r,i)=>{if(e.every(e=>Lc(e)&&(e.startBinding||e.endBinding)))return e.map(e=>{let t=e;return A(t,{startArrowhead:t.endArrowhead,endArrowhead:t.startArrowhead})});let{midX:a,midY:o}=fs(e);Hn(e,t,`nw`,i.scene,new Map(Array.from(t.values()).map(e=>[e.id,Ge(e)])),{flipByX:r===`horizontal`,flipByY:r===`vertical`,shouldResizeFromCenter:!0,shouldMaintainAspectRatio:!0}),Js(e.filter(fc),t,i.scene.getNonDeletedElements(),i.scene,wt(n),[],n.zoom);let{elbowArrows:s,otherElements:c}=e.reduce((e,t)=>B(t)?{...e,elbowArrows:e.elbowArrows.concat(t)}:{...e,otherElements:e.otherElements.concat(t)},{elbowArrows:[],otherElements:[]}),{midX:l,midY:u}=fs(e),[d,f]=[a-l,o-u];return c.forEach(e=>W(e,{x:e.x+d,y:e.y+f})),s.forEach(e=>W(e,{x:e.x+d,y:e.y+f})),e},My=j({name:`copy`,label:`labels.copy`,icon:Ea,trackEvent:{category:`element`},perform:async(e,t,n,r)=>{let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});try{await so(i,r.files,n)}catch(e){return{captureUpdate:N.EVENTUALLY,appState:{...t,errorMessage:e.message}}}return{captureUpdate:N.EVENTUALLY}},keyTest:void 0}),Ny=j({name:`paste`,label:`labels.paste`,trackEvent:{category:`element`},perform:async(e,t,n,r)=>{let i;try{i=await lc()}catch(e){return e.name===`AbortError`||e.name===`NotAllowedError`?!1:(console.error(`actionPaste ${e.name}: ${e.message}`),qc?{captureUpdate:N.EVENTUALLY,appState:{...t,errorMessage:q(`hints.firefox_clipboard_write`)}}:{captureUpdate:N.EVENTUALLY,appState:{...t,errorMessage:q(`errors.asyncPasteFailedOnRead`)}})}try{r.pasteFromClipboard(ge({types:i}))}catch(e){return console.error(e),{captureUpdate:N.EVENTUALLY,appState:{...t,errorMessage:q(`errors.asyncPasteFailedOnParse`)}}}return{captureUpdate:N.EVENTUALLY}},keyTest:void 0}),Py=j({name:`cut`,label:`labels.cut`,icon:li,trackEvent:{category:`element`},perform:(e,t,n,r)=>(My.perform(e,t,n,r),Wg.perform(e,t,null,r)),keyTest:e=>e[D.CTRL_OR_CMD]&&e.key===D.X}),Fy=j({name:`copyAsSvg`,label:`labels.copyAsSvg`,icon:In,trackEvent:{category:`element`},perform:async(e,t,n,r)=>{if(!r.canvas)return{captureUpdate:N.EVENTUALLY};let{exportedElements:i,exportingFrame:a}=Jv(e,t,!0);try{return await Yv(`clipboard-svg`,i,t,r.files,{...t,exportingFrame:a,name:r.getName()}),{appState:{toast:{message:q(`toast.copyToClipboardAsSvg`,{exportSelection:r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}).length?q(`toast.selection`):q(`toast.canvas`),exportColorScheme:t.exportWithDarkMode?q(`buttons.darkMode`):q(`buttons.lightMode`)})}},captureUpdate:N.EVENTUALLY}}catch(e){return console.error(e),{appState:{errorMessage:e.message},captureUpdate:N.EVENTUALLY}}},predicate:e=>Yo&&e.length>0,keywords:[`svg`,`clipboard`,`copy`]}),Iy=j({name:`copyAsPng`,label:`labels.copyAsPng`,icon:Ac,trackEvent:{category:`element`},perform:async(e,t,n,r)=>{if(!r.canvas)return{captureUpdate:N.EVENTUALLY};let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}),{exportedElements:a,exportingFrame:o}=Jv(e,t,!0);try{return await Yv(`clipboard`,a,t,r.files,{...t,exportingFrame:o,name:r.getName()}),{appState:{...t,toast:{message:q(`toast.copyToClipboardAsPng`,{exportSelection:i.length?q(`toast.selection`):q(`toast.canvas`),exportColorScheme:t.exportWithDarkMode?q(`buttons.darkMode`):q(`buttons.lightMode`)})}},captureUpdate:N.EVENTUALLY}}catch(e){return console.error(e),{appState:{...t,errorMessage:e.message},captureUpdate:N.EVENTUALLY}}},predicate:e=>$t&&e.length>0,keyTest:e=>e.code===E.C&&e.altKey&&e.shiftKey,keywords:[`png`,`clipboard`,`copy`]}),Ly=j({name:`copyText`,label:`labels.copyText`,trackEvent:{category:`element`},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0});try{Gt(rr(i))}catch{throw Error(q(`errors.copyToSystemClipboardFailed`))}return{captureUpdate:N.EVENTUALLY}},predicate:(e,t,n,r)=>Yo&&r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0}).some(H),keywords:[`text`,`clipboard`,`copy`]}),Ry=j({name:`gridMode`,icon:wa,keywords:[`snap`],label:`labels.toggleGrid`,viewMode:!0,trackEvent:{category:`canvas`,predicate:e=>e.gridModeEnabled},perform(e,t){return{appState:{...t,gridModeEnabled:!this.checked(t),objectsSnapModeEnabled:!1},captureUpdate:N.EVENTUALLY}},checked:e=>e.gridModeEnabled,predicate:(e,t,n)=>n.gridModeEnabled===void 0,keyTest:e=>e[D.CTRL_OR_CMD]&&e.code===E.QUOTE}),zy=j({name:`zenMode`,label:`buttons.zenMode`,icon:hl,paletteName:`Toggle zen mode`,viewMode:!0,trackEvent:{category:`canvas`,predicate:e=>!e.zenModeEnabled},perform(e,t){return{appState:{...t,zenModeEnabled:!this.checked(t)},captureUpdate:N.EVENTUALLY}},checked:e=>e.zenModeEnabled,predicate:(e,t,n)=>typeof n.zenModeEnabled>`u`,keyTest:e=>!e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.Z}),By=j({name:`objectsSnapMode`,label:`buttons.objectsSnapMode`,icon:Pl,viewMode:!1,trackEvent:{category:`canvas`,predicate:e=>!e.objectsSnapModeEnabled},perform(e,t){return{appState:{...t,objectsSnapModeEnabled:!this.checked(t),gridModeEnabled:!1},captureUpdate:N.EVENTUALLY}},checked:e=>e.objectsSnapModeEnabled,predicate:(e,t,n)=>typeof n.objectsSnapModeEnabled>`u`,keyTest:e=>!e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.S}),Vy=j({name:`stats`,label:`stats.fullTitle`,icon:Bt,paletteName:`Toggle stats`,viewMode:!0,trackEvent:{category:`menu`},keywords:[`edit`,`attributes`,`customize`],perform(e,t){return{appState:{...t,stats:{...t.stats,open:!this.checked(t)}},captureUpdate:N.EVENTUALLY}},checked:e=>e.stats.open,keyTest:e=>!e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.SLASH}),Hy=j({name:`unbindText`,label:`labels.unbindText`,trackEvent:{category:`element`},predicate:(e,t,n,r)=>r.scene.getSelectedElements(t).some(e=>Ou(e)),perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t),a=r.scene.getNonDeletedElementsMap();return i.forEach(e=>{let t=w(e,a);if(t){let{width:n,height:r}=Nn(t.originalText,Cs(t),t.lineHeight),i=Ga(e.id);Ie(e.id);let{x:o,y:s}=Vr(e,t,a);W(t,{containerId:null,width:n,height:r,text:t.originalText,x:o,y:s}),W(e,{boundElements:e.boundElements?.filter(e=>e.id!==t.id),height:i||e.height})}}),{elements:e,appState:t,captureUpdate:N.IMMEDIATELY}}}),Uy=j({name:`bindText`,label:`labels.bindText`,trackEvent:{category:`element`},predicate:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t);if(i.length===2){let e=H(i[0])||H(i[1]),t;if(Hu(i[0])?t=i[0]:Hu(i[1])&&(t=i[1]),e&&t&&w(t,r.scene.getNonDeletedElementsMap())===null)return!0}return!1},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t),a,o;H(i[0])&&Hu(i[1])?(a=i[0],o=i[1]):(a=i[1],o=i[0]),W(a,{containerId:o.id,verticalAlign:ri.MIDDLE,textAlign:to.CENTER,autoResize:!0}),W(o,{boundElements:(o.boundElements||[]).concat({type:`text`,id:a.id})});let s=o.height;return pu(a,o,r.scene.getNonDeletedElementsMap()),Ur(o.id,s),{elements:Wy(e,o,a),appState:{...t,selectedElementIds:{[o.id]:!0}},captureUpdate:N.IMMEDIATELY}}}),Wy=(e,t,n)=>{let r=e.slice(),i=r.findIndex(e=>e.id===n.id);r.splice(i,1);let a=r.findIndex(e=>e.id===t.id);return r.splice(a+1,0,n),Rt(r,P([t,n])),r},Gy=(e,t,n)=>{let r=e.slice(),i=r.findIndex(e=>e.id===t.id);r.splice(i,1);let a=r.findIndex(e=>e.id===n.id);return r.splice(a,0,t),Rt(r,P([t,n])),r},Ky=j({name:`wrapTextInContainer`,label:`labels.createContainerFromText`,trackEvent:{category:`element`},predicate:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t),a=i.every(e=>H(e));return i.length>0&&a},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t),a=e.slice(),o={};for(let e of i)if(H(e)){let n=ni({type:`rectangle`,backgroundColor:t.currentItemBackgroundColor,boundElements:[...e.boundElements||[],{id:e.id,type:`text`}],angle:e.angle,fillStyle:t.currentItemFillStyle,strokeColor:t.currentItemStrokeColor,roughness:t.currentItemRoughness,strokeWidth:t.currentItemStrokeWidth,strokeStyle:t.currentItemStrokeStyle,roundness:t.currentItemRoundness===`round`?{type:Ar(`rectangle`)?Pc.ADAPTIVE_RADIUS:Pc.PROPORTIONAL_RADIUS}:null,opacity:100,locked:!1,x:e.x-5,y:e.y-5,width:Lu(e.width,`rectangle`),height:Lu(e.height,`rectangle`),groupIds:e.groupIds,frameId:e.frameId});if(e.boundElements?.length){let t=e.boundElements.filter(e=>e.type===`arrow`).map(e=>e.id);a.filter(e=>t.includes(e.id)).forEach(t=>{let r=t.startBinding,i=t.endBinding;r?.elementId===e.id&&(r={...r,elementId:n.id}),i?.elementId===e.id&&(i={...i,elementId:n.id}),(r||i)&&W(t,{startBinding:r,endBinding:i},!1)})}W(e,{containerId:n.id,verticalAlign:ri.MIDDLE,boundElements:null,textAlign:to.CENTER,autoResize:!0},!1),pu(e,n,r.scene.getNonDeletedElementsMap()),a=Gy([...a,n],n,e),o[n.id]=!0}return{elements:a,appState:{...t,selectedElementIds:o},captureUpdate:N.IMMEDIATELY}}}),qy=380,Jy=42,Yy=5,Xy=85,Zy=500,Qy=!1,$y=new Map,eb=({element:e,elementsMap:t,setAppState:n,onLinkOpen:r,setToast:i,updateEmbedValidationStatus:a})=>{let o=CD(),s=yD(),c=bD(),l=e.link||``,[u,d]=(0,G.useState)(l),f=(0,G.useRef)(null),p=o.showHyperlinkPopup===`editor`,m=(0,G.useCallback)(()=>{if(!f.current)return;let t=Sn(f.current.value)||null;if(!e.link&&t&&Y(`hyperlink`,`create`),Fn(e)){if(o.activeEmbeddable?.element===e&&n({activeEmbeddable:null}),!t){W(e,{link:null}),a(e,!1);return}if(!mr(t,s.validateEmbeddable))t&&i({message:q(`toast.unableToEmbed`),closable:!0}),e.link&&$y.set(e.id,e.link),W(e,{link:t}),a(e,!1);else{let{width:n,height:r}=e,o=Ji(t);o?.error instanceof URIError&&i({message:q(`toast.unrecognizedLinkFormat`),closable:!0});let s=o?o.intrinsicSize.w/o.intrinsicSize.h:1;W(e,{...$y.get(e.id)===e.link?{}:{width:o?.type===`video`?n>r?n:r*s:n,height:o?.type===`video`&&n>r?n/s:r},link:t}),a(e,!0),$y.has(e.id)&&$y.delete(e.id)}}else W(e,{link:t})},[e,i,s.validateEmbeddable,o.activeEmbeddable,n,a]);(0,G.useLayoutEffect)(()=>()=>{m()},[m]),(0,G.useEffect)(()=>{p&&f?.current&&!(c.viewport.isMobile||c.isTouchScreen)&&f.current.select()},[p,c.viewport.isMobile,c.isTouchScreen]),(0,G.useEffect)(()=>{let r=null,i=i=>{p||(r&&clearTimeout(r),sb(e,t,o,I(i.clientX,i.clientY))&&(r=window.setTimeout(()=>{n({showHyperlinkPopup:!1})},Zy)))};return window.addEventListener(`pointermove`,i,!1),()=>{window.removeEventListener(`pointermove`,i,!1),r&&clearTimeout(r)}},[o,e,p,n,t]);let h=(0,G.useCallback)(()=>{Y(`hyperlink`,`delete`),W(e,{link:null}),n({showHyperlinkPopup:!1})},[n,e]),g=()=>{Y(`hyperlink`,`edit`,`popup-ui`),n({showHyperlinkPopup:`editor`})},{x:_,y:v}=tb(e,o,t);return o.contextMenu||o.selectedElementsAreBeingDragged||o.resizingElement||o.isRotating||o.openMenu||o.viewModeEnabled?null:(0,K.jsxs)(`div`,{className:`excalidraw-hyperlinkContainer`,style:{top:`${v}px`,left:`${_}px`,width:qy,padding:Yy},children:[p?(0,K.jsx)(`input`,{className:L(`excalidraw-hyperlinkContainer-input`),placeholder:q(`labels.link.hint`),ref:f,value:u,onChange:e=>d(e.target.value),autoFocus:!0,onKeyDown:e=>{e.stopPropagation(),e[D.CTRL_OR_CMD]&&e.key===D.K&&e.preventDefault(),(e.key===D.ENTER||e.key===D.ESCAPE)&&(m(),n({showHyperlinkPopup:`info`}))}}):e.link?(0,K.jsx)(`a`,{href:Sn(e.link||``),className:`excalidraw-hyperlinkContainer-link`,target:Au(e.link)?`_self`:`_blank`,onClick:t=>{if(e.link&&r){let n=Kl(`excalidraw-link`,t.nativeEvent);r({...e,link:Sn(e.link)},n),n.defaultPrevented&&t.preventDefault()}},rel:`noopener noreferrer`,children:e.link}):(0,K.jsx)(`div`,{className:`excalidraw-hyperlinkContainer-link`,children:q(`labels.link.empty`)}),(0,K.jsxs)(`div`,{className:`excalidraw-hyperlinkContainer__buttons`,children:[!p&&(0,K.jsx)(J,{type:`button`,title:q(`buttons.edit`),"aria-label":q(`buttons.edit`),label:q(`buttons.edit`),onClick:g,className:`excalidraw-hyperlinkContainer--edit`,icon:Bu}),(0,K.jsx)(J,{type:`button`,title:q(`labels.linkToElement`),"aria-label":q(`labels.linkToElement`),label:q(`labels.linkToElement`),onClick:()=>{n({openDialog:{name:`elementLinkSelector`,sourceElementId:e.id}})},icon:Zt}),l&&!Fn(e)&&(0,K.jsx)(J,{type:`button`,title:q(`buttons.remove`),"aria-label":q(`buttons.remove`),label:q(`buttons.remove`),onClick:h,className:`excalidraw-hyperlinkContainer--remove`,icon:Bs})]})]})},tb=(e,t,n)=>{let[r,i]=Le(e,n),{x:a,y:o}=ga({sceneX:r+e.width/2,sceneY:i},t);return{x:a-t.offsetLeft-qy/2,y:o-t.offsetTop-Xy}},nb=(e,t)=>{let n=V(e,t);return Fn(n[0])?`labels.link.editEmbed`:n[0]?.link?`labels.link.edit`:`labels.link.create`},rb=null,ib=(e,t,n)=>{rb&&clearTimeout(rb),rb=window.setTimeout(()=>ab(e,t,n),300)},ab=(e,t,n)=>{if(!e.link)return;let r=jv();r.classList.add(`excalidraw-tooltip--visible`),r.style.maxWidth=`20rem`,r.textContent=Jl(e.link)?q(`labels.link.goToElement`):e.link;let[i,a,o,s]=Le(e,n),[c,l,u,d]=jc([i,a,o,s],e.angle,t),f=ga({sceneX:c,sceneY:l},t);Mv(r,{left:f.x,top:f.y,width:u,height:d},`top`),Y(`hyperlink`,`tooltip`,`link-icon`),Qy=!0},ob=()=>{rb&&clearTimeout(rb),Qy&&(Qy=!1,jv().classList.remove(`excalidraw-tooltip--visible`))},sb=(e,t,n,[r,i])=>{let{x:a,y:o}=Fs({clientX:r,clientY:i},n),s=15/n.zoom.value;if(zu(a,o,e,t))return!1;let[c,l,u]=Le(e,t);if(a>=c&&a<=u&&o>=l-Xy&&o<=l)return!1;let{x:d,y:f}=tb(e,n,t);return!(r>=d-s&&r<=d+qy+Yy*2+s&&i>=f-s&&i<=f+s+Yy*2+Jy)},cb=j({name:`hyperlink`,label:(e,t)=>nb(e,t),icon:dn,perform:(e,t)=>t.showHyperlinkPopup===`editor`?!1:{elements:e,appState:{...t,showHyperlinkPopup:`editor`,openMenu:null},captureUpdate:N.IMMEDIATELY},trackEvent:{category:`hyperlink`,action:`click`},keyTest:e=>e[D.CTRL_OR_CMD]&&e.key===D.K,predicate:(e,t)=>V(e,t).length===1,PanelComponent:({elements:e,appState:t,updateData:n})=>{let r=V(e,t);return(0,K.jsx)(J,{type:`button`,icon:dn,"aria-label":q(nb(e,t)),title:`${Fn(e[0])?q(`labels.link.labelEmbed`):q(`labels.link.label`)} - ${k(`CtrlOrCmd+K`)}`,onClick:()=>n(null),selected:r.length===1&&!!r[0].link})}}),lb=e=>e.every(e=>!e.locked),ub=j({name:`toggleElementLock`,label:(e,t,n)=>{let r=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!1});return r.length===1&&!M(r[0])?r[0].locked?`labels.elementLock.unlock`:`labels.elementLock.lock`:lb(r)?`labels.elementLock.lockAll`:`labels.elementLock.unlockAll`},icon:(e,t)=>lb(V(t,e))?yr:Xt,trackEvent:{category:`element`},predicate:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t);return i.length>0&&!i.some(e=>e.locked&&e.frameId)},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0});if(!i.length)return!1;let a=lb(i),o=P(i);return{elements:e.map(e=>o.has(e.id)?A(e,{locked:a}):e),appState:{...t,selectedLinearElement:a?null:t.selectedLinearElement},captureUpdate:N.IMMEDIATELY}},keyTest:(e,t,n,r)=>e.key.toLocaleLowerCase()===D.L&&e[D.CTRL_OR_CMD]&&e.shiftKey&&r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!1}).length>0}),db=j({name:`unlockAllElements`,paletteName:`Unlock all elements`,trackEvent:{category:`canvas`},viewMode:!1,icon:Xt,predicate:(e,t)=>V(e,t).length===0&&e.some(e=>e.locked),perform:(e,t)=>{let n=e.filter(e=>e.locked);return{elements:e.map(e=>e.locked?A(e,{locked:!1}):e),appState:{...t,selectedElementIds:Object.fromEntries(n.map(e=>[e.id,!0]))},captureUpdate:N.IMMEDIATELY}},label:`labels.elementLock.unlockAll`}),fb=()=>{let[e,t]=(0,G.useState)(null);return[e,(0,G.useCallback)(e=>t(e),[])]},pb=e=>{let{closeOnClickOutside:t=!0}=e,n=R_({className:`excalidraw-modal-container`}),r=(0,G.useRef)(document.body.classList.contains(`excalidraw-animations-disabled`));if(!n)return null;let i=t=>{t.key===D.ESCAPE&&(t.nativeEvent.stopImmediatePropagation(),t.stopPropagation(),e.onCloseRequest())};return(0,pg.createPortal)((0,K.jsxs)(`div`,{className:L(`Modal`,e.className,{"animations-disabled":r.current}),role:`dialog`,"aria-modal":`true`,onKeyDown:i,"aria-labelledby":e.labelledBy,"data-prevent-outside-click":!0,children:[(0,K.jsx)(`div`,{className:`Modal__background`,onClick:t?e.onCloseRequest:void 0}),(0,K.jsx)(`div`,{className:`Modal__content`,style:{"--max-width":`${e.maxWidth}px`},tabIndex:0,children:e.children})]}),n)},mb=Cd(new Map),hb=async e=>await Ae({elements:e,appState:{exportBackground:!1,viewBackgroundColor:Dt.white},files:null,renderEmbeddables:!1,skipInliningFonts:!0}),gb=(e,t,n)=>{let[r,i]=(0,G.useState)();return(0,G.useEffect)(()=>{if(t)if(e){let r=n.get(e);r?i(r):(async()=>{let r=await hb(t);r.querySelector(`.style-fonts`)?.remove(),r&&(n.set(e,r),i(r))})()}else (async()=>{i(await hb(t))})()},[e,t,n,i]),r},_b=()=>{let[e]=xg(mb);return{clearLibraryCache:()=>e.clear(),deleteItemsFromLibraryCache:t=>{t.forEach(t=>e.delete(t))},svgCache:e}},vb=class{constructor(){C(this,`jobs`,[]),C(this,`running`,!1)}tick(){if(this.running)return;let e=this.jobs.shift();e?(this.running=!0,e.promise.resolve(id(e.jobFactory,...e.args).finally(()=>{this.running=!1,this.tick()}))):this.running=!1}push(e,...t){let n=is();return this.jobs.push({jobFactory:e,promise:n,args:t}),this.tick(),n}},yb=new nn,bb=Cd({status:`loaded`,isInitialized:!1,libraryItems:[]}),xb=e=>jn(e),Sb=(e,t)=>!e.find(e=>e.elements.length===t.elements.length?e.elements.every((e,n)=>e.id===t.elements[n].id&&e.versionNonce===t.elements[n].versionNonce):!1),Cb=(e,t)=>{let n=[];for(let r of t)Sb(e,r)&&n.push(r);return[...n,...e]},wb=(e,t)=>{let n=P(t),r={deletedItems:new Map,addedItems:new Map};for(let t of e)n.has(t.id)||r.deletedItems.set(t.id,t);let i=P(e);for(let e of t)i.has(e.id)||r.addedItems.set(e.id,e);return r},Tb=class{constructor(e){C(this,`currLibraryItems`,[]),C(this,`prevLibraryItems`,xb(this.currLibraryItems)),C(this,`app`),C(this,`updateQueue`,[]),C(this,`getLastUpdateTask`,()=>this.updateQueue[this.updateQueue.length-1]),C(this,`notifyListeners`,()=>{if(this.updateQueue.length>0)Eg.set(bb,e=>({status:`loading`,libraryItems:this.currLibraryItems,isInitialized:e.isInitialized}));else{Eg.set(bb,{status:`loaded`,libraryItems:this.currLibraryItems,isInitialized:!0});try{let e=this.prevLibraryItems;this.prevLibraryItems=xb(this.currLibraryItems);let t=xb(this.currLibraryItems);this.app.props.onLibraryChange?.(t),yb.trigger(wb(e,t),t)}catch(e){console.error(e)}}}),C(this,`destroy`,()=>{this.updateQueue=[],this.currLibraryItems=[],Eg.set(mb,new Map)}),C(this,`resetLibrary`,()=>this.setLibrary([])),C(this,`getLatestLibrary`,()=>new Promise(async e=>{try{let t=await(this.getLastUpdateTask()||this.currLibraryItems);this.updateQueue.length>0?e(this.getLatestLibrary()):e(xb(t))}catch{return e(this.currLibraryItems)}})),C(this,`updateLibrary`,async({libraryItems:e,prompt:t=!1,merge:n=!1,openLibraryMenu:r=!1,defaultStatus:i=`unpublished`})=>(r&&this.app.setState({openSidebar:{name:Fu.name,tab:`library`}}),this.setLibrary(()=>new Promise(async(r,a)=>{try{let o=await(typeof e==`function`&&!(e instanceof Blob)?e(this.currLibraryItems):e),s;s=o instanceof Blob?await iu(o,i):_a(o,i),!t||window.confirm(q(`alerts.confirmAddLibrary`,{numShapes:s.length}))?(t&&this.app.focusContainer(),r(n?Cb(this.currLibraryItems,s):s)):a(new En)}catch(e){a(e)}})))),C(this,`setLibrary`,e=>{let t=new Promise(async(t,n)=>{try{await this.getLastUpdateTask(),typeof e==`function`&&(e=e(this.currLibraryItems)),this.currLibraryItems=xb(await e),t(this.currLibraryItems)}catch(e){n(e)}}).catch(e=>{if(e.name===`AbortError`)return console.warn(`Library update aborted by user`),this.currLibraryItems;throw e}).finally(()=>{this.updateQueue=this.updateQueue.filter(e=>e!==t),this.notifyListeners()});return this.updateQueue.push(t),this.notifyListeners(),t}),this.app=e}},Eb=e=>{let t=Math.ceil(Math.sqrt(e.length)),n=[],r=n=>e.slice(n*t,n*t+t).reduce((e,t)=>{let{height:n}=fs(t.elements);return Math.max(e,n)},0),i=n=>{let r=0,i=0,a=0;for(let o of e){if(r%t===0&&(i=0),i===n){let{width:e}=fs(o.elements);a=Math.max(a,e)}r++,i++}return a},a=0,o=0,s=0,c=0,l=0,u=0,d=0;for(let f of e){l&&l%t===0&&(o+=s+50,a=0,u=0,d++),u===0&&(s=r(d)),c=i(u);let{minX:e,minY:p,width:m,height:h}=fs(f.elements),g=(c-m)/2,_=(s-h)/2;n.push(...f.elements.map(t=>({...t,x:t.x+a+g-e,y:t.y+o+_-p}))),a+=c+50,l++,u++}return n},Db=class e{constructor(e){C(this,`adapter`),this.adapter=e}static async getLibraryItems(t,n,r=!0){let i=()=>new Promise(async(e,r)=>{try{e(_a((await t.load({source:n}))?.libraryItems||[],`published`))}catch(e){r(e)}});return r?e.queue.push(i):i()}getLibraryItems(t){return e.getLibraryItems(this.adapter,t,!1)}};C(Db,`queue`,new vb),C(Db,`run`,async(e,t)=>{let n=new Db(e);return Db.queue.push(()=>t(n))});var Ob={Row:(0,G.forwardRef)(({children:e,gap:t,align:n,justifyContent:r,className:i,style:a},o)=>(0,K.jsx)(`div`,{className:L(`Stack Stack_horizontal`,i),style:{"--gap":t,alignItems:n,justifyContent:r,...a},ref:o,children:e})),Col:(0,G.forwardRef)(({children:e,gap:t,align:n,justifyContent:r,className:i,style:a},o)=>(0,K.jsx)(`div`,{className:L(`Stack Stack_vertical`,i),style:{"--gap":t,justifyItems:n,justifyContent:r,...a},ref:o,children:e}))},kb=({theme:e,id:t,libraryReturnUrl:n})=>{let r=n||window.location.origin+window.location.pathname;return(0,K.jsx)(`a`,{className:`library-menu-browse-button`,href:`${pe.VITE_APP_LIBRARY_URL}?target=${window.name||`_blank`}&referrer=${r}&useHash=true&token=${t}&theme=${e}&version=${Eu.excalidrawLibrary}`,target:`_excalidraw_libraries`,children:q(`labels.libraries`)})},Ab=({libraryReturnUrl:e,theme:t,id:n,style:r,children:i,className:a})=>(0,K.jsxs)(`div`,{className:L(`library-menu-control-buttons`,a),style:r,children:[(0,K.jsx)(kb,{id:n,libraryReturnUrl:e,theme:t}),i]}),jb=/({{[\w-]+}})|(<[\w-]+>)|(<\/[\w-]+>)/g,Mb=/{{([\w-]+)}}/,Nb=/<([\w-]+)>/,Pb=/<\/([\w-]+)>/,Fb=(e,t)=>{let n=[{name:``,children:[]}];return e.split(jb).filter(Boolean).forEach(r=>{let i=r.match(Nb),a=r.match(Pb),o=r.match(Mb);if(i!==null){let r=i[1];t.hasOwnProperty(r)?n.push({name:r,children:[]}):console.warn(`Trans: missed to pass in prop ${r} for interpolating ${e}`)}else if(a!==null)if(a[1]===n[n.length-1].name){let e=n.pop(),r=G.createElement(G.Fragment,{},...e.children),i=t[e.name];typeof i==`function`&&n[n.length-1].children.push(i(r))}else console.warn(`Trans: unexpected end tag ${r} for interpolating ${e}`);else if(o!==null){let r=o[1];t.hasOwnProperty(r)?n[n.length-1].children.push(t[r]):console.warn(`Trans: key ${r} not in props for interpolating ${e}`)}else n[n.length-1].children.push(r)}),n.length!==1&&console.warn(`Trans: stack not empty for interpolating ${e}`),n[0].children},Ib=({i18nKey:e,children:t,...n})=>{let{t:r}=Rg();return G.createElement(G.Fragment,{},...Fb(r(e),n))},Lb=({label:e,onClick:t,className:n,children:r,actionType:i,type:a=`button`,isLoading:o,...s})=>(0,K.jsxs)(`button`,{className:L(`Dialog__action-button`,i?`Dialog__action-button--${i}`:``,n),type:a,"aria-label":e,onClick:t,...s,children:[r&&(0,K.jsx)(`div`,{style:o?{visibility:`hidden`}:{},children:r}),(0,K.jsx)(`div`,{style:o?{visibility:`hidden`}:{},children:e}),o&&(0,K.jsx)(`div`,{style:{position:`absolute`,inset:0},children:(0,K.jsx)(zg,{})})]}),Rb=e=>{let{onConfirm:t,onCancel:n,children:r,confirmText:i=q(`buttons.confirm`),cancelText:a=q(`buttons.cancel`),className:o=``,...s}=e,c=wD(),l=Sg(hx),{container:u}=xD();return(0,K.jsxs)(Sx,{onCloseRequest:n,size:`small`,...s,className:`confirm-dialog ${o}`,children:[r,(0,K.jsxs)(`div`,{className:`confirm-dialog-buttons`,children:[(0,K.jsx)(Lb,{label:a,onClick:()=>{c({openMenu:null}),l(!1),(0,mg.flushSync)(()=>{n()}),u?.focus()}}),(0,K.jsx)(Lb,{label:i,onClick:()=>{c({openMenu:null}),l(!1),(0,mg.flushSync)(()=>{t()}),u?.focus()},actionType:`danger`})]})]})},zb=class{static has(e){try{return!!window.localStorage.getItem(e)}catch(e){return console.warn(`localStorage.getItem error: ${e.message}`),!1}}static get(e){try{let t=window.localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.warn(`localStorage.getItem error: ${e.message}`),null}}};C(zb,`set`,(e,t)=>{try{return window.localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return console.warn(`localStorage.setItem error: ${e.message}`),!1}}),C(zb,`delete`,e=>{try{window.localStorage.removeItem(e)}catch(e){console.warn(`localStorage.removeItem error: ${e.message}`)}});var Bb=async e=>{let t=Ut(e,6),n=document.createElement(`canvas`);n.width=t[0].length*128+(t[0].length+1)*16-16,n.height=t.length*128+(t.length+1)*16-16;let r=n.getContext(`2d`);r.fillStyle=qu.white,r.fillRect(0,0,n.width,n.height);for(let[t,n]of e.entries()){let e=await fl({elements:n.elements,files:null,maxWidthOrHeight:128}),{width:i,height:a}=e,o=Math.floor(t/6)*144,s=t%6*144;r.drawImage(e,s+(128-i)/2+8,o+(128-a)/2+8),r.lineWidth=2,r.strokeStyle=qu.gray[4],r.strokeRect(s+8/2,o+8/2,136,136)}return await Ca(new File([await Mu(n)],`preview`,{type:rn.png}),{outputType:rn.jpg,maxWidthOrHeight:5e3})},Vb=({libItem:e,appState:t,index:n,onChange:r,onRemove:i})=>{let a=(0,G.useRef)(null),o=(0,G.useRef)(null);return(0,G.useEffect)(()=>{let n=a.current;n&&(async()=>{n.innerHTML=(await Ae({elements:e.elements,appState:{...t,viewBackgroundColor:qu.white,exportBackground:!0},files:null,skipInliningFonts:!0})).outerHTML})()},[e.elements,t]),(0,K.jsxs)(`div`,{className:`single-library-item`,children:[e.status===`published`&&(0,K.jsx)(`span`,{className:`single-library-item-status`,children:q(`labels.statusPublished`)}),(0,K.jsx)(`div`,{ref:a,className:`single-library-item__svg`}),(0,K.jsx)(J,{"aria-label":q(`buttons.remove`),type:`button`,icon:Ll,className:`single-library-item--remove`,onClick:i.bind(null,e.id),title:q(`buttons.remove`)}),(0,K.jsxs)(`div`,{style:{display:`flex`,margin:`0.8rem 0`,width:`100%`,fontSize:`14px`,fontWeight:500,flexDirection:`column`},children:[(0,K.jsxs)(`label`,{style:{display:`flex`,justifyContent:`space-between`,flexDirection:`column`},children:[(0,K.jsxs)(`div`,{style:{padding:`0.5em 0`},children:[(0,K.jsx)(`span`,{style:{fontWeight:500,color:qu.gray[6]},children:q(`publishDialog.itemName`)}),(0,K.jsx)(`span`,{"aria-hidden":`true`,className:`required`,children:`*`})]}),(0,K.jsx)(`input`,{type:`text`,ref:o,style:{width:`80%`,padding:`0.2rem`},defaultValue:e.name,placeholder:`Item name`,onChange:e=>{r(e.target.value,n)}})]}),(0,K.jsx)(`span`,{className:`error`,children:e.error})]})]})},Hb=({onClose:e,libraryItems:t,appState:n,onSuccess:r,onError:i,updateItemsInStorage:a,onRemove:o})=>{let[s,c]=(0,G.useState)({authorName:``,githubHandle:``,name:``,description:``,twitterHandle:``,website:``}),[l,u]=(0,G.useState)(!1);(0,G.useEffect)(()=>{let e=zb.get(at.PUBLISH_LIBRARY);e&&c(e)},[]);let[d,f]=(0,G.useState)(t.slice());(0,G.useEffect)(()=>{f(t.slice())},[t]);let p=e=>{c({...s,[e.target.name]:e.target.value})},m=async e=>{e.preventDefault(),u(!0);let t=[],n=!1;if(d.forEach(e=>{let r=``;e.name||(r=q(`publishDialog.errors.required`),n=!0),t.push({...e,error:r})}),n){f(t),u(!1);return}let a=await Bb(d),o={type:Yt.excalidrawLibrary,version:Eu.excalidrawLibrary,source:Lt,libraryItems:d},c=JSON.stringify(o,null,2),l=new Blob([c],{type:`application/json`}),p=new FormData;p.append(`excalidrawLib`,l),p.append(`previewImage`,a),p.append(`previewImageType`,a.type),p.append(`title`,s.name),p.append(`authorName`,s.authorName),p.append(`githubHandle`,s.githubHandle),p.append(`name`,s.name),p.append(`description`,s.description),p.append(`twitterHandle`,s.twitterHandle),p.append(`website`,s.website),fetch(`${pe.VITE_APP_LIBRARY_BACKEND}/submit`,{method:`post`,body:p}).then(e=>e.ok?e.json().then(({url:e})=>{zb.delete(at.PUBLISH_LIBRARY),r({url:e,authorName:s.authorName,items:d})}):e.json().catch(()=>{throw Error(e.statusText||`something went wrong`)}).then(t=>{throw Error(t.message||e.statusText||`something went wrong`)}),e=>{console.error(e),i(e),u(!1)}).catch(e=>{console.error(e),i(e),u(!1)})},h=()=>{let e=[];return d.forEach((t,r)=>{e.push((0,K.jsx)(`div`,{className:`single-library-item-wrapper`,children:(0,K.jsx)(Vb,{libItem:t,appState:n,index:r,onChange:(e,t)=>{let n=d.slice();n[t].name=e,f(n)},onRemove:o})},r))}),(0,K.jsx)(`div`,{className:`selected-library-items`,children:e})},g=(0,G.useCallback)(()=>{a(d),zb.set(at.PUBLISH_LIBRARY,s),e()},[d,e,a,s]),_=!!t.length,v=t.some(e=>e.status===`published`);return(0,K.jsx)(Sx,{onCloseRequest:g,title:q(`publishDialog.title`),className:`publish-library`,children:_?(0,K.jsxs)(`form`,{onSubmit:m,children:[(0,K.jsx)(`div`,{className:`publish-library-note`,children:(0,K.jsx)(Ib,{i18nKey:`publishDialog.noteDescription`,link:e=>(0,K.jsx)(`a`,{href:`https://libraries.excalidraw.com`,target:`_blank`,rel:`noopener noreferrer`,children:e})})}),(0,K.jsx)(`span`,{className:`publish-library-note`,children:(0,K.jsx)(Ib,{i18nKey:`publishDialog.noteGuidelines`,link:e=>(0,K.jsx)(`a`,{href:`https://github.com/excalidraw/excalidraw-libraries#guidelines`,target:`_blank`,rel:`noopener noreferrer`,children:e})})}),(0,K.jsx)(`div`,{className:`publish-library-note`,children:q(`publishDialog.noteItems`)}),v&&(0,K.jsx)(`span`,{className:`publish-library-note publish-library-warning`,children:q(`publishDialog.republishWarning`)}),h(),(0,K.jsxs)(`div`,{className:`publish-library__fields`,children:[(0,K.jsxs)(`label`,{children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`span`,{children:q(`publishDialog.libraryName`)}),(0,K.jsx)(`span`,{"aria-hidden":`true`,className:`required`,children:`*`})]}),(0,K.jsx)(`input`,{type:`text`,name:`name`,required:!0,value:s.name,onChange:p,placeholder:q(`publishDialog.placeholder.libraryName`)})]}),(0,K.jsxs)(`label`,{style:{alignItems:`flex-start`},children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`span`,{children:q(`publishDialog.libraryDesc`)}),(0,K.jsx)(`span`,{"aria-hidden":`true`,className:`required`,children:`*`})]}),(0,K.jsx)(`textarea`,{name:`description`,rows:4,required:!0,value:s.description,onChange:p,placeholder:q(`publishDialog.placeholder.libraryDesc`)})]}),(0,K.jsxs)(`label`,{children:[(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`span`,{children:q(`publishDialog.authorName`)}),(0,K.jsx)(`span`,{"aria-hidden":`true`,className:`required`,children:`*`})]}),(0,K.jsx)(`input`,{type:`text`,name:`authorName`,required:!0,value:s.authorName,onChange:p,placeholder:q(`publishDialog.placeholder.authorName`)})]}),(0,K.jsxs)(`label`,{children:[(0,K.jsx)(`span`,{children:q(`publishDialog.githubUsername`)}),(0,K.jsx)(`input`,{type:`text`,name:`githubHandle`,value:s.githubHandle,onChange:p,placeholder:q(`publishDialog.placeholder.githubHandle`)})]}),(0,K.jsxs)(`label`,{children:[(0,K.jsx)(`span`,{children:q(`publishDialog.twitterUsername`)}),(0,K.jsx)(`input`,{type:`text`,name:`twitterHandle`,value:s.twitterHandle,onChange:p,placeholder:q(`publishDialog.placeholder.twitterHandle`)})]}),(0,K.jsxs)(`label`,{children:[(0,K.jsx)(`span`,{children:q(`publishDialog.website`)}),(0,K.jsx)(`input`,{type:`text`,name:`website`,pattern:`https?://.+`,title:q(`publishDialog.errors.website`),value:s.website,onChange:p,placeholder:q(`publishDialog.placeholder.website`)})]}),(0,K.jsx)(`span`,{className:`publish-library-note`,children:(0,K.jsx)(Ib,{i18nKey:`publishDialog.noteLicense`,link:e=>(0,K.jsx)(`a`,{href:`https://github.com/excalidraw/excalidraw-libraries/blob/main/LICENSE`,target:`_blank`,rel:`noopener noreferrer`,children:e})})})]}),(0,K.jsxs)(`div`,{className:`publish-library__buttons`,children:[(0,K.jsx)(Lb,{label:q(`buttons.cancel`),onClick:g,"data-testid":`cancel-clear-canvas-button`}),(0,K.jsx)(Lb,{type:`submit`,label:q(`buttons.submit`),actionType:`primary`,isLoading:l})]})]}):(0,K.jsx)(`p`,{style:{padding:`1em`,textAlign:`center`,fontWeight:500},children:q(`publishDialog.atleastOneLibItem`)})})},Ub=({className:e=``,children:t,onToggle:n,title:r,...i})=>{let a=bD(),o=L(`dropdown-menu-button ${e}`,`zen-mode-transition`,{"dropdown-menu-button--mobile":a.editor.isMobile}).trim();return(0,K.jsx)(`button`,{"data-prevent-outside-click":!0,className:o,onClick:n,type:`button`,"data-testid":`dropdown-menu-button`,title:r,...i,children:t})},Wb=Ub;Ub.displayName=`DropdownMenuTrigger`;var Gb=()=>(0,K.jsx)(`div`,{style:{height:`1px`,backgroundColor:`var(--default-border-color)`,margin:`.5rem 0`}}),Kb=Gb;Gb.displayName=`DropdownMenuSeparator`;var qb=({children:e,onClickOutside:t,className:n=``,onSelect:r,style:i})=>{let a=bD(),o=(0,G.useRef)(null),s=B_({onClickOutside:t});z_(o,()=>{s.onClickOutside?.()}),(0,G.useEffect)(()=>{let e=e=>{e.key===D.ESCAPE&&(e.stopImmediatePropagation(),s.onClickOutside?.())},t={capture:!0};return document.addEventListener(`keydown`,e,t),()=>{document.removeEventListener(`keydown`,e,t)}},[s]);let c=L(`dropdown-menu ${n}`,{"dropdown-menu--mobile":a.editor.isMobile}).trim();return(0,K.jsx)(ov.Provider,{value:{onSelect:r},children:(0,K.jsx)(`div`,{ref:o,className:c,style:i,"data-testid":`dropdown-menu`,children:a.editor.isMobile?(0,K.jsx)(Ob.Col,{className:`dropdown-menu-container`,children:e}):(0,K.jsx)(W_,{className:`dropdown-menu-container`,padding:2,style:{zIndex:2},children:e})})})};qb.displayName=`DropdownMenuContent`;var Jb=qb,Yb=({icon:e,shortcut:t,href:n,children:r,onSelect:i,className:a=``,selected:o,rel:s=`noreferrer`,...c})=>{let l=cv(c.onClick,i);return(0,K.jsx)(`a`,{...c,href:n,target:`_blank`,rel:`noreferrer`,className:sv(a,o),title:c.title??c[`aria-label`],onClick:l,children:(0,K.jsx)(lv,{icon:e,shortcut:t,children:r})})},Xb=Yb;Yb.displayName=`DropdownMenuItemLink`;var Zb=({children:e,className:t=``,selected:n,...r})=>(0,K.jsx)(`div`,{...r,className:`dropdown-menu-item-base dropdown-menu-item-custom ${t} ${n?`dropdown-menu-item--selected`:``}`.trim(),children:e}),Qb=e=>G.Children.toArray(e).find(e=>G.isValidElement(e)&&typeof e.type!=`string`&&e?.type.displayName&&e.type.displayName===`DropdownMenuTrigger`)||null,$b=e=>G.Children.toArray(e).find(e=>G.isValidElement(e)&&typeof e.type!=`string`&&e?.type.displayName&&e.type.displayName===`DropdownMenuContent`)||null,ex=({children:e,open:t})=>{let n=Qb(e),r=$b(e);return(0,K.jsxs)(K.Fragment,{children:[n,t&&r]})};ex.Trigger=Wb,ex.Content=Jb,ex.Item=pv,ex.ItemLink=Xb,ex.ItemCustom=Zb,ex.Group=av,ex.Separator=Kb;var X=ex;ex.displayName=`DropdownMenu`;var tx=(e,t)=>e.filter(e=>t.includes(e.id)),nx=({setAppState:e,selectedItems:t,library:n,onRemoveFromLibrary:r,resetLibrary:i,onSelectItems:a,appState:o,className:s})=>{let[c]=xg(bb),[l,u]=xg(hx),d=()=>{let e=t.length?q(`alerts.removeItemsFromsLibrary`,{count:t.length}):q(`alerts.resetLibrary`);return(0,K.jsx)(Rb,{onConfirm:()=>{t.length?r():i(),p(!1)},onCancel:()=>{p(!1)},title:t.length?q(`confirmDialog.removeItemsFromLib`):q(`confirmDialog.resetLibrary`),children:(0,K.jsx)(`p`,{children:e})})},[f,p]=(0,G.useState)(!1),m=!!t.length,h=m?c.libraryItems.filter(e=>t.includes(e.id)):c.libraryItems,g=q(m?`buttons.remove`:`buttons.resetLibrary`),[_,v]=(0,G.useState)(!1),[y,b]=(0,G.useState)(null),x=(0,G.useCallback)(()=>(0,K.jsxs)(Sx,{onCloseRequest:()=>b(null),title:q(`publishSuccessDialog.title`),className:`publish-library-success`,size:`small`,children:[(0,K.jsx)(`p`,{children:(0,K.jsx)(Ib,{i18nKey:`publishSuccessDialog.content`,authorName:y.authorName,link:e=>(0,K.jsx)(`a`,{href:y?.url,target:`_blank`,rel:`noopener noreferrer`,children:e})})}),(0,K.jsx)(J,{type:`button`,title:q(`buttons.close`),"aria-label":q(`buttons.close`),label:q(`buttons.close`),onClick:()=>b(null),"data-testid":`publish-library-success-close`,className:`publish-library-success-close`})]}),[b,y]),S=(e,r)=>{v(!1),b({url:e.url,authorName:e.authorName});let i=r.slice();i.forEach(e=>{t.includes(e.id)&&(e.status=`published`)}),n.setLibrary(i)},ee=async()=>{try{await n.updateLibrary({libraryItems:sn({description:`Excalidraw library files`}),merge:!0,openLibraryMenu:!0})}catch(t){if(t?.name===`AbortError`){console.warn(t);return}e({errorMessage:q(`errors.importLibraryError`)})}},te=async()=>{Tl(m?h:await n.getLatestLibrary()).catch(ad).catch(t=>{e({errorMessage:t.message})})};return(0,K.jsxs)(`div`,{className:L(`library-menu-dropdown-container`,s),children:[(()=>(0,K.jsxs)(X,{open:l,children:[(0,K.jsx)(X.Trigger,{onToggle:()=>u(!l),children:ys}),(0,K.jsxs)(X.Content,{onClickOutside:()=>u(!1),onSelect:()=>u(!1),className:`library-menu`,children:[!m&&(0,K.jsx)(X.Item,{onSelect:ee,icon:wr,"data-testid":`lib-dropdown--load`,children:q(`buttons.load`)}),!!h.length&&(0,K.jsx)(X.Item,{onSelect:te,icon:ac,"data-testid":`lib-dropdown--export`,children:q(`buttons.export`)}),!!h.length&&(0,K.jsx)(X.Item,{onSelect:()=>p(!0),icon:Bs,children:g}),m&&(0,K.jsx)(X.Item,{icon:Ja,onSelect:()=>v(!0),"data-testid":`lib-dropdown--remove`,children:q(`buttons.publishLibrary`)})]})]}))(),t.length>0&&(0,K.jsx)(`div`,{className:`library-actions-counter`,children:t.length}),f&&d(),_&&(0,K.jsx)(Hb,{onClose:()=>v(!1),libraryItems:tx(c.libraryItems,t),appState:o,onSuccess:e=>S(e,c.libraryItems),onError:e=>window.alert(e),updateItemsInStorage:()=>n.setLibrary(c.libraryItems),onRemove:e=>a(t.filter(t=>t!==e))}),y&&x()]})},rx=({selectedItems:e,onSelectItems:t,className:n})=>{let{library:r}=vD(),{clearLibraryCache:i,deleteItemsFromLibraryCache:a}=_b(),o=L_(),s=wD(),[c]=xg(bb),l=async n=>{let i=n.filter(t=>!e.includes(t.id));r.setLibrary(i).catch(()=>{s({errorMessage:q(`alerts.errorRemovingFromLibrary`)})}),a(e),t([])};return(0,K.jsx)(nx,{appState:o,setAppState:s,selectedItems:e,onSelectItems:t,library:r,onRemoveFromLibrary:()=>l(c.libraryItems),resetLibrary:()=>{r.resetLibrary(),i()},className:n})},ix=(0,G.memo)(({id:e,elements:t,isPending:n,onClick:r,selected:i,onToggle:a,onDrag:o,svgCache:s})=>{let c=(0,G.useRef)(null),l=gb(e,t,s);(0,G.useEffect)(()=>{let e=c.current;if(e)return l&&(e.innerHTML=l.outerHTML),()=>{e.innerHTML=``}},[l]);let[u,d]=(0,G.useState)(!1),f=bD().editor.isMobile,p=n&&(0,K.jsx)(`div`,{className:`library-unit__adder`,children:Vu});return(0,K.jsxs)(`div`,{className:L(`library-unit`,{"library-unit__active":t,"library-unit--hover":t&&u,"library-unit--selected":i,"library-unit--skeleton":!l}),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[(0,K.jsx)(`div`,{className:L(`library-unit__dragger`,{"library-unit__pulse":!!n}),ref:c,draggable:!!t,onClick:t||n?t=>{e&&t.shiftKey?a(e,t):r(e)}:void 0,onDragStart:t=>{if(!e){t.preventDefault();return}d(!1),o(e,t)}}),p,e&&t&&(u||f||i)&&(0,K.jsx)(Zv,{checked:i,onChange:(t,n)=>a(e,n),className:`library-unit__checkbox`})]})}),ax=()=>(0,K.jsx)(`div`,{className:`library-unit library-unit--skeleton`});function ox(){return[!1,(0,G.useCallback)(e=>e(),[])]}var sx=G.useTransition||ox,cx=({children:e})=>(0,K.jsx)(`div`,{className:`library-menu-items-container__grid`,children:e}),lx=(0,G.memo)(({items:e,onItemSelectToggle:t,onItemDrag:n,isItemSelected:r,onClick:i,svgCache:a,itemsRenderedPerBatch:o})=>{let[,s]=sx(),[c,l]=(0,G.useState)(0);return(0,G.useEffect)(()=>{c<e.length&&s(()=>{l(c+o)})},[c,e.length,s,o]),(0,K.jsx)(K.Fragment,{children:e.map((e,o)=>o<c?(0,K.jsx)(ix,{elements:e?.elements,isPending:!e?.id&&!!e?.elements,onClick:i,svgCache:a,id:e?.id,selected:r(e.id),onToggle:t,onDrag:n},e?.id??o):(0,K.jsx)(ax,{},o))})}),ux=Cd(0),dx=e=>{let[t,n]=xg(ux);return(0,G.useEffect)(()=>{let{current:t}=e;if(!t)return;let r=(0,wm.default)(()=>{let{scrollTop:e}=t;n(e)},200);return t.addEventListener(`scroll`,r),()=>{r.cancel(),t.removeEventListener(`scroll`,r)}},[e,n]),t},fx=17,px=64;function mx({isLoading:e,libraryItems:t,onAddToLibrary:n,onInsertLibraryItems:r,pendingElements:i,theme:a,id:o,libraryReturnUrl:s,onSelectItems:c,selectedItems:l}){let u=(0,G.useRef)(null),d=dx(u);(0,G.useEffect)(()=>{d>0&&u.current?.scrollTo(0,d)},[]);let{svgCache:f}=_b(),p=(0,G.useMemo)(()=>t.filter(e=>e.status!==`published`),[t]),m=(0,G.useMemo)(()=>t.filter(e=>e.status===`published`),[t]),h=!t.length&&!i.length,g=!i.length&&!p.length&&!m.length,[_,v]=(0,G.useState)(null),y=(0,G.useCallback)((e,t)=>{let n=!l.includes(e),r=[...p,...m];if(n){if(t.shiftKey&&_){let t=r.findIndex(e=>e.id===_),n=r.findIndex(t=>t.id===e);if(t===-1||n===-1){c([...l,e]);return}let i=P(l);c(r.reduce((e,r,a)=>((a>=t&&a<=n||i.has(r.id))&&e.push(r.id),e),[]))}else c([...l,e]);v(e)}else v(null),c(l.filter(t=>t!==e))},[_,c,m,l,p]),b=(0,G.useCallback)(e=>{let n;return n=l.includes(e)?t.filter(e=>l.includes(e.id)):t.filter(t=>t.id===e),n.map(e=>({...e,elements:rd(e.elements,{randomizeSeed:!0})}))},[t,l]),x=(0,G.useCallback)((e,t)=>{t.dataTransfer.setData(rn.excalidrawlib,Gc(b(e)))},[b]),S=(0,G.useCallback)(e=>e?l.includes(e):!1,[l]),ee=(0,G.useCallback)(()=>{n(i)},[i,n]),te=(0,G.useCallback)(e=>{e&&r(b(e))},[b,r]),ne=f.size>=t.length?px:fx;return(0,K.jsxs)(`div`,{className:`library-menu-items-container`,style:i.length||p.length||m.length?{justifyContent:`flex-start`}:{borderBottom:0},children:[!g&&(0,K.jsx)(rx,{selectedItems:l,onSelectItems:c,className:`library-menu-dropdown-container--in-heading`}),(0,K.jsxs)(Ob.Col,{className:`library-menu-items-container__items`,align:`start`,gap:1,style:{flex:m.length>0?1:`0 1 auto`,marginBottom:0},ref:u,children:[(0,K.jsxs)(K.Fragment,{children:[!g&&(0,K.jsx)(`div`,{className:`library-menu-items-container__header`,children:q(`labels.personalLib`)}),e&&(0,K.jsx)(`div`,{style:{position:`absolute`,top:`var(--container-padding-y)`,right:`var(--container-padding-x)`,transform:`translateY(50%)`},children:(0,K.jsx)(zg,{})}),!i.length&&!p.length?(0,K.jsxs)(`div`,{className:`library-menu-items__no-items`,children:[(0,K.jsx)(`div`,{className:`library-menu-items__no-items__label`,children:q(`library.noItems`)}),(0,K.jsx)(`div`,{className:`library-menu-items__no-items__hint`,children:m.length>0?q(`library.hint_emptyPrivateLibrary`):q(`library.hint_emptyLibrary`)})]}):(0,K.jsxs)(cx,{children:[i.length>0&&(0,K.jsx)(lx,{itemsRenderedPerBatch:ne,items:[{id:null,elements:i}],onItemSelectToggle:y,onItemDrag:x,onClick:ee,isItemSelected:S,svgCache:f}),(0,K.jsx)(lx,{itemsRenderedPerBatch:ne,items:p,onItemSelectToggle:y,onItemDrag:x,onClick:te,isItemSelected:S,svgCache:f})]})]}),(0,K.jsxs)(K.Fragment,{children:[(m.length>0||i.length>0||p.length>0)&&(0,K.jsx)(`div`,{className:`library-menu-items-container__header library-menu-items-container__header--excal`,children:q(`labels.excalidrawLib`)}),m.length>0?(0,K.jsx)(cx,{children:(0,K.jsx)(lx,{itemsRenderedPerBatch:ne,items:m,onItemSelectToggle:y,onItemDrag:x,onClick:te,isItemSelected:S,svgCache:f})}):p.length>0?(0,K.jsx)(`div`,{style:{margin:`1rem 0`,display:`flex`,flexDirection:`column`,alignItems:`center`,justifyContent:`center`,width:`100%`,fontSize:`.9rem`},children:q(`library.noItems`)}):null]}),h&&(0,K.jsx)(Ab,{style:{padding:`16px 0`,width:`100%`},id:o,libraryReturnUrl:s,theme:a,children:(0,K.jsx)(rx,{selectedItems:l,onSelectItems:c})})]})]})}var hx=Cd(!1),gx=({children:e})=>(0,K.jsx)(`div`,{className:`layer-ui__library`,children:e}),_x=(0,G.memo)(({onInsertLibraryItems:e,pendingElements:t,onAddToLibrary:n,setAppState:r,libraryReturnUrl:i,library:a,id:o,theme:s,selectedItems:c,onSelectItems:l})=>{let[u]=xg(bb),d=(0,G.useCallback)(e=>{(async(e,t)=>{Y(`element`,`addToLibrary`,`ui`);for(let t of $o)if(e.some(e=>e.type===t))return r({errorMessage:q(`errors.libraryElementTypeError.${t}`)});let i=[{status:`unpublished`,elements:e,id:Xc(),created:Date.now()},...t];n(),a.setLibrary(i).catch(()=>{r({errorMessage:q(`alerts.errorAddingToLibrary`)})})})(e,u.libraryItems)},[n,a,r,u.libraryItems]),f=(0,G.useMemo)(()=>u.libraryItems,[u]);if(u.status===`loading`&&!u.isInitialized)return(0,K.jsx)(gx,{children:(0,K.jsx)(`div`,{className:`layer-ui__library-message`,children:(0,K.jsxs)(`div`,{children:[(0,K.jsx)(zg,{size:`2em`}),(0,K.jsx)(`span`,{children:q(`labels.libraryLoadingMessage`)})]})})});let p=u.libraryItems.length>0||t.length>0;return(0,K.jsxs)(gx,{children:[(0,K.jsx)(mx,{isLoading:u.status===`loading`,libraryItems:f,onAddToLibrary:d,onInsertLibraryItems:e,pendingElements:t,id:o,libraryReturnUrl:i,theme:s,onSelectItems:l,selectedItems:c}),p&&(0,K.jsx)(Ab,{className:`library-menu-control-buttons--at-bottom`,style:{padding:`16px 12px 0 12px`},id:o,libraryReturnUrl:i,theme:s})]})}),vx=(e,t)=>({elements:e,pending:V(e,{selectedElementIds:t},{includeBoundTextElement:!0,includeElementsInFrames:!0}),selectedElementIds:t}),yx=(e,t)=>{let n=SD(),[r,i]=(0,G.useState)(()=>vx(n,e.selectedElementIds)),a=(0,G.useRef)(new Map);return(0,G.useEffect)(()=>{for(let e of r.pending)a.current.set(e.id,e.version)},[r.pending]),(0,G.useEffect)(()=>{t.state.cursorButton===`up`&&t.state.activeTool.type===`selection`&&i(r=>{if(!ca(r.selectedElementIds,e.selectedElementIds))return a.current.clear(),vx(n,e.selectedElementIds);let i=t.scene.getNonDeletedElementsMap();for(let t of Object.keys(e.selectedElementIds)){let r=i.get(t)?.version;if(r&&r!==a.current.get(t))return vx(n,e.selectedElementIds)}return r})},[t,t.state.cursorButton,t.state.activeTool.type,e.selectedElementIds,n]),r.pending},bx=(0,G.memo)(()=>{let e=vD(),{onInsertElements:t}=e,n=yD(),r=L_(),i=wD(),[a,o]=(0,G.useState)([]),s=(0,G.useMemo)(()=>e.library,[e.library]);return(0,K.jsx)(_x,{pendingElements:yx(r,e),onInsertLibraryItems:(0,G.useCallback)(e=>{t(Eb(e))},[t]),onAddToLibrary:(0,G.useCallback)(()=>{i({selectedElementIds:{},selectedGroupIds:{},activeEmbeddable:null})},[i]),setAppState:i,libraryReturnUrl:n.libraryReturnUrl,library:s,id:e.id,theme:r.theme,selectedItems:a,onSelectItems:o})});function xx(e){if(e&&typeof e==`number`)return e;switch(e){case`small`:return 550;case`wide`:return 1024;case`regular`:default:return 800}}var Sx=e=>{let[t,n]=fb(),[r]=(0,G.useState)(document.activeElement),{id:i}=xD(),a=bD().viewport.isMobile;(0,G.useEffect)(()=>{if(!t)return;let n=ks(t);setTimeout(()=>{n.length>0&&e.autofocus!==!1&&(n[1]||n[0]).focus()});let r=e=>{if(e.key===D.TAB){let n=ks(t),{activeElement:r}=document,i=n.findIndex(e=>e===r);i===0&&e.shiftKey?(n[n.length-1].focus(),e.preventDefault()):i===n.length-1&&!e.shiftKey&&(n[0].focus(),e.preventDefault())}};return t.addEventListener(`keydown`,r),()=>t.removeEventListener(`keydown`,r)},[t,e.autofocus]);let o=wD(),s=Sg(hx),c=()=>{o({openMenu:null}),s(!1),r.focus(),e.onCloseRequest()};return(0,K.jsx)(pb,{className:L(`Dialog`,e.className,{"Dialog--fullscreen":a}),labelledBy:`dialog-title`,maxWidth:xx(e.size),onCloseRequest:c,closeOnClickOutside:e.closeOnClickOutside,children:(0,K.jsxs)(W_,{ref:n,children:[e.title&&(0,K.jsx)(`h2`,{id:`${i}-dialog-title`,className:`Dialog__title`,children:(0,K.jsx)(`span`,{className:`Dialog__titleContent`,children:e.title})}),a&&(0,K.jsx)(`button`,{className:`Dialog__close`,onClick:c,title:q(`buttons.close`),"aria-label":q(`buttons.close`),type:`button`,children:Ll}),(0,K.jsx)(`div`,{className:`Dialog__content`,children:e.children})]})})},Cx=({type:e=`button`,onSelect:t,selected:n,children:r,className:i=``,...a})=>(0,K.jsx)(`button`,{onClick:st(a.onClick,e=>{t()}),type:e,className:L(`excalidraw-button`,i,{selected:n}),...a,children:r}),wx=(0,G.forwardRef)(({onChange:e,label:t,fullWidth:n,placeholder:r,readonly:i,selectOnRender:a,onKeyDown:o,isRedacted:s=!1,icon:c,className:l,...u},d)=>{let f=(0,G.useRef)(null);(0,G.useImperativeHandle)(d,()=>f.current),(0,G.useLayoutEffect)(()=>{a&&(f.current?.focus(),f.current?.select())},[a]);let[p,m]=(0,G.useState)(!1);return(0,K.jsxs)(`div`,{className:L(`ExcTextField`,l,{"ExcTextField--fullWidth":n,"ExcTextField--hasIcon":!!c}),onClick:()=>{f.current?.focus()},children:[c,t&&(0,K.jsx)(`div`,{className:`ExcTextField__label`,children:t}),(0,K.jsxs)(`div`,{className:L(`ExcTextField__input`,{"ExcTextField__input--readonly":i}),children:[(0,K.jsx)(`input`,{className:L({"is-redacted":`value`in u&&u.value&&s&&!p}),readOnly:i,value:`value`in u?u.value:void 0,defaultValue:`defaultValue`in u?u.defaultValue:void 0,placeholder:r,ref:f,onChange:t=>e?.(t.target.value),onKeyDown:o}),s&&(0,K.jsx)(Cx,{onSelect:()=>m(!p),style:{border:0,userSelect:`none`},children:p?ht:lo})]})]})}),Tx={toggleTheme:[k(`Shift+Alt+D`)],saveScene:[k(`CtrlOrCmd+S`)],loadScene:[k(`CtrlOrCmd+O`)],clearCanvas:[k(`CtrlOrCmd+Delete`)],imageExport:[k(`CtrlOrCmd+Shift+E`)],commandPalette:[k(`CtrlOrCmd+/`),k(`CtrlOrCmd+Shift+P`)],cut:[k(`CtrlOrCmd+X`)],copy:[k(`CtrlOrCmd+C`)],paste:[k(`CtrlOrCmd+V`)],copyStyles:[k(`CtrlOrCmd+Alt+C`)],pasteStyles:[k(`CtrlOrCmd+Alt+V`)],selectAll:[k(`CtrlOrCmd+A`)],deleteSelectedElements:[k(`Delete`)],duplicateSelection:[k(`CtrlOrCmd+D`),k(`Alt+${q(`helpDialog.drag`)}`)],sendBackward:[k(`CtrlOrCmd+[`)],bringForward:[k(`CtrlOrCmd+]`)],sendToBack:[k(hs?`CtrlOrCmd+Alt+[`:`CtrlOrCmd+Shift+[`)],bringToFront:[k(hs?`CtrlOrCmd+Alt+]`:`CtrlOrCmd+Shift+]`)],copyAsPng:[k(`Shift+Alt+C`)],group:[k(`CtrlOrCmd+G`)],ungroup:[k(`CtrlOrCmd+Shift+G`)],gridMode:[k(`CtrlOrCmd+'`)],zenMode:[k(`Alt+Z`)],objectsSnapMode:[k(`Alt+S`)],stats:[k(`Alt+/`)],addToLibrary:[],flipHorizontal:[k(`Shift+H`)],flipVertical:[k(`Shift+V`)],viewMode:[k(`Alt+R`)],hyperlink:[k(`CtrlOrCmd+K`)],toggleElementLock:[k(`CtrlOrCmd+Shift+L`)],resetZoom:[k(`CtrlOrCmd+0`)],zoomOut:[k(`CtrlOrCmd+-`)],zoomIn:[k(`CtrlOrCmd++`)],zoomToFitSelection:[k(`Shift+3`)],zoomToFit:[k(`Shift+1`)],zoomToFitSelectionInViewport:[k(`Shift+2`)],toggleEraserTool:[k(`E`)],toggleHandTool:[k(`H`)],setFrameAsActiveTool:[k(`F`)],saveFileToDisk:[k(`CtrlOrCmd+S`)],saveToActiveFile:[k(`CtrlOrCmd+S`)],toggleShortcuts:[k(`?`)],searchMenu:[k(`CtrlOrCmd+F`)],wrapSelectionInFrame:[]},Ex=(e,t=0)=>{let n=Tx[e];return n&&n.length>0?n[t]||n[0]:``},Dx=RegExp(`[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]`,`g`),Ox=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,kx={:`A`,:`A`,:`A`,:`A`,:`A`,:`A`,:`a`,:`a`,:`a`,:`a`,:`a`,:`a`,:`C`,:`c`,:`D`,:`d`,:`E`,:`E`,:`E`,:`E`,:`e`,:`e`,:`e`,:`e`,:`I`,:`I`,:`I`,:`I`,:`i`,:`i`,:`i`,:`i`,:`N`,:`n`,:`O`,:`O`,:`O`,:`O`,:`O`,:`O`,:`o`,:`o`,:`o`,:`o`,:`o`,:`o`,:`U`,:`U`,:`U`,:`U`,:`u`,:`u`,:`u`,:`u`,:`Y`,:`y`,:`y`,:`E`,:`e`,:`T`,:`t`,:`s`,:`A`,:`A`,:`A`,:`a`,:`a`,:`a`,:`C`,:`C`,:`C`,:`C`,:`c`,:`c`,:`c`,:`c`,:`D`,:`D`,:`d`,:`d`,:`E`,:`E`,:`E`,:`E`,:`E`,:`e`,:`e`,:`e`,:`e`,:`e`,:`G`,:`G`,:`G`,:`G`,:`g`,:`g`,:`g`,:`g`,:`H`,:`H`,:`h`,:`h`,:`I`,:`I`,:`I`,:`I`,:`I`,:`i`,:`i`,:`i`,:`i`,:`i`,:`J`,:`j`,:`K`,:`k`,:`k`,:`L`,:`L`,:`L`,:`L`,:`L`,:`l`,:`l`,:`l`,:`l`,:`l`,:`N`,:`N`,:`N`,:`N`,:`n`,:`n`,:`n`,:`n`,:`O`,:`O`,:`O`,:`o`,:`o`,:`o`,:`R`,:`R`,:`R`,:`r`,:`r`,:`r`,:`S`,:`S`,:`S`,:`S`,:`s`,:`s`,:`s`,:`s`,:`T`,:`T`,:`T`,:`t`,:`t`,:`t`,:`U`,:`U`,:`U`,:`U`,:`U`,:`U`,:`u`,:`u`,:`u`,:`u`,:`u`,:`u`,:`W`,:`w`,:`Y`,:`y`,:`Y`,:`Z`,:`Z`,:`Z`,:`z`,:`z`,:`z`,:`I`,:`i`,:`E`,:`e`,:`n`,:`s`},Ax=e=>e.replace(Ox,e=>kx[e]||e).replace(Dx,``),jx=G.createContext(null),Mx=()=>G.useContext(jx),Nx=lf(),Px=()=>G.useMemo(()=>({MainMenuTunnel:Pm(),WelcomeScreenMenuHintTunnel:Pm(),WelcomeScreenToolbarHintTunnel:Pm(),WelcomeScreenHelpHintTunnel:Pm(),WelcomeScreenCenterTunnel:Pm(),FooterCenterTunnel:Pm(),DefaultSidebarTriggerTunnel:Pm(),DefaultSidebarTabTriggersTunnel:Pm(),OverwriteConfirmDialogTunnel:Pm(),TTDDialogTriggerTunnel:Pm(),tunnelsJotai:Nx}),[]),Fx=(e,t)=>{let n=t[0]?.type||null;for(let e of t)if(e.type!==n){n=null;break}return Tc(e.activeTool.type)&&e.activeTool.type!==`image`&&n!==`image`&&n!==`frame`&&n!==`magicframe`||t.some(e=>Tc(e.type))},Ix=(e,t)=>Wu(e.activeTool.type)||t.some(e=>Wu(e.type)),Lx=({appState:e,elementsMap:t,renderAction:n,app:r})=>{let i=Nc(t,e),a=!1;i.length===2&&(Ou(i[0])||Ou(i[1]))&&(a=!0);let o=!!(e.editingTextElement||e.newElement),s=bD(),c=document.documentElement.getAttribute(`dir`)===`rtl`,l=Wu(e.activeTool.type)&&!To(e.currentItemBackgroundColor)||i.some(e=>Wu(e.type)&&!To(e.backgroundColor)),u=i.length===1||a,d=!e.editingLinearElement&&i.length===1&&fc(i[0])&&!B(i[0]),f=!e.croppingElementId&&i.length===1&&De(i[0]),p=!a&&Cy(e,r);return(0,K.jsxs)(`div`,{className:`panelColumn`,children:[(0,K.jsx)(`div`,{children:Fx(e,i)&&n(`changeStrokeColor`)}),Ix(e,i)&&(0,K.jsx)(`div`,{children:n(`changeBackgroundColor`)}),l&&n(`changeFillStyle`),(Zn(e.activeTool.type)||i.some(e=>Zn(e.type)))&&n(`changeStrokeWidth`),(e.activeTool.type===`freedraw`||i.some(e=>e.type===`freedraw`))&&n(`changeStrokeShape`),(ua(e.activeTool.type)||i.some(e=>ua(e.type)))&&(0,K.jsxs)(K.Fragment,{children:[n(`changeStrokeStyle`),n(`changeSloppiness`)]}),(Tu(e.activeTool.type)||i.some(e=>Tu(e.type)))&&(0,K.jsx)(K.Fragment,{children:n(`changeRoundness`)}),(ju(e.activeTool.type)||i.some(e=>ju(e.type)))&&(0,K.jsx)(K.Fragment,{children:n(`changeArrowType`)}),(e.activeTool.type===`text`||i.some(H))&&(0,K.jsxs)(K.Fragment,{children:[n(`changeFontFamily`),n(`changeFontSize`),(e.activeTool.type===`text`||No(i,t))&&n(`changeTextAlign`)]}),Er(i,t)&&n(`changeVerticalAlign`),(vu(e.activeTool.type)||i.some(e=>vu(e.type)))&&(0,K.jsx)(K.Fragment,{children:n(`changeArrowhead`)}),n(`changeOpacity`),(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.layers`)}),(0,K.jsxs)(`div`,{className:`buttonList`,children:[n(`sendToBack`),n(`sendBackward`),n(`bringForward`),n(`bringToFront`)]})]}),p&&!a&&(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.align`)}),(0,K.jsxs)(`div`,{className:`buttonList`,children:[c?(0,K.jsxs)(K.Fragment,{children:[n(`alignRight`),n(`alignHorizontallyCentered`),n(`alignLeft`)]}):(0,K.jsxs)(K.Fragment,{children:[n(`alignLeft`),n(`alignHorizontallyCentered`),n(`alignRight`)]}),i.length>2&&n(`distributeHorizontally`),(0,K.jsx)(`div`,{style:{flexBasis:`100%`,height:0}}),(0,K.jsxs)(`div`,{style:{display:`flex`,flexWrap:`wrap`,gap:`.5rem`,marginTop:`-0.5rem`},children:[n(`alignTop`),n(`alignVerticallyCentered`),n(`alignBottom`),i.length>2&&n(`distributeVertically`)]})]})]}),!o&&i.length>0&&(0,K.jsxs)(`fieldset`,{children:[(0,K.jsx)(`legend`,{children:q(`labels.actions`)}),(0,K.jsxs)(`div`,{className:`buttonList`,children:[!s.editor.isMobile&&n(`duplicateSelection`),!s.editor.isMobile&&n(`deleteSelectedElements`),n(`group`),n(`ungroup`),u&&n(`hyperlink`),f&&n(`cropEditor`),d&&n(`toggleLinearEditor`)]})]})]})},Rx=({activeTool:e,appState:t,app:n,UIOptions:r})=>{let[i,a]=(0,G.useState)(!1),o=e.type===`frame`,s=e.type===`laser`,c=e.type===`embeddable`,{TTDDialogTriggerTunnel:l}=Mx();return(0,K.jsxs)(K.Fragment,{children:[Jc.map(({value:i,icon:a,key:o,numericKey:s,fillable:c},l)=>{if(r.tools?.[i]===!1)return null;let u=q(`toolBar.${i}`),d=o&&Dr(typeof o==`string`?o:o[0]),f=d?`${d} ${q(`helpDialog.or`)} ${s}`:`${s}`;return(0,K.jsx)(J,{className:L(`Shape`,{fillable:c}),type:`radio`,icon:a,checked:e.type===i,name:`editor-current-shape`,title:`${Dr(u)} \u2014 ${f}`,keyBindingLabel:s||d,"aria-label":Dr(u),"aria-keyshortcuts":f,"data-testid":`toolbar-${i}`,onPointerDown:({pointerType:e})=>{!t.penDetected&&e===`pen`&&n.togglePenMode(!0)},onChange:({pointerType:e})=>{t.activeTool.type!==i&&Y(`toolbar`,i,`ui`),i===`image`?n.setActiveTool({type:i,insertOnCanvasDirectly:e!==`mouse`}):n.setActiveTool({type:i})}},i)}),(0,K.jsx)(`div`,{className:`App-toolbar__divider`}),(0,K.jsxs)(X,{open:i,children:[(0,K.jsx)(X.Trigger,{className:L(`App-toolbar__extra-tools-trigger`,{"App-toolbar__extra-tools-trigger--selected":o||c||s&&!n.props.isCollaborating}),onToggle:()=>a(!i),title:q(`toolBar.extraTools`),children:Ju}),(0,K.jsxs)(X.Content,{onClickOutside:()=>a(!1),onSelect:()=>a(!1),className:`App-toolbar__extra-tools-dropdown`,children:[(0,K.jsx)(X.Item,{onSelect:()=>n.setActiveTool({type:`frame`}),icon:be,shortcut:D.F.toLocaleUpperCase(),"data-testid":`toolbar-frame`,selected:o,children:q(`toolBar.frame`)}),(0,K.jsx)(X.Item,{onSelect:()=>n.setActiveTool({type:`embeddable`}),icon:pc,"data-testid":`toolbar-embeddable`,selected:c,children:q(`toolBar.embeddable`)}),(0,K.jsx)(X.Item,{onSelect:()=>n.setActiveTool({type:`laser`}),icon:Wc,"data-testid":`toolbar-laser`,selected:s,shortcut:D.K.toLocaleUpperCase(),children:q(`toolBar.laser`)}),(0,K.jsx)(`div`,{style:{margin:`6px 0`,fontSize:14,fontWeight:600},children:`Generate`}),n.props.aiEnabled!==!1&&(0,K.jsx)(l.Out,{}),(0,K.jsx)(X.Item,{onSelect:()=>n.setOpenDialog({name:`ttd`,tab:`mermaid`}),icon:sd,"data-testid":`toolbar-embeddable`,children:q(`toolBar.mermaidToExcalidraw`)}),n.props.aiEnabled!==!1&&n.plugins.diagramToCode&&(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)(X.Item,{onSelect:()=>n.onMagicframeToolSelect(),icon:uo,"data-testid":`toolbar-magicframe`,children:[q(`toolBar.magicframe`),(0,K.jsx)(X.Item.Badge,{children:`AI`})]})})]})]})]})},zx=({renderAction:e,zoom:t})=>(0,K.jsx)(Ob.Col,{gap:1,className:bi.ZOOM_ACTIONS,children:(0,K.jsxs)(Ob.Row,{align:`center`,children:[e(`zoomOut`),e(`resetZoom`),e(`zoomIn`)]})}),Bx=({renderAction:e,className:t})=>(0,K.jsxs)(`div`,{className:`undo-redo-buttons ${t}`,children:[(0,K.jsx)(`div`,{className:`undo-button-container`,children:(0,K.jsx)(Pv,{label:q(`buttons.undo`),children:e(`undo`)})}),(0,K.jsx)(`div`,{className:`redo-button-container`,children:(0,K.jsxs)(Pv,{label:q(`buttons.redo`),children:[` `,e(`redo`)]})})]}),Vx=({actionManager:e,showExitZenModeBtn:t})=>(0,K.jsx)(`button`,{type:`button`,className:L(`disable-zen-mode`,{"disable-zen-mode--visible":t}),onClick:()=>e.executeAction(zy),children:q(`buttons.exitZenMode`)}),Hx=({renderAction:e,className:t})=>(0,K.jsx)(`div`,{className:`finalize-button ${t}`,children:e(`finalize`,{size:`small`})}),Ux=e=>{let t=(0,G.useRef)({userFn:e});return t.current.userFn=e,t.current.stableFn||(t.current.stableFn=(...e)=>t.current.userFn(...e)),t.current.stableFn},Wx=Cd(null),Gx=()=>{let[e,t]=xg(Wx),n=TD();return e&&e===`clearCanvas`?(0,K.jsx)(Rb,{onConfirm:()=>{n.executeAction(Fv),t(null)},onCancel:()=>t(null),title:q(`clearCanvasDialog.title`),children:(0,K.jsxs)(`p`,{className:`clear-canvas__content`,children:[` `,q(`alerts.clearReset`)]})}):null},Kx={};he(Kx,{toggleTheme:()=>qx});var qx={...Hv,category:`App`,label:`Toggle theme`,perform:({actionManager:e})=>{e.executeAction(Hv,`commandPalette`)}},Jx=j({name:`copyElementLink`,label:`labels.copyElementLink`,icon:hc,trackEvent:{category:`element`},perform:async(e,t,n,r)=>{let i=V(e,t);try{if(window.location){let n=Na(i,t);return n?(await Gt(r.props.generateLinkForSelection?r.props.generateLinkForSelection(n.id,n.type):io(n.id,n.type)),{appState:{toast:{message:q(`toast.elementLinkCopied`),closable:!0}},captureUpdate:N.EVENTUALLY}):{appState:t,elements:e,app:r,captureUpdate:N.EVENTUALLY}}}catch(e){console.error(e)}return{appState:t,elements:e,app:r,captureUpdate:N.EVENTUALLY}},predicate:(e,t)=>uu(V(e,t))}),Yx=j({name:`linkToElement`,label:`labels.linkToElement`,icon:Zt,perform:(e,t,n,r)=>{let i=V(e,t);return i.length!==1||!uu(i)?{elements:e,appState:t,app:r,captureUpdate:N.EVENTUALLY}:{appState:{...t,openDialog:{name:`elementLinkSelector`,sourceElementId:V(e,t)[0].id}},captureUpdate:N.IMMEDIATELY}},predicate:(e,t,n,r)=>{let i=V(e,t);return t.openDialog?.name!==`elementLinkSelector`&&i.length===1&&uu(i)},trackEvent:!1}),Xx=Cd(null),Zx={app:`App`,export:`Export`,tools:`Tools`,editor:`Editor`,elements:`Elements`,links:`Links`},Qx=e=>{switch(e){case Zx.app:return 1;case Zx.export:return 2;case Zx.editor:return 3;case Zx.tools:return 4;case Zx.elements:return 5;case Zx.links:return 6;default:return 10}},$x=({shortcut:e,className:t,children:n})=>{let r=e.replace(`++`,`+$`).split(`+`);return(0,K.jsxs)(`div`,{className:L(`shortcut`,t),children:[r.map((e,t)=>(0,K.jsx)(`div`,{className:`shortcut-wrapper`,children:(0,K.jsx)(`div`,{className:`shortcut-key`,children:e===`$`?`+`:e})},e)),(0,K.jsx)(`div`,{className:`shortcut-desc`,children:n})]})},eS=e=>!e.altKey&&e[D.CTRL_OR_CMD]&&(e.shiftKey&&e.key.toLowerCase()===D.P||e.key===D.SLASH);Object.assign(e=>{let t=L_(),n=wD();return(0,G.useEffect)(()=>{let e=e=>{eS(e)&&(e.preventDefault(),e.stopPropagation(),n(e=>{let t=e.openDialog?.name===`commandPalette`?null:{name:`commandPalette`};return t&&Y(`command_palette`,`open`,`shortcut`),{openDialog:t}}))};return window.addEventListener(`keydown`,e,{capture:!0}),()=>window.removeEventListener(`keydown`,e,{capture:!0})},[n]),t.openDialog?.name===`commandPalette`?(0,K.jsx)(tS,{...e}):null},{defaultItems:Kx});function tS({customCommandPaletteItems:e}){let t=vD(),n=L_(),r=wD(),i=yD(),a=TD(),[o,s]=xg(Xx),[c,l]=(0,G.useState)(null),u=(0,G.useRef)(null),d=B_({uiAppState:n,customCommandPaletteItems:e,appProps:i});(0,G.useEffect)(()=>{let{uiAppState:e,customCommandPaletteItems:n,appProps:i}=d,c=n=>{let r=``;return n.label&&(r=typeof n.label==`function`?q(n.label(t.scene.getNonDeletedElements(),e,t)):q(n.label)),r},u=n=>typeof n.icon==`function`?n.icon(e,t.scene.getNonDeletedElements()):n.icon,f=[],p=(e,t,n)=>{let r={label:c(e),icon:u(e),category:t,shortcut:Ex(e.name),keywords:e.keywords,predicate:e.predicate,viewMode:e.viewMode,perform:()=>{a.executeAction(e,`commandPalette`)}};return n?n(r,e):r};if(e&&t.scene&&a){let d=[a.actions.group,a.actions.ungroup,a.actions.cut,a.actions.copy,a.actions.deleteSelectedElements,a.actions.wrapSelectionInFrame,a.actions.copyStyles,a.actions.pasteStyles,a.actions.bringToFront,a.actions.bringForward,a.actions.sendBackward,a.actions.sendToBack,a.actions.alignTop,a.actions.alignBottom,a.actions.alignLeft,a.actions.alignRight,a.actions.alignVerticallyCentered,a.actions.alignHorizontallyCentered,a.actions.duplicateSelection,a.actions.flipHorizontal,a.actions.flipVertical,a.actions.zoomToFitSelection,a.actions.zoomToFitSelectionInViewport,a.actions.increaseFontSize,a.actions.decreaseFontSize,a.actions.toggleLinearEditor,a.actions.cropEditor,cb,Jx,Yx].map(e=>p(e,Zx.elements,(e,t)=>({...e,predicate:t.predicate?t.predicate:(e,t,n,r)=>V(e,t).length>0}))),m=[a.actions.toggleHandTool,a.actions.setFrameAsActiveTool].map(e=>p(e,Zx.tools)),h=[a.actions.undo,a.actions.redo,a.actions.zoomIn,a.actions.zoomOut,a.actions.resetZoom,a.actions.zoomToFit,a.actions.zenMode,a.actions.viewMode,a.actions.gridMode,a.actions.objectsSnapMode,a.actions.toggleShortcuts,a.actions.selectAll,a.actions.toggleElementLock,a.actions.unlockAllElements,a.actions.stats].map(e=>p(e,Zx.editor)),g=[a.actions.saveToActiveFile,a.actions.saveFileToDisk,a.actions.copyAsPng,a.actions.copyAsSvg].map(e=>p(e,Zx.export));f=[...d,...h,{label:c(Fv),icon:u(Fv),shortcut:Ex(Fv.name),category:Zx.editor,keywords:[`delete`,`destroy`],viewMode:!1,perform:()=>{Eg.set(Wx,`clearCanvas`)}},{label:q(`buttons.exportImage`),category:Zx.export,icon:Je,shortcut:Ex(`imageExport`),keywords:[`export`,`image`,`png`,`jpeg`,`svg`,`clipboard`,`picture`],perform:()=>{r({openDialog:{name:`imageExport`}})}},...g];let _=[{label:q(`toolBar.library`),category:Zx.app,icon:Li,viewMode:!1,perform:()=>{e.openSidebar?r({openSidebar:null}):r({openSidebar:{name:Fu.name,tab:Fu.defaultTab}})}},{label:q(`search.title`),category:Zx.app,icon:wo,viewMode:!0,perform:()=>{a.executeAction(iS)}},{label:q(`labels.changeStroke`),keywords:[`color`,`outline`],category:Zx.elements,icon:ct,viewMode:!1,predicate:(e,t)=>{let n=V(e,t);return n.length>0&&Fx(t,n)},perform:()=>{r(e=>({openMenu:e.openMenu===`shape`?null:`shape`,openPopup:`elementStroke`}))}},{label:q(`labels.changeBackground`),keywords:[`color`,`fill`],icon:ct,category:Zx.elements,viewMode:!1,predicate:(e,t)=>{let n=V(e,t);return n.length>0&&Ix(t,n)},perform:()=>{r(e=>({openMenu:e.openMenu===`shape`?null:`shape`,openPopup:`elementBackground`}))}},{label:q(`labels.canvasBackground`),keywords:[`color`],icon:ct,category:Zx.editor,viewMode:!1,perform:()=>{r(e=>({openMenu:e.openMenu===`canvas`?null:`canvas`,openPopup:`canvasBackground`}))}},...Jc.reduce((e,n)=>{let{value:r,icon:a,key:o,numericKey:s}=n;if(i.UIOptions.tools?.[r]===!1)return e;let c=o&&Dr(typeof o==`string`?o:o[0])||s,l={label:q(`toolBar.${r}`),category:Zx.tools,shortcut:c,icon:a,keywords:[`toolbar`],viewMode:!1,perform:({event:e})=>{r===`image`?t.setActiveTool({type:r,insertOnCanvasDirectly:e.type===`keydown`}):t.setActiveTool({type:r})}};return e.push(l),e},[]),...m,{label:q(`toolBar.lock`),category:Zx.tools,icon:e.activeTool.locked?yr:Xt,shortcut:D.Q.toLocaleUpperCase(),viewMode:!1,perform:()=>{t.toggleLock()}},{label:`${q(`labels.textToDiagram`)}...`,category:Zx.tools,icon:yi,viewMode:!1,predicate:i.aiEnabled,perform:()=>{r(e=>({...e,openDialog:{name:`ttd`,tab:`text-to-diagram`}}))}},{label:`${q(`toolBar.mermaidToExcalidraw`)}...`,category:Zx.tools,icon:sd,viewMode:!1,predicate:i.aiEnabled,perform:()=>{r(e=>({...e,openDialog:{name:`ttd`,tab:`mermaid`}}))}}],v=[...f,..._,...n||[]].map(e=>({...e,icon:e.icon||gt,order:e.order??Qx(e.category),haystack:`${Ax(e.label.toLocaleLowerCase())} ${e.keywords?.join(` `)||``}`}));l(v),s(v.find(e=>e.label===o?.label)??null)}},[d,t,a,l,o?.label,s,r]);let[f,p]=(0,G.useState)(``),[m,h]=(0,G.useState)(null),[g,_]=(0,G.useState)({}),v=e=>{r({openDialog:null},e),p(``)},y=(e,t)=>{n.openDialog?.name===`commandPalette`&&(t.stopPropagation(),t.preventDefault(),document.body.classList.add(`excalidraw-animations-disabled`),v(()=>{e.perform({actionManager:a,event:t}),s(e),requestAnimationFrame(()=>{document.body.classList.remove(`excalidraw-animations-disabled`)})}))},b=Ux(e=>e.viewMode===!1&&n.viewModeEnabled?!1:typeof e.predicate==`function`?e.predicate(t.scene.getNonDeletedElements(),n,i,t):e.predicate===void 0||e.predicate),x=Ux(e=>{let t=su(e.target)||eS(e)||e.key===D.ESCAPE;if(t&&e.key!==D.ARROW_UP&&e.key!==D.ARROW_DOWN&&e.key!==D.ENTER)return;let n=Object.values(g).flat(),r=o&&!f&&b(o);if(e.key===D.ARROW_UP){e.preventDefault();let t=n.findIndex(e=>e.label===m?.label);if(r){if(t===0){h(o);return}if(m===o){let e=n[n.length-1];e&&h(e);return}}let i;i=t===-1||t===0?n.length-1:(t-1)%n.length;let a=n[i];a&&h(a);return}if(e.key===D.ARROW_DOWN){e.preventDefault();let t=n.findIndex(e=>e.label===m?.label);if(r){if(!m||t===n.length-1){h(o);return}if(m===o){let e=n[0];e&&h(e);return}}let i=n[(t+1)%n.length];i&&h(i);return}if(e.key===D.ENTER&&m&&setTimeout(()=>{y(m,e)}),!t){if(e.stopPropagation(),/^[a-zA-Z0-9]$/.test(e.key)){u?.current?.focus();return}e.preventDefault()}});return(0,G.useEffect)(()=>(window.addEventListener(`keydown`,x,{capture:!0}),()=>window.removeEventListener(`keydown`,x,{capture:!0})),[x]),(0,G.useEffect)(()=>{if(!c)return;let e=e=>{let t={};for(let n of e)t[n.category]?t[n.category].push(n):t[n.category]=[n];return t},t=c.filter(b).sort((e,t)=>e.order-t.order),n=!f&&o&&b(o);if(!f){_(e(n?t.filter(e=>e.label!==o?.label):t)),h(n?o:t[0]||null);return}let r=Ax(f.toLocaleLowerCase().replace(/[<>_| -]/g,``));t=Cm.default.filter(r,t,{extract:e=>e.haystack}).sort((e,t)=>t.score-e.score).map(e=>e.original),_(e(t)),h(t[0]??null)},[f,c,b,o]),(0,K.jsxs)(Sx,{onCloseRequest:()=>v(),closeOnClickOutside:!0,title:!1,size:720,autofocus:!0,className:`command-palette-dialog`,children:[(0,K.jsx)(wx,{value:f,placeholder:q(`commandPalette.search.placeholder`),onChange:e=>{p(e)},selectOnRender:!0,ref:u}),!t.device.viewport.isMobile&&(0,K.jsxs)(`div`,{className:`shortcuts-wrapper`,children:[(0,K.jsx)($x,{shortcut:``,children:q(`commandPalette.shortcuts.select`)}),(0,K.jsx)($x,{shortcut:``,children:q(`commandPalette.shortcuts.confirm`)}),(0,K.jsx)($x,{shortcut:k(`Esc`),children:q(`commandPalette.shortcuts.close`)})]}),(0,K.jsxs)(`div`,{className:`commands`,children:[o&&!f&&(0,K.jsxs)(`div`,{className:`command-category`,children:[(0,K.jsxs)(`div`,{className:`command-category-title`,children:[q(`commandPalette.recents`),(0,K.jsx)(`div`,{className:`icon`,style:{marginLeft:`6px`},children:oi})]}),(0,K.jsx)(nS,{command:o,isSelected:o.label===m?.label,onClick:e=>y(o,e),disabled:!b(o),onMouseMove:()=>h(o),showShortcut:!t.device.viewport.isMobile,appState:n})]}),Object.keys(g).length>0?Object.keys(g).map((e,r)=>(0,K.jsxs)(`div`,{className:`command-category`,children:[(0,K.jsx)(`div`,{className:`command-category-title`,children:e}),g[e].map(e=>(0,K.jsx)(nS,{command:e,isSelected:e.label===m?.label,onClick:t=>y(e,t),onMouseMove:()=>h(e),showShortcut:!t.device.viewport.isMobile,appState:n},e.label))]},e)):c?(0,K.jsxs)(`div`,{className:`no-match`,children:[(0,K.jsx)(`div`,{className:`icon`,children:wo}),` `,q(`commandPalette.search.noMatch`)]}):null]})]})}var nS=({command:e,isSelected:t,disabled:n,onMouseMove:r,onClick:i,showShortcut:a,appState:o})=>{let s=()=>{};return(0,K.jsxs)(`div`,{className:L(`command-item`,{"item-selected":t,"item-disabled":n}),ref:e=>{t&&!n&&e?.scrollIntoView?.({block:`nearest`})},onClick:n?s:i,onMouseMove:n?s:r,title:n?q(`commandPalette.itemNotAvailable`):``,children:[(0,K.jsxs)(`div`,{className:`name`,children:[e.icon&&(0,K.jsx)(Z_,{icon:typeof e.icon==`function`?e.icon(o):e.icon}),e.label]}),a&&e.shortcut&&(0,K.jsx)($x,{shortcut:e.shortcut})]})},rS=j({name:`toggleLinearEditor`,category:Zx.elements,label:(e,t,n)=>n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds})[0]?.type===`arrow`?`labels.lineEditor.editArrow`:`labels.lineEditor.edit`,keywords:[`line`],trackEvent:{category:`element`},predicate:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t);return!!(!t.editingLinearElement&&i.length===1&&fc(i[0])&&!B(i[0]))},perform(e,t,n,r){let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0})[0],a=t.editingLinearElement?.elementId===i.id?null:new F(i);return{appState:{...t,editingLinearElement:a},captureUpdate:N.IMMEDIATELY}},PanelComponent:({appState:e,updateData:t,app:n})=>{let r=n.scene.getSelectedElements({selectedElementIds:e.selectedElementIds})[0],i=q(r.type===`arrow`?`labels.lineEditor.editArrow`:`labels.lineEditor.edit`);return(0,K.jsx)(J,{type:`button`,icon:un,title:i,"aria-label":i,onClick:()=>t(null)})}}),iS=j({name:`searchMenu`,icon:wo,keywords:[`search`,`find`],label:`search.title`,viewMode:!0,trackEvent:{category:`search_menu`,action:`toggle`,predicate:e=>e.gridModeEnabled},perform(e,t,n,r){if(t.openSidebar?.name===Fu.name&&t.openSidebar.tab===`search`){let e=r.excalidrawContainerValue.container?.querySelector(`.${bi.SEARCH_MENU_INPUT_WRAPPER} input`);return e?.matches(`:focus`)?{appState:{...t,openSidebar:null},captureUpdate:N.EVENTUALLY}:(e?.focus(),e?.select(),!1)}return{appState:{...t,openSidebar:{name:Fu.name,tab:Kt},openDialog:null},captureUpdate:N.EVENTUALLY}},checked:e=>e.gridModeEnabled,predicate:(e,t,n)=>n.gridModeEnabled===void 0,keyTest:e=>e[D.CTRL_OR_CMD]&&e.key===D.F}),aS=j({name:`cropEditor`,label:`helpDialog.cropStart`,icon:Jn,viewMode:!0,trackEvent:{category:`menu`},keywords:[`image`,`crop`],perform(e,t,n,r){let i=r.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!0})[0];return{appState:{...t,isCropping:!1,croppingElementId:i.id},captureUpdate:N.IMMEDIATELY}},predicate:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t);return!!(!t.croppingElementId&&i.length===1&&De(i[0]))},PanelComponent:({appState:e,updateData:t,app:n})=>{let r=q(`helpDialog.cropStart`);return(0,K.jsx)(J,{type:`button`,icon:Jn,title:r,"aria-label":r,onClick:()=>t(null)})}}),oS=class{constructor(e=!0,t=!0){this.isUndoStackEmpty=e,this.isRedoStackEmpty=t}},sS=class e{constructor(){C(this,`onHistoryChangedEmitter`,new nn),C(this,`undoStack`,[]),C(this,`redoStack`,[])}get isUndoStackEmpty(){return this.undoStack.length===0}get isRedoStackEmpty(){return this.redoStack.length===0}clear(){this.undoStack.length=0,this.redoStack.length=0}record(e,t){let n=cS.create(t,e);n.isEmpty()||(this.undoStack.push(n.inverse()),n.elementsChange.isEmpty()||(this.redoStack.length=0),this.onHistoryChangedEmitter.trigger(new oS(this.isUndoStackEmpty,this.isRedoStackEmpty)))}undo(t,n,r){return this.perform(t,n,r,()=>e.pop(this.undoStack),n=>e.push(this.redoStack,n,t))}redo(t,n,r){return this.perform(t,n,r,()=>e.pop(this.redoStack),n=>e.push(this.undoStack,n,t))}perform(e,t,n,r,i){try{let a=r();if(a===null)return;let o=e,s=t,c=!1;for(;a;){try{[o,s,c]=a.applyTo(o,s,n)}finally{i(a)}if(c)break;a=r()}return[o,s]}finally{this.onHistoryChangedEmitter.trigger(new oS(this.isUndoStackEmpty,this.isRedoStackEmpty))}}static pop(e){if(!e.length)return null;let t=e.pop();return t===void 0?null:t}static push(e,t,n){let r=t.inverse().applyLatestChanges(n);return e.push(r)}},cS=class e{constructor(e,t){this.appStateChange=e,this.elementsChange=t}static create(t,n){return new e(t,n)}inverse(){return new e(this.appStateChange.inverse(),this.elementsChange.inverse())}applyTo(e,t,n){let[r,i]=this.elementsChange.applyTo(e,n.elements),[a,o]=this.appStateChange.applyTo(t,r);return[r,a,i||o]}applyLatestChanges(t){let n=this.elementsChange.applyLatestChanges(t);return e.create(this.appStateChange,n)}isEmpty(){return this.appStateChange.isEmpty()&&this.elementsChange.isEmpty()}},lS=(e,t)=>{let[n,r]=(0,G.useState)(t);return(0,G.useEffect)(()=>{let t=e.on(e=>{r(e)});return()=>{t()}},[e]),n},uS=(e,t,n)=>{if(!t.multiElement&&!t.resizingElement&&!t.editingTextElement&&!t.newElement&&!t.selectedElementsAreBeingDragged&&!t.selectionElement&&!e.flowChartCreator.isCreatingChart){let e=n();if(!e)return{captureUpdate:N.EVENTUALLY};let[t,r]=e;return{appState:r,elements:Array.from(t.values()),captureUpdate:N.NEVER}}return{captureUpdate:N.EVENTUALLY}},dS=(e,t)=>({name:`undo`,label:`buttons.undo`,icon:Oa,trackEvent:{category:`history`},viewMode:!1,perform:(n,r,i,a)=>uS(a,r,()=>e.undo(P(n),r,t.snapshot)),keyTest:e=>e[D.CTRL_OR_CMD]&&pi(e,D.Z)&&!e.shiftKey,PanelComponent:({updateData:t,data:n})=>{let{isUndoStackEmpty:r}=lS(e.onHistoryChangedEmitter,new oS(e.isUndoStackEmpty,e.isRedoStackEmpty));return(0,K.jsx)(J,{type:`button`,icon:Oa,"aria-label":q(`buttons.undo`),onClick:t,size:n?.size||`medium`,disabled:r,"data-testid":`button-undo`})}}),fS=(e,t)=>({name:`redo`,label:`buttons.redo`,icon:sc,trackEvent:{category:`history`},viewMode:!1,perform:(n,r,i,a)=>uS(a,r,()=>e.redo(P(n),r,t.snapshot)),keyTest:e=>e[D.CTRL_OR_CMD]&&e.shiftKey&&pi(e,D.Z)||ya&&e.ctrlKey&&!e.shiftKey&&pi(e,D.Y),PanelComponent:({updateData:t,data:n})=>{let{isRedoStackEmpty:r}=lS(e.onHistoryChangedEmitter,new oS(e.isUndoStackEmpty,e.isRedoStackEmpty));return(0,K.jsx)(J,{type:`button`,icon:sc,"aria-label":q(`buttons.redo`),onClick:t,size:n?.size||`medium`,disabled:r,"data-testid":`button-redo`})}}),pS=(e,t,n,r,i,a)=>{if(e.trackEvent)try{typeof e.trackEvent==`object`&&(!e.trackEvent.predicate||e.trackEvent.predicate(n,r,a))&&Y(e.trackEvent.category,e.trackEvent.action||e.name,`${t} (${i.device.editor.isMobile?`mobile`:`desktop`})`)}catch(e){console.error(`error while logging action:`,e)}},mS=class{constructor(e,t,n,r){C(this,`actions`,{}),C(this,`updater`),C(this,`getAppState`),C(this,`getElementsIncludingDeleted`),C(this,`app`),C(this,`renderAction`,(e,t)=>{let n=this.app.props.UIOptions.canvasActions;if(this.actions[e]&&`PanelComponent`in this.actions[e]&&(!(e in n)||n[e])){let n=this.actions[e],r=n.PanelComponent;r.displayName=`PanelComponent`;let i=this.getElementsIncludingDeleted(),a=this.getAppState();return(0,K.jsx)(r,{elements:this.getElementsIncludingDeleted(),appState:this.getAppState(),updateData:e=>{pS(n,`ui`,a,i,this.app,e),this.updater(n.perform(this.getElementsIncludingDeleted(),this.getAppState(),e,this.app))},appProps:this.app.props,app:this.app,data:t})}return null}),C(this,`isActionEnabled`,e=>{let t=this.getElementsIncludingDeleted(),n=this.getAppState();return!e.predicate||e.predicate(t,n,this.app.props,this.app)}),this.updater=t=>{if(Fe(t))t.then(t=>e(t));else return e(t)},this.getAppState=t,this.getElementsIncludingDeleted=n,this.app=r}registerAction(e){this.actions[e.name]=e}registerAll(e){e.forEach(e=>this.registerAction(e))}handleKeyDown(e){let t=this.app.props.UIOptions.canvasActions,n=Object.values(this.actions).sort((e,t)=>(t.keyPriority||0)-(e.keyPriority||0)).filter(n=>(n.name in t?t[n.name]:!0)&&n.keyTest&&n.keyTest(e,this.getAppState(),this.getElementsIncludingDeleted(),this.app));if(n.length!==1)return n.length>1&&console.warn(`Canceling as multiple actions match this shortcut`,n),!1;let r=n[0];if(this.getAppState().viewModeEnabled&&r.viewMode!==!0)return!1;let i=this.getElementsIncludingDeleted(),a=this.getAppState();return pS(r,`keyboard`,a,i,this.app,null),e.preventDefault(),e.stopPropagation(),this.updater(n[0].perform(i,a,null,this.app)),!0}executeAction(e,t=`api`,n=null){let r=this.getElementsIncludingDeleted(),i=this.getAppState();pS(e,t,i,r,this.app,n),this.updater(e.perform(r,i,n,this.app))}},hS=e=>{let t=Array.from(e.values());return{x:_S(t,e=>e.x)/t.length,y:_S(t,e=>e.y)/t.length}},gS=([e,t])=>Math.hypot(e.x-t.x,e.y-t.y),_S=(e,t)=>e.reduce((e,n)=>e+t(n),0),vS=({children:e,left:t,top:n,onCloseRequest:r,fitInViewport:i=!1,offsetLeft:a=0,offsetTop:o=0,viewportWidth:s=window.innerWidth,viewportHeight:c=window.innerHeight})=>{let l=(0,G.useRef)(null);(0,G.useEffect)(()=>{let e=l.current;if(!e)return;e.contains(document.activeElement)||e.focus();let t=t=>{if(t.key===D.TAB){let n=ks(e),{activeElement:r}=document,i=n.findIndex(e=>e===r);r===e?(t.shiftKey?n[n.length-1]?.focus():n[0].focus(),t.preventDefault(),t.stopImmediatePropagation()):i===0&&t.shiftKey?(n[n.length-1]?.focus(),t.preventDefault(),t.stopImmediatePropagation()):i===n.length-1&&!t.shiftKey&&(n[0]?.focus(),t.preventDefault(),t.stopImmediatePropagation())}};return e.addEventListener(`keydown`,t),()=>e.removeEventListener(`keydown`,t)},[]);let u=(0,G.useRef)(null);return(0,G.useLayoutEffect)(()=>{if(i&&l.current&&n!=null&&t!=null){let e=l.current,{width:r,height:i}=e.getBoundingClientRect();if(u.current?.top===n&&u.current?.left===t)return;u.current={top:n,left:t},r>=s?(e.style.width=`${s}px`,e.style.left=`0px`,e.style.overflowX=`scroll`):t+r-a>s?e.style.left=`${s-r-10}px`:e.style.left=`${t}px`,i>=c?(e.style.height=`${c-20}px`,e.style.top=`10px`,e.style.overflowY=`scroll`):n+i-o>c?e.style.top=`${c-i}px`:e.style.top=`${n}px`}},[n,t,i,s,c,a,o]),(0,G.useEffect)(()=>{if(r){let e=e=>{l.current?.contains(e.target)||(0,hg.unstable_batchedUpdates)(()=>r(e))};return document.addEventListener(`pointerdown`,e,!1),()=>document.removeEventListener(`pointerdown`,e,!1)}},[r]),(0,K.jsx)(`div`,{className:`popover`,ref:l,tabIndex:-1,children:e})},yS=`separator`,bS=G.memo(({actionManager:e,items:t,top:n,left:r,onClose:i})=>{let a=CD(),o=SD(),s=t.reduce((t,n)=>(n&&(n===yS||!n.predicate||n.predicate(o,a,e.app.props,e.app))&&t.push(n),t),[]);return(0,K.jsx)(vS,{onCloseRequest:()=>{i()},top:n,left:r,fitInViewport:!0,offsetLeft:a.offsetLeft,offsetTop:a.offsetTop,viewportWidth:a.width,viewportHeight:a.height,children:(0,K.jsx)(`ul`,{className:`context-menu`,onContextMenu:e=>e.preventDefault(),children:s.map((t,n)=>{if(t===yS)return!s[n-1]||s[n-1]===yS?null:(0,K.jsx)(`hr`,{className:`context-menu-item-separator`},n);let r=t.name,c=``;return t.label&&(c=typeof t.label==`function`?q(t.label(o,a,e.app)):q(t.label)),(0,K.jsx)(`li`,{"data-testid":r,onClick:()=>{i(()=>{e.executeAction(t,`contextMenu`)})},children:(0,K.jsxs)(`button`,{type:`button`,className:L(`context-menu-item`,{dangerous:r===`deleteSelectedElements`,checkmark:t.checked?.(a)}),children:[(0,K.jsx)(`div`,{className:`context-menu-item__label`,children:c}),(0,K.jsx)(`kbd`,{className:`context-menu-item__shortcut`,children:r?Ex(r):``})]})},n)})})})}),xS=({children:e,onClose:t})=>{let[n,r]=(0,G.useState)(!!e),{container:i}=xD(),a=G.useCallback(()=>{r(!1),t&&t(),i?.focus()},[t,i]);return(0,K.jsx)(K.Fragment,{children:n&&(0,K.jsx)(Sx,{size:`small`,onCloseRequest:a,title:q(`errorDialog.title`),children:(0,K.jsx)(`div`,{style:{whiteSpace:`pre-wrap`},children:e})})})},SS=function({onChange:e,value:t,choices:n,name:r}){return(0,K.jsx)(`div`,{className:`RadioGroup`,children:n.map(n=>(0,K.jsxs)(`div`,{className:L(`RadioGroup__choice`,{active:n.value===t}),title:n.ariaLabel,children:[(0,K.jsx)(`input`,{name:r,type:`radio`,checked:n.value===t,onChange:()=>e(n.value),"aria-label":n.ariaLabel}),n.label]},String(n.value)))})},CS=({title:e,name:t,checked:n,onChange:r,disabled:i=!1})=>(0,K.jsx)(`div`,{className:L(`Switch`,{toggled:n,disabled:i}),children:(0,K.jsx)(`input`,{name:t,id:t,title:e,type:`checkbox`,checked:n,disabled:i,onChange:()=>r(!n),onKeyDown:e=>{e.key===` `&&r(!n)}})}),wS=(0,G.forwardRef)(({children:e,icon:t,onClick:n,label:r,variant:i=`filled`,color:a=`primary`,size:o=`medium`,fullWidth:s,className:c,status:l},u)=>{let[d,f]=(0,G.useState)(!1),p=async e=>{let t=n?.(e);if(Fe(t)){let e=window.setTimeout(()=>{f(!0)},50);try{await t}catch(e){if(e instanceof En)console.warn(e);else throw e}finally{clearTimeout(e),f(!1)}}},m=d?`loading`:l;return a=m===`success`?`success`:a,(0,K.jsx)(`button`,{className:L(`ExcButton`,`ExcButton--color-${a}`,`ExcButton--variant-${i}`,`ExcButton--size-${o}`,`ExcButton--status-${m}`,{"ExcButton--fullWidth":s},c),onClick:p,type:`button`,"aria-label":r,ref:u,disabled:m===`loading`||m===`success`,children:(0,K.jsxs)(`div`,{className:`ExcButton__contents`,children:[m===`loading`?(0,K.jsx)(zg,{className:`ExcButton__statusIcon`}):m===`success`&&(0,K.jsx)(`div`,{className:`ExcButton__statusIcon`,children:we}),t&&(0,K.jsx)(`div`,{className:`ExcButton__icon`,"aria-hidden":!0,children:t}),i!==`icon`&&(e??r)]})})}),TS=2e3,ES=()=>{let[e,t]=(0,G.useState)(null),n=(0,G.useRef)(0);return{copyStatus:e,resetCopyStatus:(0,G.useCallback)(()=>{t(null)},[]),onCopy:()=>{clearTimeout(n.current),t(`success`),n.current=window.setTimeout(()=>{t(null)},TS)}}},DS=`filter`in document.createElement(`canvas`).getContext(`2d`),OS=()=>(0,K.jsxs)(`div`,{children:[(0,K.jsx)(`h3`,{children:q(`canvasError.cannotShowPreview`)}),(0,K.jsx)(`p`,{children:(0,K.jsx)(`span`,{children:q(`canvasError.canvasTooBig`)})}),(0,K.jsxs)(`em`,{children:[`(`,q(`canvasError.canvasTooBigTip`),`)`]})]}),kS=({appStateSnapshot:e,elementsSnapshot:t,files:n,actionManager:r,onExportImage:i,name:a})=>{let o=js(t,e),[s,c]=(0,G.useState)(a),[l,u]=(0,G.useState)(o),[d,f]=(0,G.useState)(e.exportBackground),[p,m]=(0,G.useState)(e.exportWithDarkMode),[h,g]=(0,G.useState)(e.exportEmbedScene),[_,v]=(0,G.useState)(e.exportScale),y=(0,G.useRef)(null),[b,x]=(0,G.useState)(null),{onCopy:S,copyStatus:ee,resetCopyStatus:te}=ES();(0,G.useEffect)(()=>{te()},[s,d,p,_,h,te]);let{exportedElements:ne,exportingFrame:re}=Jv(t,e,l);return(0,G.useEffect)(()=>{let t=y.current;if(!t)return;let r=t.offsetWidth,i=t.offsetHeight;r&&fl({elements:ne,appState:{...e,name:s,exportBackground:d,exportWithDarkMode:p,exportScale:_,exportEmbedScene:h},files:n,exportPadding:10,maxWidthOrHeight:Math.max(r,i),exportingFrame:re}).then(e=>(x(null),Mu(e).then(()=>{t.replaceChildren(e)}).catch(e=>{throw e.name===`CANVAS_POSSIBLY_TOO_BIG`?Error(q(`canvasError.canvasTooBig`)):e}))).catch(e=>{console.error(e),x(e)})},[e,n,ne,re,s,d,p,_,h]),(0,K.jsxs)(`div`,{className:`ImageExportModal`,children:[(0,K.jsx)(`h3`,{children:q(`imageExportDialog.header`)}),(0,K.jsxs)(`div`,{className:`ImageExportModal__preview`,children:[(0,K.jsx)(`div`,{className:`ImageExportModal__preview__canvas`,ref:y,children:b&&(0,K.jsx)(OS,{})}),(0,K.jsx)(`div`,{className:`ImageExportModal__preview__filename`,children:!_s&&(0,K.jsx)(`input`,{type:`text`,className:`TextInput`,value:s,style:{width:`30ch`},onChange:e=>{c(e.target.value),r.executeAction(Qv,`ui`,e.target.value)}})})]}),(0,K.jsxs)(`div`,{className:`ImageExportModal__settings`,children:[(0,K.jsx)(`h3`,{children:q(`imageExportDialog.header`)}),o&&(0,K.jsx)(AS,{label:q(`imageExportDialog.label.onlySelected`),name:`exportOnlySelected`,children:(0,K.jsx)(CS,{name:`exportOnlySelected`,checked:l,onChange:e=>{u(e)}})}),(0,K.jsx)(AS,{label:q(`imageExportDialog.label.withBackground`),name:`exportBackgroundSwitch`,children:(0,K.jsx)(CS,{name:`exportBackgroundSwitch`,checked:d,onChange:e=>{f(e),r.executeAction(ey,`ui`,e)}})}),DS&&(0,K.jsx)(AS,{label:q(`imageExportDialog.label.darkMode`),name:`exportDarkModeSwitch`,children:(0,K.jsx)(CS,{name:`exportDarkModeSwitch`,checked:p,onChange:e=>{m(e),r.executeAction(ay,`ui`,e)}})}),(0,K.jsx)(AS,{label:q(`imageExportDialog.label.embedScene`),tooltip:q(`imageExportDialog.tooltip.embedScene`),name:`exportEmbedSwitch`,children:(0,K.jsx)(CS,{name:`exportEmbedSwitch`,checked:h,onChange:e=>{g(e),r.executeAction(ty,`ui`,e)}})}),(0,K.jsx)(AS,{label:q(`imageExportDialog.label.scale`),name:`exportScale`,children:(0,K.jsx)(SS,{name:`exportScale`,value:_,onChange:e=>{v(e),r.executeAction($v,`ui`,e)},choices:cl.map(e=>({value:e,label:`${e}\xD7`}))})}),(0,K.jsxs)(`div`,{className:`ImageExportModal__settings__buttons`,children:[(0,K.jsx)(wS,{className:`ImageExportModal__settings__buttons__button`,label:q(`imageExportDialog.title.exportToPng`),onClick:()=>i(nr.png,ne,{exportingFrame:re}),icon:ds,children:q(`imageExportDialog.button.exportToPng`)}),(0,K.jsx)(wS,{className:`ImageExportModal__settings__buttons__button`,label:q(`imageExportDialog.title.exportToSvg`),onClick:()=>i(nr.svg,ne,{exportingFrame:re}),icon:ds,children:q(`imageExportDialog.button.exportToSvg`)}),($t||qc)&&(0,K.jsx)(wS,{className:`ImageExportModal__settings__buttons__button`,label:q(`imageExportDialog.title.copyPngToClipboard`),status:ee,onClick:async()=>{await i(nr.clipboard,ne,{exportingFrame:re}),S()},icon:hc,children:q(`imageExportDialog.button.copyPngToClipboard`)})]})]})]})},AS=({label:e,children:t,tooltip:n,name:r})=>(0,K.jsxs)(`div`,{className:`ImageExportModal__settings__setting`,title:e,children:[(0,K.jsxs)(`label`,{htmlFor:r,className:`ImageExportModal__settings__setting__label`,children:[e,n&&(0,K.jsx)(Pv,{label:n,long:!0,children:ei})]}),(0,K.jsx)(`div`,{className:`ImageExportModal__settings__setting__content`,children:t})]}),jS=({elements:e,appState:t,files:n,actionManager:r,onExportImage:i,onCloseRequest:a,name:o})=>{let[{appStateSnapshot:s,elementsSnapshot:c}]=(0,G.useState)(()=>({appStateSnapshot:jn(t),elementsSnapshot:jn(e)}));return(0,K.jsx)(Sx,{onCloseRequest:a,size:`wide`,title:!1,children:(0,K.jsx)(kS,{elementsSnapshot:c,appStateSnapshot:s,files:n,actionManager:r,onExportImage:i,name:o})})},MS=({children:e,side:t,className:n})=>(0,K.jsx)(`div`,{className:L(`FixedSideContainer`,`FixedSideContainer_side_${t}`,n),children:e}),NS=100,PS=100,FS=e=>{switch(e){case D.ARROW_UP:return`up`;case D.ARROW_DOWN:return`down`;case D.ARROW_RIGHT:return`right`;case D.ARROW_LEFT:return`left`;default:return`right`}},IS=(e,t,n,r)=>{let i=[...n.values()].reduce((r,i)=>{let a;if(B(i)&&(a=i[e===`predecessors`?`startBinding`:`endBinding`])&&i[e===`predecessors`?`endBinding`:`startBinding`]?.elementId===t.id){let o=n.get(a.elementId);if(!o)return r;as(vl(o),`not an ExcalidrawBindableElement`);let s=e===`predecessors`?i.points[i.points.length-1]:[0,0],c=La(t,gn(t),[s[0]+i.x,s[1]+i.y]);r.push({relative:o,heading:c})}return r},[]);switch(r){case`up`:return i.filter(e=>Si(e.heading,Do)).map(e=>e.relative);case`down`:return i.filter(e=>Si(e.heading,pt)).map(e=>e.relative);case`right`:return i.filter(e=>Si(e.heading,Cl)).map(e=>e.relative);case`left`:return i.filter(e=>Si(e.heading,ra)).map(e=>e.relative)}},LS=(e,t,n)=>IS(`successors`,e,t,n),RS=(e,t,n)=>IS(`predecessors`,e,t,n),zS=(e,t,n)=>{let r=PS+e.width;if(n===`up`||n===`down`){let r=NS+e.height,i=e.x,a=e.x+e.width;if(t.every(e=>e.x+e.width<i||e.x>a))return{x:0,y:r*(n===`up`?-1:1)}}else if(n===`right`||n===`left`){let r=e.y,i=e.y+e.height;if(t.every(e=>e.y+e.height<r||e.y>i))return{x:(PS+e.width)*(n===`left`?-1:1),y:0}}if(n===`up`||n===`down`){let i=NS+e.height,a=(t.length,i),o=t.length===0?0:(t.length+1)%2==0?(t.length+1)/2*r:t.length/2*r*-1;return n===`up`?{x:o,y:a*-1}:{x:o,y:a}}let i=NS+e.height,a=(t.length,PS+e.width),o=t.length===0?0:(t.length+1)%2==0?(t.length+1)/2*i:t.length/2*i*-1;return n===`left`?{x:a*-1,y:o}:{x:a,y:o}},BS=(e,t,n,r)=>{let i=LS(e,t,r),a=RS(e,t,r),o=zS(e,[...i,...a],r),s=ni({type:e.type,x:e.x+o.x,y:e.y+o.y,width:e.width,height:e.height,roundness:e.roundness,roughness:e.roughness,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,opacity:e.opacity,fillStyle:e.fillStyle,strokeStyle:e.strokeStyle});return as(Ws(s),`not an ExcalidrawFlowchartNodeElement`),{nextNode:s,bindingArrow:HS(e,s,t,r,n)}},VS=(e,t,n,r,i)=>{let a=[];for(let o=0;o<i;o++){let s,c;if(r===`left`||r===`right`){let t=NS*(i-1)+i*e.height,n=e.y+e.height/2-t/2,a=PS+e.width;r===`left`&&(a*=-1),s=e.x+a,c=n+(NS+e.height)*o}else{let t=PS*(i-1)+i*e.width,n=e.x+e.width/2-t/2,a=NS+e.height;r===`up`&&(a*=-1),c=e.y+a,s=n+(PS+e.width)*o}let l=ni({type:e.type,x:s,y:c,width:e.width,height:e.height,roundness:e.roundness,roughness:e.roughness,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,opacity:e.opacity,fillStyle:e.fillStyle,strokeStyle:e.strokeStyle});as(Ws(l),`not an ExcalidrawFlowchartNodeElement`);let u=HS(e,l,t,r,n);a.push(l),a.push(u)}return a},HS=(e,t,n,r,i)=>{let a,o;switch(r){case`up`:a=e.x+e.width/2,o=e.y-6;break;case`down`:a=e.x+e.width/2,o=e.y+e.height+6;break;case`right`:a=e.x+e.width+6,o=e.y+e.height/2;break;case`left`:a=e.x-6,o=e.y+e.height/2;break}let s,c;switch(r){case`up`:s=t.x+t.width/2-a,c=t.y+t.height-o+6;break;case`down`:s=t.x+t.width/2-a,c=t.y-o-6;break;case`right`:s=t.x-a-6,c=t.y-o+t.height/2;break;case`left`:s=t.x+t.width-a+6,c=t.y-o+t.height/2;break}let l=Fi({type:`arrow`,x:a,y:o,startArrowhead:null,endArrowhead:i.currentItemEndArrowhead,strokeColor:e.strokeColor,strokeStyle:e.strokeStyle,strokeWidth:e.strokeWidth,opacity:e.opacity,roughness:e.roughness,points:[I(0,0),I(s,c)],elbowed:!0});ml(l,e,`start`,n),ml(l,t,`end`,n);let u=new Map;u.set(e.id,e),u.set(t.id,t),u.set(l.id,l),F.movePoints(l,[{index:1,point:l.points[1]}]);let d=tn(l,Al(new Map([...n.entries(),[e.id,e],[t.id,t],[l.id,l]])),{points:l.points});return{...l,...d}},US=class{constructor(){C(this,`isExploring`,!1),C(this,`sameLevelNodes`,[]),C(this,`sameLevelIndex`,0),C(this,`direction`,null),C(this,`visitedNodes`,new Set)}clear(){this.isExploring=!1,this.sameLevelNodes=[],this.sameLevelIndex=0,this.direction=null,this.visitedNodes.clear()}exploreByDirection(e,t,n){if(!vl(e))return null;if(n!==this.direction&&this.clear(),this.visitedNodes.has(e.id)||this.visitedNodes.add(e.id),this.isExploring&&n===this.direction&&this.sameLevelNodes.length>1)return this.sameLevelIndex=(this.sameLevelIndex+1)%this.sameLevelNodes.length,this.sameLevelNodes[this.sameLevelIndex].id;let r=[...LS(e,t,n),...RS(e,t,n)];if(r.length>0)return this.sameLevelIndex=0,this.isExploring=!0,this.sameLevelNodes=r,this.direction=n,this.visitedNodes.add(r[0].id),r[0].id;if(n===this.direction||!this.isExploring){this.isExploring||this.visitedNodes.add(e.id);let r=[`up`,`right`,`down`,`left`].filter(e=>e!==n).map(n=>[...LS(e,t,n),...RS(e,t,n)]).flat().filter(e=>!this.visitedNodes.has(e.id));for(let e of r)if(!this.visitedNodes.has(e.id))return this.visitedNodes.add(e.id),this.isExploring=!0,this.direction=n,e.id}return null}},WS=class{constructor(){C(this,`isCreatingChart`,!1),C(this,`numberOfNodes`,0),C(this,`direction`,`right`),C(this,`pendingNodes`,null)}createNodes(e,t,n,r){if(r!==this.direction){let{nextNode:i,bindingArrow:a}=BS(e,t,n,r);this.numberOfNodes=1,this.isCreatingChart=!0,this.direction=r,this.pendingNodes=[i,a]}else{this.numberOfNodes+=1;let i=VS(e,t,n,r,this.numberOfNodes);this.isCreatingChart=!0,this.direction=r,this.pendingNodes=i}if(e.frameId){let n=t.get(e.frameId);as(n&&ud(n),`not an ExcalidrawFrameElement`),n&&this.pendingNodes.every(e=>Et([e],n,t)||Qi(e,n,t))&&(this.pendingNodes=this.pendingNodes.map(t=>W(t,{frameId:e.frameId},!1)))}}clear(){this.isCreatingChart=!1,this.pendingNodes=null,this.direction=null,this.numberOfNodes=0}},GS=(e,t)=>{for(let[,n]of t)if(n.type===`arrow`&&(n.startBinding?.elementId===e.id||n.endBinding?.elementId===e.id))return!0;return!1},KS=({appState:e,isMobile:t,device:n,app:r})=>{let{activeTool:i,isResizing:a,isRotating:o,lastPointerDownWith:s}=e,c=e.multiElement!==null;if(e.openSidebar?.name===Fu.name&&e.openSidebar.tab===`search`&&e.searchMatches?.length)return q(`hints.dismissSearch`);if(e.openSidebar&&!n.editor.canFitSidebar)return null;if(aa(e))return q(`hints.eraserRevert`);if(i.type===`arrow`||i.type===`line`)return c?q(`hints.linearElementMulti`):i.type===`arrow`?q(`hints.arrowTool`,{arrowShortcut:k(`A`)}):q(`hints.linearElement`);if(i.type===`freedraw`)return q(`hints.freeDraw`);if(i.type===`text`)return q(`hints.text`);if(i.type===`embeddable`)return q(`hints.embeddable`);if(e.activeTool.type===`image`&&e.pendingImageElementId)return q(`hints.placeImage`);let l=r.scene.getSelectedElements(e);if(a&&s===`mouse`&&l.length===1){let e=l[0];return fc(e)&&e.points.length===2?q(`hints.lockAngle`):De(e)?q(`hints.resizeImage`):q(`hints.resize`)}if(o&&s===`mouse`)return q(`hints.rotate`);if(l.length===1&&H(l[0]))return q(`hints.text_selected`);if(e.editingTextElement)return q(`hints.text_editing`);if(e.croppingElementId)return q(`hints.leaveCropEditor`);if(l.length===1&&De(l[0]))return q(`hints.enterCropEditor`);if(i.type===`selection`){if(e.selectionElement&&!l.length&&!e.editingTextElement&&!e.editingLinearElement)return q(`hints.deepBoxSelect`);if(Oo(r)&&e.selectedElementsAreBeingDragged)return q(`hints.disableSnapping`);if(!l.length&&!t)return q(`hints.canvasPanning`);if(l.length===1){if(fc(l[0]))return e.editingLinearElement?e.editingLinearElement.selectedPointsIndices?q(`hints.lineEditor_pointSelected`):q(`hints.lineEditor_nothingSelected`):q(`hints.lineEditor_info`);if(!e.newElement&&!e.selectedElementsAreBeingDragged&&Hu(l[0]))return Ws(l[0])?(GS(l[0],r.scene.getNonDeletedElementsMap()),[q(`hints.bindTextToElement`),q(`hints.createFlowchart`)]):q(`hints.bindTextToElement`)}}return null},qS=({appState:e,isMobile:t,device:n,app:r})=>{let i=KS({appState:e,isMobile:t,device:n,app:r});return i?(0,K.jsx)(`div`,{className:`HintViewer`,children:(0,K.jsx)(`span`,{children:Array.isArray(i)?i.map(e=>k(e).replace(/\. ?$/,``)).join(`. `):k(i)})}):null},JS=`medium`,YS={CHECKED:yr,UNCHECKED:Xt},XS=e=>(0,K.jsxs)(`label`,{className:L(`ToolIcon ToolIcon__lock`,`ToolIcon_size_${JS}`,{"is-mobile":e.isMobile}),title:`${e.title} \u2014 Q`,children:[(0,K.jsx)(`input`,{className:`ToolIcon_type_checkbox`,type:`checkbox`,name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title,"data-testid":`toolbar-lock`}),(0,K.jsx)(`div`,{className:`ToolIcon__icon`,children:e.checked?YS.CHECKED:YS.UNCHECKED})]}),ZS=({heading:e,children:t,...n})=>{let{id:r}=xD(),i=(0,K.jsx)(`h2`,{className:`visually-hidden`,id:`${r}-${e}-title`,children:q(`headings.${e}`)});return(0,K.jsx)(`section`,{...n,"aria-labelledby":`${r}-${e}-title`,children:typeof t==`function`?t(i):(0,K.jsxs)(K.Fragment,{children:[i,t]})})},QS=4,$S=6,eC=`rgba(0,0,0,0.3)`,tC=(e,t,n,r)=>{if(!e.length)return{horizontal:null,vertical:null};let[i,a,o,s]=Ts(e),c=t/r.zoom.value,l=n/r.zoom.value,u=t-c,d=n-l,f={top:parseInt(Oe(`sat`))||0,bottom:parseInt(Oe(`sab`))||0,left:parseInt(Oe(`sal`))||0,right:parseInt(Oe(`sar`))||0},p=Fg().rtl,m=-r.scrollX+u/2+f.left,h=-r.scrollY+d/2+f.top,g=m+c-f.right,_=h+l-f.bottom,v=Math.min(i,m),y=Math.min(a,h),b=Math.max(o,g),x=Math.max(s,_);return{horizontal:m===v&&g===b?null:{x:Math.max(f.left,QS)+(m-v)/(b-v)*t,y:n-$S-Math.max(QS,f.bottom),width:(g-m)/(b-v)*t-Math.max(QS*2,f.left+f.right),height:$S},vertical:h===y&&_===x?null:{x:p?Math.max(f.left,QS):t-$S-Math.max(f.right,QS),y:(h-y)/(x-y)*n+Math.max(f.top,QS),width:$S,height:(_-h)/(x-y)*n-Math.max(QS*2,f.top+f.bottom)}}},nC=(e,t,n)=>{let[r,i]=[e.horizontal,e.vertical].map(e=>e!=null&&e.x<=t&&t<=e.x+e.width&&e.y<=n&&n<=e.y+e.height);return{isOverEither:r||i,isOverHorizontal:r,isOverVertical:i}},rC=`medium`,iC=e=>e.penDetected?(0,K.jsxs)(`label`,{className:L(`ToolIcon ToolIcon__penMode`,`ToolIcon_size_${rC}`,{"is-mobile":e.isMobile}),title:`${e.title}`,children:[(0,K.jsx)(`input`,{className:`ToolIcon_type_checkbox`,type:`checkbox`,name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title}),(0,K.jsx)(`div`,{className:`ToolIcon__icon`,children:Os})]}):null,aC=e=>(0,K.jsx)(J,{className:L(`Shape`,{fillable:!1}),type:`radio`,icon:ar,name:`editor-current-shape`,checked:e.checked,title:`${e.title} \u2014 H`,keyBindingLabel:e.isMobile?void 0:D.H.toLocaleUpperCase(),"aria-label":`${e.title} \u2014 H`,"aria-keyshortcuts":D.H,"data-testid":`toolbar-hand`,onChange:()=>e.onChange?.()}),oC=({appState:e,elements:t,actionManager:n,setAppState:r,onLockToggle:i,onHandToolToggle:a,onPenModeToggle:o,renderTopRightUI:s,renderCustomStats:c,renderSidebars:l,device:u,renderWelcomeScreen:d,UIOptions:f,app:p})=>{let{WelcomeScreenCenterTunnel:m,MainMenuTunnel:h,DefaultSidebarTriggerTunnel:g}=Mx();return(0,K.jsxs)(K.Fragment,{children:[l(),!e.viewModeEnabled&&e.openDialog?.name!==`elementLinkSelector`&&(()=>(0,K.jsxs)(MS,{side:`top`,className:`App-top-bar`,children:[d&&(0,K.jsx)(m.Out,{}),(0,K.jsx)(ZS,{heading:`shapes`,children:t=>(0,K.jsx)(Ob.Col,{gap:4,align:`center`,children:(0,K.jsxs)(Ob.Row,{gap:1,className:`App-toolbar-container`,children:[(0,K.jsxs)(W_,{padding:1,className:`App-toolbar App-toolbar--mobile`,children:[t,(0,K.jsx)(Ob.Row,{gap:1,children:(0,K.jsx)(Rx,{appState:e,activeTool:e.activeTool,UIOptions:f,app:p})})]}),s&&s(!0,e),(0,K.jsxs)(`div`,{className:`mobile-misc-tools-container`,children:[!e.viewModeEnabled&&e.openDialog?.name!==`elementLinkSelector`&&(0,K.jsx)(g.Out,{}),(0,K.jsx)(iC,{checked:e.penMode,onChange:()=>o(null),title:q(`toolBar.penMode`),isMobile:!0,penDetected:e.penDetected}),(0,K.jsx)(XS,{checked:e.activeTool.locked,onChange:i,title:q(`toolBar.lock`),isMobile:!0}),(0,K.jsx)(aC,{checked:On(e),onChange:()=>a(),title:q(`toolBar.hand`),isMobile:!0})]})]})})}),(0,K.jsx)(qS,{appState:e,isMobile:!0,device:u,app:p})]}))(),(0,K.jsx)(`div`,{className:`App-bottom-bar`,style:{marginBottom:$S+QS*2,marginLeft:$S+QS*2,marginRight:$S+QS*2},children:(0,K.jsxs)(W_,{padding:0,children:[e.openMenu===`shape`&&!e.viewModeEnabled&&e.openDialog?.name!==`elementLinkSelector`&&St(e,t)?(0,K.jsx)(ZS,{className:`App-mobile-menu`,heading:`selectedShapeActions`,children:(0,K.jsx)(Lx,{appState:e,elementsMap:p.scene.getNonDeletedElementsMap(),renderAction:n.renderAction,app:p})}):null,(0,K.jsxs)(`footer`,{className:`App-toolbar`,children:[(()=>e.viewModeEnabled||e.openDialog?.name===`elementLinkSelector`?(0,K.jsx)(`div`,{className:`App-toolbar-content`,children:(0,K.jsx)(h.Out,{})}):(0,K.jsxs)(`div`,{className:`App-toolbar-content`,children:[(0,K.jsx)(h.Out,{}),n.renderAction(`toggleEditMenu`),n.renderAction(e.multiElement?`finalize`:`duplicateSelection`),n.renderAction(`deleteSelectedElements`),(0,K.jsxs)(`div`,{children:[n.renderAction(`undo`),n.renderAction(`redo`)]})]}))(),e.scrolledOutside&&!e.openMenu&&!e.openSidebar&&(0,K.jsx)(`button`,{type:`button`,className:`scroll-back-to-content`,onClick:()=>{r(e=>({...Fr(t,e)}))},children:q(`buttons.scrollBackToContent`)})]})]})})]})},sC=e=>{let t=(0,G.useRef)(null),[n,r]=(0,G.useState)(null);return(0,G.useLayoutEffect)(()=>{if(!e.spreadsheet)return;let n=gc(e.chartType,e.spreadsheet,0,0);r(n);let i,a=t.current;return(async()=>(i=await Ua(n,{exportBackground:!1,viewBackgroundColor:qu.white},null,{skipInliningFonts:!0}),i.querySelector(`.style-fonts`)?.remove(),a.replaceChildren(),a.appendChild(i),e.selected&&a.parentNode.focus()))(),()=>{a.replaceChildren()}},[e.spreadsheet,e.chartType,e.selected]),(0,K.jsx)(`button`,{type:`button`,className:`ChartPreview`,onClick:()=>{n&&e.onClick(e.chartType,n)},children:(0,K.jsx)(`div`,{ref:t})})},cC=({setAppState:e,appState:t,onClose:n})=>{let{onInsertElements:r}=vD(),i=G.useCallback(()=>{n&&n()},[n]),a=(t,n)=>{r(n),Y(`paste`,`chart`,t),e({currentChartType:t,pasteDialog:{shown:!1,data:null}})};return(0,K.jsx)(Sx,{size:`small`,onCloseRequest:i,title:q(`labels.pasteCharts`),className:`PasteChartDialog`,autofocus:!1,children:(0,K.jsxs)(`div`,{className:`container`,children:[(0,K.jsx)(sC,{chartType:`bar`,spreadsheet:t.pasteDialog.data,selected:t.currentChartType===`bar`,onClick:a}),(0,K.jsx)(sC,{chartType:`line`,spreadsheet:t.pasteDialog.data,selected:t.currentChartType===`line`,onClick:a})]})})},lC=()=>(0,K.jsxs)(`div`,{className:`HelpDialog__header`,children:[(0,K.jsxs)(`a`,{className:`HelpDialog__btn`,href:`https://docs.excalidraw.com`,target:`_blank`,rel:`noopener noreferrer`,children:[(0,K.jsx)(`div`,{className:`HelpDialog__link-icon`,children:tr}),q(`helpDialog.documentation`)]}),(0,K.jsxs)(`a`,{className:`HelpDialog__btn`,href:`https://plus.excalidraw.com/blog`,target:`_blank`,rel:`noopener noreferrer`,children:[(0,K.jsx)(`div`,{className:`HelpDialog__link-icon`,children:tr}),q(`helpDialog.blog`)]}),(0,K.jsxs)(`a`,{className:`HelpDialog__btn`,href:`https://github.com/excalidraw/excalidraw/issues`,target:`_blank`,rel:`noopener noreferrer`,children:[(0,K.jsx)(`div`,{className:`HelpDialog__link-icon`,children:nd}),q(`helpDialog.github`)]}),(0,K.jsxs)(`a`,{className:`HelpDialog__btn`,href:`https://youtube.com/@excalidraw`,target:`_blank`,rel:`noopener noreferrer`,children:[(0,K.jsx)(`div`,{className:`HelpDialog__link-icon`,children:Is}),`YouTube`]})]}),uC=e=>(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`h3`,{children:e.title}),(0,K.jsx)(`div`,{className:`HelpDialog__islands-container`,children:e.children})]}),dC=e=>(0,K.jsxs)(`div`,{className:`HelpDialog__island ${e.className}`,children:[(0,K.jsx)(`h4`,{className:`HelpDialog__island-title`,children:e.caption}),(0,K.jsx)(`div`,{className:`HelpDialog__island-content`,children:e.children})]});function*fC(e,t){let n=!0;for(let r of e)n||(yield t),n=!1,yield r}var pC=e=>e.replace(/\b[a-z]\b/,e=>e.toUpperCase()),Z=({label:e,shortcuts:t,isOr:n=!0})=>{let r=t.map(e=>(e.endsWith(`++`)?[...e.slice(0,-2).split(`+`),`+`]:e.split(`+`)).map(e=>(0,K.jsx)(mC,{children:pC(e)},e)));return(0,K.jsxs)(`div`,{className:`HelpDialog__shortcut`,children:[(0,K.jsx)(`div`,{children:e}),(0,K.jsx)(`div`,{className:`HelpDialog__key-container`,children:[...fC(r,n?q(`helpDialog.or`):null)]})]})},mC=e=>(0,K.jsx)(`kbd`,{className:`HelpDialog__key`,...e}),hC=({onClose:e})=>(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)(Sx,{onCloseRequest:G.useCallback(()=>{e&&e()},[e]),title:q(`helpDialog.title`),className:`HelpDialog`,children:[(0,K.jsx)(lC,{}),(0,K.jsxs)(uC,{title:q(`helpDialog.shortcuts`),children:[(0,K.jsxs)(dC,{className:`HelpDialog__island--tools`,caption:q(`helpDialog.tools`),children:[(0,K.jsx)(Z,{label:q(`toolBar.hand`),shortcuts:[D.H]}),(0,K.jsx)(Z,{label:q(`toolBar.selection`),shortcuts:[D.V,D[1]]}),(0,K.jsx)(Z,{label:q(`toolBar.rectangle`),shortcuts:[D.R,D[2]]}),(0,K.jsx)(Z,{label:q(`toolBar.diamond`),shortcuts:[D.D,D[3]]}),(0,K.jsx)(Z,{label:q(`toolBar.ellipse`),shortcuts:[D.O,D[4]]}),(0,K.jsx)(Z,{label:q(`toolBar.arrow`),shortcuts:[D.A,D[5]]}),(0,K.jsx)(Z,{label:q(`toolBar.line`),shortcuts:[D.L,D[6]]}),(0,K.jsx)(Z,{label:q(`toolBar.freedraw`),shortcuts:[D.P,D[7]]}),(0,K.jsx)(Z,{label:q(`toolBar.text`),shortcuts:[D.T,D[8]]}),(0,K.jsx)(Z,{label:q(`toolBar.image`),shortcuts:[D[9]]}),(0,K.jsx)(Z,{label:q(`toolBar.eraser`),shortcuts:[D.E,D[0]]}),(0,K.jsx)(Z,{label:q(`toolBar.frame`),shortcuts:[D.F]}),(0,K.jsx)(Z,{label:q(`toolBar.laser`),shortcuts:[D.K]}),(0,K.jsx)(Z,{label:q(`labels.eyeDropper`),shortcuts:[D.I,`Shift+S`,`Shift+G`]}),(0,K.jsx)(Z,{label:q(`helpDialog.editLineArrowPoints`),shortcuts:[k(`CtrlOrCmd+Enter`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.editText`),shortcuts:[k(`Enter`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.textNewLine`),shortcuts:[k(`Enter`),k(`Shift+Enter`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.textFinish`),shortcuts:[k(`Esc`),k(`CtrlOrCmd+Enter`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.curvedArrow`),shortcuts:[`A`,q(`helpDialog.click`),q(`helpDialog.click`),q(`helpDialog.click`)],isOr:!1}),(0,K.jsx)(Z,{label:q(`helpDialog.curvedLine`),shortcuts:[`L`,q(`helpDialog.click`),q(`helpDialog.click`),q(`helpDialog.click`)],isOr:!1}),(0,K.jsx)(Z,{label:q(`helpDialog.cropStart`),shortcuts:[q(`helpDialog.doubleClick`),k(`Enter`)],isOr:!0}),(0,K.jsx)(Z,{label:q(`helpDialog.cropFinish`),shortcuts:[k(`Enter`),k(`Escape`)],isOr:!0}),(0,K.jsx)(Z,{label:q(`toolBar.lock`),shortcuts:[D.Q]}),(0,K.jsx)(Z,{label:q(`helpDialog.preventBinding`),shortcuts:[k(`CtrlOrCmd`)]}),(0,K.jsx)(Z,{label:q(`toolBar.link`),shortcuts:[k(`CtrlOrCmd+K`)]})]}),(0,K.jsxs)(dC,{className:`HelpDialog__island--view`,caption:q(`helpDialog.view`),children:[(0,K.jsx)(Z,{label:q(`buttons.zoomIn`),shortcuts:[k(`CtrlOrCmd++`)]}),(0,K.jsx)(Z,{label:q(`buttons.zoomOut`),shortcuts:[k(`CtrlOrCmd+-`)]}),(0,K.jsx)(Z,{label:q(`buttons.resetZoom`),shortcuts:[k(`CtrlOrCmd+0`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.zoomToFit`),shortcuts:[`Shift+1`]}),(0,K.jsx)(Z,{label:q(`helpDialog.zoomToSelection`),shortcuts:[`Shift+2`]}),(0,K.jsx)(Z,{label:q(`helpDialog.movePageUpDown`),shortcuts:[`PgUp/PgDn`]}),(0,K.jsx)(Z,{label:q(`helpDialog.movePageLeftRight`),shortcuts:[`Shift+PgUp/PgDn`]}),(0,K.jsx)(Z,{label:q(`buttons.zenMode`),shortcuts:[k(`Alt+Z`)]}),(0,K.jsx)(Z,{label:q(`buttons.objectsSnapMode`),shortcuts:[k(`Alt+S`)]}),(0,K.jsx)(Z,{label:q(`labels.toggleGrid`),shortcuts:[k(`CtrlOrCmd+'`)]}),(0,K.jsx)(Z,{label:q(`labels.viewMode`),shortcuts:[k(`Alt+R`)]}),(0,K.jsx)(Z,{label:q(`labels.toggleTheme`),shortcuts:[k(`Alt+Shift+D`)]}),(0,K.jsx)(Z,{label:q(`stats.fullTitle`),shortcuts:[k(`Alt+/`)]}),(0,K.jsx)(Z,{label:q(`search.title`),shortcuts:[Ex(`searchMenu`)]}),(0,K.jsx)(Z,{label:q(`commandPalette.title`),shortcuts:qc?[Ex(`commandPalette`)]:[Ex(`commandPalette`),Ex(`commandPalette`,1)]})]}),(0,K.jsxs)(dC,{className:`HelpDialog__island--editor`,caption:q(`helpDialog.editor`),children:[(0,K.jsx)(Z,{label:q(`helpDialog.createFlowchart`),shortcuts:[k(`CtrlOrCmd+Arrow Key`)],isOr:!0}),(0,K.jsx)(Z,{label:q(`helpDialog.navigateFlowchart`),shortcuts:[k(`Alt+Arrow Key`)],isOr:!0}),(0,K.jsx)(Z,{label:q(`labels.moveCanvas`),shortcuts:[k(`Space+${q(`helpDialog.drag`)}`),k(`Wheel+${q(`helpDialog.drag`)}`)],isOr:!0}),(0,K.jsx)(Z,{label:q(`buttons.clearReset`),shortcuts:[k(`CtrlOrCmd+Delete`)]}),(0,K.jsx)(Z,{label:q(`labels.delete`),shortcuts:[k(`Delete`)]}),(0,K.jsx)(Z,{label:q(`labels.cut`),shortcuts:[k(`CtrlOrCmd+X`)]}),(0,K.jsx)(Z,{label:q(`labels.copy`),shortcuts:[k(`CtrlOrCmd+C`)]}),(0,K.jsx)(Z,{label:q(`labels.paste`),shortcuts:[k(`CtrlOrCmd+V`)]}),(0,K.jsx)(Z,{label:q(`labels.pasteAsPlaintext`),shortcuts:[k(`CtrlOrCmd+Shift+V`)]}),(0,K.jsx)(Z,{label:q(`labels.selectAll`),shortcuts:[k(`CtrlOrCmd+A`)]}),(0,K.jsx)(Z,{label:q(`labels.multiSelect`),shortcuts:[k(`Shift+${q(`helpDialog.click`)}`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.deepSelect`),shortcuts:[k(`CtrlOrCmd+${q(`helpDialog.click`)}`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.deepBoxSelect`),shortcuts:[k(`CtrlOrCmd+${q(`helpDialog.drag`)}`)]}),($t||qc)&&(0,K.jsx)(Z,{label:q(`labels.copyAsPng`),shortcuts:[k(`Shift+Alt+C`)]}),(0,K.jsx)(Z,{label:q(`labels.copyStyles`),shortcuts:[k(`CtrlOrCmd+Alt+C`)]}),(0,K.jsx)(Z,{label:q(`labels.pasteStyles`),shortcuts:[k(`CtrlOrCmd+Alt+V`)]}),(0,K.jsx)(Z,{label:q(`labels.sendToBack`),shortcuts:[k(hs?`CtrlOrCmd+Alt+[`:`CtrlOrCmd+Shift+[`)]}),(0,K.jsx)(Z,{label:q(`labels.bringToFront`),shortcuts:[k(hs?`CtrlOrCmd+Alt+]`:`CtrlOrCmd+Shift+]`)]}),(0,K.jsx)(Z,{label:q(`labels.sendBackward`),shortcuts:[k(`CtrlOrCmd+[`)]}),(0,K.jsx)(Z,{label:q(`labels.bringForward`),shortcuts:[k(`CtrlOrCmd+]`)]}),(0,K.jsx)(Z,{label:q(`labels.alignTop`),shortcuts:[k(`CtrlOrCmd+Shift+Up`)]}),(0,K.jsx)(Z,{label:q(`labels.alignBottom`),shortcuts:[k(`CtrlOrCmd+Shift+Down`)]}),(0,K.jsx)(Z,{label:q(`labels.alignLeft`),shortcuts:[k(`CtrlOrCmd+Shift+Left`)]}),(0,K.jsx)(Z,{label:q(`labels.alignRight`),shortcuts:[k(`CtrlOrCmd+Shift+Right`)]}),(0,K.jsx)(Z,{label:q(`labels.duplicateSelection`),shortcuts:[k(`CtrlOrCmd+D`),k(`Alt+${q(`helpDialog.drag`)}`)]}),(0,K.jsx)(Z,{label:q(`helpDialog.toggleElementLock`),shortcuts:[k(`CtrlOrCmd+Shift+L`)]}),(0,K.jsx)(Z,{label:q(`buttons.undo`),shortcuts:[k(`CtrlOrCmd+Z`)]}),(0,K.jsx)(Z,{label:q(`buttons.redo`),shortcuts:ya?[k(`CtrlOrCmd+Y`),k(`CtrlOrCmd+Shift+Z`)]:[k(`CtrlOrCmd+Shift+Z`)]}),(0,K.jsx)(Z,{label:q(`labels.group`),shortcuts:[k(`CtrlOrCmd+G`)]}),(0,K.jsx)(Z,{label:q(`labels.ungroup`),shortcuts:[k(`CtrlOrCmd+Shift+G`)]}),(0,K.jsx)(Z,{label:q(`labels.flipHorizontal`),shortcuts:[k(`Shift+H`)]}),(0,K.jsx)(Z,{label:q(`labels.flipVertical`),shortcuts:[k(`Shift+V`)]}),(0,K.jsx)(Z,{label:q(`labels.showStroke`),shortcuts:[k(`S`)]}),(0,K.jsx)(Z,{label:q(`labels.showBackground`),shortcuts:[k(`G`)]}),(0,K.jsx)(Z,{label:q(`labels.showFonts`),shortcuts:[k(`Shift+F`)]}),(0,K.jsx)(Z,{label:q(`labels.decreaseFontSize`),shortcuts:[k(`CtrlOrCmd+Shift+<`)]}),(0,K.jsx)(Z,{label:q(`labels.increaseFontSize`),shortcuts:[k(`CtrlOrCmd+Shift+>`)]})]})]})]})}),gC=4,_C=8,vC=({shouldWrap:e,children:t,username:n})=>e?(0,K.jsx)(Pv,{label:n||`Unknown user`,children:t}):(0,K.jsx)(K.Fragment,{children:t}),yC=({actionManager:e,collaborator:t,socketId:n,withName:r=!1,shouldWrapWithTooltip:i=!1,isBeingFollowed:a})=>{let o={socketId:n,collaborator:t,withName:r,isBeingFollowed:a},s=e.renderAction(`goToCollaborator`,o);return(0,K.jsx)(vC,{username:t.username,shouldWrap:i,children:s},n)},bC=[`avatarUrl`,`id`,`socketId`,`username`,`isInCall`,`isSpeaking`,`isMuted`],xC=G.memo(({className:e,mobile:t,collaborators:n,userToFollow:r})=>{let i=TD(),a=new Map;n.forEach((e,t)=>{let n=e.id||t;a.set(n,{...e,socketId:t})});let o=Array.from(a.values()).filter(e=>e.username?.trim()),[s,c]=G.useState(``),l=o.filter(e=>e.username?.toLowerCase().includes(s)),u=G.useRef(null);(0,G.useLayoutEffect)(()=>{if(u.current){let e=e=>{f(Math.max(1,Math.min(8,Math.floor(e/38))))};if(e(u.current.clientWidth),!Us)return;let t=new ResizeObserver(t=>{for(let n of t){let{width:t}=n.contentRect;e(t)}});return t.observe(u.current),()=>{t.disconnect()}}},[]);let[d,f]=G.useState(gC),p=o.slice(0,d-1).map(e=>yC({actionManager:i,collaborator:e,socketId:e.socketId,shouldWrapWithTooltip:!0,isBeingFollowed:e.socketId===r}));return t?(0,K.jsx)(`div`,{className:L(`UserList UserList_mobile`,e),children:o.map(e=>yC({actionManager:i,collaborator:e,socketId:e.socketId,shouldWrapWithTooltip:!0,isBeingFollowed:e.socketId===r}))}):(0,K.jsx)(`div`,{className:`UserList__wrapper`,ref:u,children:(0,K.jsxs)(`div`,{className:L(`UserList`,e),style:{"--max-avatars":d},children:[p,o.length>d-1&&(0,K.jsxs)(vm,{children:[(0,K.jsxs)(ym,{className:`UserList__more`,children:[`+`,o.length-d+1]}),(0,K.jsx)(xm,{style:{zIndex:2,width:`15rem`,textAlign:`left`},align:`end`,sideOffset:10,children:(0,K.jsxs)(W_,{padding:2,children:[o.length>=_C&&(0,K.jsx)(nv,{placeholder:q(`quickSearch.placeholder`),onChange:c}),(0,K.jsx)(rv,{className:`dropdown-menu UserList__collaborators`,placeholder:q(`userList.empty`),children:l.length>0?[(0,K.jsx)(`div`,{className:`hint`,children:q(`userList.hint.text`)}),l.map(e=>yC({actionManager:i,collaborator:e,socketId:e.socketId,withName:!0,isBeingFollowed:e.socketId===r}))]:[]}),(0,K.jsx)(Sm,{width:20,height:10,style:{fill:`var(--popup-bg-color)`,filter:`drop-shadow(rgba(0, 0, 0, 0.05) 0px 3px 2px)`}})]})})]})]})})},(e,t)=>{if(e.collaborators.size!==t.collaborators.size||e.mobile!==t.mobile||e.className!==t.className||e.userToFollow!==t.userToFollow)return!1;let n=t.collaborators.keys();for(let[r,i]of e.collaborators){let e=t.collaborators.get(r);if(!e||r!==n.next().value||!ca(i,e,bC))return!1}return!0}),SC=({children:e,color:t})=>(0,K.jsx)(`div`,{className:`Card`,style:{"--card-color":t===`primary`?`var(--color-primary)`:qu[t][7],"--card-color-darker":t===`primary`?`var(--color-primary-darker)`:qu[t][8],"--card-color-darkest":t===`primary`?`var(--color-primary-darkest)`:qu[t][9]},children:e}),CC=({elements:e,appState:t,setAppState:n,files:r,actionManager:i,exportOpts:a,canvas:o,onCloseRequest:s})=>{let{onExportToBackend:c}=a;return(0,K.jsx)(`div`,{className:`ExportDialog ExportDialog--json`,children:(0,K.jsxs)(`div`,{className:`ExportDialog-cards`,children:[a.saveFileToDisk&&(0,K.jsxs)(SC,{color:`lime`,children:[(0,K.jsx)(`div`,{className:`Card-icon`,children:Ui}),(0,K.jsx)(`h2`,{children:q(`exportDialog.disk_title`)}),(0,K.jsxs)(`div`,{className:`Card-details`,children:[q(`exportDialog.disk_details`),!_s&&i.renderAction(`changeProjectName`)]}),(0,K.jsx)(J,{className:`Card-button`,type:`button`,title:q(`exportDialog.disk_button`),"aria-label":q(`exportDialog.disk_button`),showAriaLabel:!0,onClick:()=>{i.executeAction(ry,`ui`)}})]}),c&&(0,K.jsxs)(SC,{color:`pink`,children:[(0,K.jsx)(`div`,{className:`Card-icon`,children:dn}),(0,K.jsx)(`h2`,{children:q(`exportDialog.link_title`)}),(0,K.jsx)(`div`,{className:`Card-details`,children:q(`exportDialog.link_details`)}),(0,K.jsx)(J,{className:`Card-button`,type:`button`,title:q(`exportDialog.link_button`),"aria-label":q(`exportDialog.link_button`),showAriaLabel:!0,onClick:async()=>{try{Y(`export`,`link`,`ui (${It()})`),await c(e,t,r),s()}catch(e){n({errorMessage:e.message})}}})]}),a.renderCustomUI&&a.renderCustomUI(e,t,r,o)]})})},wC=({elements:e,appState:t,files:n,actionManager:r,exportOpts:i,canvas:a,setAppState:o})=>{let s=G.useCallback(()=>{o({openDialog:null})},[o]);return(0,K.jsx)(K.Fragment,{children:t.openDialog?.name===`jsonExport`&&(0,K.jsx)(Sx,{onCloseRequest:s,title:q(`buttons.export`),children:(0,K.jsx)(CC,{elements:e,appState:t,setAppState:o,files:n,actionManager:r,onCloseRequest:s,exportOpts:i,canvas:a})})})},TC=e=>(0,K.jsx)(`button`,{className:`help-icon`,onClick:e.onClick,type:`button`,title:`${q(`helpDialog.title`)} \u2014 ?`,"aria-label":q(`helpDialog.title`),children:Wt}),EC=({appState:e,actionManager:t,showExitZenModeBtn:n,renderWelcomeScreen:r})=>{let{FooterCenterTunnel:i,WelcomeScreenHelpHintTunnel:a}=Mx(),o=bD(),s=!e.viewModeEnabled&&e.multiElement&&o.isTouchScreen;return(0,K.jsxs)(`footer`,{role:`contentinfo`,className:`layer-ui__wrapper__footer App-menu App-menu_bottom`,children:[(0,K.jsx)(`div`,{className:L(`layer-ui__wrapper__footer-left zen-mode-transition`,{"layer-ui__wrapper__footer-left--transition-left":e.zenModeEnabled}),children:(0,K.jsx)(Ob.Col,{gap:2,children:(0,K.jsxs)(ZS,{heading:`canvasActions`,children:[(0,K.jsx)(zx,{renderAction:t.renderAction,zoom:e.zoom}),!e.viewModeEnabled&&(0,K.jsx)(Bx,{renderAction:t.renderAction,className:L(`zen-mode-transition`,{"layer-ui__wrapper__footer-left--transition-bottom":e.zenModeEnabled})}),s&&(0,K.jsx)(Hx,{renderAction:t.renderAction,className:L(`zen-mode-transition`,{"layer-ui__wrapper__footer-left--transition-left":e.zenModeEnabled})})]})})}),(0,K.jsx)(i.Out,{}),(0,K.jsx)(`div`,{className:L(`layer-ui__wrapper__footer-right zen-mode-transition`,{"transition-right":e.zenModeEnabled}),children:(0,K.jsxs)(`div`,{style:{position:`relative`},children:[r&&(0,K.jsx)(a.Out,{}),(0,K.jsx)(TC,{onClick:()=>t.executeAction(ly)})]})}),(0,K.jsx)(Vx,{actionManager:t,showExitZenModeBtn:n})]})},DC=EC;EC.displayName=`Footer`;var OC=G.createContext({}),kC=({children:e,className:t})=>{let n=bD(),r=(0,G.useContext)(OC),i=!!(n.editor.canFitSidebar&&r.shouldRenderDockButton);return(0,K.jsxs)(`div`,{className:L(`sidebar__header`,t),"data-testid":`sidebar-header`,children:[e,(0,K.jsxs)(`div`,{className:`sidebar__header__buttons`,children:[i&&(0,K.jsx)(Pv,{label:q(`labels.sidebarLock`),children:(0,K.jsx)(Cx,{onSelect:()=>r.onDock?.(!r.docked),selected:!!r.docked,className:`sidebar__dock`,"data-testid":`sidebar-dock`,"aria-label":q(`labels.sidebarLock`),children:td})}),(0,K.jsx)(Cx,{"data-testid":`sidebar-close`,className:`sidebar__close`,onSelect:r.onCloseRequest,"aria-label":q(`buttons.close`),children:Ll})]})]})};kC.displayName=`SidebarHeader`;var AC=({name:e,tab:t,icon:n,title:r,children:i,onToggle:a,className:o,style:s})=>{let c=wD();return(0,K.jsxs)(`label`,{title:r,className:`sidebar-trigger__label-element`,children:[(0,K.jsx)(`input`,{className:`ToolIcon_type_checkbox`,type:`checkbox`,onChange:n=>{document.querySelector(`.layer-ui__wrapper`)?.classList.remove(`animate`);let r=n.target.checked;c({openSidebar:r?{name:e,tab:t}:null}),a?.(r)},checked:L_().openSidebar?.name===e,"aria-label":r,"aria-keyshortcuts":`0`}),(0,K.jsxs)(`div`,{className:L(`sidebar-trigger`,o),style:s,children:[n&&(0,K.jsx)(`div`,{children:n}),i&&(0,K.jsx)(`div`,{className:`sidebar-trigger__label`,children:i})]})]})};AC.displayName=`SidebarTrigger`;var jC=({children:e,...t})=>(0,K.jsx)(Gh,{className:`sidebar-triggers`,...t,children:e});jC.displayName=`SidebarTabTriggers`;var MC=({children:e,tab:t,onSelect:n,...r})=>(0,K.jsx)(Kh,{value:t,asChild:!0,onSelect:n,children:(0,K.jsx)(`button`,{type:`button`,className:`excalidraw-button sidebar-tab-trigger`,...r,children:e})});MC.displayName=`SidebarTabTrigger`;var NC=({children:e,...t})=>{let n=L_(),r=wD();if(!n.openSidebar)return null;let{name:i}=n.openSidebar;return(0,K.jsx)(Wh,{className:`sidebar-tabs-root`,value:n.openSidebar.tab,onValueChange:e=>r(t=>({...t,openSidebar:{...t.openSidebar,name:i,tab:e}})),...t,children:e})};NC.displayName=`SidebarTabs`;var PC=({tab:e,children:t,...n})=>(0,K.jsx)(qh,{...n,value:e,"data-testid":e,children:t});PC.displayName=`SidebarTab`;var FC=Cd(!1),IC=(0,G.forwardRef)(({name:e,children:t,onDock:n,docked:r,className:i,...a},o)=>{pe.DEV&&n&&r==null&&console.warn("Sidebar: `docked` must be set when `onDock` is supplied for the sidebar to be user-dockable. To hide this message, either pass `docked` or remove `onDock`");let s=wD(),c=Sg(FC);(0,G.useLayoutEffect)(()=>(c(!!r),()=>{c(!1)}),[c,r]);let l=(0,G.useRef)({});l.current.onCloseRequest=()=>{s({openSidebar:null})},l.current.onDock=e=>n?.(e),l.current=Kc(l.current,{docked:r,shouldRenderDockButton:!!n&&r!=null});let u=(0,G.useRef)(null);(0,G.useImperativeHandle)(o,()=>u.current);let d=bD(),f=(0,G.useCallback)(()=>{document.querySelector(`.Dialog`)||s({openSidebar:null})},[s]);return z_(u,(0,G.useCallback)(e=>{e.target.closest(`.sidebar-trigger`)||(!r||!d.editor.canFitSidebar)&&f()},[f,r,d.editor.canFitSidebar])),(0,G.useEffect)(()=>{let e=e=>{e.key===D.ESCAPE&&(!r||!d.editor.canFitSidebar)&&f()};return document.addEventListener(`keydown`,e),()=>{document.removeEventListener(`keydown`,e)}},[f,r,d.editor.canFitSidebar]),(0,K.jsx)(W_,{...a,className:L(`sidebar`,{"sidebar--docked":r},i),ref:u,children:(0,K.jsx)(OC.Provider,{value:l.current,children:t})})});IC.displayName=`SidebarInner`;var LC=Object.assign((0,G.forwardRef)((e,t)=>{let n=L_(),{onStateChange:r}=e,i=(0,G.useRef)(n.openSidebar);(0,G.useEffect)(()=>{(!n.openSidebar&&i?.current?.name===e.name||n.openSidebar?.name===e.name&&i?.current?.name!==e.name||i.current?.name===e.name)&&n.openSidebar!==i.current&&r?.(n.openSidebar?.name===e.name?n.openSidebar:null),i.current=n.openSidebar},[n.openSidebar,r,e.name]);let[a,o]=(0,G.useState)(!1);return(0,G.useLayoutEffect)(()=>(o(!0),()=>o(!1)),[]),a&&n.openSidebar?.name===e.name?(0,G.createElement)(IC,{...e,ref:t,key:e.name}):null}),{Header:kC,TabTriggers:jC,TabTrigger:MC,Tabs:NC,Tab:PC,Trigger:AC});LC.displayName=`Sidebar`;var RC={};he(RC,{ChangeCanvasBackground:()=>ZC,ClearCanvas:()=>YC,CommandPalette:()=>KC,Export:()=>QC,Help:()=>JC,LiveCollaborationTrigger:()=>ew,LoadScene:()=>UC,SaveAsImage:()=>GC,SaveToActiveFile:()=>WC,SearchMenu:()=>qC,Socials:()=>$C,ToggleTheme:()=>XC});var zC=Cd({active:!1});async function BC({title:e,description:t,actionLabel:n,color:r}){return new Promise(i=>{Eg.set(zC,{active:!0,onConfirm:()=>i(!0),onClose:()=>i(!1),onReject:()=>i(!1),title:e,description:t,actionLabel:n,color:r})})}var VC=({value:e,shortcut:t,onChange:n,choices:r,children:i,name:a})=>{let o=bD();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`div`,{className:`dropdown-menu-item-base dropdown-menu-item-bare`,children:[(0,K.jsx)(`label`,{className:`dropdown-menu-item__text`,htmlFor:a,children:i}),(0,K.jsx)(SS,{name:a,value:e,onChange:n,choices:r})]}),t&&!o.editor.isMobile&&(0,K.jsx)(`div`,{className:`dropdown-menu-item__shortcut dropdown-menu-item__shortcut--orphaned`,children:t})]})};VC.displayName=`DropdownMenuItemContentRadio`;var HC=VC,UC=()=>{let{t:e}=Rg(),t=TD(),n=SD();return t.isActionEnabled(iy)?(0,K.jsx)(pv,{icon:wr,onSelect:async()=>{(!n.length||await BC({title:e(`overwriteConfirm.modal.loadFromFile.title`),actionLabel:e(`overwriteConfirm.modal.loadFromFile.button`),color:`warning`,description:(0,K.jsx)(Ib,{i18nKey:`overwriteConfirm.modal.loadFromFile.description`,bold:e=>(0,K.jsx)(`strong`,{children:e}),br:()=>(0,K.jsx)(`br`,{})})}))&&t.executeAction(iy)},"data-testid":`load-button`,shortcut:Ex(`loadScene`),"aria-label":e(`buttons.load`),children:e(`buttons.load`)}):null};UC.displayName=`LoadScene`;var WC=()=>{let{t:e}=Rg(),t=TD();return t.isActionEnabled(ny)?(0,K.jsx)(pv,{shortcut:Ex(`saveScene`),"data-testid":`save-button`,onSelect:()=>t.executeAction(ny),icon:Aa,"aria-label":`${e(`buttons.save`)}`,children:`${e(`buttons.save`)}`}):null};WC.displayName=`SaveToActiveFile`;var GC=()=>{let e=wD(),{t}=Rg();return(0,K.jsx)(pv,{icon:Je,"data-testid":`image-export-button`,onSelect:()=>e({openDialog:{name:`imageExport`}}),shortcut:Ex(`imageExport`),"aria-label":t(`buttons.exportImage`),children:t(`buttons.exportImage`)})};GC.displayName=`SaveAsImage`;var KC=e=>{let t=wD(),{t:n}=Rg();return(0,K.jsx)(pv,{icon:gt,"data-testid":`command-palette-button`,onSelect:()=>{Y(`command_palette`,`open`,`menu`),t({openDialog:{name:`commandPalette`}})},shortcut:Ex(`commandPalette`),"aria-label":n(`commandPalette.title`),className:e?.className,children:n(`commandPalette.title`)})};KC.displayName=`CommandPalette`;var qC=e=>{let{t}=Rg(),n=TD();return(0,K.jsx)(pv,{icon:wo,"data-testid":`search-menu-button`,onSelect:()=>{n.executeAction(iS)},shortcut:Ex(`searchMenu`),"aria-label":t(`search.title`),className:e?.className,children:t(`search.title`)})};qC.displayName=`SearchMenu`;var JC=()=>{let{t:e}=Rg(),t=TD();return(0,K.jsx)(pv,{"data-testid":`help-menu-item`,icon:Wt,onSelect:()=>t.executeAction(ly),shortcut:`?`,"aria-label":e(`helpDialog.title`),children:e(`helpDialog.title`)})};JC.displayName=`Help`;var YC=()=>{let{t:e}=Rg(),t=Sg(Wx);return TD().isActionEnabled(Fv)?(0,K.jsx)(pv,{icon:Bs,onSelect:()=>t(`clearCanvas`),"data-testid":`clear-canvas-button`,"aria-label":e(`buttons.clearReset`),children:e(`buttons.clearReset`)}):null};YC.displayName=`ClearCanvas`;var XC=e=>{let{t}=Rg(),n=L_(),r=TD(),i=Ex(`toggleTheme`);return r.isActionEnabled(Hv)?e?.allowSystemTheme?(0,K.jsx)(HC,{name:`theme`,value:e.theme,onChange:t=>e.onSelect(t),choices:[{value:R.LIGHT,label:cs,ariaLabel:`${t(`buttons.lightMode`)} - ${i}`},{value:R.DARK,label:Vl,ariaLabel:`${t(`buttons.darkMode`)} - ${i}`},{value:`system`,label:Ka,ariaLabel:t(`buttons.systemMode`)}],children:t(`labels.theme`)}):(0,K.jsx)(pv,{onSelect:t=>{if(t.preventDefault(),e?.onSelect)e.onSelect(n.theme===R.DARK?R.LIGHT:R.DARK);else return r.executeAction(Hv)},icon:n.theme===R.DARK?cs:Vl,"data-testid":`toggle-dark-mode`,shortcut:i,"aria-label":n.theme===R.DARK?t(`buttons.lightMode`):t(`buttons.darkMode`),children:n.theme===R.DARK?t(`buttons.lightMode`):t(`buttons.darkMode`)}):null};XC.displayName=`ToggleTheme`;var ZC=()=>{let{t:e}=Rg(),t=L_(),n=TD(),r=yD();return t.viewModeEnabled||!r.UIOptions.canvasActions.changeViewBackgroundColor?null:(0,K.jsxs)(`div`,{style:{marginTop:`0.5rem`},children:[(0,K.jsx)(`div`,{"data-testid":`canvas-background-label`,style:{fontSize:`.75rem`,marginBottom:`.5rem`},children:e(`labels.canvasBackground`)}),(0,K.jsx)(`div`,{style:{padding:`0 0.625rem`},children:n.renderAction(`changeViewBackgroundColor`)})]})};ZC.displayName=`ChangeCanvasBackground`;var QC=()=>{let{t:e}=Rg(),t=wD();return(0,K.jsx)(pv,{icon:ac,onSelect:()=>{t({openDialog:{name:`jsonExport`}})},"data-testid":`json-export-button`,"aria-label":e(`buttons.export`),children:e(`buttons.export`)})};QC.displayName=`Export`;var $C=()=>{let{t:e}=Rg();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(Xb,{icon:nd,href:`https://github.com/excalidraw/excalidraw`,"aria-label":`GitHub`,children:`GitHub`}),(0,K.jsx)(Xb,{icon:pn,href:`https://x.com/excalidraw`,"aria-label":`X`,children:e(`labels.followUs`)}),(0,K.jsx)(Xb,{icon:Ms,href:`https://discord.gg/UexuTaE`,"aria-label":`Discord`,children:e(`labels.discordChat`)})]})};$C.displayName=`Socials`;var ew=({onSelect:e,isCollaborating:t})=>{let{t:n}=Rg();return(0,K.jsx)(pv,{"data-testid":`collab-button`,icon:Ni,className:L({"active-collab":t}),onSelect:e,children:n(`labels.liveCollaboration`)})};ew.displayName=`LiveCollaborationTrigger`;var tw=(e,t)=>{let n=Cd(0),r=e=>{let{tunnelsJotai:{useAtom:r}}=Mx(),[,i]=r(n),a=(0,G.useRef)({preferHost:!1,counter:0});return(0,G.useLayoutEffect)(()=>{let e=a.current;return i(t=>{let n=t+1;return e.counter=n,n}),()=>{i(t=>{let n=t-1;return e.counter=n,n||(e.preferHost=!1),n})}},[i]),e.__fallback||(a.current.preferHost=!0),!a.current.counter&&e.__fallback&&a.current.preferHost||a.current.counter>1&&e.__fallback?null:(0,K.jsx)(t,{...e})};return r.displayName=e,r},nw=Object.assign(tw(`MainMenu`,({children:e,onSelect:t})=>{let{MainMenuTunnel:n}=Mx(),r=bD(),i=L_(),a=wD(),o=r.editor.isMobile?void 0:()=>a({openMenu:null});return(0,K.jsx)(n.In,{children:(0,K.jsxs)(X,{open:i.openMenu===`canvas`,children:[(0,K.jsx)(X.Trigger,{onToggle:()=>{a({openMenu:i.openMenu===`canvas`?null:`canvas`})},"data-testid":`main-menu-trigger`,className:`main-menu-trigger`,children:ic}),(0,K.jsxs)(X.Content,{onClickOutside:o,onSelect:st(t,()=>{a({openMenu:null})}),children:[e,r.editor.isMobile&&i.collaborators.size>0&&(0,K.jsxs)(`fieldset`,{className:`UserList-Wrapper`,children:[(0,K.jsx)(`legend`,{children:q(`labels.collaborators`)}),(0,K.jsx)(xC,{mobile:!0,collaborators:i.collaborators,userToFollow:i.userToFollow?.socketId||null})]})]})]})})}),{Trigger:X.Trigger,Item:X.Item,ItemLink:X.ItemLink,ItemCustom:X.ItemCustom,Group:X.Group,Separator:X.Separator,DefaultItems:RC}),rw=({title:e,children:t,actionLabel:n,onClick:r})=>(0,K.jsxs)(`div`,{className:`OverwriteConfirm__Actions__Action`,children:[(0,K.jsx)(`h4`,{children:e}),(0,K.jsx)(`div`,{className:`OverwriteConfirm__Actions__Action__content`,children:t}),(0,K.jsx)(wS,{variant:`outlined`,color:`muted`,label:n,size:`large`,fullWidth:!0,onClick:r})]}),iw=Object.assign(({children:e})=>(0,K.jsx)(`div`,{className:`OverwriteConfirm__Actions`,children:e}),{ExportToImage:()=>{let{t:e}=Rg(),t=TD(),n=wD();return(0,K.jsx)(rw,{title:e(`overwriteConfirm.action.exportToImage.title`),actionLabel:e(`overwriteConfirm.action.exportToImage.button`),onClick:()=>{t.executeAction(ty,`ui`,!0),n({openDialog:{name:`imageExport`}})},children:e(`overwriteConfirm.action.exportToImage.description`)})},SaveToDisk:()=>{let{t:e}=Rg(),t=TD();return(0,K.jsx)(rw,{title:e(`overwriteConfirm.action.saveToDisk.title`),actionLabel:e(`overwriteConfirm.action.saveToDisk.button`),onClick:()=>{t.executeAction(ry,`ui`)},children:e(`overwriteConfirm.action.saveToDisk.description`)})}}),aw=Object.assign(tw(`OverwriteConfirmDialog`,({children:e})=>{let{OverwriteConfirmDialogTunnel:t}=Mx(),[n,r]=xg(zC);return n.active?(0,K.jsx)(t.In,{children:(0,K.jsx)(Sx,{onCloseRequest:()=>{n.onClose(),r(e=>({...e,active:!1}))},title:!1,size:916,children:(0,K.jsxs)(`div`,{className:`OverwriteConfirm`,children:[(0,K.jsx)(`h3`,{children:n.title}),(0,K.jsxs)(`div`,{className:`OverwriteConfirm__Description OverwriteConfirm__Description--color-${n.color}`,children:[(0,K.jsx)(`div`,{className:`OverwriteConfirm__Description__icon`,children:qs}),(0,K.jsx)(`div`,{children:n.description}),(0,K.jsx)(`div`,{className:`OverwriteConfirm__Description__spacer`}),(0,K.jsx)(wS,{color:n.color,size:`large`,label:n.actionLabel,onClick:()=>{n.onConfirm(),r(e=>({...e,active:!1}))}})]}),(0,K.jsx)(iw,{children:e})]})})}):null}),{Actions:iw,Action:rw}),ow=Cd(``),sw=Cd(null),cw=350,lw=()=>{let e=vD(),t=wD(),n=(0,G.useRef)(null),[r,i]=xg(ow),a=r.trim(),[o,s]=(0,G.useState)(!1),[c,l]=(0,G.useState)({nonce:null,items:[]}),u=(0,G.useRef)(null),d=(0,G.useRef)(void 0),[f,p]=xg(sw);(0,G.useEffect)(()=>{o||(a!==u.current||e.scene.getSceneNonce()!==d.current)&&(u.current=null,gw(a,e,(n,r)=>{l({nonce:ve(),items:n}),u.current=a,d.current=e.scene.getSceneNonce(),t({searchMatches:n.map(e=>({id:e.textElement.id,focus:!1,matchedLines:e.matchedLines}))})}))},[o,a,e.scene.getNonDeletedElementsMap(),e,t,p,d]);let m=()=>{c.items.length>0&&p(e=>e===null?0:(e+1)%c.items.length)},h=()=>{c.items.length>0&&p(e=>e===null?0:e-1<0?c.items.length-1:e-1)};(0,G.useEffect)(()=>{t(e=>({searchMatches:e.searchMatches.map((e,t)=>t===f?{...e,focus:!0}:{...e,focus:!1})}))},[f,t]),(0,G.useEffect)(()=>{if(c.items.length>0&&f!==null){let t=c.items[f];if(t){let n=e.state.zoom.value,r=yt({text:t.searchQuery,x:t.textElement.x+(t.matchedLines[0]?.offsetX??0),y:t.textElement.y+(t.matchedLines[0]?.offsetY??0),width:t.matchedLines[0]?.width,height:t.matchedLines[0]?.height,fontSize:t.textElement.fontSize,fontFamily:t.textElement.fontFamily}),i=t.textElement.fontSize,a=i*n<14;if(!la([r],e.canvas.width/window.devicePixelRatio,e.canvas.height/window.devicePixelRatio,{offsetLeft:e.state.offsetLeft,offsetTop:e.state.offsetTop,scrollX:e.state.scrollX,scrollY:e.state.scrollY,zoom:e.state.zoom},e.scene.getNonDeletedElementsMap(),e.getEditorUIOffsets())||a){let t;t=a?i>=14?{fitToContent:!0}:{fitToViewport:!0,maxZoom:gr(14/i,1)}:{fitToContent:!0},e.scrollToContent(r,{animate:!0,duration:300,...t,canvasOffsets:e.getEditorUIOffsets()})}}}},[f,c,e]),(0,G.useEffect)(()=>()=>{p(null),u.current=null,d.current=void 0,t({searchMatches:[]}),s(!1)},[t,p]);let g=B_({goToNextItem:m,goToPreviousItem:h,searchMatches:c});(0,G.useEffect)(()=>tl(window,`keydown`,r=>{if(r.key===D.ESCAPE&&!e.state.openDialog&&!e.state.openPopup){r.preventDefault(),r.stopPropagation(),t({openSidebar:null});return}r[D.CTRL_OR_CMD]&&r.key===D.F&&(r.preventDefault(),r.stopPropagation(),n.current?.matches(`:focus`)?t({openSidebar:null}):(e.state.openDialog&&t({openDialog:null}),n.current?.focus(),n.current?.select())),r.target instanceof HTMLElement&&r.target.closest(`.layer-ui__search`)&&g.searchMatches.items.length&&(r.key===D.ENTER&&(r.stopPropagation(),g.goToNextItem()),r.key===D.ARROW_UP?(r.stopPropagation(),g.goToPreviousItem()):r.key===D.ARROW_DOWN&&(r.stopPropagation(),g.goToNextItem()))},{capture:!0,passive:!1}),[t,g,e]);let _=`${c.items.length} ${c.items.length===1?q(`search.singleResult`):q(`search.multipleResults`)}`;return(0,K.jsxs)(`div`,{className:`layer-ui__search`,children:[(0,K.jsx)(`div`,{className:`layer-ui__search-header`,children:(0,K.jsx)(wx,{className:bi.SEARCH_MENU_INPUT_WRAPPER,value:r,ref:n,placeholder:q(`search.placeholder`),icon:wo,onChange:n=>{i(n),s(!0);let r=n.trim();gw(r,e,(n,i)=>{l({nonce:ve(),items:n}),p(i),u.current=r,d.current=e.scene.getSceneNonce(),t({searchMatches:n.map(e=>({id:e.textElement.id,focus:!1,matchedLines:e.matchedLines}))}),s(!1)})},selectOnRender:!0})}),(0,K.jsxs)(`div`,{className:`layer-ui__search-count`,children:[c.items.length>0&&(0,K.jsxs)(K.Fragment,{children:[f!==null&&f>-1?(0,K.jsxs)(`div`,{children:[f+1,` / `,_]}):(0,K.jsx)(`div`,{children:_}),(0,K.jsxs)(`div`,{className:`result-nav`,children:[(0,K.jsx)(Cx,{onSelect:()=>{m()},className:`result-nav-btn`,children:Yi}),(0,K.jsx)(Cx,{onSelect:()=>{h()},className:`result-nav-btn`,children:Xr})]})]}),c.items.length===0&&a&&u.current&&(0,K.jsx)(`div`,{style:{margin:`1rem auto`},children:q(`search.noMatch`)})]}),(0,K.jsx)(dw,{matches:c,onItemClick:p,focusIndex:f,searchQuery:a})]})},uw=e=>{let t=[e.preview.moreBefore?`...`:``,e.preview.previewText.slice(0,e.preview.indexInSearchQuery),e.preview.previewText.slice(e.preview.indexInSearchQuery,e.preview.indexInSearchQuery+e.searchQuery.length),e.preview.previewText.slice(e.preview.indexInSearchQuery+e.searchQuery.length),e.preview.moreAfter?`...`:``];return(0,K.jsx)(`div`,{tabIndex:-1,className:L(`layer-ui__result-item`,{active:e.highlighted}),onClick:e.onClick,ref:t=>{e.highlighted&&t?.scrollIntoView({behavior:`auto`,block:`nearest`})},children:(0,K.jsx)(`div`,{className:`preview-text`,children:t.flatMap((e,t)=>(0,K.jsx)(G.Fragment,{children:t===2?(0,K.jsx)(`b`,{children:e}):e},t))})})},dw=(0,G.memo)(e=>(0,K.jsx)(`div`,{className:`layer-ui__search-result-container`,children:e.matches.items.map((t,n)=>(0,K.jsx)(uw,{searchQuery:e.searchQuery,preview:t.preview,highlighted:n===e.focusIndex,onClick:()=>e.onItemClick(n)},t.textElement.id+t.index))}),(e,t)=>e.matches.nonce===t.matches.nonce&&e.focusIndex===t.focusIndex),fw=(e,t,n)=>{let r=e.slice(0,t),i=r.split(/\s+/),a=r.endsWith(` `),o=i.length-2-1-(a?0:1),s=i.slice(o<=0?0:o).join(` `)+(a?` `:``);s=s.length>20?s.slice(-20):s;let c=e.slice(t+n.length),l=c.split(/\s+/),u=!c.startsWith(` `),d=u?6:5,f=(u?``:` `)+l.slice(0,d).join(` `);return{indexInSearchQuery:s.length,previewText:s+n+f,moreBefore:o>0,moreAfter:l.length>d}},pw=(e,t)=>{let n=e.split(`
`),r=[],i=0;for(let e=0;e<n.length;e++){let a=n[e],o=n[e+1];if(o){let e=t.indexOf(o,i);if(e>a.length+i){let t=e-(a.length+i);for(;t>0;)a+=` `,t--}}r.push(a),i+=a.length}return r.join(`
`)},mw=(e,t,n)=>{let r=pw(e.text,e.originalText).split(`
`),i=[],a=0,o=0;for(let e of r){let t=a,n=t+e.length-1;i.push({line:e,startIndex:t,endIndex:n,lineNumber:o}),a=n+1,o++}let s=n,c=e.originalText.slice(n,n+t.length),l=[];for(let t of i){if(c===``)break;if(s>=t.startIndex&&s<=t.endIndex){let n=t.endIndex+1-s,r=t.line.slice(0,s-t.startIndex),i=c.slice(0,n);c=c.slice(n);let a=Nn(r,Cs(e),e.lineHeight);if(r===``&&(a.width=0),e.textAlign!==`left`&&t.line.length>0){let n=Nn(t.line,Cs(e),e.lineHeight),r=e.textAlign===`center`?(e.width-n.width)/2:e.width-n.width;a.width+=r}let{width:o,height:u}=Nn(i,Cs(e),e.lineHeight),d=a.width,f=t.lineNumber*a.height;l.push({offsetX:d,offsetY:f,width:o,height:u}),s+=n}}return l},hw=e=>e.replace(/[.*+?^${}()|[\]\\-]/g,`\\$&`),gw=(0,Jh.default)((e,t,n)=>{if(!e||e===``){n([],null);return}let r=t.scene.getNonDeletedElements().filter(e=>H(e));r.sort((e,t)=>e.y-t.y);let i=[],a=new RegExp(hw(e),`gi`);for(let t of r){let n=null,r=t.originalText;for(;(n=a.exec(r))!==null;){let a=fw(r,n.index,e),o=mw(t,e,n.index);o.length>0&&i.push({textElement:t,searchQuery:e,preview:a,index:n.index,matchedLines:o})}}let o=new Set(t.visibleElements.map(e=>e.id));n(i,i.findIndex(e=>o.has(e.textElement.id))??null)},cw),_w=tw(`DefaultSidebarTrigger`,e=>{let{DefaultSidebarTriggerTunnel:t}=Mx();return(0,K.jsx)(t.In,{children:(0,K.jsx)(LC.Trigger,{...e,className:`default-sidebar-trigger`,name:Fu.name})})});_w.displayName=`DefaultSidebarTrigger`;var vw=({children:e})=>{let{DefaultSidebarTabTriggersTunnel:t}=Mx();return(0,K.jsx)(t.In,{children:e})};vw.displayName=`DefaultTabTriggers`;var yw=Object.assign(tw(`DefaultSidebar`,({children:e,className:t,onDock:n,docked:r,...i})=>{let a=L_(),o=wD(),{DefaultSidebarTabTriggersTunnel:s}=Mx(),c=a.openSidebar?.tab===Kt;return(0,G.createElement)(LC,{...i,name:`default`,key:`default`,className:L(`default-sidebar`,t),docked:c||(r??a.defaultSidebarDockedPreference),onDock:c||n===!1||!n&&r!=null?void 0:st(n,e=>{o({defaultSidebarDockedPreference:e})})},(0,K.jsxs)(LC.Tabs,{children:[(0,K.jsx)(LC.Header,{children:(0,K.jsxs)(LC.TabTriggers,{children:[(0,K.jsx)(LC.TabTrigger,{tab:Kt,children:wo}),(0,K.jsx)(LC.TabTrigger,{tab:za,children:Li}),(0,K.jsx)(s.Out,{})]})}),(0,K.jsx)(LC.Tab,{tab:za,children:(0,K.jsx)(bx,{})}),(0,K.jsx)(LC.Tab,{tab:Kt,children:(0,K.jsx)(lw,{})}),e]}))}),{Trigger:_w,TabTriggers:vw}),bw=`small`,xw=e=>(0,K.jsxs)(`label`,{className:L(`ToolIcon ToolIcon__LaserPointer`,`ToolIcon_size_${bw}`,{"is-mobile":e.isMobile}),title:`${e.title}`,children:[(0,K.jsx)(`input`,{className:`ToolIcon_type_checkbox`,type:`checkbox`,name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title,"data-testid":`toolbar-LaserPointer`}),(0,K.jsx)(`div`,{className:`ToolIcon__icon`,children:Wc})]}),Sw=({canvasRef:e,setError:t})=>{let n=e.current;if(!n)return;let r=n.parentElement;r&&(r.style.background=``,t(null),n.replaceChildren())},Cw=async({canvasRef:e,mermaidToExcalidrawLib:t,mermaidDefinition:n,setError:r,data:i})=>{let a=e.current,o=a?.parentElement;if(!(!a||!o)){if(!n){Sw({canvasRef:e,setError:r});return}try{let e=await t.api,s;try{s=await e.parseMermaidToExcalidraw(n)}catch{s=await e.parseMermaidToExcalidraw(n.replace(/"/g,`'`))}let{elements:c,files:l}=s;r(null),i.current={elements:iE(c,{regenerateIds:!0}),files:l};let u=await fl({elements:i.current.elements,files:i.current.files,exportPadding:10,maxWidthOrHeight:Math.max(o.offsetWidth,o.offsetHeight)*window.devicePixelRatio});try{await Mu(u)}catch(e){throw e.name===`CANVAS_POSSIBLY_TOO_BIG`?Error(q(`canvasError.canvasTooBig`)):e}o.style.background=`var(--default-bg-color)`,a.replaceChildren(u)}catch(e){throw o.style.background=`var(--default-bg-color)`,n&&r(e),e}}},ww=e=>{zb.set(at.MERMAID_TO_EXCALIDRAW,e)},Tw=({app:e,data:t,text:n,shouldSaveMermaidDataToStorage:r})=>{let{elements:i,files:a}=t.current;i.length&&(e.addElementsFromPasteOrLibrary({elements:i,files:a,position:`center`,fitToContent:!0}),e.setOpenDialog(null),r&&n&&ww(n))},Ew=({children:e})=>(0,K.jsx)(`div`,{className:`ttd-dialog-panels`,children:e}),Dw=({label:e,children:t,panelAction:n,panelActionDisabled:r=!1,onTextSubmitInProgess:i,renderTopRight:a,renderSubmitShortcut:o,renderBottomRight:s})=>(0,K.jsxs)(`div`,{className:`ttd-dialog-panel`,children:[(0,K.jsxs)(`div`,{className:`ttd-dialog-panel__header`,children:[(0,K.jsx)(`label`,{children:e}),a?.()]}),t,(0,K.jsxs)(`div`,{className:L(`ttd-dialog-panel-button-container`,{invisible:!n}),style:{display:`flex`,alignItems:`center`},children:[(0,K.jsxs)(Cx,{className:`ttd-dialog-panel-button`,onSelect:n?n.action:()=>{},disabled:r||i,children:[(0,K.jsxs)(`div`,{className:L({invisible:i}),children:[n?.label,n?.icon&&(0,K.jsx)(`span`,{children:n.icon})]}),i&&(0,K.jsx)(zg,{})]}),!r&&!i&&o?.(),s?.()]})]}),Ow=({input:e,placeholder:t,onChange:n,onKeyboardSubmit:r})=>{let i=(0,G.useRef)(null),a=(0,G.useRef)(r);return a.current=r,(0,G.useEffect)(()=>{if(!a.current)return;let e=i.current;if(e){let t=e=>{e[D.CTRL_OR_CMD]&&e.key===D.ENTER&&(e.preventDefault(),a.current?.())};return e.addEventListener(`keydown`,t),()=>{e.removeEventListener(`keydown`,t)}}},[]),(0,K.jsx)(`textarea`,{className:`ttd-dialog-input`,onChange:n,value:e,placeholder:t,autoFocus:!0,ref:i})},kw=({error:e})=>(0,K.jsxs)(`div`,{"data-testid":`ttd-dialog-output-error`,className:`ttd-dialog-output-error`,children:[`Error! `,(0,K.jsx)(`p`,{children:e})]}),Aw=({error:e,canvasRef:t,loaded:n})=>(0,K.jsxs)(`div`,{className:`ttd-dialog-output-wrapper`,children:[e&&(0,K.jsx)(kw,{error:e.message}),n?(0,K.jsx)(`div`,{ref:t,style:{opacity:e?`0.15`:1},className:`ttd-dialog-output-canvas-container`}):(0,K.jsx)(zg,{size:`2rem`})]}),jw=()=>(0,K.jsxs)(`div`,{className:`ttd-dialog-submit-shortcut`,children:[(0,K.jsx)(`div`,{className:`ttd-dialog-submit-shortcut__key`,children:k(`CtrlOrCmd`)}),(0,K.jsx)(`div`,{className:`ttd-dialog-submit-shortcut__key`,children:k(`Enter`)})]}),Mw=`flowchart TD
 A[Christmas] -->|Get money| B(Go shopping)
 B --> C{Let me think}
 C -->|One| D[Laptop]
 C -->|Two| E[iPhone]
 C -->|Three| F[Car]`,Nw=jl(ww,300),Pw=({mermaidToExcalidrawLib:e})=>{let[t,n]=(0,G.useState)(()=>zb.get(at.MERMAID_TO_EXCALIDRAW)||Mw),r=(0,G.useDeferredValue)(t.trim()),[i,a]=(0,G.useState)(null),o=(0,G.useRef)(null),s=(0,G.useRef)({elements:[],files:null}),c=vD();(0,G.useEffect)(()=>{Cw({canvasRef:o,data:s,mermaidToExcalidrawLib:e,setError:a,mermaidDefinition:r}).catch(e=>{Hi()&&console.error(`Failed to parse mermaid definition`,e)}),Nw(r)},[r,e]),(0,G.useEffect)(()=>()=>{Nw.flush()},[]);let l=()=>{Tw({app:c,data:s,text:t,shouldSaveMermaidDataToStorage:!0})};return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`div`,{className:`ttd-dialog-desc`,children:(0,K.jsx)(Ib,{i18nKey:`mermaid.description`,flowchartLink:e=>(0,K.jsx)(`a`,{href:`https://mermaid.js.org/syntax/flowchart.html`,children:e}),sequenceLink:e=>(0,K.jsx)(`a`,{href:`https://mermaid.js.org/syntax/sequenceDiagram.html`,children:e}),classLink:e=>(0,K.jsx)(`a`,{href:`https://mermaid.js.org/syntax/classDiagram.html`,children:e})})}),(0,K.jsxs)(Ew,{children:[(0,K.jsx)(Dw,{label:q(`mermaid.syntax`),children:(0,K.jsx)(Ow,{input:t,placeholder:`Write Mermaid diagram defintion here...`,onChange:e=>n(e.target.value),onKeyboardSubmit:()=>{l()}})}),(0,K.jsx)(Dw,{label:q(`mermaid.preview`),panelAction:{action:()=>{l()},label:q(`mermaid.button`),icon:fa},renderSubmitShortcut:()=>(0,K.jsx)(jw,{}),children:(0,K.jsx)(Aw,{canvasRef:o,loaded:e.loaded,error:i})})]})]})},Fw=e=>{let t=wD(),n=(0,G.useRef)(null),r=(0,G.useRef)(0);return(0,K.jsx)(Wh,{ref:n,className:`ttd-dialog-tabs-root`,value:e.tab,onValueChange:i=>{if(!i)return;let a=n.current?.closest(`.Modal__content`);if(a){let e=a.offsetHeight||0;e>r.current&&(r.current=e,a.style.minHeight=`min(${r.current}px, 100%)`)}e.dialog===`ttd`&&Dc([`text-to-diagram`,`mermaid`],i)&&t({openDialog:{name:e.dialog,tab:i}})},children:e.children})};Fw.displayName=`TTDDialogTabs`;var Iw=Fw,Lw=({children:e,...t})=>(0,K.jsx)(Gh,{className:`ttd-dialog-triggers`,...t,children:e});Lw.displayName=`TTDDialogTabTriggers`;var Rw=({children:e,tab:t,onSelect:n,...r})=>(0,K.jsx)(Kh,{value:t,asChild:!0,onSelect:n,children:(0,K.jsx)(`button`,{type:`button`,className:`ttd-dialog-tab-trigger`,...r,children:e})});Rw.displayName=`TTDDialogTabTrigger`;var zw=({tab:e,children:t,...n})=>(0,K.jsx)(qh,{...n,value:e,children:t});zw.displayName=`TTDDialogTab`;var Bw=3,Vw=1e3,Hw=Cd(null),Uw=Cd(null),Ww=e=>{let t=L_();return t.openDialog?.name===`ttd`?(0,K.jsx)(Gw,{...e,tab:t.openDialog.tab}):null},Gw=tw(`TTDDialogBase`,({tab:e,...t})=>{let n=vD(),r=wD(),i=(0,G.useRef)(null),[a,o]=xg(Uw),[s,l]=(0,G.useState)(a?.prompt??``),u=s.trim(),d=e=>{l(e.target.value),o(t=>({generatedResponse:t?.generatedResponse??null,prompt:e.target.value}))},[f,p]=(0,G.useState)(!1),[m,h]=xg(Hw),g=async()=>{if(u.length>Vw||u.length<Bw||f||m?.rateLimitRemaining===0||`__fallback`in t){u.length<Bw&&S(Error(`Prompt is too short (min ${Bw} characters)`)),u.length>Vw&&S(Error(`Prompt is too long (max ${Vw} characters)`));return}try{p(!0),Y(`ai`,`generate`,`ttd`);let{generatedResponse:e,error:n,rateLimit:r,rateLimitRemaining:a}=await t.onTextSubmit(u);if(typeof e==`string`&&o(t=>({generatedResponse:e,prompt:t?.prompt??null})),zl(r)&&zl(a)&&h({rateLimit:r,rateLimitRemaining:a}),n){S(n);return}if(!e){S(Error(`Generation failed`));return}try{await Cw({canvasRef:i,data:b,mermaidToExcalidrawLib:v,setError:S,mermaidDefinition:e}),Y(`ai`,`mermaid parse success`,`ttd`)}catch(e){console.info(`%cTTD mermaid render errror: ${e.message}`,`color: red`),console.info(`>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
TTD mermaid definition render errror: ${e.message}`,`color: yellow`),Y(`ai`,`mermaid parse failed`,`ttd`),S(Error(`Generated an invalid diagram :(. You may also try a different prompt.`))}}catch(e){let t=e.message;(!t||t===`Failed to fetch`)&&(t=`Request failed`),S(Error(t))}finally{p(!1)}},_=(0,G.useRef)(g);_.current=g;let[v,y]=(0,G.useState)({loaded:!1,api:c(()=>import(`./dist-0fyaNKyr.js`),__vite__mapDeps([67,60,2,61,62,63,68,69,70,71,72,73,66,74,75]))});(0,G.useEffect)(()=>{(async()=>{await v.api,y(e=>({...e,loaded:!0}))})()},[v.api]);let b=(0,G.useRef)({elements:[],files:null}),[x,S]=(0,G.useState)(null);return(0,K.jsx)(Sx,{className:`ttd-dialog`,onCloseRequest:()=>{n.setOpenDialog(null)},size:1200,title:!1,...t,autofocus:!1,children:(0,K.jsxs)(Iw,{dialog:`ttd`,tab:e,children:[`__fallback`in t&&t.__fallback?(0,K.jsx)(`p`,{className:`dialog-mermaid-title`,children:q(`mermaid.title`)}):(0,K.jsxs)(Lw,{children:[(0,K.jsx)(Rw,{tab:`text-to-diagram`,children:(0,K.jsxs)(`div`,{style:{display:`flex`,alignItems:`center`},children:[q(`labels.textToDiagram`),(0,K.jsx)(`div`,{style:{display:`flex`,alignItems:`center`,justifyContent:`center`,padding:`1px 6px`,marginLeft:`10px`,fontSize:10,borderRadius:`12px`,background:`var(--color-promo)`,color:`var(--color-surface-lowest)`},children:`AI Beta`})]})}),(0,K.jsx)(Rw,{tab:`mermaid`,children:`Mermaid`})]}),(0,K.jsx)(zw,{className:`ttd-dialog-content`,tab:`mermaid`,children:(0,K.jsx)(Pw,{mermaidToExcalidrawLib:v})}),!(`__fallback`in t)&&(0,K.jsxs)(zw,{className:`ttd-dialog-content`,tab:`text-to-diagram`,children:[(0,K.jsx)(`div`,{className:`ttd-dialog-desc`,children:`Currently we use Mermaid as a middle step, so you'll get best results if you describe a diagram, workflow, flow chart, and similar.`}),(0,K.jsxs)(Ew,{children:[(0,K.jsx)(Dw,{label:q(`labels.prompt`),panelAction:{action:g,label:`Generate`,icon:fa},onTextSubmitInProgess:f,panelActionDisabled:u.length>Vw||m?.rateLimitRemaining===0,renderTopRight:()=>m?(0,K.jsxs)(`div`,{className:`ttd-dialog-rate-limit`,style:{fontSize:12,marginLeft:`auto`,color:m.rateLimitRemaining===0?`var(--color-danger)`:void 0},children:[m.rateLimitRemaining,` requests left today`]}):null,renderSubmitShortcut:()=>(0,K.jsx)(jw,{}),renderBottomRight:()=>{if(typeof a?.generatedResponse==`string`)return(0,K.jsxs)(`div`,{className:`excalidraw-link`,style:{marginLeft:`auto`,fontSize:14},onClick:()=>{typeof a?.generatedResponse==`string`&&(ww(a.generatedResponse),r({openDialog:{name:`ttd`,tab:`mermaid`}}))},children:[`View as Mermaid`,(0,K.jsx)(Z_,{icon:fa})]});let e=u.length/Vw;return e>.8?(0,K.jsxs)(`div`,{style:{marginLeft:`auto`,fontSize:12,fontFamily:`monospace`,color:e>1?`var(--color-danger)`:void 0},children:[`Length: `,u.length,`/`,Vw]}):null},children:(0,K.jsx)(Ow,{onChange:d,input:s,placeholder:`Describe what you want to see...`,onKeyboardSubmit:()=>{_.current()}})}),(0,K.jsx)(Dw,{label:`Preview`,panelAction:{action:()=>{console.info(`Panel action clicked`),Tw({app:n,data:b})},label:`Insert`,icon:fa},children:(0,K.jsx)(Aw,{canvasRef:i,error:x,loaded:v.loaded})})]})]})]})})}),Kw=.01,qw=(e,t)=>!(t===`height`&&H(e)||t===`width`&&H(e)||t===`angle`&&M(e)),Jw=(e,t)=>{let n=e+t/2;return n-n%t},Yw=(e,t,n)=>Object.keys(e).map(e=>({original:(n??t).get(e),latest:t.get(e)})).filter(e=>e.original!==void 0&&e.latest!==void 0),Xw=(e,t,n,r,i,a,o,s=!0)=>{let c=r.get(n.id);if(!c)return;let[l,u]=[n.x+n.width/2,n.y+n.height/2],[d,f]=Ia(I(n.x,n.y),I(l,u),n.angle),p=e-d,m=t-f,[h,g]=Ia(I(e,t),I(l+p,u+m),-n.angle);W(c,{x:h,y:g},s),Qw(c,r,i,a);let _=w(n,o);if(_){let e=r.get(_.id);e&&W(e,{x:_.x+p,y:_.y+m},s)}},Zw=(e,t)=>{let n=ki(t).map(t=>jo(e,t).reduce((e,t)=>(e[t.id]=!0,e),{}));return e.filter(e=>!So(e)).forEach(e=>{n.push({[e.id]:!0})}),n},Qw=(e,t,n,r,i)=>{fc(e)?Js([e],t,n,r,!0,[],i?.zoom):ao(e,t,i)},$w=({label:e,icon:t,dragInputCallback:n,value:r,elements:i,editable:a=!0,shouldKeepAspectRatio:o,property:s,scene:c,appState:l,sensitivity:u=1})=>{let d=vD(),f=(0,G.useRef)(null),p=(0,G.useRef)(null),[m,h]=(0,G.useState)(r.toString()),g=(0,G.useRef)(null);g.current||={originalAppState:jn(l),originalElements:i,lastUpdatedValue:m,updatePending:!1},(0,G.useEffect)(()=>{let e=r.toString();h(e),g.current.lastUpdatedValue=e},[r]);let _=(e,t,i)=>{if(!g.current.updatePending)return!1;g.current.updatePending=!1;let a=Number(e);if(isNaN(a)){h(r.toString());return}let l=Number(a.toFixed(2)),u=Number(r);(isNaN(u)||Math.abs(l-u)>=Kw)&&(g.current.lastUpdatedValue=e,n({accumulatedChange:0,instantChange:0,originalElements:t,originalElementsMap:d.scene.getNonDeletedElementsMap(),shouldKeepAspectRatio:o,shouldChangeByStepSize:!1,scene:c,nextValue:l,property:s,originalAppState:i,setInputValue:e=>h(String(e))}),d.syncActionResult({captureUpdate:N.IMMEDIATELY}))},v=(0,G.useRef)({});return v.current.handleInputValue=_,(0,G.useEffect)(()=>{let e=f.current,t=v.current;return()=>{let n=e?.value;n&&t.handleInputValue?.(n,g.current.originalElements,g.current.originalAppState),window.removeEventListener(`pointermove`,t.onPointerMove,!1),window.removeEventListener(`pointerup`,t.onPointerUp,!1)}},[a]),a?(0,K.jsxs)(`div`,{className:L(`drag-input-container`,!a&&`disabled`),"data-testid":e,children:[(0,K.jsx)(`div`,{className:`drag-input-label`,ref:p,onPointerDown:e=>{if(f.current&&a){document.body.classList.add(`excalidraw-cursor-resize`);let e=Number(f.current.value);isNaN(e)&&(e=0);let t=null,r=d.scene.getNonDeletedElements().reduce((e,t)=>(e.set(t.id,Ge(t)),e),new Map),a=i.map(e=>r.get(e.id)),p=jn(l),m=0,g=0,_=e=>{if(t&&r!==null&&a!==null){let i=e.clientX-t.x;i!==0&&(g+=i,Math.abs(g)>=u&&(g=Math.sign(g)*Math.floor(Math.abs(g)/u),m+=g,n({accumulatedChange:m,instantChange:g,originalElements:a,originalElementsMap:r,shouldKeepAspectRatio:o,shouldChangeByStepSize:e.shiftKey,property:s,scene:c,originalAppState:p,setInputValue:e=>h(String(e))}),g=0))}t={x:e.clientX,y:e.clientY}},y=()=>{window.removeEventListener(`pointermove`,_,!1),d.syncActionResult({captureUpdate:N.IMMEDIATELY}),t=null,m=0,g=0,a=null,r=null,document.body.classList.remove(`excalidraw-cursor-resize`),window.removeEventListener(`pointerup`,y,!1)};v.current.onPointerMove=_,v.current.onPointerUp=y,window.addEventListener(`pointermove`,_,!1),window.addEventListener(`pointerup`,y,!1)}},onPointerEnter:()=>{p.current&&(p.current.style.cursor=`ew-resize`)},children:t?(0,K.jsx)(Z_,{icon:t}):e}),(0,K.jsx)(`input`,{className:`drag-input`,autoComplete:`off`,spellCheck:`false`,onKeyDown:e=>{if(a){let t=e.target;t instanceof HTMLInputElement&&e.key===D.ENTER&&(_(t.value,i,l),d.focusContainer())}},ref:f,value:m,onChange:e=>{g.current.updatePending=!0,h(e.target.value)},onFocus:e=>{e.target.select(),g.current.originalElements=i,g.current.originalAppState=jn(l)},onBlur:e=>{m?a&&_(e.target.value,g.current.originalElements,g.current.originalAppState):h(r.toString())},disabled:!a})]}):null},eT=10,tT=e=>e.type===`image`,nT=({accumulatedChange:e,originalElements:t,originalElementsMap:n,shouldKeepAspectRatio:r,shouldChangeByStepSize:i,nextValue:a,property:o,originalAppState:s,instantChange:c,scene:l})=>{let u=l.getNonDeletedElementsMap(),d=t[0],f=u.get(d.id);if(d&&f){let t=r||tT(d),l=d.width/d.height;if(s.croppingElementId===d.id){let e=u.get(d.id);if(!e||!De(e)||!e.crop)return;let t=e.crop,n={...t},r=e.scale[0]===-1,i=e.scale[1]===-1,{width:s,height:l}=Yc(e),f=t.naturalWidth/s,p=t.naturalHeight/l,m=r?t.width+t.x:t.naturalWidth-t.x,h=i?t.height+t.y:t.naturalHeight-t.y,g=10*f,_=10*p;if(a!==void 0){if(o===`width`){let e=Be(a*f,g,m);n={...n,width:e,x:r?t.x+t.width-e:t.x}}else if(o===`height`){let e=Be(a*p,_,h);n={...n,height:e,y:i?t.y+t.height-e:t.y}}W(e,{crop:n,width:n.width/(t.naturalWidth/s),height:n.height/(t.naturalHeight/l)});return}let v=o===`width`?c:0,y=o===`height`?c:0,b=Be(t.width+v,g,m),x=Be(t.height+y,g,h);n={...t,x:r?t.x+t.width-b:t.x,y:i?t.y+t.height-x:t.y,width:b,height:x},W(e,{crop:n,width:n.width/(t.naturalWidth/s),height:n.height/(t.naturalHeight/l)});return}if(a!==void 0){Fl(Math.max(o===`width`?a:t?a*l:d.width,1),Math.max(o===`height`?a:t?a/l:d.height,1),f,d,u,n,o===`width`?`e`:`s`,{shouldMaintainAspectRatio:t});return}let p=o===`width`?e:0,m=o===`height`?e:0,h=Math.max(0,d.width+p);o===`width`&&(h=i?Jw(h,eT):Math.round(h));let g=Math.max(0,d.height+m);o===`height`&&(g=i?Jw(g,eT):Math.round(g)),t&&(o===`width`?g=Math.round(h/l*100)/100:h=Math.round(g*l*100)/100),g=Math.max(1,g),h=Math.max(1,h),Fl(h,g,f,d,u,n,o===`width`?`e`:`s`,{shouldMaintainAspectRatio:t})}},rT=({property:e,element:t,scene:n,appState:r})=>{let i=gr(e===`width`?t.width:t.height,2);if(r.croppingElementId&&r.croppingElementId===t.id&&De(t)&&t.crop){let{width:n,height:r}=Yc(t);if(e===`width`){let e=n/t.crop.naturalWidth;i=gr(t.crop.width*e,2)}if(e===`height`){let e=r/t.crop.naturalHeight;i=gr(t.crop.height*e,2)}}return(0,K.jsx)($w,{label:e===`width`?`W`:`H`,elements:[t],dragInputCallback:nT,value:i,editable:qw(t,e),scene:n,appState:r,property:e})},iT=15,aT=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:n,nextValue:r,scene:i})=>{let a=i.getNonDeletedElementsMap(),o=i.getNonDeletedElements(),s=t[0];if(s&&!B(s)){let t=a.get(s.id);if(!t)return;if(r!==void 0){let e=Sl(r);W(t,{angle:e}),Qw(t,a,o,i);let n=w(t,a);n&&!Lc(t)&&W(n,{angle:e});return}let c=(Math.round(Xn(s.angle)*100)/100+Math.round(e))%360;n&&(c=Jw(c,iT)),c=c<0?c+360:c;let l=Sl(c);W(t,{angle:l}),Qw(t,a,o,i);let u=w(t,a);u&&!Lc(t)&&W(u,{angle:l})}},oT=({element:e,scene:t,appState:n,property:r})=>(0,K.jsx)($w,{label:`A`,icon:mc,value:Math.round(Xn(e.angle)%360*100)/100,elements:[e],dragInputCallback:aT,editable:qw(e,`angle`),scene:t,appState:n,property:r}),sT=4,cT=4,lT=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:n,nextValue:r,scene:i})=>{let a=i.getNonDeletedElementsMap(),o=t[0];if(o){let t=a.get(o.id);if(!t||!H(t))return;let s;if(r!==void 0)s=Math.max(Math.round(r),sT);else if(o.type===`text`){let t=Math.round(o.fontSize),r=Math.round(e);s=Math.max(t+r,sT),n&&(s=Jw(s,cT))}s&&(W(t,{fontSize:s}),pu(t,i.getContainerElement(t),i.getNonDeletedElementsMap()))}},uT=({element:e,scene:t,appState:n,property:r})=>{let i=H(e)?e:Ou(e)?w(e,t.getNonDeletedElementsMap()):null;return i?(0,K.jsx)($w,{label:`F`,value:Math.round(i.fontSize*10)/10,elements:[i],dragInputCallback:lT,icon:gl,appState:n,scene:t,property:r}):null},dT=10,fT=(e,t,n,r)=>{let i=r.x-e,a=r.y-t,o=r.width*n,s=r.height*n;return{width:o,height:s,x:e+i*n,y:t+a*n,...Qs(r,o,s,!1),...H(r)?{fontSize:r.fontSize*n}:{}}},pT=(e,t,n,r,i,a,o,s)=>{let c=fT(e,t,r,a);W(i,c,!1);let l=w(a,s);if(l){let e=l.fontSize*r;ao(i,o,{newSize:{width:c.width,height:c.height}});let t=o.get(l.id);t&&H(t)&&(W(t,{fontSize:e},!1),Ho(i,o,n===`width`?`e`:`s`,!0))}},mT=(e,t,n,r,i,a,o,s,c,l)=>{a===`width`?t=Math.round(e/r*100)/100:e=Math.round(t*r*100)/100;let u=t/n;for(let e=0;e<s.length;e++){let t=s[e],n=o[e];pT(i[0],i[1],a,u,n,t,c,l)}},hT=({accumulatedChange:e,originalElements:t,originalElementsMap:n,originalAppState:r,shouldChangeByStepSize:i,nextValue:a,scene:o,property:s})=>{let c=o.getNonDeletedElementsMap(),l=Zw(t,r);if(a!==void 0){for(let e of l){let t=Yw(e,c,n);if(t.length>1){let e=t.map(e=>e.latest),r=t.map(e=>e.original),[i,o,l,u]=Ts(r),d=l-i,f=u-o,p=d/f;mT(Math.max(1,s===`width`?Math.max(0,a):d),Math.max(1,s===`height`?Math.max(0,a):f),f,p,I(i,o),s,e,r,c,n)}else{let[e]=t,r=e?.latest,o=e?.original;if(r&&o&&qw(r,s)){let e=s===`width`?Math.max(0,a):r.width;s===`width`&&(e=i?Jw(e,dT):Math.round(e));let t=s===`height`?Math.max(0,a):r.height;s===`height`&&(t=i?Jw(t,dT):Math.round(t)),e=Math.max(1,e),t=Math.max(1,t),Fl(e,t,r,o,c,n,s===`width`?`e`:`s`,{shouldInformMutation:!1})}}}o.triggerUpdate();return}let u=s===`width`?e:0,d=s===`height`?e:0;for(let e of l){let t=Yw(e,c,n);if(t.length>1){let e=t.map(e=>e.latest),r=t.map(e=>e.original),[a,o,l,f]=Ts(r),p=l-a,m=f-o,h=p/m,g=Math.max(0,p+u);s===`width`&&(g=i?Jw(g,dT):Math.round(g));let _=Math.max(0,m+d);s===`height`&&(_=i?Jw(_,dT):Math.round(_)),g=Math.max(1,g),_=Math.max(1,_),mT(g,_,m,h,I(a,o),s,e,r,c,n)}else{let[e]=t,r=e?.latest,a=e?.original;if(r&&a&&qw(r,s)){let e=Math.max(0,a.width+u);s===`width`&&(e=i?Jw(e,dT):Math.round(e));let t=Math.max(0,a.height+d);s===`height`&&(t=i?Jw(t,dT):Math.round(t)),e=Math.max(1,e),t=Math.max(1,t),Fl(e,t,r,a,c,n,s===`width`?`e`:`s`,{shouldInformMutation:!1})}}}o.triggerUpdate()},gT=({property:e,elements:t,elementsMap:n,atomicUnits:r,scene:i,appState:a})=>{let o=(0,G.useMemo)(()=>r.map(t=>{let r=Yw(t,n);if(r.length>1){let[t,n,i,a]=Ts(r.map(e=>e.latest));return Math.round((e===`width`?i-t:a-n)*100)/100}let[i]=r;return Math.round((e===`width`?i.latest.width:i.latest.height)*100)/100}),[n,r,e]),s=new Set(o).size===1?Math.round(o[0]*100)/100:`Mixed`,c=o.length>0;return(0,K.jsx)($w,{label:e===`width`?`W`:`H`,elements:t,dragInputCallback:hT,value:s,editable:c,appState:a,property:e,scene:i})},_T=15,vT=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:n,nextValue:r,property:i,scene:a})=>{let o=a.getNonDeletedElementsMap(),s=t.map(e=>o.get(e.id)).filter(e=>e&&!So(e)&&qw(e,i)),c=t.filter(e=>!So(e)&&qw(e,i));if(r!==void 0){let e=Sl(r);for(let t of s){if(!t)continue;W(t,{angle:e},!1);let n=w(t,o);n&&!Lc(t)&&W(n,{angle:e},!1)}a.triggerUpdate();return}for(let t=0;t<s.length;t++){let r=s[t];if(!r)continue;let i=c[t],a=(Math.round(Xn(i.angle)*100)/100+Math.round(e))%360;n&&(a=Jw(a,_T)),a=a<0?a+360:a;let l=Sl(a);W(r,{angle:l},!1);let u=w(r,o);u&&!Lc(r)&&W(u,{angle:l},!1)}a.triggerUpdate()},yT=({elements:e,scene:t,appState:n,property:r})=>{let i=e.filter(e=>!So(e)&&qw(e,`angle`)),a=i.map(e=>Math.round(Xn(e.angle)%360*100)/100);return(0,K.jsx)($w,{label:`A`,icon:mc,value:new Set(a).size===1?a[0]:`Mixed`,elements:e,dragInputCallback:vT,editable:i.some(e=>qw(e,`angle`)),appState:n,scene:t,property:r})},bT=4,xT=4,ST=(e,t)=>e.reduce((e,n)=>{if(!n||So(n))return e;if(H(n))return e.push(n),e;if(Ou(n)){let r=w(n,t);if(r)return e.push(r),e}return e},[]),CT=({accumulatedChange:e,originalElements:t,shouldChangeByStepSize:n,nextValue:r,scene:i})=>{let a=i.getNonDeletedElementsMap(),o=t.map(e=>a.get(e.id)),s;if(r){s=Math.max(Math.round(r),bT);for(let e of o)W(e,{fontSize:s},!1),pu(e,i.getContainerElement(e),a,!1);i.triggerUpdate()}else{let r=t;for(let t=0;t<o.length;t++){let s=o[t],c=r[t],l=Math.round(c.fontSize),u=Math.round(e),d=Math.max(l+u,bT);n&&(d=Jw(d,xT)),W(s,{fontSize:d},!1),pu(s,i.getContainerElement(s),a,!1)}i.triggerUpdate()}},wT=({elements:e,scene:t,appState:n,property:r,elementsMap:i})=>{let a=ST(e,i);if(!a.length)return null;let o=a.map(e=>Math.round(e.fontSize*10)/10);return(0,K.jsx)($w,{label:`F`,icon:gl,elements:a,dragInputCallback:CT,value:new Set(o).size===1?o[0]:`Mixed`,editable:o.length>0,scene:t,property:r,appState:n})},TT=10,ET=({accumulatedChange:e,instantChange:t,originalElements:n,originalElementsMap:r,shouldChangeByStepSize:i,nextValue:a,property:o,scene:s,originalAppState:c})=>{let l=s.getNonDeletedElementsMap(),u=s.getNonDeletedElements(),d=n[0],[f,p]=[d.x+d.width/2,d.y+d.height/2],[m,h]=Ia(I(d.x,d.y),I(f,p),d.angle);if(c.croppingElementId===d.id){let e=l.get(d.id);if(!e||!De(e)||!e.crop)return;let n=e.crop,r=n,i=e.scale[0]===-1,s=e.scale[1]===-1,{width:c,height:u}=Yc(e);if(a!==void 0){if(o===`x`){let e=a*(n.naturalWidth/c);r=i?{...n,x:Be(n.naturalWidth-e-n.width,0,n.naturalWidth-n.width)}:{...n,x:Be(a*(n.naturalWidth/c),0,n.naturalWidth-n.width)}}o===`y`&&(r={...n,y:Be(a*(n.naturalHeight/u),0,n.naturalHeight-n.height)}),W(e,{crop:r});return}let f=(o===`x`?t:0)*(i?-1:1),p=(o===`y`?t:0)*(s?-1:1);r={...n,x:Be(n.x+f,0,n.naturalWidth-n.width),y:Be(n.y+p,0,n.naturalHeight-n.height)},W(e,{crop:r});return}if(a!==void 0){Xw(o===`x`?a:m,o===`y`?a:h,d,l,u,s,r);return}let g=o===`x`?e:0,_=o===`y`?e:0;Xw(o===`x`?Math.round(i?Jw(d.x+g,TT):m+g):m,o===`y`?Math.round(i?Jw(d.y+_,TT):h+_):h,d,l,u,s,r)},DT=({property:e,element:t,elementsMap:n,scene:r,appState:i})=>{let[a,o]=Ia(I(t.x,t.y),I(t.x+t.width/2,t.y+t.height/2),t.angle),s=gr(e===`x`?a:o,2);if(i.croppingElementId===t.id&&De(t)&&t.crop){let n=Rn(t);n&&(s=gr(e===`x`?n.x:n.y,2))}return(0,K.jsx)($w,{label:e===`x`?`X`:`Y`,elements:[t],dragInputCallback:ET,scene:r,value:s,property:e,appState:i})},OT=10,kT=(e,t,n,r,i,a,o,s)=>{for(let c=0;c<r.length;c++){let l=i[c],[u,d]=[l.x+l.width/2,l.y+l.height/2],[f,p]=Ia(I(l.x,l.y),I(u,d),l.angle);Xw(e===`x`?Math.round(f+t):f,e===`y`?Math.round(p+n):p,l,a,r,s,o,!1)}},AT=(e,t,n,r,i,a,o)=>{let[s,c,,]=Ts(n),l=e-s,u=t-c;for(let e=0;e<n.length;e++){let t=n[e],s=r.get(t.id);if(s&&(!H(s)||!s.containerId)){let[e,n]=[s.x+s.width/2,s.y+s.height/2],[c,d]=Ia(I(s.x,s.y),I(e,n),s.angle);Xw(c+l,d+u,t,r,i,o,a,!1)}}},jT=({accumulatedChange:e,originalElements:t,originalElementsMap:n,shouldChangeByStepSize:r,nextValue:i,property:a,scene:o,originalAppState:s})=>{let c=o.getNonDeletedElementsMap(),l=o.getNonDeletedElements();if(i!==void 0){for(let e of Zw(t,s)){let t=Yw(e,c,n);if(t.length>1){let[e,r,,]=Ts(t.map(e=>e.latest));AT(a===`x`?i:e,a===`y`?i:r,t.map(e=>e.original),c,l,n,o)}else{let e=t[0]?.original,r=t[0]?.latest;if(e&&r&&qw(r,a)){let[t,r]=[e.x+e.width/2,e.y+e.height/2],[s,u]=Ia(I(e.x,e.y),I(t,r),e.angle);Xw(a===`x`?i:s,a===`y`?i:u,e,c,l,o,n,!1)}}}o.triggerUpdate();return}let u=r?Jw(e,OT):e;kT(a,a===`x`?u:0,a===`y`?u:0,t,t,c,n,o),o.triggerUpdate()},MT=({property:e,elements:t,elementsMap:n,atomicUnits:r,scene:i,appState:a})=>{let o=(0,G.useMemo)(()=>r.map(t=>{let r=Object.keys(t).map(e=>n.get(e)).filter(e=>e!==void 0);if(r.length>1){let[t,n]=Ts(r);return Math.round((e===`x`?t:n)*100)/100}let[i]=r,[a,o]=[i.x+i.width/2,i.y+i.height/2],[s,c]=Ia(I(i.x,i.y),I(a,o),i.angle);return Math.round((e===`x`?s:c)*100)/100}),[r,n,e]),s=new Set(o).size===1?o[0]:`Mixed`;return(0,K.jsx)($w,{label:e===`x`?`X`:`Y`,elements:t,dragInputCallback:jT,value:s,property:e,scene:i,appState:a})},NT=5,PT=({property:e,scene:t,appState:n,setAppState:r})=>(0,K.jsx)($w,{label:`Grid step`,sensitivity:8,elements:[],dragInputCallback:({nextValue:e,instantChange:t,shouldChangeByStepSize:n,setInputValue:i})=>{r(r=>{let a;return e?a=e:t&&(a=n?Jw(r.gridStep+NT*Math.sign(t),NT):r.gridStep+t),a?(a=vr(a),i(a),{gridStep:a}):(i(r.gridStep),null)})},scene:t,value:n.gridStep,property:e,appState:n}),FT=50,IT=e=>{let t=CD(),n=e.app.scene.getSceneNonce()||1,r=e.app.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,includeBoundTextElement:!1}),i=Oo(e.app);return(0,K.jsx)(RT,{...e,appState:t,sceneNonce:n,selectedElements:r,gridModeEnabled:i})},Q=({children:e,columns:t=1,heading:n,style:r,...i})=>(0,K.jsx)(`div`,{className:L(`exc-stats__row`,{"exc-stats__row--heading":n}),style:{gridTemplateColumns:`repeat(${t}, 1fr)`,...r},...i,children:e});Q.displayName=`StatsRow`;var LT=({children:e,order:t,style:n,...r})=>(0,K.jsx)(`div`,{className:`exc-stats__rows`,style:{order:t,...n},...r,children:e});LT.displayName=`StatsRows`,IT.StatsRow=Q,IT.StatsRows=LT;var RT=(0,G.memo)(({app:e,onClose:t,renderCustomStats:n,selectedElements:r,appState:i,sceneNonce:a,gridModeEnabled:o})=>{let s=e.scene,c=s.getNonDeletedElements(),l=s.getNonDeletedElementsMap(),u=wD(),d=r.length===1?r[0]:null,f=r.length>1?r:null,p=i.croppingElementId&&De(d),m=p?Yc(d):null,[h,g]=(0,G.useState)({width:0,height:0}),_=(0,G.useMemo)(()=>(0,gg.default)(e=>{let t=Ts(e);g({width:Math.round(t[2])-Math.round(t[0]),height:Math.round(t[3])-Math.round(t[1])})},FT),[]);(0,G.useEffect)(()=>{_(c)},[a,c,_]),(0,G.useEffect)(()=>()=>_.cancel(),[_]);let v=(0,G.useMemo)(()=>Zw(r,i),[r,i]),y=(0,G.useMemo)(()=>Fc(r),[r]);return(0,K.jsx)(`div`,{className:`exc-stats`,children:(0,K.jsxs)(W_,{padding:3,children:[(0,K.jsxs)(`div`,{className:`title`,children:[(0,K.jsx)(`h2`,{children:q(`stats.title`)}),(0,K.jsx)(`div`,{className:`close`,onClick:t,children:Ll})]}),(0,K.jsxs)(Q_,{label:(0,K.jsx)(`h3`,{children:q(`stats.generalStats`)}),open:!!(i.stats.panels&Pa.generalStats),openTrigger:()=>u(e=>({stats:{open:!0,panels:e.stats.panels^Pa.generalStats}})),children:[(0,K.jsxs)(LT,{children:[(0,K.jsx)(Q,{heading:!0,children:q(`stats.scene`)}),(0,K.jsxs)(Q,{columns:2,children:[(0,K.jsx)(`div`,{children:q(`stats.shapes`)}),(0,K.jsx)(`div`,{children:c.length})]}),(0,K.jsxs)(Q,{columns:2,children:[(0,K.jsx)(`div`,{children:q(`stats.width`)}),(0,K.jsx)(`div`,{children:h.width})]}),(0,K.jsxs)(Q,{columns:2,children:[(0,K.jsx)(`div`,{children:q(`stats.height`)}),(0,K.jsx)(`div`,{children:h.height})]}),o&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(Q,{heading:!0,children:`Canvas`}),(0,K.jsx)(Q,{children:(0,K.jsx)(PT,{property:`gridStep`,scene:s,appState:i,setAppState:u})})]})]}),n?.(c,i)]}),!y&&r.length>0&&(0,K.jsx)(`div`,{id:`elementStats`,style:{marginTop:12},children:(0,K.jsx)(Q_,{label:(0,K.jsx)(`h3`,{children:q(`stats.elementProperties`)}),open:!!(i.stats.panels&Pa.elementProperties),openTrigger:()=>u(e=>({stats:{open:!0,panels:e.stats.panels^Pa.elementProperties}})),children:(0,K.jsxs)(LT,{children:[d&&(0,K.jsxs)(K.Fragment,{children:[p&&(0,K.jsx)(Q,{heading:!0,children:q(`labels.unCroppedDimension`)}),i.croppingElementId&&De(d)&&m&&(0,K.jsxs)(Q,{columns:2,children:[(0,K.jsx)(`div`,{children:q(`stats.width`)}),(0,K.jsx)(`div`,{children:gr(m.width,2)})]}),i.croppingElementId&&De(d)&&m&&(0,K.jsxs)(Q,{columns:2,children:[(0,K.jsx)(`div`,{children:q(`stats.height`)}),(0,K.jsx)(`div`,{children:gr(m.height,2)})]}),(0,K.jsx)(Q,{heading:!0,"data-testid":`stats-element-type`,children:i.croppingElementId?q(`labels.imageCropping`):q(`element.${d.type}`)}),(0,K.jsx)(Q,{children:(0,K.jsx)(DT,{element:d,property:`x`,elementsMap:l,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(DT,{element:d,property:`y`,elementsMap:l,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(rT,{property:`width`,element:d,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(rT,{property:`height`,element:d,scene:s,appState:i})}),!B(d)&&(0,K.jsx)(Q,{children:(0,K.jsx)(oT,{property:`angle`,element:d,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(uT,{property:`fontSize`,element:d,scene:s,appState:i})})]}),f&&(0,K.jsxs)(K.Fragment,{children:[bs(f)&&(0,K.jsx)(Q,{heading:!0,children:q(`element.group`)}),(0,K.jsxs)(Q,{columns:2,style:{margin:`0.3125rem 0`},children:[(0,K.jsx)(`div`,{children:q(`stats.shapes`)}),(0,K.jsx)(`div`,{children:r.length})]}),(0,K.jsx)(Q,{children:(0,K.jsx)(MT,{property:`x`,elements:f,elementsMap:l,atomicUnits:v,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(MT,{property:`y`,elements:f,elementsMap:l,atomicUnits:v,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(gT,{property:`width`,elements:f,elementsMap:l,atomicUnits:v,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(gT,{property:`height`,elements:f,elementsMap:l,atomicUnits:v,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(yT,{property:`angle`,elements:f,scene:s,appState:i})}),(0,K.jsx)(Q,{children:(0,K.jsx)(wT,{property:`fontSize`,elements:f,scene:s,appState:i,elementsMap:l})})]})]})})})]})})},(e,t)=>e.sceneNonce===t.sceneNonce&&e.selectedElements===t.selectedElements&&e.appState.stats.panels===t.appState.stats.panels&&e.gridModeEnabled===t.gridModeEnabled&&e.appState.gridStep===t.appState.gridStep&&e.appState.croppingElementId===t.appState.croppingElementId),zT=({sourceElementId:e,onClose:t,elementsMap:n,appState:r,generateLinkForSelection:i=io})=>{let a=n.get(e)?.link??null,[o,s]=(0,G.useState)(a),[c,l]=(0,G.useState)(!1);(0,G.useEffect)(()=>{let e=V(n,r),t=a;if(e.length>0&&i){let n=Na(e,r);n&&(t=Sn(i(n.id,n.type)))}s(t)},[n,r,r.selectedElementIds,a,i]);let u=(0,G.useCallback)(()=>{if(o&&o!==n.get(e)?.link){let t=n.get(e);t&&W(t,{link:o})}if(!o&&c&&e){let t=n.get(e);t&&W(t,{link:null})}t?.()},[e,o,n,c,t]);return(0,G.useEffect)(()=>{let e=e=>{r.openDialog?.name===`elementLinkSelector`&&e.key===D.ENTER&&u(),r.openDialog?.name===`elementLinkSelector`&&e.key===D.ESCAPE&&t?.()};return window.addEventListener(`keydown`,e),()=>{window.removeEventListener(`keydown`,e)}},[r,t,u]),(0,K.jsxs)(`div`,{className:`ElementLinkDialog`,children:[(0,K.jsxs)(`div`,{className:`ElementLinkDialog__header`,children:[(0,K.jsx)(`h2`,{children:q(`elementLink.title`)}),(0,K.jsx)(`p`,{children:q(`elementLink.desc`)})]}),(0,K.jsxs)(`div`,{className:`ElementLinkDialog__input`,children:[(0,K.jsx)(wx,{value:o??``,onChange:e=>{c||l(!0),s(e)},onKeyDown:e=>{e.key===D.ENTER&&u()},className:`ElementLinkDialog__input-field`,selectOnRender:!0}),a&&o&&(0,K.jsx)(J,{type:`button`,title:q(`buttons.remove`),"aria-label":q(`buttons.remove`),label:q(`buttons.remove`),onClick:()=>{s(null),l(!0)},className:`ElementLinkDialog__remove`,icon:Bs})]}),(0,K.jsxs)(`div`,{className:`ElementLinkDialog__actions`,children:[(0,K.jsx)(Lb,{label:q(`buttons.cancel`),onClick:()=>{t?.()},style:{marginRight:10}}),(0,K.jsx)(Lb,{label:q(`buttons.confirm`),onClick:u,actionType:`primary`})]})]})},BT=({UIOptions:e})=>(0,K.jsxs)(nw,{__fallback:!0,children:[(0,K.jsx)(nw.DefaultItems.LoadScene,{}),(0,K.jsx)(nw.DefaultItems.SaveToActiveFile,{}),e.canvasActions.export&&(0,K.jsx)(nw.DefaultItems.Export,{}),e.canvasActions.saveAsImage&&(0,K.jsx)(nw.DefaultItems.SaveAsImage,{}),(0,K.jsx)(nw.DefaultItems.SearchMenu,{}),(0,K.jsx)(nw.DefaultItems.Help,{}),(0,K.jsx)(nw.DefaultItems.ClearCanvas,{}),(0,K.jsx)(nw.Separator,{}),(0,K.jsx)(nw.Group,{title:`Excalidraw links`,children:(0,K.jsx)(nw.DefaultItems.Socials,{})}),(0,K.jsx)(nw.Separator,{}),(0,K.jsx)(nw.DefaultItems.ToggleTheme,{}),(0,K.jsx)(nw.DefaultItems.ChangeCanvasBackground,{})]}),VT=()=>(0,K.jsxs)(aw,{__fallback:!0,children:[(0,K.jsx)(aw.Actions.SaveToDisk,{}),(0,K.jsx)(aw.Actions.ExportToImage,{})]}),HT=({actionManager:e,appState:t,files:n,setAppState:r,elements:i,canvas:a,onLockToggle:o,onHandToolToggle:s,onPenModeToggle:c,showExitZenModeBtn:l,renderTopRightUI:u,renderCustomStats:d,UIOptions:f,onExportImage:p,renderWelcomeScreen:m,children:h,app:g,isCollaborating:_,generateLinkForSelection:v})=>{let y=bD(),b=Px(),x=b.tunnelsJotai.Provider,[S,ee]=xg(V_),te=()=>f.canvasActions.export?(0,K.jsx)(wC,{elements:i,appState:t,files:n,actionManager:e,exportOpts:f.canvasActions.export,canvas:a,setAppState:r}):null,ne=()=>!f.canvasActions.saveAsImage||t.openDialog?.name!==`imageExport`?null:(0,K.jsx)(jS,{elements:i,appState:t,files:n,actionManager:e,onExportImage:p,onCloseRequest:()=>r({openDialog:null}),name:g.getName()}),re=()=>(0,K.jsxs)(`div`,{style:{position:`relative`},children:[(0,K.jsx)(b.MainMenuTunnel.Out,{}),m&&(0,K.jsx)(b.WelcomeScreenMenuHintTunnel.Out,{})]}),ie=()=>(0,K.jsx)(ZS,{heading:`selectedShapeActions`,className:L(`selected-shape-actions zen-mode-transition`,{"transition-left":t.zenModeEnabled}),children:(0,K.jsx)(W_,{className:bi.SHAPE_ACTIONS_MENU,padding:2,style:{maxHeight:`${t.height-166}px`},children:(0,K.jsx)(Lx,{appState:t,elementsMap:g.scene.getNonDeletedElementsMap(),renderAction:e.renderAction,app:g})})}),ae=()=>{let n=St(t,i),r=t.stats.open&&!t.zenModeEnabled&&!t.viewModeEnabled&&t.openDialog?.name!==`elementLinkSelector`;return(0,K.jsx)(MS,{side:`top`,children:(0,K.jsxs)(`div`,{className:`App-menu App-menu_top`,children:[(0,K.jsxs)(Ob.Col,{gap:6,className:L(`App-menu_top__left`),children:[re(),n&&ie()]}),!t.viewModeEnabled&&t.openDialog?.name!==`elementLinkSelector`&&(0,K.jsx)(ZS,{heading:`shapes`,className:`shapes-section`,children:e=>(0,K.jsxs)(`div`,{style:{position:`relative`},children:[m&&(0,K.jsx)(b.WelcomeScreenToolbarHintTunnel.Out,{}),(0,K.jsx)(Ob.Col,{gap:4,align:`start`,children:(0,K.jsxs)(Ob.Row,{gap:1,className:L(`App-toolbar-container`,{"zen-mode":t.zenModeEnabled}),children:[(0,K.jsxs)(W_,{padding:1,className:L(`App-toolbar`,{"zen-mode":t.zenModeEnabled}),children:[(0,K.jsx)(qS,{appState:t,isMobile:y.editor.isMobile,device:y,app:g}),e,(0,K.jsxs)(Ob.Row,{gap:1,children:[(0,K.jsx)(iC,{zenModeEnabled:t.zenModeEnabled,checked:t.penMode,onChange:()=>c(null),title:q(`toolBar.penMode`),penDetected:t.penDetected}),(0,K.jsx)(XS,{checked:t.activeTool.locked,onChange:o,title:q(`toolBar.lock`)}),(0,K.jsx)(`div`,{className:`App-toolbar__divider`}),(0,K.jsx)(aC,{checked:On(t),onChange:()=>s(),title:q(`toolBar.hand`),isMobile:!0}),(0,K.jsx)(Rx,{appState:t,activeTool:t.activeTool,UIOptions:f,app:g})]})]}),_&&(0,K.jsx)(W_,{style:{marginLeft:8,alignSelf:`center`,height:`fit-content`},children:(0,K.jsx)(xw,{title:q(`toolBar.laser`),checked:t.activeTool.type===$u.laser,onChange:()=>g.setActiveTool({type:$u.laser}),isMobile:!0})})]})})]})}),(0,K.jsxs)(`div`,{className:L(`layer-ui__wrapper__top-right zen-mode-transition`,{"transition-right":t.zenModeEnabled}),children:[t.collaborators.size>0&&(0,K.jsx)(xC,{collaborators:t.collaborators,userToFollow:t.userToFollow?.socketId||null}),u?.(y.editor.isMobile,t),!t.viewModeEnabled&&t.openDialog?.name!==`elementLinkSelector`&&(!se||t.openSidebar?.name!==Fu.name)&&(0,K.jsx)(b.DefaultSidebarTriggerTunnel.Out,{}),r&&(0,K.jsx)(IT,{app:g,onClose:()=>{e.executeAction(Vy)},renderCustomStats:d})]})]})})},oe=()=>(0,K.jsx)(yw,{__fallback:!0,onDock:e=>{Y(`sidebar`,`toggleDock (${e?`dock`:`undock`})`,`(${y.editor.isMobile?`mobile`:`desktop`})`)}}),se=Cg(FC),ce=(0,K.jsxs)(K.Fragment,{children:[h,(0,K.jsx)(BT,{UIOptions:f}),(0,K.jsx)(yw.Trigger,{__fallback:!0,icon:Li,title:Dr(q(`toolBar.library`)),onToggle:e=>{e&&Y(`sidebar`,`${Fu.name} (open)`,`button (${y.editor.isMobile?`mobile`:`desktop`})`)},tab:Fu.defaultTab,children:q(`toolBar.library`)}),(0,K.jsx)(VT,{}),t.openDialog?.name===`ttd`&&(0,K.jsx)(Ww,{__fallback:!0}),t.isLoading&&(0,K.jsx)(Bg,{delay:250}),t.errorMessage&&(0,K.jsx)(xS,{onClose:()=>r({errorMessage:null}),children:t.errorMessage}),S&&!y.editor.isMobile&&(0,K.jsx)(H_,{colorPickerType:S.colorPickerType,onCancel:()=>{ee(null)},onChange:(e,t,n,{altKey:i})=>{if(!(e!==`elementBackground`&&e!==`elementStroke`))if(n.length){for(let r of n)W(r,{[i&&S.swapPreviewOnAlt?e===`elementBackground`?`strokeColor`:`backgroundColor`:e===`elementBackground`?`backgroundColor`:`strokeColor`]:t},!1),We.delete(r);Zs.getScene(n[0])?.triggerUpdate()}else r(e===`elementBackground`?{currentItemBackgroundColor:t}:{currentItemStrokeColor:t})},onSelect:(e,t)=>{ee(e=>e?.keepOpenOnAlt&&t.altKey?e:null),S?.onSelect?.(e,t)}}),t.openDialog?.name===`help`&&(0,K.jsx)(hC,{onClose:()=>{r({openDialog:null})}}),(0,K.jsx)(Gx,{}),t.openDialog?.name===`elementLinkSelector`&&(0,K.jsx)(zT,{sourceElementId:t.openDialog.sourceElementId,onClose:()=>{r({openDialog:null})},elementsMap:g.scene.getNonDeletedElementsMap(),appState:t,generateLinkForSelection:v}),(0,K.jsx)(b.OverwriteConfirmDialogTunnel.Out,{}),ne(),te(),t.pasteDialog.shown&&(0,K.jsx)(cC,{setAppState:r,appState:t,onClose:()=>r({pasteDialog:{shown:!1,data:null}})}),y.editor.isMobile&&(0,K.jsx)(oC,{app:g,appState:t,elements:i,actionManager:e,renderJSONExportDialog:te,renderImageExportDialog:ne,setAppState:r,onLockToggle:o,onHandToolToggle:s,onPenModeToggle:c,renderTopRightUI:u,renderCustomStats:d,renderSidebars:oe,device:y,renderWelcomeScreen:m,UIOptions:f}),!y.editor.isMobile&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(`div`,{className:`layer-ui__wrapper`,style:t.openSidebar&&se&&y.editor.canFitSidebar?{width:`calc(100% - var(--right-sidebar-width))`}:{},children:[m&&(0,K.jsx)(b.WelcomeScreenCenterTunnel.Out,{}),ae(),(0,K.jsx)(DC,{appState:t,actionManager:e,showExitZenModeBtn:l,renderWelcomeScreen:m}),t.scrolledOutside&&(0,K.jsx)(`button`,{type:`button`,className:`scroll-back-to-content`,onClick:()=>{r(e=>({...Fr(i,e)}))},children:q(`buttons.scrollBackToContent`)})]}),oe()]})]});return(0,K.jsx)(I_.Provider,{value:t,children:(0,K.jsx)(x,{children:(0,K.jsx)(jx.Provider,{value:b,children:ce})})})},UT=e=>{let{suggestedBindings:t,startBoundElement:n,cursorButton:r,scrollX:i,scrollY:a,...o}=e;return o},WT=G.memo(HT,(e,t)=>{if(e.children!==t.children)return!1;let{canvas:n,appState:r,...i}=e,{canvas:a,appState:o,...s}=t;return ca(UT(r),UT(o),{selectedElementIds:ca,selectedGroupIds:ca})&&ca(i,s)}),GT=5e3,KT=({message:e,onClose:t,closable:n=!1,duration:r=GT,style:i})=>{let a=(0,G.useRef)(0),o=r!==1/0,s=(0,G.useCallback)(()=>{o&&(a.current=window.setTimeout(()=>t(),r))},[t,r,o]);return(0,G.useEffect)(()=>{if(o)return s(),()=>clearTimeout(a.current)},[s,e,r,o]),(0,K.jsxs)(`div`,{className:`Toast`,onMouseEnter:o?()=>clearTimeout(a?.current):void 0,onMouseLeave:o?s:void 0,style:i,children:[(0,K.jsx)(`p`,{className:`Toast__message`,children:e}),n&&(0,K.jsx)(J,{icon:Ll,"aria-label":`close`,type:`icon`,onClick:t,className:`close`})]})},qT=j({name:`viewMode`,label:`labels.viewMode`,paletteName:`Toggle view mode`,icon:lo,viewMode:!0,trackEvent:{category:`canvas`,predicate:e=>!e.viewModeEnabled},perform(e,t){return{appState:{...t,viewModeEnabled:!this.checked(t)},captureUpdate:N.EVENTUALLY}},checked:e=>e.viewModeEnabled,predicate:(e,t,n)=>typeof n.viewModeEnabled>`u`,keyTest:e=>!e[D.CTRL_OR_CMD]&&e.altKey&&e.code===E.R}),JT=(e,t)=>{let n=t.scene.getSelectedElements(e);return n.length===1&&M(n[0])},YT=j({name:`selectAllElementsInFrame`,label:`labels.selectAllElementsInFrame`,trackEvent:{category:`canvas`},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t).at(0)||null;if(M(i)){let n=Mt(U(e),i.id).filter(e=>!(e.type===`text`&&e.containerId));return{elements:e,appState:{...t,selectedElementIds:n.reduce((e,t)=>(e[t.id]=!0,e),{})},captureUpdate:N.IMMEDIATELY}}return{elements:e,appState:t,captureUpdate:N.EVENTUALLY}},predicate:(e,t,n,r)=>JT(t,r)}),XT=j({name:`removeAllElementsFromFrame`,label:`labels.removeAllElementsFromFrame`,trackEvent:{category:`history`},perform:(e,t,n,r)=>{let i=r.scene.getSelectedElements(t).at(0)||null;return M(i)?{elements:or(e,i),appState:{...t,selectedElementIds:{[i.id]:!0}},captureUpdate:N.IMMEDIATELY}:{elements:e,appState:t,captureUpdate:N.EVENTUALLY}},predicate:(e,t,n,r)=>JT(t,r)});j({name:`updateFrameRendering`,label:`labels.updateFrameRendering`,viewMode:!0,trackEvent:{category:`canvas`},perform:(e,t)=>({elements:e,appState:{...t,frameRendering:{...t.frameRendering,enabled:!t.frameRendering.enabled}},captureUpdate:N.EVENTUALLY}),checked:e=>e.frameRendering.enabled}),j({name:`setFrameAsActiveTool`,label:`toolBar.frame`,trackEvent:{category:`toolbar`},icon:be,viewMode:!1,perform:(e,t,n,r)=>{let i=fo(t,{type:`frame`});return Ul(r.interactiveCanvas,{...t,activeTool:i}),{elements:e,appState:{...t,activeTool:fo(t,{type:`frame`})},captureUpdate:N.EVENTUALLY}},keyTest:e=>!e[D.CTRL_OR_CMD]&&!e.shiftKey&&!e.altKey&&e.key.toLocaleLowerCase()===D.F});var ZT=j({name:`wrapSelectionInFrame`,label:`labels.wrapSelectionInFrame`,trackEvent:{category:`element`},predicate:(e,t,n,r)=>{let i=V(e,t);return i.length>0&&!i.some(e=>M(e))},perform:(e,t,n,r)=>{let i=V(e,t),[a,o,s,c]=Ts(i,r.scene.getNonDeletedElementsMap()),l=os({x:a-16,y:o-16,width:s-a+32,height:c-o+32});if(t.editingGroupId){let e=jo(i,t.editingGroupId);for(let n of e){let e=n.groupIds.indexOf(t.editingGroupId);W(n,{groupIds:n.groupIds.slice(0,e)},!1)}}return{elements:wu([...r.scene.getElementsIncludingDeleted(),l],i,l,t),appState:{selectedElementIds:{[l.id]:!0}},captureUpdate:N.IMMEDIATELY}}}),QT=()=>(0,K.jsxs)(`div`,{"data-testid":`brave-measure-text-error`,children:[(0,K.jsx)(`p`,{children:(0,K.jsx)(Ib,{i18nKey:`errors.brave_measure_text_error.line1`,bold:e=>(0,K.jsx)(`span`,{style:{fontWeight:600},children:e})})}),(0,K.jsx)(`p`,{children:(0,K.jsx)(Ib,{i18nKey:`errors.brave_measure_text_error.line2`,bold:e=>(0,K.jsx)(`span`,{style:{fontWeight:600},children:e})})}),(0,K.jsx)(`p`,{children:(0,K.jsx)(Ib,{i18nKey:`errors.brave_measure_text_error.line3`,link:e=>(0,K.jsx)(`a`,{href:`http://docs.excalidraw.com/docs/@excalidraw/excalidraw/faq#turning-off-aggresive-block-fingerprinting-in-brave-browser`,children:e})})}),(0,K.jsx)(`p`,{children:(0,K.jsx)(Ib,{i18nKey:`errors.brave_measure_text_error.line4`,issueLink:e=>(0,K.jsx)(`a`,{href:`https://github.com/excalidraw/excalidraw/issues/new`,children:e}),discordLink:e=>(0,K.jsxs)(`a`,{href:`https://discord.gg/UexuTaE`,children:[e,`.`]})})})]}),$T={width:100,height:0},eE=100,tE=(e,t,n)=>{let r=yt({x:0,y:0,textAlign:to.CENTER,verticalAlign:ri.MIDDLE,...t,containerId:e.id,strokeColor:t.strokeColor||e.strokeColor});return Object.assign(e,{boundElements:(e.boundElements||[]).concat({type:`text`,id:r.id})}),pu(r,e,n),[e,r]},nE=(e,t,n,r,i)=>{let a,o;if(Object.assign(e,{startBinding:e?.startBinding||null,endBinding:e.endBinding||null}),t){let n=t?.width??eE,o=t?.height??eE,s;t.id&&(s=r.getElement(t.id),s||console.error(`No element for start binding with id ${t.id} found`));let c=t.x||e.x-n,l=t.y||e.y-o/2,u=s?s.type:t.type;if(u){if(u===`text`){let n=``;s&&s.type===`text`?n=s.text:t.type===`text`&&(n=t.text),n||console.error(`No text found for start binding text element for ${e.id}`),a=yt({x:c,y:l,type:`text`,...s,...t,text:n}),Object.assign(a,{x:t.x||e.x-a.width,y:t.y||e.y-a.height/2})}else switch(u){case`rectangle`:case`ellipse`:case`diamond`:a=ni({x:c,y:l,width:n,height:o,...s,...t,type:u});break;default:vs(e,`Unhandled element start type "${t.type}"`,!0)}ml(e,a,`start`,i)}}if(n){let t=n?.height??eE,a=n?.width??eE,s;n.id&&(s=r.getElement(n.id),s||console.error(`No element for end binding with id ${n.id} found`));let c=n.x||e.x+e.width,l=n.y||e.y-t/2,u=s?s.type:n.type;if(u){if(u===`text`){let t=``;s&&s.type===`text`?t=s.text:n.type===`text`&&(t=n.text),t||console.error(`No text found for end binding text element for ${e.id}`),o=yt({x:c,y:l,type:`text`,...s,...n,text:t}),Object.assign(o,{y:n.y||e.y-o.height/2})}else switch(u){case`rectangle`:case`ellipse`:case`diamond`:o=ni({x:c,y:l,width:a,height:t,...s,...n,type:u});break;default:vs(e,`Unhandled element end type "${u}"`,!0)}ml(e,o,`end`,i)}}if(e.points.length<2)return{linearElement:e,startBoundElement:a,endBoundElement:o};let s=e.points.length-1,c=.5,l=jn(e.points);return e.points[s][0]>e.points[s-1][0]&&(l[0][0]=c,l[s][0]-=c),e.points[s][0]<e.points[s-1][0]&&(l[0][0]=-c,l[s][0]+=c),e.points[s][1]>e.points[s-1][1]&&(l[0][1]=c,l[s][1]-=c),e.points[s][1]<e.points[s-1][1]&&(l[0][1]=-c,l[s][1]+=c),Object.assign(e,{points:l}),{linearElement:e,startBoundElement:a,endBoundElement:o}},rE=class{constructor(){C(this,`excalidrawElements`,new Map),C(this,`add`,e=>{e&&this.excalidrawElements.set(e.id,e)}),C(this,`getElements`,()=>eo(Array.from(this.excalidrawElements.values()))),C(this,`getElementsMap`,()=>Al(P(this.getElements()))),C(this,`getElement`,e=>this.excalidrawElements.get(e))}},iE=(e,t)=>{if(!e)return[];let n=jn(e),r=new rE,i=new Map,a=new Map;for(let e of n){let n,o=e.id;switch(t?.regenerateIds!==!1&&Object.assign(e,{id:Xc()}),e.type){case`rectangle`:case`ellipse`:case`diamond`:{let t=e?.label?.text&&e.width===void 0?0:e?.width||eE,r=e?.label?.text&&e.height===void 0?0:e?.height||eE;n=ni({...e,width:t,height:r});break}case`line`:{let t=e.width||$T.width,r=e.height||$T.height;n=lr({width:t,height:r,points:[I(0,0),I(t,r)],...e});break}case`arrow`:{let t=e.width||$T.width,r=e.height||$T.height;n=Fi({width:t,height:r,endArrowhead:`arrow`,points:[I(0,0),I(t,r)],...e,type:`arrow`}),Object.assign(n,qt(n.points));break}case`text`:{let t=e?.fontFamily||Ks,r=e?.fontSize||20,i=e?.lineHeight||mu(t),a=Nn(Hr(e.text??``),Cs({fontFamily:t,fontSize:r}),i);n=yt({width:a.width,height:a.height,fontFamily:t,fontSize:r,...e});break}case`image`:n=Vc({width:e?.width||eE,height:e?.height||eE,...e});break;case`frame`:n=os({x:0,y:0,...e});break;case`magicframe`:n=Mr({x:0,y:0,...e});break;case`freedraw`:case`iframe`:case`embeddable`:n=e;break;default:n=e,vs(e,`Unhandled element type "${e.type}"`,!0)}r.getElement(n.id)?console.error(`Duplicate id found for ${n.id}`):(r.add(n),i.set(n.id,e),o&&a.set(o,n.id))}let o=r.getElementsMap();for(let[e,t]of i){let n=r.getElement(e);switch(t.type){case`rectangle`:case`ellipse`:case`diamond`:case`arrow`:if(t.label?.text){let[e,i]=tE(n,t?.label,o);if(r.add(e),r.add(i),Lc(e)){let n=t.type===`arrow`?t?.start:void 0,i=t.type===`arrow`?t?.end:void 0;if(n&&n.id){let e=a.get(n.id);e&&Object.assign(n,{id:e})}if(i&&i.id){let e=a.get(i.id);e&&Object.assign(i,{id:e})}let{linearElement:s,startBoundElement:c,endBoundElement:l}=nE(e,n,i,r,o);e=s,r.add(s),r.add(c),r.add(l)}}else switch(t.type){case`arrow`:{let{start:e,end:i}=t;if(e&&e.id){let t=a.get(e.id);Object.assign(e,{id:t})}if(i&&i.id){let e=a.get(i.id);Object.assign(i,{id:e})}let{linearElement:s,startBoundElement:c,endBoundElement:l}=nE(n,e,i,r,o);r.add(s),r.add(c),r.add(l);break}}break}}for(let[e,t]of i){if(t.type!==`frame`&&t.type!==`magicframe`)continue;let n=r.getElement(e);if(!n)throw Error(`Excalidraw element with id ${e} doesn't exist`);let i=[];t.children.forEach(e=>{let t=a.get(e);if(!t)throw Error(`Element with ${e} wasn't mapped correctly`);let o=r.getElement(t);if(!o)throw Error(`Frame element with id ${t} doesn't exist`);Object.assign(o,{frameId:n.id}),o?.boundElements?.forEach(e=>{let t=r.getElement(e.id);if(!t)throw Error(`Bound element with id ${e.id} doesn't exist`);Object.assign(t,{frameId:n.id}),i.push(t)}),i.push(o)});let[o,s,c,l]=Ts(i);o-=10,s-=10,c+=10,l+=10;let u=n?.x||o,d=n?.y||s,f=n?.width||c-o,p=n?.height||l-s;Object.assign(n,{x:u,y:d,width:f,height:p}),Hi()&&t.children.length&&(n?.x||n?.y||n?.width||n?.height)&&console.info(`User provided frame attributes are being considered, if you find this inaccurate, please remove any of the attributes - x, y, width and height so frame coordinates and dimensions are calculated automatically`)}return r.getElements()},aE=e=>t=>{(0,vg.unstable_batchedUpdates)(e,t)},oE=e=>uc(t=>{(0,vg.unstable_batchedUpdates)(e,t)}),sE=(()=>{let e;try{let t=G.version.split(`.`);e=Number(t[0])>17}catch{e=!1}let t=!1;return()=>window.EXCALIDRAW_THROTTLE_RENDER===!0?e?!0:(t||(t=!0,console.warn(`Excalidraw: render throttling is disabled on React versions < 18.`)),!1):!1})(),cE=`#ff6b6b`,lE=`#ff0000`,uE=1,dE=2,fE=(e,t)=>{if(!t.snapLines.length)return;let n=t.theme===R.LIGHT||t.zenModeEnabled?cE:lE,r=(t.zenModeEnabled?uE*1.5:uE)/t.zoom.value;e.save(),e.translate(t.scrollX,t.scrollY);for(let i of t.snapLines)i.type===`pointer`?(e.lineWidth=r,e.strokeStyle=n,mE(i,e,t)):i.type===`gap`?(e.lineWidth=r,e.strokeStyle=n,_E(i.points[0],i.points[1],i.direction,t,e)):i.type===`points`&&(e.lineWidth=r,e.strokeStyle=n,pE(i,e,t));e.restore()},pE=(e,t,n)=>{if(!n.zenModeEnabled){let n=e.points[0],r=e.points[e.points.length-1];gE(n,r,t)}for(let r of e.points)hE(r,n,t)},mE=(e,t,n)=>{hE(e.points[0],n,t),n.zenModeEnabled||gE(e.points[0],e.points[1],t)},hE=([e,t],n,r)=>{r.save();let i=(n.zenModeEnabled?dE*1.5:dE)/n.zoom.value;r.beginPath(),r.moveTo(e-i,t-i),r.lineTo(e+i,t+i),r.moveTo(e+i,t-i),r.lineTo(e-i,t+i),r.stroke(),r.restore()},gE=(e,t,n)=>{n.beginPath(),n.lineTo(e[0],e[1]),n.lineTo(t[0],t[1]),n.stroke()},_E=(e,t,n,r,i)=>{let a=8/r.zoom.value,o=a/2,s=a/4;if(n===`horizontal`){let n=[(e[0]+t[0])/2,e[1]];r.zenModeEnabled||gE(I(e[0],e[1]-a),I(e[0],e[1]+a),i),gE(I(n[0]-s,n[1]-o),I(n[0]-s,n[1]+o),i),gE(I(n[0]+s,n[1]-o),I(n[0]+s,n[1]+o),i),r.zenModeEnabled||(gE(I(t[0],t[1]-a),I(t[0],t[1]+a),i),gE(e,t,i))}else{let n=[e[0],(e[1]+t[1])/2];r.zenModeEnabled||gE(I(e[0]-a,e[1]),I(e[0]+a,e[1]),i),gE(I(n[0]-o,n[1]-s),I(n[0]+o,n[1]-s),i),gE(I(n[0]-o,n[1]+s),I(n[0]+o,n[1]+s),i),r.zenModeEnabled||(gE(I(t[0]-a,t[1]),I(t[0]+a,t[1]),i),gE(e,t,i))}},vE=(e,t)=>{as(t.selectedLinearElement,`selectedLinearElement is null`);let{segmentMidPointHoveredCoords:n}=t.selectedLinearElement;as(n,`midPointCoords is null`),e.save(),e.translate(t.scrollX,t.scrollY),bE(n,e,t),e.restore()},yE=(e,t,n)=>{let{elementId:r,hoverPointIndex:i}=t.selectedLinearElement;if(t.editingLinearElement?.selectedPointsIndices?.includes(i))return;let a=F.getElement(r,n);if(!a)return;let o=F.getPointAtIndexGlobalCoordinates(a,i,n);e.save(),e.translate(t.scrollX,t.scrollY),bE(o,e,t),e.restore()},bE=(e,t,n)=>{t.fillStyle=`rgba(105, 101, 219, 0.4)`,bt(t,e[0],e[1],F.POINT_HANDLE_SIZE/n.zoom.value,!1)},xE=(e,t,n,r,i,a,o,s,c=!1,l=0)=>{e.save(),e.translate(a,o),e.rotate(s),c&&e.fillRect(t-a,n-o,r,i),l&&e.roundRect?(e.beginPath(),e.roundRect(t-a,n-o,r,i,l),e.stroke(),e.closePath()):e.strokeRect(t-a,n-o,r,i),e.restore()},SE=(e,t,n,r,i,a)=>{e.save(),e.translate(r,i),e.rotate(a),e.beginPath(),e.moveTo(0,n/2),e.lineTo(t/2,0),e.lineTo(0,-n/2),e.lineTo(-t/2,0),e.closePath(),e.stroke(),e.restore()},CE=(e,t,n,r,i,a=!1)=>{e.strokeStyle=`#5e5ad8`,e.setLineDash([]),e.fillStyle=`rgba(255, 255, 255, 0.9)`,i?e.fillStyle=`rgba(134, 131, 226, 0.9)`:a&&(e.fillStyle=`rgba(177, 151, 252, 0.7)`),bt(e,n[0],n[1],r/t.zoom.value,!a)},wE=(e,t,n,r,i,a)=>{e.beginPath(),e.ellipse(r,i,t/2,n/2,a,0,Math.PI*2),e.stroke()},TE=(e,t,n,r)=>{let[i,a,o,s]=Le(t,n),c=o-i,l=s-a;e.strokeStyle=`rgba(0,0,0,.05)`,e.lineWidth=10/(r.value<1?r.value:1);let u=e.lineWidth/2+4,d=xl(Math.min(t.width,t.height),t);switch(t.type){case`rectangle`:case`text`:case`image`:case`iframe`:case`embeddable`:case`frame`:case`magicframe`:xE(e,i-u,a-u,c+u*2,l+u*2,i+c/2,a+l/2,t.angle,void 0,d);break;case`diamond`:let n=Math.hypot(c,l),r=u*n/l,o=u*n/c;SE(e,c+r*2,l+o*2,i+c/2,a+l/2,t.angle);break;case`ellipse`:wE(e,c+u*2,l+u*2,i+c/2,a+l/2,t.angle);break}},EE=(e,t,n,r)=>{let[i,a,o]=t,s=Qo(o,o.width,o.height,r);e.strokeStyle=`rgba(0,0,0,0)`,e.fillStyle=`rgba(0,0,0,.05)`,(a===`both`?[0,-1]:a===`start`?[0]:[-1]).forEach(t=>{let[r,a]=F.getPointAtIndexGlobalCoordinates(i,t,n);bt(e,r,a,s)})},DE=(e,t,n)=>{let{angle:r,x1:i,y1:a,x2:o,y2:s,selectionColors:c,cx:l,cy:u,dashed:d,activeEmbeddable:f}=n,p=o-i,m=s-a,h=(n.padding??4)/t.zoom.value,g=8/t.zoom.value,_=4/t.zoom.value;e.save(),e.translate(t.scrollX,t.scrollY),e.lineWidth=(f?4:1)/t.zoom.value;let v=c.length;for(let t=0;t<v;++t)e.strokeStyle=c[t],d&&e.setLineDash([g,_+(g+_)*(v-1)]),e.lineDashOffset=(g+_)*t,xE(e,i-h,a-h,p+h*2,m+h*2,l,u,r);e.restore()},OE=(e,t,n,r)=>{let i=Array.isArray(n)?EE:TE;e.save(),e.translate(t.scrollX,t.scrollY),i(e,n,r,t.zoom),e.restore()},kE=(e,t,n,r)=>{let[i,a,o,s]=Le(n,r),c=o-i,l=s-a;e.strokeStyle=`rgb(0,118,255)`,e.lineWidth=Ue.strokeWidth/t.zoom.value,e.save(),e.translate(t.scrollX,t.scrollY),xE(e,i,a,c,l,i+c/2,a+l/2,n.angle,!1,Ue.radius/t.zoom.value),e.restore()},AE=(e,t,n)=>{let r=n.filter(e=>e.groupIds.length===0),i=n.filter(e=>e.groupIds.length>0),a=e=>{let[t,n,r,i]=Ts(e);return{angle:0,x1:t,x2:r,y1:n,y2:i,selectionColors:[`rgb(0,118,255)`],dashed:!1,cx:t+(r-t)/2,cy:n+(i-n)/2,activeEmbeddable:!1}},o=e=>a(jo(n,e));Object.entries(As(i,t)).filter(([e,t])=>t).map(([e,t])=>e).map(e=>o(e)).concat(r.map(e=>a([e]))).forEach(n=>DE(e,t,n))},jE=(e,t,n,r)=>{if(!t.selectedLinearElement)return;e.save(),e.translate(t.scrollX,t.scrollY),e.lineWidth=1/t.zoom.value;let i=F.getPointsGlobalCoordinates(n,r),{POINT_HANDLE_SIZE:a}=F,o=t.editingLinearElement?a:a/2;if(i.forEach((r,a)=>{B(n)&&a!==0&&a!==i.length-1||CE(e,t,r,o,!!t.editingLinearElement?.selectedPointsIndices?.includes(a))}),B(n)){let r=n.fixedSegments?.map(e=>e.index)||[];i.slice(0,-1).forEach((o,s)=>{F.isSegmentTooShort(n,i[s+1],i[s],s,t.zoom)||CE(e,t,I((o[0]+i[s+1][0])/2,(o[1]+i[s+1][1])/2),a/2,!1,!r.includes(s+1))})}else F.getEditorMidPoints(n,r,t).filter((e,t,r)=>e!==null&&!(B(n)&&(t===0||t===r.length-1))).forEach(n=>{(t.editingLinearElement||i.length===2)&&CE(e,t,n,a/2,!1,!0)});e.restore()},ME=(e,t,n,r,i)=>{Object.keys(r).forEach(a=>{let o=r[a];if(o!==void 0){let[r,s,c,l]=o;e.save(),e.lineWidth=1/n.zoom.value,t.selectionColor&&(e.strokeStyle=t.selectionColor),a===`rotation`?bt(e,r+c/2,s+l/2,c/2):e.roundRect?(e.beginPath(),e.roundRect(r,s,c,l,2/n.zoom.value),e.fill(),e.stroke()):xE(e,r,s,c,l,r+c/2,s+l/2,i,!0),e.restore()}})},NE=(e,t,n,r,i)=>{let[a,o,,,s,c]=Le(r,i),l=3/n.zoom.value,u=l/2,d=s-a+l,f=c-o+l,p=Math.min(20/n.zoom.value,d),m=Math.min(20/n.zoom.value,f);e.save(),e.fillStyle=t.selectionColor,e.strokeStyle=t.selectionColor,e.lineWidth=l,[[[-d,-f],[0,u],[p,u],[u,0],[u,m]],[[d-u,-f],[u,u],[-p+u,u],[0,0],[0,m]],[[-d,f],[0,-u],[p,-u],[u,0],[u,-m]],[[d-u,f],[u,-u],[-p+u,-u],[0,0],[0,-m]]].forEach(t=>{let[[n,i],[a,o],[l,u],[d,f],[p,m]]=t;e.save(),e.translate(s,c),e.rotate(r.angle),e.beginPath(),e.moveTo(n+a,i+o),e.lineTo(n+l,i+u),e.stroke(),e.beginPath(),e.moveTo(n+d,i+f),e.lineTo(n+p,i+m),e.stroke(),e.restore()}),e.restore()},PE=(e,t,n,r)=>{t.save();let i=4/n.zoom.value,a=e.width+i*2,o=e.height+i*2,s=e.x+a/2,c=e.y+o/2,l=-(a/2+i),u=-(o/2+i);t.translate(s+n.scrollX,c+n.scrollY),t.rotate(e.angle),t.lineWidth=1/n.zoom.value,t.strokeStyle=r,t.strokeRect(l,u,a,o),t.restore()},FE=({canvas:e,elementsMap:t,visibleElements:n,selectedElements:r,allElementsMap:i,scale:a,appState:o,renderConfig:s,device:c})=>{if(e===null)return{atLeastOneVisibleElement:!1,elementsMap:t};let[l,u]=ma(e,a),d=At({canvas:e,scale:a,normalizedWidth:l,normalizedHeight:u});d.save(),d.scale(o.zoom.value,o.zoom.value);let f;if(n.forEach(e=>{o.editingLinearElement?.elementId===e.id&&e&&(f=e)}),f&&jE(d,o,f,t),o.selectionElement&&!o.isCropping)try{rt(o.selectionElement,d,o,s.selectionColor)}catch(e){console.error(e)}if(o.editingTextElement&&H(o.editingTextElement)){let e=i.get(o.editingTextElement.id);e&&!e.autoResize&&PE(e,d,o,s.selectionColor)}o.isBindingEnabled&&o.suggestedBindings.filter(e=>e!=null).forEach(e=>{OE(d,o,e,t)}),o.frameToHighlight&&kE(d,o,o.frameToHighlight,t),o.elementsToHighlight&&AE(d,o,o.elementsToHighlight);let p=r.some(e=>M(e));if(r.length===1&&o.editingLinearElement?.elementId===r[0].id&&jE(d,o,r[0],t),B(r[0])&&o.selectedLinearElement&&o.selectedLinearElement.segmentMidPointHoveredCoords?vE(d,o):o.selectedLinearElement&&o.selectedLinearElement.hoverPointIndex>=0&&!(B(r[0])&&o.selectedLinearElement.hoverPointIndex>0&&o.selectedLinearElement.hoverPointIndex<r[0].points.length-1)&&yE(d,o,t),!o.multiElement&&!o.editingLinearElement){let e=Ec(r,o),n=r.length===1&&fc(r[0]);n&&o.selectedLinearElement?.elementId===r[0].id&&!r[0].locked&&jE(d,o,r[0],t);let i=s.selectionColor||qu.black;if(e){let e=P(r),a=[];for(let r of t.values()){let c=[],l=s.remoteSelectedElementIds.get(r.id);if(n&&B(r)&&(r.startBinding||r.endBinding)||(e.has(r.id)&&!od(o,r)&&c.push(i),l&&c.push(...l.map(e=>gy(e,o.collaborators.get(e))))),c.length){let[e,n,i,s,u,d]=Le(r,t,!0);a.push({angle:r.angle,x1:e,y1:n,x2:i,y2:s,selectionColors:c,dashed:!!l,cx:u,cy:d,activeEmbeddable:o.activeEmbeddable?.element===r&&o.activeEmbeddable.state===`active`,padding:r.id===o.croppingElementId||De(r)?0:void 0})}}let c=e=>{let[n,r,i,o]=Ts(jo(t,e));a.push({angle:0,x1:n,x2:i,y1:r,y2:o,selectionColors:[qu.black],dashed:!0,cx:n+(i-n)/2,cy:r+(o-r)/2,activeEmbeddable:!1})};for(let e of ki(o))c(e);o.editingGroupId&&c(o.editingGroupId),a.forEach(e=>DE(d,o,e))}if(d.save(),d.translate(o.scrollX,o.scrollY),r.length===1){d.fillStyle=qu.white;let n=$a(r[0],o.zoom,t,`mouse`,oa(c));if(!o.viewModeEnabled&&e&&!H(o.editingTextElement)&&!o.croppingElementId&&ME(d,s,o,n,r[0].angle),o.croppingElementId&&!o.isCropping){let e=t.get(o.croppingElementId);e&&De(e)&&NE(d,s,o,e,t)}}else if(r.length>1&&!o.isRotating){let e=4/o.zoom.value;d.fillStyle=qu.white;let[t,n,a,l]=Ts(r),u=d.getLineDash();d.setLineDash([2/o.zoom.value]);let f=d.lineWidth;d.lineWidth=1/o.zoom.value,d.strokeStyle=i,xE(d,t-e,n-e,a-t+e*2,l-n+e*2,(t+a)/2,(n+l)/2,0),d.lineWidth=f,d.setLineDash(u);let m=Hs([t,n,a,l,(t+a)/2,(n+l)/2],0,o.zoom,`mouse`,p?{...oa(c),rotation:!0}:oa(c));r.some(e=>!e.locked)&&ME(d,s,o,m,0)}d.restore()}o.searchMatches.forEach(({id:e,focus:n,matchedLines:r})=>{let i=t.get(e);if(i&&H(i)){let[e,a,,,s,c]=Le(i,t,!0);d.save(),o.theme===R.LIGHT?n?d.fillStyle=`rgba(255, 124, 0, 0.4)`:d.fillStyle=`rgba(255, 226, 0, 0.4)`:n?d.fillStyle=`rgba(229, 82, 0, 0.4)`:d.fillStyle=`rgba(99, 52, 0, 0.4)`,d.translate(o.scrollX,o.scrollY),d.translate(s,c),d.rotate(i.angle),r.forEach(t=>{d.fillRect(e+t.offsetX-s,a+t.offsetY-c,t.width,t.height)}),d.restore()}}),fE(d,o),d.restore(),vy({context:d,renderConfig:s,appState:o,normalizedWidth:l,normalizedHeight:u});let m;return s.renderScrollbars&&(m=tC(n,l,u,o),d.save(),d.fillStyle=eC,d.strokeStyle=`rgba(255,255,255,0.8)`,[m.horizontal,m.vertical].forEach(e=>{e&&my(d,e.x,e.y,e.width,e.height,$S/2)}),d.restore()),{scrollBars:m,atLeastOneVisibleElement:n.length>0,elementsMap:t}},IE=uc(e=>{let t=FE(e);e.callback?.(t)},{trailing:!0}),LE=(e,t)=>{if(t){IE(e);return}let n=FE(e);return e.callback(n),n},RE=e=>{let t=(0,G.useRef)(!1);return(0,G.useEffect)(()=>{if(!t.current){t.current=!0;return}let n=new Map,r=new Map,i=new Map,a=new Map,o=new Map;e.appState.collaborators.forEach((t,s)=>{if(t.selectedElementIds)for(let e of Object.keys(t.selectedElementIds))i.has(e)||i.set(e,[]),i.get(e).push(s);!t.pointer||t.pointer.renderCursor===!1||(t.username&&a.set(s,t.username),t.userState&&o.set(s,t.userState),r.set(s,ga({sceneX:t.pointer.x,sceneY:t.pointer.y},e.appState)),n.set(s,t.button))});let s=e.containerRef?.current&&getComputedStyle(e.containerRef.current).getPropertyValue(`--color-selection`)||`#6965db`;LE({canvas:e.canvas,elementsMap:e.elementsMap,visibleElements:e.visibleElements,selectedElements:e.selectedElements,allElementsMap:e.allElementsMap,scale:window.devicePixelRatio,appState:e.appState,renderConfig:{remotePointerViewportCoords:r,remotePointerButton:n,remoteSelectedElementIds:i,remotePointerUsernames:a,remotePointerUserStates:o,selectionColor:s,renderScrollbars:!1},device:e.device,callback:e.renderInteractiveSceneCallback},sE())}),(0,K.jsx)(`canvas`,{className:`excalidraw__canvas interactive`,style:{width:e.appState.width,height:e.appState.height,cursor:e.appState.viewModeEnabled?T.GRAB:T.AUTO},width:e.appState.width*e.scale,height:e.appState.height*e.scale,ref:e.handleCanvasRef,onContextMenu:e.onContextMenu,onPointerMove:e.onPointerMove,onPointerUp:e.onPointerUp,onPointerCancel:e.onPointerCancel,onTouchMove:e.onTouchMove,onPointerDown:e.onPointerDown,onDoubleClick:e.appState.viewModeEnabled?void 0:e.onDoubleClick,children:q(`labels.drawingCanvas`)})},zE=e=>({zoom:e.zoom,scrollX:e.scrollX,scrollY:e.scrollY,width:e.width,height:e.height,viewModeEnabled:e.viewModeEnabled,openDialog:e.openDialog,editingGroupId:e.editingGroupId,editingLinearElement:e.editingLinearElement,selectedElementIds:e.selectedElementIds,frameToHighlight:e.frameToHighlight,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,theme:e.theme,pendingImageElementId:e.pendingImageElementId,selectionElement:e.selectionElement,selectedGroupIds:e.selectedGroupIds,selectedLinearElement:e.selectedLinearElement,multiElement:e.multiElement,isBindingEnabled:e.isBindingEnabled,suggestedBindings:e.suggestedBindings,isRotating:e.isRotating,elementsToHighlight:e.elementsToHighlight,collaborators:e.collaborators,activeEmbeddable:e.activeEmbeddable,snapLines:e.snapLines,zenModeEnabled:e.zenModeEnabled,editingTextElement:e.editingTextElement,isCropping:e.isCropping,croppingElementId:e.croppingElementId,searchMatches:e.searchMatches}),BE=G.memo(RE,(e,t)=>e.selectionNonce!==t.selectionNonce||e.sceneNonce!==t.sceneNonce||e.scale!==t.scale||e.elementsMap!==t.elementsMap||e.visibleElements!==t.visibleElements||e.selectedElements!==t.selectedElements?!1:ca(zE(e.appState),zE(t.appState))),VE=e=>{let t=(0,G.useRef)(null),n=(0,G.useRef)(!1);return(0,G.useEffect)(()=>{let r=t.current;if(!r)return;let i=e.canvas;n.current||(n.current=!0,r.replaceChildren(i),i.classList.add(`excalidraw__canvas`,`static`));let a=`${e.appState.width}px`,o=`${e.appState.height}px`;i.style.width!==a&&(i.style.width=a),i.style.height!==o&&(i.style.height=o);let s=e.appState.width*e.scale,c=e.appState.height*e.scale;i.width!==s&&(i.width=s),i.height!==c&&(i.height=c),fn({canvas:i,rc:e.rc,scale:e.scale,elementsMap:e.elementsMap,allElementsMap:e.allElementsMap,visibleElements:e.visibleElements,appState:e.appState,renderConfig:e.renderConfig},sE())}),(0,K.jsx)(`div`,{className:`excalidraw__canvas-wrapper`,ref:t})},HE=e=>({zoom:e.zoom,scrollX:e.scrollX,scrollY:e.scrollY,width:e.width,height:e.height,viewModeEnabled:e.viewModeEnabled,openDialog:e.openDialog,hoveredElementIds:e.hoveredElementIds,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,theme:e.theme,pendingImageElementId:e.pendingImageElementId,shouldCacheIgnoreZoom:e.shouldCacheIgnoreZoom,viewBackgroundColor:e.viewBackgroundColor,exportScale:e.exportScale,selectedElementsAreBeingDragged:e.selectedElementsAreBeingDragged,gridSize:e.gridSize,gridStep:e.gridStep,frameRendering:e.frameRendering,selectedElementIds:e.selectedElementIds,frameToHighlight:e.frameToHighlight,editingGroupId:e.editingGroupId,currentHoveredFontFamily:e.currentHoveredFontFamily,croppingElementId:e.croppingElementId}),UE=G.memo(VE,(e,t)=>e.sceneNonce!==t.sceneNonce||e.scale!==t.scale||e.elementsMap!==t.elementsMap||e.visibleElements!==t.visibleElements?!1:ca(HE(e.appState),HE(t.appState))&&ca(e.renderConfig,t.renderConfig)),WE=class{constructor(e){C(this,`scene`),C(this,`getRenderableElements`,(()=>{let e=({elementsMap:e,zoom:t,offsetLeft:n,offsetTop:r,scrollX:i,scrollY:a,height:o,width:s})=>{let c=[];for(let l of e.values())Ku(l,s,o,{zoom:t,offsetLeft:n,offsetTop:r,scrollX:i,scrollY:a},e)&&c.push(l);return c},t=({elements:e,editingTextElement:t,newElementId:n,pendingImageElementId:r})=>{let i=Al(new Map);for(let a of e)De(a)&&r===a.id||n!==a.id&&(!t||t.type!==`text`||a.id!==t.id)&&i.set(a.id,a);return i};return Ns(({zoom:n,offsetLeft:r,offsetTop:i,scrollX:a,scrollY:o,height:s,width:c,editingTextElement:l,newElementId:u,pendingImageElementId:d,sceneNonce:f})=>{let p=t({elements:this.scene.getNonDeletedElements(),editingTextElement:l,newElementId:u,pendingImageElementId:d});return{elementsMap:p,visibleElements:e({elementsMap:p,zoom:n,offsetLeft:r,offsetTop:i,scrollX:a,scrollY:o,height:s,width:c})}})})()),this.scene=e}destroy(){IE.cancel(),fd.cancel(),this.getRenderableElements.clear()}},GE=({trails:e})=>{let t=(0,G.useRef)(null);return(0,G.useEffect)(()=>{if(t.current)for(let n of e)n.start(t.current);return()=>{for(let t of e)t.stop()}},e),(0,K.jsx)(`div`,{className:`SVGLayer`,children:(0,K.jsx)(`svg`,{ref:t})})},KE=5,qE=(e,t,n)=>{let[r,i]=Le(e,n),{x:a,y:o}=ga({sceneX:r+e.width,sceneY:i},t);return{x:a-t.offsetLeft+10,y:o-t.offsetTop}},JE=({children:e,element:t,elementsMap:n})=>{let r=CD();if(r.contextMenu||r.newElement||r.resizingElement||r.isRotating||r.openMenu||r.viewModeEnabled)return null;let{x:i,y:a}=qE(t,r,n);return(0,K.jsx)(`div`,{className:`excalidraw-canvas-buttons`,style:{top:`${a}px`,left:`${i}px`,padding:KE},children:e})},YE=`small`,XE=e=>(0,K.jsxs)(`label`,{className:L(`ToolIcon ToolIcon__MagicButton`,`ToolIcon_size_${YE}`,{"is-mobile":e.isMobile}),title:`${e.title}`,children:[(0,K.jsx)(`input`,{className:`ToolIcon_type_checkbox`,type:`checkbox`,name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title}),(0,K.jsx)(`div`,{className:`ToolIcon__icon`,children:e.icon})]}),ZE=({height:e,width:t,userToFollow:n,onDisconnect:r})=>(0,K.jsx)(`div`,{className:`follow-mode`,style:{width:t,height:e},children:(0,K.jsxs)(`div`,{className:`follow-mode__badge`,children:[(0,K.jsxs)(`div`,{className:`follow-mode__badge__label`,children:[`Following`,` `,(0,K.jsx)(`span`,{className:`follow-mode__badge__username`,title:n.username,children:n.username})]}),(0,K.jsx)(`button`,{type:`button`,onClick:r,className:`follow-mode__disconnect-btn`,children:Ll})]})}),QE=class{constructor(){C(this,`targets`,new WeakMap),C(this,`rafIds`,new WeakMap)}register(e,t){this.targets.set(e,{callback:t,stopped:!0})}start(e){let t=this.targets.get(e);t&&(this.rafIds.has(e)||(this.targets.set(e,{...t,stopped:!1}),this.scheduleFrame(e)))}stop(e){let t=this.targets.get(e);t&&!t.stopped&&this.targets.set(e,{...t,stopped:!0}),this.cancelFrame(e)}constructFrame(e){return t=>{let n=this.targets.get(e);if(!n)return;let r=this.onFrame(n,t);!n.stopped&&!r?this.scheduleFrame(e):this.cancelFrame(e)}}scheduleFrame(e){let t=requestAnimationFrame(this.constructFrame(e));this.rafIds.set(e,t)}cancelFrame(e){if(this.rafIds.has(e)){let t=this.rafIds.get(e);cancelAnimationFrame(t)}this.rafIds.delete(e)}onFrame(e,t){return e.callback(t)??!1}},$E=class{constructor(e,t,n){this.animationFrameHandler=e,this.app=t,this.options=n,C(this,`currentTrail`),C(this,`pastTrails`,[]),C(this,`container`),C(this,`trailElement`),this.animationFrameHandler.register(this,this.onFrame.bind(this)),this.trailElement=document.createElementNS(sr,`path`)}get hasCurrentTrail(){return!!this.currentTrail}hasLastPoint(e,t){if(this.currentTrail){let n=this.currentTrail.originalPoints.length;return this.currentTrail.originalPoints[n-1][0]===e&&this.currentTrail.originalPoints[n-1][1]===t}return!1}start(e){e&&(this.container=e),this.trailElement.parentNode!==this.container&&this.container&&this.container.appendChild(this.trailElement),this.animationFrameHandler.start(this)}stop(){this.animationFrameHandler.stop(this),this.trailElement.parentNode===this.container&&this.container?.removeChild(this.trailElement)}startPath(e,t){this.currentTrail=new ug(this.options),this.currentTrail.addPoint([e,t,performance.now()]),this.update()}addPointToPath(e,t){this.currentTrail&&(this.currentTrail.addPoint([e,t,performance.now()]),this.update())}endPath(){this.currentTrail&&(this.currentTrail.close(),this.currentTrail.options.keepHead=!1,this.pastTrails.push(this.currentTrail),this.currentTrail=void 0,this.update())}update(){this.start()}onFrame(){let e=[];for(let t of this.pastTrails)e.push(this.drawTrail(t,this.app.state));if(this.currentTrail){let t=this.drawTrail(this.currentTrail,this.app.state);e.push(t)}this.pastTrails=this.pastTrails.filter(e=>e.getStrokeOutline().length!==0),e.length===0&&this.stop();let t=e.join(` `).trim();this.trailElement.setAttribute(`d`,t),this.trailElement.setAttribute(`fill`,(this.options.fill??(()=>`black`))(this))}drawTrail(e,t){return Tt(e.getStrokeOutline(e.options.size/t.zoom.value).map(([e,n])=>{let r=ga({sceneX:e,sceneY:n},t);return[r.x,r.y]}),!0)}},eD=class{constructor(e,t){this.animationFrameHandler=e,this.app=t,C(this,`localTrail`),C(this,`collabTrails`,new Map),C(this,`container`),this.animationFrameHandler.register(this,this.onFrame.bind(this)),this.localTrail=new $E(e,t,{...this.getTrailOptions(),fill:()=>`red`})}getTrailOptions(){return{simplify:0,streamline:.4,sizeMapping:e=>{let t=Math.max(0,1-(performance.now()-e.pressure)/1e3),n=(50-Math.min(50,e.totalLength-e.currentIndex))/50;return Math.min(du(n),du(t))}}}startPath(e,t){this.localTrail.startPath(e,t)}addPointToPath(e,t){this.localTrail.addPointToPath(e,t)}endPath(){this.localTrail.endPath()}start(e){this.container=e,this.animationFrameHandler.start(this),this.localTrail.start(e)}stop(){this.animationFrameHandler.stop(this),this.localTrail.stop()}onFrame(){this.updateCollabTrails()}updateCollabTrails(){if(!(!this.container||this.app.state.collaborators.size===0)){for(let[e,t]of this.app.state.collaborators.entries()){let n;this.collabTrails.has(e)?n=this.collabTrails.get(e):(n=new $E(this.animationFrameHandler,this.app,{...this.getTrailOptions(),fill:()=>t.pointer?.laserColor||gy(e,t)}),n.start(this.container),this.collabTrails.set(e,n)),t.pointer&&t.pointer.tool===`laser`&&(t.button===`down`&&!n.hasCurrentTrail&&n.startPath(t.pointer.x,t.pointer.y),t.button===`down`&&n.hasCurrentTrail&&!n.hasLastPoint(t.pointer.x,t.pointer.y)&&n.addPointToPath(t.pointer.x,t.pointer.y),t.button===`up`&&n.hasCurrentTrail&&(n.addPointToPath(t.pointer.x,t.pointer.y),n.endPath()))}for(let e of this.collabTrails.keys())this.app.state.collaborators.has(e)||(this.collabTrails.get(e).stop(),this.collabTrails.delete(e))}}},tD=(e,t,n,r,i,a)=>{let{zoom:o}=r,s=180*n/Math.PI,c=e*(o.value-1)/2,l=t*(o.value-1)/2;return e>i&&o.value!==1&&(c=i*(o.value-1)/2),t>a&&o.value!==1&&(l=a*(o.value-1)/2),`translate(${c}px, ${l}px) scale(${o.value}) rotate(${s}deg)`},nD=({id:e,onChange:t,onSubmit:n,getViewportCoords:r,element:i,canvas:a,excalidrawContainer:o,app:s,autoSelect:c=!0})=>{let l=(e,t)=>{if(!t.style.fontFamily||!t.style.fontSize)return!1;let n=t.style.fontFamily.replace(/"/g,``);return Ql({fontFamily:e.fontFamily})!==n||`${e.fontSize}px`!==t.style.fontSize},u=()=>{let t=s.state,n=Zs.getScene(i)?.getElement(e);if(!n)return;let{textAlign:a,verticalAlign:o}=n,c=s.scene.getNonDeletedElementsMap();if(n&&H(n)){let e=n.x,i=n.y,u=ai(n,s.scene.getNonDeletedElementsMap()),f=n.width,p=n.height,m=n.width,h=n.height;if(u&&n.containerId){if(Lc(u)){let t=F.getBoundTextElementPosition(u,n,c);e=t.x,i=t.y}let t=l(n,d),r;if(t?r=Ur(u.id,u.height):(r=gi[u.id],r||=Ur(u.id,u.height)),m=ke(u,n),h=Nu(u,n),!Lc(u)&&p>h){W(u,{height:Lu(p,u.type)});return}else if(!Lc(u)&&u.height>r.height&&p<h)W(u,{height:Lu(p,u.type)});else{let{y:e}=Vr(u,n,c);i=e}}let[g,_]=r(e,i),v=d.selectionStart,y=d.selectionEnd,b=d.value.length;if(v===y&&y!==b){let e=b-y;d.selectionStart=d.value.length-e,d.selectionEnd=d.value.length-e}u?f+=.5:(m=(t.width-8-g)/t.zoom.value,f=Math.min(f,m)),p*=1.05;let x=Cs(n),S=(t.height-_)/t.zoom.value;Object.assign(d.style,{font:x,lineHeight:n.lineHeight,width:`${f}px`,height:`${p}px`,left:`${g}px`,top:`${_}px`,transform:tD(f,p,mi(n,u),t,m,S),textAlign:a,verticalAlign:o,color:n.strokeColor,opacity:n.opacity/100,filter:`var(--theme-filter)`,maxHeight:`${S}px`}),d.scrollTop=0,Nt()&&(d.style.fontFamily=Ql(n)),W(n,{x:e,y:i})}},d=document.createElement(`textarea`);d.dir=`auto`,d.tabIndex=0,d.dataset.type=`wysiwyg`,d.wrap=`off`,d.classList.add(`excalidraw-wysiwyg`);let f=`pre`,p=`normal`;(Ba(i)||!i.autoResize)&&(f=`pre-wrap`,p=`break-word`),Object.assign(d.style,{position:`absolute`,display:`inline-block`,minHeight:`1em`,backfaceVisibility:`hidden`,margin:0,padding:0,border:0,outline:0,resize:`none`,background:`transparent`,overflow:`hidden`,zIndex:`var(--zIndex-wysiwyg)`,wordBreak:p,whiteSpace:f,overflowWrap:`break-word`,boxSizing:`content-box`}),d.value=i.originalText,u(),t&&(d.onpaste=async e=>{let t=await di(e,!0);if(!t.text)return;let n=Hr(t.text);if(!n)return;let r=ai(i,s.scene.getNonDeletedElementsMap()),a=Cs({fontSize:s.state.currentItemFontSize,fontFamily:s.state.currentItemFontFamily});if(r){let e=w(r,s.scene.getNonDeletedElementsMap()),t=$l(Ps(`${d.value}${n}`,a,ke(r,e)),a);d.style.width=`${t}px`}},d.oninput=()=>{let e=Hr(d.value);if(d.value!==e){let t=d.selectionStart;d.value=e,d.selectionStart=t,d.selectionEnd=t}t(d.value)}),d.onkeydown=e=>{if(!e.shiftKey&&Iv.keyTest(e))e.preventDefault(),s.actionManager.executeAction(Iv),u();else if(!e.shiftKey&&Lv.keyTest(e))e.preventDefault(),s.actionManager.executeAction(Lv),u();else if(!e.shiftKey&&Rv.keyTest(e))e.preventDefault(),s.actionManager.executeAction(Rv),u();else if(Dv.keyTest(e))s.actionManager.executeAction(Dv);else if(Ov.keyTest(e))s.actionManager.executeAction(Ov);else if(e.key===D.ESCAPE)e.preventDefault(),b=!0,x();else if(e.key===D.ENTER&&e[D.CTRL_OR_CMD]){if(e.preventDefault(),e.isComposing||e.keyCode===229)return;b=!0,x()}else if(e.key===D.TAB||e[D.CTRL_OR_CMD]&&(e.code===E.BRACKET_LEFT||e.code===E.BRACKET_RIGHT)){if(e.preventDefault(),e.isComposing)return;e.shiftKey||e.code===E.BRACKET_LEFT?_():g(),d.dispatchEvent(new Event(`input`))}};let m=` `.repeat(4),h=RegExp(`^ {1,4}`),g=()=>{let{selectionStart:e,selectionEnd:t}=d,n=v(),r=d.value;n.forEach(e=>{r=`${r.slice(0,e)}${m}${r.slice(e)}`}),d.value=r,d.selectionStart=e+4,d.selectionEnd=t+4*n.length},_=()=>{let{selectionStart:e,selectionEnd:t}=d,n=v(),r=[],i=d.value;n.forEach(e=>{let t=i.slice(e,e+4).match(h);t&&(i=`${i.slice(0,e)}${i.slice(e+t[0].length)}`,r.push(e))}),d.value=i,r.length&&(e>r[r.length-1]?d.selectionStart=Math.max(e-4,r[r.length-1]):d.selectionStart=e,d.selectionEnd=Math.max(d.selectionStart,t-4*r.length))},v=()=>{let{selectionStart:e,selectionEnd:t,value:n}=d,r=n.slice(0,e).match(/[^\n]*$/)[0].length;return e-=r,n.slice(e,t).split(`
`).reduce((t,n,r,i)=>t.concat(r?t[r-1]+i[r-1].length+1:e),[]).reverse()},y=e=>{e.target instanceof HTMLCanvasElement&&(e.preventDefault(),e.stopPropagation())},b=!1,x=()=>{if(ae)return;ae=!0,S();let e=Zs.getScene(i)?.getElement(i.id);if(!e)return;let t=ai(e,s.scene.getNonDeletedElementsMap());if(t){if(d.value.trim()){let e=ir(t);!e||e!==i.id?W(t,{boundElements:(t.boundElements||[]).concat({type:`text`,id:i.id})}):Lc(t)&&no(t)}else W(t,{boundElements:t.boundElements?.filter(e=>!H(e))});pu(e,t,s.scene.getNonDeletedElementsMap())}n({viaKeyboard:b,nextOriginalText:d.value})},S=()=>{d.onblur=null,d.oninput=null,d.onkeydown=null,oe&&oe.disconnect(),window.removeEventListener(`resize`,u),window.removeEventListener(`wheel`,y,!0),window.removeEventListener(`pointerdown`,ne),window.removeEventListener(`pointerup`,ee),window.removeEventListener(`blur`,x),window.removeEventListener(`beforeunload`,x),re(),ie(),d.remove()},ee=e=>{window.removeEventListener(`pointerup`,ee);let t=e?.target,n=t instanceof HTMLElement&&t.classList.contains(`properties-trigger`);setTimeout(()=>{d.onblur=x,n||d.focus()})},te=()=>{d.onblur=null,window.addEventListener(`pointerup`,ee),window.addEventListener(`blur`,x)},ne=e=>{let t=e?.target;if(e.button===Tr.WHEEL){t instanceof HTMLTextAreaElement&&(e.preventDefault(),s.handleCanvasPanUsingWheelOrSpaceDrag(e)),te();return}let n=t instanceof HTMLElement&&t.classList.contains(`properties-trigger`);(e.target instanceof HTMLElement||e.target instanceof SVGElement)&&e.target.closest(`.${bi.SHAPE_ACTIONS_MENU}, .${bi.ZOOM_ACTIONS}`)&&!su(e.target)||n?te():e.target instanceof HTMLCanvasElement&&!Nt()&&requestAnimationFrame(()=>{x()})},re=s.scene.onUpdate(()=>{u(),document.activeElement?.closest(`.properties-content`)||d.focus()}),ie=s.onScrollChangeEmitter.on(()=>{u()}),ae=!1;c&&d.select(),ee();let oe=null;a&&`ResizeObserver`in window?(oe=new window.ResizeObserver(()=>{u()}),oe.observe(a)):window.addEventListener(`resize`,u),d.onpointerdown=e=>e.stopPropagation(),requestAnimationFrame(()=>{window.addEventListener(`pointerdown`,ne,{capture:!0})}),window.addEventListener(`beforeunload`,x),o?.querySelector(`.excalidraw-textEditorContainer`).appendChild(d)},rD=j({name:`autoResize`,label:`labels.autoResize`,icon:null,trackEvent:{category:`element`},predicate:(e,t,n,r)=>{let i=V(e,t);return i.length===1&&H(i[0])&&!i[0].autoResize},perform:(e,t,n,r)=>{let i=V(e,t);return{appState:t,elements:e.map(e=>{if(e.id===i[0].id&&H(e)){let t=Nn(e.originalText,Cs(e),e.lineHeight);return A(e,{autoResize:!0,width:t.width,height:t.height,text:e.originalText})}return e}),captureUpdate:N.IMMEDIATELY}}}),iD=e=>RegExp(`^(?:%%{.*?}%%[\\s\\n]*)?\\b(?:${[`flowchart`,`graph`,`sequenceDiagram`,`classDiagram`,`stateDiagram`,`stateDiagram-v2`,`erDiagram`,`journey`,`gantt`,`pie`,`quadrantChart`,`requirementDiagram`,`gitGraph`,`C4Context`,`mindmap`,`timeline`,`zenuml`,`sankey`,`xychart`,`block`].map(e=>`\\s*${e}(-beta)?`).join(`|`)})\\b`).test(e.trim()),aD=({canvas:e,rc:t,newElement:n,elementsMap:r,allElementsMap:i,scale:a,appState:o,renderConfig:s})=>{if(e){let[c,l]=ma(e,a),u=At({canvas:e,scale:a,normalizedWidth:c,normalizedHeight:l});u.save(),u.scale(o.zoom.value,o.zoom.value),n&&n.type!==`selection`?rc(n,r,i,t,u,s,o):u.clearRect(0,0,c,l)}},oD=uc(e=>{aD(e)},{trailing:!0}),sD=(e,t)=>{if(t){oD(e);return}aD(e)},cD=e=>{let t=(0,G.useRef)(null);return(0,G.useEffect)(()=>{t.current&&sD({canvas:t.current,scale:e.scale,newElement:e.appState.newElement,elementsMap:e.elementsMap,allElementsMap:e.allElementsMap,rc:e.rc,renderConfig:e.renderConfig,appState:e.appState},sE())}),(0,K.jsx)(`canvas`,{className:`excalidraw__canvas`,style:{width:e.appState.width,height:e.appState.height},width:e.appState.width*e.scale,height:e.appState.height*e.scale,ref:t})},lD=G.createContext(null),uD=G.createContext(null),dD={viewport:{isMobile:!1,isLandscape:!1},editor:{isMobile:!1,canFitSidebar:!1},isTouchScreen:!1},fD=G.createContext(dD);fD.displayName=`DeviceContext`;var pD=G.createContext({container:null,id:null});pD.displayName=`ExcalidrawContainerContext`;var mD=G.createContext([]);mD.displayName=`ExcalidrawElementsContext`;var hD=G.createContext({...Ii(),width:0,height:0,offsetLeft:0,offsetTop:0});hD.displayName=`ExcalidrawAppStateContext`;var gD=G.createContext(()=>{console.warn(`Uninitialized ExcalidrawSetAppStateContext context!`)});gD.displayName=`ExcalidrawSetAppStateContext`;var _D=G.createContext(null);_D.displayName=`ExcalidrawActionManagerContext`;var vD=()=>(0,G.useContext)(lD),yD=()=>(0,G.useContext)(uD),bD=()=>(0,G.useContext)(fD),xD=()=>(0,G.useContext)(pD),SD=()=>(0,G.useContext)(mD),CD=()=>(0,G.useContext)(hD),wD=()=>(0,G.useContext)(gD),TD=()=>(0,G.useContext)(_D),ED=!1,DD=0,OD=!1,kD=!1,AD=!1,jD={horizontal:null,vertical:null},MD=0,ND=!1,PD=new Map,FD=!1,ID=0,LD=!1,RD=null,$={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},zD=class e extends G.Component{constructor(t){super(t),C(this,`canvas`),C(this,`interactiveCanvas`,null),C(this,`rc`),C(this,`unmounted`,!1),C(this,`actionManager`),C(this,`device`,dD),C(this,`excalidrawContainerRef`,G.createRef()),C(this,`scene`),C(this,`fonts`),C(this,`renderer`),C(this,`visibleElements`),C(this,`resizeObserver`),C(this,`nearestScrollableContainer`),C(this,`library`),C(this,`libraryItemsFromStorage`),C(this,`id`),C(this,`store`),C(this,`history`),C(this,`excalidrawContainerValue`),C(this,`files`,{}),C(this,`imageCache`,new Map),C(this,`iFrameRefs`,new Map),C(this,`embedsValidationStatus`,new Map),C(this,`initializedEmbeds`,new Set),C(this,`elementsPendingErasure`,new Set),C(this,`flowChartCreator`,new WS),C(this,`flowChartNavigator`,new US),C(this,`hitLinkElement`),C(this,`lastPointerDownEvent`,null),C(this,`lastPointerUpEvent`,null),C(this,`lastPointerMoveEvent`,null),C(this,`lastPointerMoveCoords`,null),C(this,`lastViewportPosition`,{x:0,y:0}),C(this,`animationFrameHandler`,new QE),C(this,`laserTrails`,new eD(this.animationFrameHandler,this)),C(this,`eraserTrail`,new $E(this.animationFrameHandler,this,{streamline:.2,size:5,keepHead:!0,sizeMapping:e=>{let t=Math.max(0,1-(performance.now()-e.pressure)/200),n=(10-Math.min(10,e.totalLength-e.currentIndex))/10;return Math.min(du(n),du(t))},fill:()=>this.state.theme===R.LIGHT?`rgba(0, 0, 0, 0.2)`:`rgba(255, 255, 255, 0.2)`})),C(this,`onChangeEmitter`,new nn),C(this,`onPointerDownEmitter`,new nn),C(this,`onPointerUpEmitter`,new nn),C(this,`onUserFollowEmitter`,new nn),C(this,`onScrollChangeEmitter`,new nn),C(this,`missingPointerEventCleanupEmitter`,new nn),C(this,`onRemoveEventListenersEmitter`,new nn),C(this,`getEffectiveGridSize`,()=>Oo(this)?this.state.gridSize:null),C(this,`updateEmbedValidationStatus`,(e,t)=>{this.embedsValidationStatus.set(e.id,t),We.delete(e)}),C(this,`updateEmbeddables`,()=>{let e=new Set,t=!1;this.scene.getNonDeletedElements().filter(n=>{if(Fn(n)){if(e.add(n.id),!this.embedsValidationStatus.has(n.id)){t=!0;let e=mr(n.link,this.props.validateEmbeddable);this.updateEmbedValidationStatus(n,e)}}else Xl(n)&&e.add(n.id);return!1}),t&&this.scene.triggerUpdate(),this.iFrameRefs.forEach((t,n)=>{e.has(n)||this.iFrameRefs.delete(n)})}),C(this,`getFrameNameDOMId`,e=>`${this.id}-frame-name-${e.id}`),C(this,`frameNameBoundsCache`,{get:e=>{let t=this.frameNameBoundsCache._cache.get(e.id);if(!t||t.zoom!==this.state.zoom.value||t.versionNonce!==e.versionNonce){let n=document.getElementById(this.getFrameNameDOMId(e));if(n){let r=n.getBoundingClientRect(),i=Fs({clientX:r.x,clientY:r.y},this.state),a=Fs({clientX:r.right,clientY:r.bottom},this.state);return t={x:i.x,y:i.y,width:a.x-i.x,height:a.y-i.y,angle:0,zoom:this.state.zoom.value,versionNonce:e.versionNonce},this.frameNameBoundsCache._cache.set(e.id,t),t}return null}return t},_cache:new Map}),C(this,`resetEditingFrame`,e=>{e&&W(e,{name:e.name?.trim()||null}),this.setState({editingFrame:null})}),C(this,`renderFrameNames`,()=>{if(!this.state.frameRendering.enabled||!this.state.frameRendering.name)return this.state.editingFrame&&this.resetEditingFrame(null),null;let e=this.state.theme===R.DARK;return this.scene.getNonDeletedFramesLikes().map(t=>{if(!Ku(t,this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap()))return this.state.editingFrame===t.id&&this.resetEditingFrame(t),null;let{x:n,y:r}=ga({sceneX:t.x,sceneY:t.y},this.state),i,a=vi(t);if(t.id===this.state.editingFrame){let r=a;i=(0,K.jsx)(`input`,{autoFocus:!0,value:r,onChange:e=>{W(t,{name:e.target.value})},onFocus:e=>e.target.select(),onBlur:()=>this.resetEditingFrame(t),onKeyDown:e=>{(e.key===D.ESCAPE||e.key===D.ENTER)&&this.resetEditingFrame(t)},style:{background:this.state.viewBackgroundColor,filter:e?vo:`none`,zIndex:2,border:`none`,display:`block`,padding:`6px`,borderRadius:4,boxShadow:`inset 0 0 0 1px var(--color-primary)`,fontFamily:`Assistant`,fontSize:`14px`,transform:`translate(-6px, 6px)`,color:`var(--color-gray-80)`,overflow:`hidden`,maxWidth:`${document.body.clientWidth-n-6}px`},size:r.length+1||1,dir:`auto`,autoComplete:`off`,autoCapitalize:`off`,autoCorrect:`off`})}else i=a;return(0,K.jsx)(`div`,{id:this.getFrameNameDOMId(t),style:{position:`absolute`,bottom:`${this.state.height+Ue.nameOffsetY-r+this.state.offsetTop}px`,left:`${n-this.state.offsetLeft}px`,zIndex:2,fontSize:Ue.nameFontSize,color:e?Ue.nameColorDarkTheme:Ue.nameColorLightTheme,lineHeight:Ue.nameLineHeight,width:`max-content`,maxWidth:`${t.width}px`,overflow:t.id===this.state.editingFrame?`visible`:`hidden`,whiteSpace:`nowrap`,textOverflow:`ellipsis`,cursor:T.MOVE,pointerEvents:this.state.viewModeEnabled?Zu.disabled:Zu.enabled},onPointerDown:e=>this.handleCanvasPointerDown(e),onWheel:e=>this.handleWheel(e),onContextMenu:this.handleCanvasContextMenu,onDoubleClick:()=>{this.setState({editingFrame:t.id})},children:i},t.id)})}),C(this,`focusContainer`,()=>{this.excalidrawContainerRef.current?.focus()}),C(this,`getSceneElementsIncludingDeleted`,()=>this.scene.getElementsIncludingDeleted()),C(this,`getSceneElements`,()=>this.scene.getNonDeletedElements()),C(this,`onInsertElements`,e=>{this.addElementsFromPasteOrLibrary({elements:e,position:`center`,files:null})}),C(this,`onExportImage`,async(e,t,n)=>{Y(`export`,e,`ui`);let r=await Yv(e,t,this.state,this.files,{exportBackground:this.state.exportBackground,name:this.getName(),viewBackgroundColor:this.state.viewBackgroundColor,exportingFrame:n.exportingFrame}).catch(ad).catch(e=>{console.error(e),this.setState({errorMessage:e.message})});this.state.exportEmbedScene&&r&&Wl(r)&&this.setState({fileHandle:r})}),C(this,`magicGenerations`,new Map),C(this,`updateMagicGeneration`,({frameElement:e,data:t})=>{t.status===`pending`?W(e,{customData:{generationData:void 0}},!1):W(e,{customData:{generationData:t}},!1),this.magicGenerations.set(e.id,t),this.triggerRender()}),C(this,`plugins`,{}),C(this,`onMagicframeToolSelect`,()=>{let e=this.scene.getSelectedElements({selectedElementIds:this.state.selectedElementIds});if(e.length===0)this.setActiveTool({type:$u.magicframe}),Y(`ai`,`tool-select (empty-selection)`,`d2c`);else{let t=e.length===1&&Ro(e[0])&&e[0];if(!t&&e.some(e=>M(e)||e.frameId)){this.setActiveTool({type:$u.magicframe});return}Y(`ai`,`tool-select (existing selection)`,`d2c`);let n;if(t)n=t;else{let[t,r,i,a]=Ts(e);n=Mr({...Ue,x:t-50,y:r-50,width:i-t+100,height:a-r+100,opacity:100,locked:!1}),this.scene.insertElement(n);for(let t of e)W(t,{frameId:n.id});this.setState({selectedElementIds:{[n.id]:!0}})}this.onMagicFrameGenerate(n,`upstream`)}}),C(this,`openEyeDropper`,({type:e})=>{Eg.set(V_,{swapPreviewOnAlt:!0,colorPickerType:e===`stroke`?`elementStroke`:`elementBackground`,onSelect:(t,n)=>{let r=e===`background`&&n.altKey||e===`stroke`&&!n.altKey;!this.scene.getSelectedElements(this.state).length||this.state.activeTool.type!==`selection`?r?this.syncActionResult({appState:{...this.state,currentItemStrokeColor:t},captureUpdate:N.IMMEDIATELY}):this.syncActionResult({appState:{...this.state,currentItemBackgroundColor:t},captureUpdate:N.IMMEDIATELY}):this.updateScene({elements:this.scene.getElementsIncludingDeleted().map(e=>this.state.selectedElementIds[e.id]?A(e,{[r?`strokeColor`:`backgroundColor`]:t}):e),captureUpdate:N.IMMEDIATELY})},keepOpenOnAlt:!1})}),C(this,`dismissLinearEditor`,()=>{setTimeout(()=>{this.setState({editingLinearElement:null})})}),C(this,`syncActionResult`,aE(e=>{if(this.unmounted||e===!1)return;e.captureUpdate===N.NEVER?this.store.shouldUpdateSnapshot():e.captureUpdate===N.IMMEDIATELY&&this.store.shouldCaptureIncrement();let t=!1,n=null;if(e.elements&&(this.scene.replaceAllElements(e.elements),t=!0),e.files&&(this.addMissingFiles(e.files,e.replaceFiles),this.addNewImagesToImageCache()),e.appState||n||this.state.contextMenu){let r=e?.appState?.viewModeEnabled||!1,i=e?.appState?.zenModeEnabled||!1,a=e?.appState?.theme||this.props.theme||R.LIGHT,o=e?.appState?.name??this.state.name,s=e?.appState?.errorMessage??this.state.errorMessage;typeof this.props.viewModeEnabled<`u`&&(r=this.props.viewModeEnabled),typeof this.props.zenModeEnabled<`u`&&(i=this.props.zenModeEnabled),n=e.appState?.editingTextElement||null,e.elements&&n&&e.elements.forEach(e=>{n?.id===e.id&&n!==e&&el(e)&&H(e)&&(n=e)}),n?.isDeleted&&(n=null),this.setState(t=>{let c=e.appState||{};return{...t,...c,contextMenu:null,editingTextElement:n,viewModeEnabled:r,zenModeEnabled:i,theme:a,name:o,errorMessage:s}}),t=!0}!t&&e.captureUpdate!==N.EVENTUALLY&&this.scene.triggerUpdate()})),C(this,`onBlur`,aE(()=>{OD=!1,this.setState({isBindingEnabled:!0})})),C(this,`onUnload`,()=>{this.onBlur()}),C(this,`disableEvent`,e=>{e.preventDefault()}),C(this,`resetHistory`,()=>{this.history.clear()}),C(this,`resetStore`,()=>{this.store.clear()}),C(this,`resetScene`,aE(e=>{this.scene.replaceAllElements([]),this.setState(t=>({...Ii(),isLoading:e?.resetLoadingState?!1:t.isLoading,theme:this.state.theme})),this.resetStore(),this.resetHistory()})),C(this,`initializeScene`,async()=>{`launchQueue`in window&&`LaunchParams`in window&&window.launchQueue.setConsumer(async e=>{if(!e.files.length)return;let t=e.files[0],n=await t.getFile();this.loadFileToCanvas(new File([n],n.name||``,{type:n.type}),t)}),this.props.theme&&this.setState({theme:this.props.theme}),this.state.isLoading||this.setState({isLoading:!0});let e=null;try{e=typeof this.props.initialData==`function`?await this.props.initialData()||null:await this.props.initialData||null,e?.libraryItems&&this.library.updateLibrary({libraryItems:e.libraryItems,merge:!0}).catch(e=>{console.error(e)})}catch(t){console.error(t),e={appState:{errorMessage:t.message||`Encountered an error during importing or restoring scene data`}}}let t=Gl(e,null,null,{repairBindings:!0});t.appState={...t.appState,theme:this.props.theme||t.appState.theme,openSidebar:t.appState?.openSidebar||this.state.openSidebar,activeTool:t.appState.activeTool.type===`image`?{...t.appState.activeTool,type:`selection`}:t.appState.activeTool,isLoading:!1,toast:this.state.toast},e?.scrollToContent&&(t.appState={...t.appState,...Fr(t.elements,{...t.appState,width:this.state.width,height:this.state.height,offsetTop:this.state.offsetTop,offsetLeft:this.state.offsetLeft})}),this.resetStore(),this.resetHistory(),this.syncActionResult({...t,captureUpdate:N.NEVER}),this.clearImageShapeCache(),this.fonts.loadSceneFonts().then(e=>{this.fonts.onLoaded(e)}),Jl(window.location.href)&&this.scrollToContent(window.location.href,{animate:!1})}),C(this,`isMobileBreakpoint`,(e,t)=>e<730||t<500&&e<1e3),C(this,`refreshViewportBreakpoints`,()=>{if(!this.excalidrawContainerRef.current)return;let{clientWidth:e,clientHeight:t}=document.body,n=this.device.viewport,r=Kc(n,{isLandscape:e>t,isMobile:this.isMobileBreakpoint(e,t)});return n===r?!1:(this.device={...this.device,viewport:r},!0)}),C(this,`refreshEditorBreakpoints`,()=>{let e=this.excalidrawContainerRef.current;if(!e)return;let{width:t,height:n}=e.getBoundingClientRect(),r=this.props.UIOptions.dockedSidebarBreakpoint==null?pa:this.props.UIOptions.dockedSidebarBreakpoint,i=this.device.editor,a=Kc(i,{isMobile:this.isMobileBreakpoint(t,n),canFitSidebar:t>r});return i===a?!1:(this.device={...this.device,editor:a},!0)}),C(this,`onResize`,aE(()=>{this.scene.getElementsIncludingDeleted().forEach(e=>We.delete(e)),this.refreshViewportBreakpoints(),this.updateDOMRect(),Us||this.refreshEditorBreakpoints(),this.setState({})})),C(this,`onFullscreenChange`,()=>{!document.fullscreenElement&&this.state.activeEmbeddable?.state===`active`&&this.setState({activeEmbeddable:null})}),C(this,`renderInteractiveSceneCallback`,({atLeastOneVisibleElement:e,scrollBars:t,elementsMap:n})=>{t&&(jD=t);let r=this.state.editingTextElement?!1:!e&&n.size>0;this.state.scrolledOutside!==r&&this.setState({scrolledOutside:r}),this.scheduleImageRefresh()}),C(this,`onScroll`,jl(()=>{let{offsetTop:e,offsetLeft:t}=this.getCanvasOffsets();this.setState(n=>n.offsetLeft===t&&n.offsetTop===e?null:{offsetTop:e,offsetLeft:t})},100)),C(this,`onCut`,aE(e=>{!this.excalidrawContainerRef.current?.contains(document.activeElement)||su(e.target)||(this.actionManager.executeAction(Py,`keyboard`,e),e.preventDefault(),e.stopPropagation())})),C(this,`onCopy`,aE(e=>{!this.excalidrawContainerRef.current?.contains(document.activeElement)||su(e.target)||(this.actionManager.executeAction(My,`keyboard`,e),e.preventDefault(),e.stopPropagation())})),C(this,`onTouchStart`,t=>{if(El&&t.preventDefault(),!ED){ED=!0,clearTimeout(DD),DD=window.setTimeout(e.resetTapTwice,300);return}if(ED&&t.touches.length===1){let e=t.touches[0];this.handleCanvasDoubleClick({clientX:e.clientX,clientY:e.clientY}),ED=!1,clearTimeout(DD)}t.touches.length===2&&this.setState({selectedElementIds:O({},this.state),activeEmbeddable:null})}),C(this,`onTouchEnd`,e=>{this.resetContextMenuTimer(),e.touches.length>0?this.setState({previousSelectedElementIds:{},selectedElementIds:O(this.state.previousSelectedElementIds,this.state)}):$.pointers.clear()}),C(this,`pasteFromClipboard`,aE(async e=>{let t=!!FD,n=document.activeElement,r=this.excalidrawContainerRef.current?.contains(n);if(e&&!r)return;let i=document.elementFromPoint(this.lastViewportPosition.x,this.lastViewportPosition.y);if(e&&(!(i instanceof HTMLCanvasElement)||su(n)))return;let{x:a,y:o}=Fs({clientX:this.lastViewportPosition.x,clientY:this.lastViewportPosition.y},this.state),s=e?.clipboardData?.files[0],l=await di(e,t);if(!s&&!t){if(l.mixedContent)return this.addElementsFromMixedContentPaste(l.mixedContent,{isPlainPaste:t,sceneX:a,sceneY:o});if(l.text){let e=l.text.trim();e.startsWith(`<svg`)&&e.endsWith(`</svg>`)&&(s=tc(e))}}if(ba(s)&&!l.spreadsheet){if(!this.isToolSupported(`image`)){this.setState({errorMessage:q(`errors.imageToolNotSupported`)});return}let e=this.createImageElement({sceneX:a,sceneY:o});this.insertImageElement(e,s),this.initializeImageDimensions(e),this.setState({selectedElementIds:O({[e.id]:!0},this.state)});return}if(this.props.onPaste)try{if(await this.props.onPaste(l,e)===!1)return}catch(e){console.error(e)}if(l.errorMessage)this.setState({errorMessage:l.errorMessage});else if(l.spreadsheet&&!t)this.setState({pasteDialog:{data:l.spreadsheet,shown:!0}});else if(l.elements){let e=l.programmaticAPI?iE(l.elements):l.elements;this.addElementsFromPasteOrLibrary({elements:e,files:l.files||null,position:`cursor`,retainSeed:t})}else if(l.text){if(l.text&&iD(l.text)){let e=await c(()=>import(`./dist-0fyaNKyr.js`),__vite__mapDeps([67,60,2,61,62,63,68,69,70,71,72,73,66,74,75]));try{let{elements:t,files:n}=await e.parseMermaidToExcalidraw(l.text),r=iE(t,{regenerateIds:!0});this.addElementsFromPasteOrLibrary({elements:r,files:n,position:`cursor`});return}catch(e){console.warn(`parsing pasted text as mermaid definition failed: ${e.message}`)}}let e=xr(l.text).split(/\n+/).map(e=>e.trim()).filter(Boolean),n=e.map(e=>rl(e)).filter(e=>mr(e,this.props.validateEmbeddable)&&(/^(http|https):\/\/[^\s/$.?#].[^\s]*$/.test(e)||Ji(e)?.type===`video`));if(!FD&&n.length>0&&n.length===e.length){let e=[];for(let t of n){let n=e[e.length-1],r=this.insertEmbeddableElement({sceneX:n?n.x+n.width+20:a,sceneY:o,link:Sn(t)});r&&e.push(r)}e.length&&this.setState({selectedElementIds:Object.fromEntries(e.map(e=>[e.id,!0]))});return}this.addTextFromPaste(l.text,t)}this.setActiveTool({type:`selection`}),e?.preventDefault()})),C(this,`addElementsFromPasteOrLibrary`,e=>{let t=bo(e.elements,null,void 0),[n,r,i,a]=Ts(t),o=Da(n,i)/2,s=Da(r,a)/2,{x:c,y:l}=Fs({clientX:typeof e.position==`object`?e.position.clientX:e.position===`cursor`?this.lastViewportPosition.x:this.state.width/2+this.state.offsetLeft,clientY:typeof e.position==`object`?e.position.clientY:e.position===`cursor`?this.lastViewportPosition.y:this.state.height/2+this.state.offsetTop},this.state),[u,d]=Lr(c-o,l-s,this.getEffectiveGridSize()),f=rd(t.map(e=>A(e,{x:e.x+u-n,y:e.y+d-r})),{randomizeSeed:!e.retainSeed}),p=this.scene.getElementsIncludingDeleted(),m=[...p,...f];m=this.props.onDuplicate?.(m,p)||m,Rt(m,P(f));let h=this.getTopLayerFrameAtSceneCoords({x:c,y:l});if(h){let e=Wi(f,h);wu(m,e,h,this.state)}this.scene.replaceAllElements(m),f.forEach(e=>{H(e)&&Ba(e)&&pu(e,ai(e,this.scene.getElementsMapIncludingDeleted()),this.scene.getElementsMapIncludingDeleted())}),Yr&&Qu.loadElementsFonts(f).then(e=>{this.fonts.onLoaded(e)}),e.files&&this.addMissingFiles(e.files),this.store.shouldCaptureIncrement();let g=lu(f);this.setState({...this.state,openSidebar:this.state.openSidebar&&this.device.editor.canFitSidebar&&Eg.get(FC)?this.state.openSidebar:null,...Rl({editingGroupId:null,selectedElementIds:g.reduce((e,t)=>(Ba(t)||(e[t.id]=!0),e),{})},this.scene.getNonDeletedElements(),this.state,this)},()=>{e.files&&this.addNewImagesToImageCache()}),this.setActiveTool({type:`selection`}),e.fitToContent&&this.scrollToContent(f,{fitToContent:!0,canvasOffsets:this.getEditorUIOffsets()})}),C(this,`setAppState`,(e,t)=>{this.setState(e,t)}),C(this,`removePointer`,e=>{MD&&this.resetContextMenuTimer(),$.pointers.delete(e.pointerId)}),C(this,`toggleLock`,(e=`ui`)=>{this.state.activeTool.locked||Y(`toolbar`,`toggleLock`,`${e} (${this.device.editor.isMobile?`mobile`:`desktop`})`),this.setState(e=>({activeTool:{...e.activeTool,...fo(this.state,e.activeTool.locked?{type:`selection`}:e.activeTool),locked:!e.activeTool.locked}}))}),C(this,`updateFrameRendering`,e=>{this.setState(t=>{let n=typeof e==`function`?e(t.frameRendering):e;return{frameRendering:{enabled:n?.enabled??t.frameRendering.enabled,clip:n?.clip??t.frameRendering.clip,name:n?.name??t.frameRendering.name,outline:n?.outline??t.frameRendering.outline}}})}),C(this,`togglePenMode`,e=>{this.setState(t=>({penMode:e??!t.penMode,penDetected:!0}))}),C(this,`onHandToolToggle`,()=>{this.actionManager.executeAction(Uv)}),C(this,`zoomCanvas`,e=>{this.setState({...Av({viewportX:this.state.width/2+this.state.offsetLeft,viewportY:this.state.height/2+this.state.offsetTop,nextZoom:Ne(e)},this.state)})}),C(this,`cancelInProgressAnimation`,null),C(this,`scrollToContent`,(e=this.scene.getNonDeletedElements(),t)=>{if(typeof e==`string`){let n;if(n=Jl(e)?Ft(e):e,n){let r=this.scene.getElementsFromId(n);r?.length?this.scrollToContent(r,{fitToContent:t?.fitToContent??!0,animate:t?.animate??!0}):Jl(e)&&this.setState({toast:{message:q(`elementLink.notFound`),duration:3e3,closable:!0}})}return}this.cancelInProgressAnimation?.();let n=Array.isArray(e)?e:[e],r=this.state.zoom,i=this.state.scrollX,a=this.state.scrollY;if(t?.fitToContent||t?.fitToViewport){let{appState:e}=Vv({canvasOffsets:t.canvasOffsets,targetElements:n,appState:this.state,fitToViewport:!!t?.fitToViewport,viewportZoomFactor:t?.viewportZoomFactor,minZoom:t?.minZoom,maxZoom:t?.maxZoom});r=e.zoom,i=e.scrollX,a=e.scrollY}else{let e=Fr(n,this.state);i=e.scrollX,a=e.scrollY}if(t?.animate){let e=this.state.scrollX,n=this.state.scrollY,o=this.state.zoom.value,s=Ri({fromValues:{scrollX:e,scrollY:n,zoom:o},toValues:{scrollX:i,scrollY:a,zoom:r.value},interpolateValue:(e,t,n,r)=>{if(r===`zoom`)return e*(t/e)**+du(n)},onStep:({scrollX:e,scrollY:t,zoom:n})=>{this.setState({scrollX:e,scrollY:t,zoom:{value:n}})},onStart:()=>{this.setState({shouldCacheIgnoreZoom:!0})},onEnd:()=>{this.setState({shouldCacheIgnoreZoom:!1})},onCancel:()=>{this.setState({shouldCacheIgnoreZoom:!1})},duration:t?.duration??500});this.cancelInProgressAnimation=()=>{s(),this.cancelInProgressAnimation=null}}else this.setState({scrollX:i,scrollY:a,zoom:r})}),C(this,`maybeUnfollowRemoteUser`,()=>{this.state.userToFollow&&this.setState({userToFollow:null})}),C(this,`translateCanvas`,e=>{this.cancelInProgressAnimation?.(),this.maybeUnfollowRemoteUser(),this.setState(e)}),C(this,`setToast`,e=>{this.setState({toast:e})}),C(this,`restoreFileFromShare`,async()=>{try{let e=await caches.open(`web-share-target`),t=await e.match(`shared-file`);if(t){let n=await t.blob(),r=new File([n],n.name||``,{type:n.type});this.loadFileToCanvas(r,null),await e.delete(`shared-file`),window.history.replaceState(null,_t,window.location.pathname)}}catch(e){this.setState({errorMessage:e.message})}}),C(this,`addFiles`,aE(e=>{let{addedFiles:t}=this.addMissingFiles(e);this.clearImageShapeCache(t),this.scene.triggerUpdate(),this.addNewImagesToImageCache()})),C(this,`addMissingFiles`,(e,t=!1)=>{let n=t?{}:{...this.files},r={},i=Array.isArray(e)?e:Object.values(e);for(let e of i)if(!n[e.id]&&(r[e.id]=e,n[e.id]=e,e.mimeType===rn.svg))try{let t=xs(Oi(Ls(e.dataURL)),rn.svg);e.dataURL!==t&&(e.version=(e.version??1)+1,e.dataURL=t)}catch(e){console.error(e)}return this.files=n,{addedFiles:r}}),C(this,`updateScene`,aE(e=>{let t=eo(e.elements??[]);if(e.captureUpdate&&e.captureUpdate!==N.EVENTUALLY){let n=this.store.snapshot.appState,r=this.store.snapshot.elements,i=e.appState?Object.assign({},n,e.appState):n,a=e.elements?this.store.filterUncomittedElements(this.scene.getElementsMapIncludingDeleted(),P(t)):r;e.captureUpdate===N.IMMEDIATELY?this.store.captureIncrement(a,i):e.captureUpdate===N.NEVER&&this.store.updateSnapshot(a,i)}e.appState&&this.setState(e.appState),e.elements&&this.scene.replaceAllElements(t),e.collaborators&&this.setState({collaborators:e.collaborators})})),C(this,`triggerRender`,e=>{e===!0?this.scene.triggerUpdate():this.setState({})}),C(this,`toggleSidebar`,({name:e,tab:t,force:n})=>{let r;r=n===void 0?this.state.openSidebar?.name===e&&this.state.openSidebar?.tab===t?null:e:n?e:null;let i=r?{name:r}:null;return i&&t&&(i.tab=t),this.setState({openSidebar:i}),!!r}),C(this,`updateCurrentCursorPosition`,aE(e=>{this.lastViewportPosition.x=e.clientX,this.lastViewportPosition.y=e.clientY})),C(this,`getEditorUIOffsets`,()=>{let e=this.excalidrawContainerRef?.current?.querySelector(`.App-toolbar`)?.getBoundingClientRect()?.bottom??0,t=this.excalidrawContainerRef?.current?.querySelector(`.sidebar`)?.getBoundingClientRect(),n=this.excalidrawContainerRef?.current?.querySelector(`.App-menu__left`)?.getBoundingClientRect();return Fg().rtl?{top:e+16,right:Math.max(this.state.width-(n?.left??this.state.width),0)+16,bottom:16,left:Math.max(t?.right??0,0)+16}:{top:e+16,right:Math.max(this.state.width-(t?.left??this.state.width)+16,0),bottom:16,left:Math.max(n?.right??0,0)+16}}),C(this,`onKeyDown`,aE(e=>{if(`Proxy`in window&&(!e.shiftKey&&/^[A-Z]$/.test(e.key)||e.shiftKey&&/^[a-z]$/.test(e.key))&&(e=new Proxy(e,{get(t,n){let r=t[n];return typeof r==`function`?r.bind(t):n===`key`?e.shiftKey?t.key.toUpperCase():t.key.toLowerCase():r}})),!ta(e.target)){if((e.key===D.ESCAPE||e.key===D.ENTER)&&this.state.croppingElementId){this.finishImageCropping();return}let t=V(this.scene.getNonDeletedElementsMap(),this.state);if(t.length===1&&De(t[0])&&e.key===D.ENTER){this.startImageCropping(t[0]);return}if(e.key===D.ESCAPE&&this.flowChartCreator.isCreatingChart){this.flowChartCreator.clear(),this.triggerRender(!0);return}let n=Pi(e.key);if(e[D.CTRL_OR_CMD]&&n&&!e.shiftKey){e.preventDefault();let t=V(this.scene.getNonDeletedElementsMap(),this.state);t.length===1&&Ws(t[0])&&this.flowChartCreator.createNodes(t[0],this.scene.getNonDeletedElementsMap(),this.state,FS(e.key)),this.flowChartCreator.pendingNodes?.length&&!la(this.flowChartCreator.pendingNodes,this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap(),this.getEditorUIOffsets())&&this.scrollToContent(this.flowChartCreator.pendingNodes,{animate:!0,duration:300,fitToContent:!0,canvasOffsets:this.getEditorUIOffsets()});return}if(e.altKey){let t=V(this.scene.getNonDeletedElementsMap(),this.state);if(t.length===1&&n){e.preventDefault();let n=this.flowChartNavigator.exploreByDirection(t[0],this.scene.getNonDeletedElementsMap(),FS(e.key));if(n){this.setState(e=>({selectedElementIds:O({[n]:!0},e)}));let e=this.scene.getNonDeletedElementsMap().get(n);e&&!la([e],this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap(),this.getEditorUIOffsets())&&this.scrollToContent(e,{animate:!0,duration:300,canvasOffsets:this.getEditorUIOffsets()})}return}}}if(e[D.CTRL_OR_CMD]&&e.key===D.P&&!e.shiftKey&&!e.altKey){this.setToast({message:q(`commandPalette.shortcutHint`,{shortcut:Ex(`commandPalette`)})}),e.preventDefault();return}if(e[D.CTRL_OR_CMD]&&e.key.toLowerCase()===D.V&&(FD=e.shiftKey,clearTimeout(ID),ID=window.setTimeout(()=>{FD=!1},100)),e[D.CTRL_OR_CMD]&&su(e.target)&&(e.code===E.MINUS||e.code===E.EQUAL)){e.preventDefault();return}if(su(e.target)&&e.key!==D.ESCAPE||Pi(e.key)&&ta(e.target))return;if(e.key===D.QUESTION_MARK){this.setState({openDialog:{name:`help`}});return}else if(e.key.toLowerCase()===D.E&&e.shiftKey&&e[D.CTRL_OR_CMD]){e.preventDefault(),this.setState({openDialog:{name:`imageExport`}});return}if(e.key===D.PAGE_UP||e.key===D.PAGE_DOWN){let t=(e.shiftKey?this.state.width:this.state.height)/this.state.zoom.value;e.key===D.PAGE_DOWN&&(t=-t),e.shiftKey?this.translateCanvas(e=>({scrollX:e.scrollX+t})):this.translateCanvas(e=>({scrollY:e.scrollY+t}))}if(this.state.openDialog?.name===`elementLinkSelector`||this.actionManager.handleKeyDown(e)||this.state.viewModeEnabled)return;if(e[D.CTRL_OR_CMD]&&this.state.isBindingEnabled&&this.setState({isBindingEnabled:!1}),Pi(e.key)){let t=this.scene.getSelectedElements({selectedElementIds:this.state.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}),n=t.find(B),r=new Set;t.filter(B).filter(e=>{let n=e.startBinding&&!t.some(t=>t.id===e.startBinding?.elementId),r=e.endBinding&&!t.some(t=>t.id===e.endBinding?.elementId);return n||r}).forEach(e=>r.add(e.id)),t=t.filter(e=>!r.has(e.id));let i=this.getEffectiveGridSize()&&(e.shiftKey?1:this.getEffectiveGridSize())||(e.shiftKey?5:1),a=0,o=0;e.key===D.ARROW_LEFT?a=-i:e.key===D.ARROW_RIGHT?a=i:e.key===D.ARROW_UP?o=-i:e.key===D.ARROW_DOWN&&(o=i),t.forEach(e=>{W(e,{x:e.x+a,y:e.y+o},!1),ao(e,this.scene.getNonDeletedElementsMap(),{simultaneouslyUpdated:t})}),this.setState({suggestedBindings:na(t.filter(e=>e.id!==n?.id||i!==0),this.scene.getNonDeletedElementsMap(),this.state.zoom)}),this.scene.triggerUpdate(),e.preventDefault()}else if(e.key===D.ENTER){let t=this.scene.getSelectedElements(this.state);if(t.length===1){let n=t[0];if(e[D.CTRL_OR_CMD])fc(n)&&(!this.state.editingLinearElement||this.state.editingLinearElement.elementId!==t[0].id)&&(this.store.shouldCaptureIncrement(),B(n)||this.setState({editingLinearElement:new F(n)}));else if(H(n)||Il(n)){let t;H(n)||(t=n);let r=Me(n,this.state,this.scene.getNonDeletedElementsMap()),i=r.x,a=r.y;this.startTextEditing({sceneX:i,sceneY:a,container:t}),e.preventDefault();return}else M(n)&&this.setState({editingFrame:n.id})}}else if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&!this.state.newElement&&!this.state.selectionElement&&!this.state.selectedElementsAreBeingDragged){let t=ka(e.key);t?(this.state.activeTool.type!==t&&Y(`toolbar`,t,`keyboard (${this.device.editor.isMobile?`mobile`:`desktop`})`),t===`arrow`&&this.state.activeTool.type===`arrow`&&this.setState(e=>({currentItemArrowType:e.currentItemArrowType===nu.sharp?nu.round:e.currentItemArrowType===nu.round?nu.elbow:nu.sharp})),this.setActiveTool({type:t}),e.stopPropagation()):e.key===D.Q&&(this.toggleLock(`keyboard`),e.stopPropagation())}if(e.key===D.SPACE&&$.pointers.size===0&&(OD=!0,z(this.interactiveCanvas,T.GRAB),e.preventDefault()),(e.key===D.G||e.key===D.S)&&!e.altKey&&!e[D.CTRL_OR_CMD]){let t=this.scene.getSelectedElements(this.state);if(this.state.activeTool.type===`selection`&&!t.length)return;e.key===D.G&&(Wu(this.state.activeTool.type)||t.some(e=>Wu(e.type)))&&(this.setState({openPopup:`elementBackground`}),e.stopPropagation()),e.key===D.S&&(this.setState({openPopup:`elementStroke`}),e.stopPropagation())}if(!e[D.CTRL_OR_CMD]&&e.shiftKey&&e.key.toLowerCase()===D.F){let t=this.scene.getSelectedElements(this.state);if(this.state.activeTool.type===`selection`&&!t.length)return;(this.state.activeTool.type===`text`||t.find(e=>H(e)||w(e,this.scene.getNonDeletedElementsMap())))&&(e.preventDefault(),this.setState({openPopup:`fontFamily`}))}if(e.key===D.K&&!e.altKey&&!e[D.CTRL_OR_CMD]){this.state.activeTool.type===`laser`?this.setActiveTool({type:`selection`}):this.setActiveTool({type:`laser`});return}e[D.CTRL_OR_CMD]&&(e.key===D.BACKSPACE||e.key===D.DELETE)&&Eg.set(Wx,`clearCanvas`);let t=e.key.toLocaleLowerCase(),n=t===D.S&&e.shiftKey,r=e.key===D.I||t===D.G&&e.shiftKey;(n||r)&&this.openEyeDropper({type:n?`stroke`:`background`})})),C(this,`onKeyUp`,aE(e=>{if(e.key===D.SPACE&&(this.state.viewModeEnabled||this.state.openDialog?.name===`elementLinkSelector`?z(this.interactiveCanvas,T.GRAB):this.state.activeTool.type===`selection`?_l(this.interactiveCanvas):(Ul(this.interactiveCanvas,this.state),this.setState({selectedElementIds:O({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null})),OD=!1),!e[D.CTRL_OR_CMD]&&!this.state.isBindingEnabled&&this.setState({isBindingEnabled:!0}),Pi(e.key)&&(Js(this.scene.getSelectedElements(this.state).filter(fc),this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements(),this.scene,wt(this.state),this.state.selectedLinearElement?.selectedPointsIndices??[],this.state.zoom),this.setState({suggestedBindings:[]})),e.altKey||this.flowChartNavigator.isExploring&&(this.flowChartNavigator.clear(),this.syncActionResult({captureUpdate:N.IMMEDIATELY})),!e[D.CTRL_OR_CMD]&&this.flowChartCreator.isCreatingChart){this.flowChartCreator.pendingNodes?.length&&this.scene.insertElements(this.flowChartCreator.pendingNodes);let e=this.flowChartCreator.pendingNodes?.[0];e&&(this.setState(t=>({selectedElementIds:O({[e.id]:!0},t)})),la([e],this.canvas.width/window.devicePixelRatio,this.canvas.height/window.devicePixelRatio,{offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,zoom:this.state.zoom},this.scene.getNonDeletedElementsMap(),this.getEditorUIOffsets())||this.scrollToContent(e,{animate:!0,duration:300,canvasOffsets:this.getEditorUIOffsets()})),this.flowChartCreator.clear(),this.syncActionResult({captureUpdate:N.IMMEDIATELY})}})),C(this,`isToolSupported`,e=>this.props.UIOptions.tools?.[e]!==!1),C(this,`setActiveTool`,e=>{if(!this.isToolSupported(e.type)){console.warn(`"${e.type}" tool is disabled via "UIOptions.canvasActions.tools.${e.type}"`);return}let t=fo(this.state,e);t.type===`hand`?z(this.interactiveCanvas,T.GRAB):OD||Ul(this.interactiveCanvas,{...this.state,activeTool:t}),Bo(document.activeElement)&&this.focusContainer(),zt(t.type)||this.setState({suggestedBindings:[]}),t.type===`image`&&this.onImageAction({insertOnCanvasDirectly:(e.type===`image`&&e.insertOnCanvasDirectly)??!1}),this.setState(e=>{let n={snapLines:e.snapLines.length?[]:e.snapLines,originSnapOffset:null,activeEmbeddable:null};return t.type===`freedraw`&&this.store.shouldCaptureIncrement(),t.type===`selection`?{...e,activeTool:t,...n}:{...e,activeTool:t,selectedElementIds:O({},e),selectedGroupIds:O({},e),editingGroupId:null,multiElement:null,...n}})}),C(this,`setOpenDialog`,e=>{this.setState({openDialog:e})}),C(this,`setCursor`,e=>{z(this.interactiveCanvas,e)}),C(this,`resetCursor`,()=>{_l(this.interactiveCanvas)}),C(this,`isTouchScreenMultiTouchGesture`,()=>$.pointers.size>=2),C(this,`getName`,()=>this.state.name||this.props.name||`${q(`labels.untitled`)}-${ul()}`),C(this,`onGestureStart`,aE(e=>{e.preventDefault(),this.isTouchScreenMultiTouchGesture()&&this.setState({selectedElementIds:O({},this.state),activeEmbeddable:null}),$.initialScale=this.state.zoom.value})),C(this,`onGestureChange`,aE(e=>{if(e.preventDefault(),this.isTouchScreenMultiTouchGesture())return;let t=$.initialScale;t&&this.setState(n=>({...Av({viewportX:this.lastViewportPosition.x,viewportY:this.lastViewportPosition.y,nextZoom:Ne(t*e.scale)},n)}))})),C(this,`onGestureEnd`,aE(e=>{e.preventDefault(),this.isTouchScreenMultiTouchGesture()&&this.setState({previousSelectedElementIds:{},selectedElementIds:O(this.state.previousSelectedElementIds,this.state)}),$.initialScale=null})),C(this,`startTextEditing`,({sceneX:e,sceneY:t,insertAtParentCenter:n=!0,container:r,autoEdit:i=!0})=>{let a=!1,o=n&&this.getTextWysiwygSnappedToCenterPosition(e,t,this.state,r);r&&o&&(w(r,this.scene.getNonDeletedElementsMap())||(a=!0));let s=null,c=this.scene.getSelectedElements(this.state);s=c.length===1?H(c[0])?c[0]:r?w(c[0],this.scene.getNonDeletedElementsMap()):this.getTextElementAtPosition(e,t):this.getTextElementAtPosition(e,t);let l=s?.fontFamily||this.state.currentItemFontFamily,u=s?.lineHeight||mu(l),d=this.state.currentItemFontSize;if(!s&&a&&r&&!Lc(r)){let n=vt(Cs({fontSize:d,fontFamily:l}),u),i=Ht(d,u),a=Math.max(r.height,i),s=Math.max(r.width,n);W(r,{height:a,width:s}),e=r.x+s/2,t=r.y+a/2,o&&=this.getTextWysiwygSnappedToCenterPosition(e,t,this.state,r)}let f=this.getTopLayerFrameAtSceneCoords({x:e,y:t}),p=s||yt({x:o?o.elementCenterX:e,y:o?o.elementCenterY:t,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,text:``,fontSize:d,fontFamily:l,textAlign:o?`center`:this.state.currentItemTextAlign,verticalAlign:o?ri.MIDDLE:`top`,containerId:a?r?.id:void 0,groupIds:r?.groupIds??[],lineHeight:u,angle:r?.angle??0,frameId:f?f.id:null});if(!s&&a&&r&&W(r,{boundElements:(r.boundElements||[]).concat({type:`text`,id:p.id})}),this.setState({editingTextElement:p}),!s)if(r&&a){let e=this.scene.getElementIndex(r.id);this.scene.insertElementAtIndex(p,e+1)}else this.scene.insertElement(p);i||s||r?this.handleTextWysiwyg(p,{isExistingElement:!!s}):this.setState({newElement:p,multiElement:null})}),C(this,`startImageCropping`,e=>{this.store.shouldCaptureIncrement(),this.setState({croppingElementId:e.id})}),C(this,`finishImageCropping`,()=>{this.state.croppingElementId&&(this.store.shouldCaptureIncrement(),this.setState({croppingElementId:null}))}),C(this,`handleCanvasDoubleClick`,e=>{if(this.state.multiElement||this.state.activeTool.type!==`selection`)return;let t=this.scene.getSelectedElements(this.state),{x:n,y:r}=Fs(e,this.state);if(t.length===1&&fc(t[0])){if(e[D.CTRL_OR_CMD]&&(!this.state.editingLinearElement||this.state.editingLinearElement.elementId!==t[0].id)&&!B(t[0])){this.store.shouldCaptureIncrement(),this.setState({editingLinearElement:new F(t[0])});return}else if(this.state.selectedLinearElement&&B(t[0])){let e=F.getSegmentMidpointHitCoords(this.state.selectedLinearElement,{x:n,y:r},this.state,this.scene.getNonDeletedElementsMap()),i=e?F.getSegmentMidPointIndex(this.state.selectedLinearElement,this.state,e,this.scene.getNonDeletedElementsMap()):-1;if(i&&i>-1){this.store.shouldCaptureIncrement(),F.deleteFixedSegment(t[0],i);let a=F.getSegmentMidpointHitCoords({...this.state.selectedLinearElement,segmentMidPointHoveredCoords:null},{x:n,y:r},this.state,this.scene.getNonDeletedElementsMap()),o=a?F.getSegmentMidPointIndex(this.state.selectedLinearElement,this.state,a,this.scene.getNonDeletedElementsMap()):null;this.setState({selectedLinearElement:{...this.state.selectedLinearElement,pointerDownState:{...this.state.selectedLinearElement.pointerDownState,segmentMidpoint:{index:o,value:e,added:!1}},segmentMidPointHoveredCoords:a}});return}}}if(t.length===1&&De(t[0])){this.startImageCropping(t[0]);return}if(_l(this.interactiveCanvas),ki(this.state).length>0){let e=this.getElementAtPosition(n,r),t=e&&ot(e,this.state.selectedGroupIds);if(t){this.store.shouldCaptureIncrement(),this.setState(n=>({...n,...Rl({editingGroupId:t,selectedElementIds:{[e.id]:!0}},this.scene.getNonDeletedElements(),n,this)}));return}}if(_l(this.interactiveCanvas),!e[D.CTRL_OR_CMD]&&!this.state.viewModeEnabled){let t=this.getElementAtPosition(n,r);if(er(t)){this.setState({activeEmbeddable:{element:t,state:`active`}});return}let i=this.getTextBindableContainerAtPosition(n,r);if(i&&(Ou(i)||!To(i.backgroundColor)||ea({x:n,y:r,element:i,shape:ye(i,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold()}))){let e=Me(i,this.state,this.scene.getNonDeletedElementsMap());n=e.x,r=e.y}this.startTextEditing({sceneX:n,sceneY:r,insertAtParentCenter:!e.altKey,container:i})}}),C(this,`getElementLinkAtPosition`,(e,t)=>{let n=this.scene.getNonDeletedElements(),r=-1;for(let i=n.length-1;i>=0;i--){let a=n[i];if(t&&a.id===t.id&&(r=i),a.link&&i>=r&&Ee(a,this.scene.getNonDeletedElementsMap(),this.state,I(e.x,e.y),this.device.editor.isMobile))return a}}),C(this,`redirectToLink`,(e,t)=>{let n=Ce(I(this.lastPointerDownEvent.clientX,this.lastPointerDownEvent.clientY),I(this.lastPointerUpEvent.clientX,this.lastPointerUpEvent.clientY));if(!this.hitLinkElement||n>10)return;let r=Fs(this.lastPointerDownEvent,this.state),i=this.scene.getNonDeletedElementsMap(),a=Ee(this.hitLinkElement,i,this.state,I(r.x,r.y),this.device.editor.isMobile),o=Fs(this.lastPointerUpEvent,this.state),s=Ee(this.hitLinkElement,i,this.state,I(o.x,o.y),this.device.editor.isMobile);if(a&&s){ob();let t=this.hitLinkElement.link;if(t){t=Sn(t);let n;if(this.props.onLinkOpen&&(n=Kl(`excalidraw-link`,e.nativeEvent),this.props.onLinkOpen({...this.hitLinkElement,link:t},n)),!n?.defaultPrevented){let e=Au(t)?`_self`:`_blank`,n=window.open(void 0,e);n&&(n.opener=null,n.location=t)}}}}),C(this,`getTopLayerFrameAtSceneCoords`,e=>{let t=this.scene.getNonDeletedElementsMap(),n=this.scene.getNonDeletedFramesLikes().filter(n=>Ot(e,n,t));return n.length?n[n.length-1]:null}),C(this,`handleCanvasPointerMove`,e=>{this.savePointer(e.clientX,e.clientY,this.state.cursorButton),this.lastPointerMoveEvent=e.nativeEvent,$.pointers.has(e.pointerId)&&$.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});let t=$.initialScale;if($.pointers.size===2&&$.lastCenter&&t&&$.initialDistance){let e=hS($.pointers),n=e.x-$.lastCenter.x,r=e.y-$.lastCenter.y;$.lastCenter=e;let i=gS(Array.from($.pointers.values())),a=this.state.activeTool.type===`freedraw`&&this.state.penMode?1:i/$.initialDistance,o=a?Ne(t*a):this.state.zoom.value;this.setState(t=>{let i=Av({viewportX:e.x,viewportY:e.y,nextZoom:o},t);this.translateCanvas({zoom:i.zoom,scrollX:i.scrollX+n/o*2,scrollY:i.scrollY+r/o*2,shouldCacheIgnoreZoom:!0})}),this.resetShouldCacheIgnoreZoomDebounced()}else $.lastCenter=$.initialDistance=$.initialScale=null;if(OD||kD||AD||On(this.state))return;let n=nC(jD,e.clientX-this.state.offsetLeft,e.clientY-this.state.offsetTop).isOverEither;!this.state.newElement&&!this.state.selectionElement&&!this.state.selectedElementsAreBeingDragged&&!this.state.multiElement&&(n?_l(this.interactiveCanvas):Ul(this.interactiveCanvas,this.state));let r=Fs(e,this.state),{x:i,y:a}=r;if(!this.state.newElement&&Pr(this.state.activeTool.type)){let{originOffset:t,snapLines:n}=zi(this.scene.getNonDeletedElements(),this,{x:i,y:a},e,this.scene.getNonDeletedElementsMap());this.setState(e=>{let r=Rc(e.snapLines,n),i=e.originSnapOffset?Rc(e.originSnapOffset,t):t;return e.snapLines===r&&e.originSnapOffset===i?null:{snapLines:r,originSnapOffset:i}})}else !this.state.newElement&&!this.state.selectedElementsAreBeingDragged&&!this.state.selectionElement&&this.setState(e=>e.snapLines.length?{snapLines:[]}:null);if(this.state.editingLinearElement&&!this.state.editingLinearElement.isDragging){let t=F.handlePointerMove(e,i,a,this,this.scene.getNonDeletedElementsMap());t&&t!==this.state.editingLinearElement&&(0,dg.flushSync)(()=>{this.setState({editingLinearElement:t})}),t?.lastUncommittedPoint==null?(0,dg.flushSync)(()=>{this.setState({suggestedBindings:[]})}):this.maybeSuggestBindingAtCursor(r,t.elbowed)}if(Mo(this.state.activeTool.type)){let{newElement:e}=this.state;Zi(e,!1)?this.maybeSuggestBindingsForLinearElementAtCoords(e,[r],this.state.startBoundElement):this.maybeSuggestBindingAtCursor(r,!1)}if(this.state.multiElement){let{multiElement:t}=this.state,{x:n,y:r}=t,{points:o,lastCommittedPoint:s}=t,c=o[o.length-1];if(Ul(this.interactiveCanvas,this.state),c===s)Ce(I(i-n,a-r),c)>=8?W(t,{points:[...o,I(i-n,a-r)]},!1):z(this.interactiveCanvas,T.POINTER);else if(o.length>2&&s&&Ce(I(i-n,a-r),s)<8)z(this.interactiveCanvas,T.POINTER),W(t,{points:o.slice(0,-1)},!1);else{let[s,c]=Lr(i,a,e[D.CTRL_OR_CMD]||B(t)?null:this.getEffectiveGridSize()),[l,u]=t?.lastCommittedPoint??[0,0],d=s-n-l,f=c-r-u;ft(e)&&({width:d,height:f}=dl(l+n,u+r,s,c)),jt(o,this.state.zoom.value)&&z(this.interactiveCanvas,T.POINTER),W(t,{points:[...o.slice(0,-1),I(l+d,u+f)]},!1,{isDragging:!0}),this.triggerRender(!1)}return}if(e.buttons||this.state.activeTool.type!==`selection`&&this.state.activeTool.type!==`text`&&this.state.activeTool.type!==`eraser`)return;let o=this.scene.getNonDeletedElements(),s=this.scene.getSelectedElements(this.state);if(s.length===1&&!n&&!this.state.editingLinearElement){if(this.state.selectedLinearElement&&this.handleHoverSelectedLinearElement(this.state.selectedLinearElement,i,a),(!this.state.selectedLinearElement||this.state.selectedLinearElement.hoverPointIndex===-1)&&this.state.openDialog?.name!==`elementLinkSelector`&&!(s.length===1&&B(s[0]))){let t=Po(o,this.state,i,a,this.state.zoom,e.pointerType,this.scene.getNonDeletedElementsMap(),this.device);if(t&&t.transformHandleType){z(this.interactiveCanvas,Pt(t));return}}}else if(s.length>1&&!n&&this.state.openDialog?.name!==`elementLinkSelector`){let t=tt(Ts(s),i,a,this.state.zoom,e.pointerType,this.device);if(t){z(this.interactiveCanvas,Pt({transformHandleType:t}));return}}let c=this.getElementAtPosition(r.x,r.y);this.hitLinkElement=this.getElementLinkAtPosition(r,c),!aa(this.state)&&(this.hitLinkElement&&!this.state.selectedElementIds[this.hitLinkElement.id]?(z(this.interactiveCanvas,T.POINTER),ib(this.hitLinkElement,this.state,this.scene.getNonDeletedElementsMap())):(ob(),c&&(c.link||Fn(c))&&this.state.selectedElementIds[c.id]&&!this.state.contextMenu&&!this.state.showHyperlinkPopup?this.setState({showHyperlinkPopup:`info`}):this.state.activeTool.type===`text`?z(this.interactiveCanvas,H(c)?T.TEXT:T.CROSSHAIR):this.state.viewModeEnabled?z(this.interactiveCanvas,T.GRAB):this.state.openDialog?.name===`elementLinkSelector`||n?z(this.interactiveCanvas,T.AUTO):this.state.selectedLinearElement?this.handleHoverSelectedLinearElement(this.state.selectedLinearElement,i,a):e[D.CTRL_OR_CMD]?z(this.interactiveCanvas,T.AUTO):(c||this.isHittingCommonBoundingBoxOfSelectedElements(r,s))&&!c?.locked&&(c&&er(c)&&this.isIframeLikeElementCenter(c,e,i,a)?(z(this.interactiveCanvas,T.POINTER),this.setState({activeEmbeddable:{element:c,state:`hover`}})):(!c||!B(c))&&(z(this.interactiveCanvas,T.MOVE),this.state.activeEmbeddable?.state===`hover`&&this.setState({activeEmbeddable:null})))),this.state.openDialog?.name===`elementLinkSelector`&&c?this.setState(e=>({hoveredElementIds:Rc(e.hoveredElementIds,Rl({editingGroupId:e.editingGroupId,selectedElementIds:{[c.id]:!0}},this.scene.getNonDeletedElements(),e,this).selectedElementIds)})):this.state.openDialog?.name===`elementLinkSelector`&&!c&&this.setState(e=>({hoveredElementIds:Rc(e.hoveredElementIds,{})})))}),C(this,`handleEraser`,(e,t,n)=>{this.eraserTrail.addPointToPath(n.x,n.y);let r=!1,i=new Set,a=this.scene.getNonDeletedElements(),o=t=>{for(let n of t){if(n.locked)return;if(e.altKey?this.elementsPendingErasure.delete(n.id)&&(r=!0):this.elementsPendingErasure.has(n.id)||(r=!0,this.elementsPendingErasure.add(n.id)),r&&n.groupIds?.length){let t=n.groupIds.at(-1);if(!i.has(t)){i.add(t);let n=jo(a,t);for(let t of n)e.altKey?this.elementsPendingErasure.delete(t.id):this.elementsPendingErasure.add(t.id)}}}},s=Ce(I(t.lastCoords.x,t.lastCoords.y),I(n.x,n.y)),c=this.getElementHitThreshold(),l={...t.lastCoords},u=0;for(;u<=s&&(o(this.getElementsAtPosition(l.x,l.y)),u!==s);){u=Math.min(u+c,s);let e=u/s,t=(1-e)*l.x+e*n.x,r=(1-e)*l.y+e*n.y;l.x=t,l.y=r}if(t.lastCoords.x=n.x,t.lastCoords.y=n.y,r){for(let t of this.scene.getNonDeletedElements())Ba(t)&&(this.elementsPendingErasure.has(t.id)||this.elementsPendingErasure.has(t.containerId))&&(e.altKey?(this.elementsPendingErasure.delete(t.id),this.elementsPendingErasure.delete(t.containerId)):(this.elementsPendingErasure.add(t.id),this.elementsPendingErasure.add(t.containerId)));this.elementsPendingErasure=new Set(this.elementsPendingErasure),this.triggerRender()}}),C(this,`handleTouchMove`,e=>{ND=!0}),C(this,`handleCanvasPointerDown`,e=>{let t=e.target;if(t.setPointerCapture&&t.setPointerCapture(e.pointerId),this.maybeCleanupAfterMissingPointerUp(e.nativeEvent),this.maybeUnfollowRemoteUser(),this.state.searchMatches&&(this.setState(e=>({searchMatches:e.searchMatches.map(e=>({...e,focus:!1}))})),Eg.set(sw,null)),this.state.contextMenu&&this.setState({contextMenu:null}),this.state.snapLines&&this.setAppState({snapLines:[]}),this.updateGestureOnPointerDown(e),e.pointerType===`touch`&&this.state.newElement&&this.state.newElement.type===`freedraw`){let e=this.state.newElement;this.updateScene({...e.points.length<10?{elements:this.scene.getElementsIncludingDeleted().filter(t=>t.id!==e.id)}:{},appState:{newElement:null,editingTextElement:null,startBoundElement:null,suggestedBindings:[],selectedElementIds:O(Object.keys(this.state.selectedElementIds).filter(t=>t!==e.id).reduce((e,t)=>(e[t]=this.state.selectedElementIds[t],e),{}),this.state)},captureUpdate:this.state.openDialog?.name===`elementLinkSelector`?N.EVENTUALLY:N.NEVER});return}let n=document.getSelection();if(n?.anchorNode&&n.removeAllRanges(),this.maybeOpenContextMenuAfterPointerDownOnTouchDevices(e),!this.state.penDetected&&e.pointerType===`pen`&&this.setState(e=>({penMode:!0,penDetected:!0})),!this.device.isTouchScreen&&[`pen`,`touch`].includes(e.pointerType)&&(this.device=Kc(this.device,{isTouchScreen:!0})),kD||(this.lastPointerDownEvent=e,this.handleCanvasPanUsingWheelOrSpaceDrag(e)))return;if(this.setState({lastPointerDownWith:e.pointerType,cursorButton:`down`}),this.savePointer(e.clientX,e.clientY,`down`),e.button===Tr.ERASER&&this.state.activeTool.type!==$u.eraser){this.setState({activeTool:fo(this.state,{type:$u.eraser,lastActiveToolBeforeEraser:this.state.activeTool})},()=>{this.handleCanvasPointerDown(e);let t=()=>{n(),r?.(),aa(this.state)&&this.setState({activeTool:fo(this.state,{...this.state.activeTool.lastActiveTool||{type:$u.selection},lastActiveToolBeforeEraser:null})})},n=tl(window,`pointerup`,t,{once:!0}),r;requestAnimationFrame(()=>{r=this.missingPointerEventCleanupEmitter.once(t)})});return}if(e.button!==Tr.MAIN&&e.button!==Tr.TOUCH&&e.button!==Tr.ERASER||$.pointers.size>1)return;let r=this.initialPointerDownState(e);if(this.setState({selectedElementsAreBeingDragged:!1}),this.handleDraggingScrollBar(e,r)||(this.clearSelectionIfNotUsingSelection(),this.updateBindingEnabledOnPointerMove(e),this.handleSelectionOnPointerDown(e,r))||!(!this.state.penMode||e.pointerType!==`touch`||this.state.activeTool.type===`selection`||this.state.activeTool.type===`text`||this.state.activeTool.type===`image`))return;if(this.state.activeTool.type===`text`)this.handleTextOnPointerDown(e,r);else if(this.state.activeTool.type===`arrow`||this.state.activeTool.type===`line`)this.handleLinearElementOnPointerDown(e,this.state.activeTool.type,r);else if(this.state.activeTool.type===`image`){z(this.interactiveCanvas,T.CROSSHAIR);let t=this.state.pendingImageElementId&&this.scene.getElement(this.state.pendingImageElementId);if(!t)return;this.setState({newElement:t,pendingImageElementId:null,multiElement:null});let{x:n,y:r}=Fs(e,this.state),i=this.getTopLayerFrameAtSceneCoords({x:n,y:r});W(t,{x:n,y:r,frameId:i?i.id:null})}else this.state.activeTool.type===`freedraw`?this.handleFreeDrawElementOnPointerDown(e,this.state.activeTool.type,r):this.state.activeTool.type===`custom`?Ul(this.interactiveCanvas,this.state):this.state.activeTool.type===$u.frame||this.state.activeTool.type===$u.magicframe?this.createFrameElementOnPointerDown(r,this.state.activeTool.type):this.state.activeTool.type===`laser`?this.laserTrails.startPath(r.lastCoords.x,r.lastCoords.y):this.state.activeTool.type!==`eraser`&&this.state.activeTool.type!==`hand`&&this.createGenericElementOnPointerDown(this.state.activeTool.type,r);this.props?.onPointerDown?.(this.state.activeTool,r),this.onPointerDownEmitter.trigger(this.state.activeTool,r,e),this.state.activeTool.type===`eraser`&&this.eraserTrail.startPath(r.lastCoords.x,r.lastCoords.y);let i=this.onPointerMoveFromPointerDownHandler(r),a=this.onPointerUpFromPointerDownHandler(r),o=this.onKeyDownFromPointerDownHandler(r),s=this.onKeyUpFromPointerDownHandler(r);this.missingPointerEventCleanupEmitter.once(t=>a(t||e.nativeEvent)),(!this.state.viewModeEnabled||this.state.activeTool.type===`laser`)&&(window.addEventListener(`pointermove`,i),window.addEventListener(`pointerup`,a),window.addEventListener(`keydown`,o),window.addEventListener(`keyup`,s),r.eventListeners.onMove=i,r.eventListeners.onUp=a,r.eventListeners.onKeyUp=s,r.eventListeners.onKeyDown=o)}),C(this,`handleCanvasPointerUp`,e=>{this.removePointer(e),this.lastPointerUpEvent=e;let t=Fs({clientX:e.clientX,clientY:e.clientY},this.state),n=e.timeStamp-(this.lastPointerDownEvent?.timeStamp??0);if(this.device.editor.isMobile&&n<300){let n=this.getElementAtPosition(t.x,t.y);if(er(n)&&this.isIframeLikeElementCenter(n,e,t.x,t.y)){this.handleEmbeddableCenterClick(n);return}}if(this.device.isTouchScreen){let e=this.getElementAtPosition(t.x,t.y);this.hitLinkElement=this.getElementLinkAtPosition(t,e)}this.hitLinkElement&&!this.state.selectedElementIds[this.hitLinkElement.id]?n<300&&er(this.hitLinkElement)&&!yu(this.hitLinkElement,this.scene.getNonDeletedElementsMap(),this.state,I(t.x,t.y))?this.handleEmbeddableCenterClick(this.hitLinkElement):this.redirectToLink(e,this.device.isTouchScreen):this.state.viewModeEnabled&&this.setState({activeEmbeddable:null,selectedElementIds:{}})}),C(this,`maybeOpenContextMenuAfterPointerDownOnTouchDevices`,e=>{e.pointerType===`touch`&&(ND=!1,MD?ND=!0:MD=window.setTimeout(()=>{MD=0,ND||this.handleCanvasContextMenu(e)},500))}),C(this,`resetContextMenuTimer`,()=>{clearTimeout(MD),MD=0,ND=!1}),C(this,`maybeCleanupAfterMissingPointerUp`,e=>{RD?.(),this.missingPointerEventCleanupEmitter.trigger(e).clear()}),C(this,`handleCanvasPanUsingWheelOrSpaceDrag`,e=>{if(!($.pointers.size<=1&&(e.button===Tr.WHEEL||e.button===Tr.MAIN&&OD||On(this.state)||this.state.viewModeEnabled)))return!1;kD=!0,this.focusContainer(),this.state.editingTextElement||e.preventDefault();let t=!1,n=/Linux/.test(window.navigator.platform);z(this.interactiveCanvas,T.GRABBING);let{clientX:r,clientY:i}=e,a=oE(e=>{let a=r-e.clientX,o=i-e.clientY;if(r=e.clientX,i=e.clientY,n&&!t&&(Math.abs(a)>1||Math.abs(o)>1)){t=!0;let e=t=>{document.body.removeEventListener(`paste`,e),t.stopPropagation()},n=()=>{setTimeout(()=>{document.body.removeEventListener(`paste`,e),window.removeEventListener(`pointerup`,n)},100)};document.body.addEventListener(`paste`,e),window.addEventListener(`pointerup`,n)}this.translateCanvas({scrollX:this.state.scrollX-a/this.state.zoom.value,scrollY:this.state.scrollY-o/this.state.zoom.value})}),o=aE(RD=()=>{RD=null,kD=!1,OD||(this.state.viewModeEnabled?z(this.interactiveCanvas,T.GRAB):Ul(this.interactiveCanvas,this.state)),this.setState({cursorButton:`up`}),this.savePointer(e.clientX,e.clientY,`up`),window.removeEventListener(`pointermove`,a),window.removeEventListener(`pointerup`,o),window.removeEventListener(`blur`,o),a.flush()});return window.addEventListener(`blur`,o),window.addEventListener(`pointermove`,a,{passive:!0}),window.addEventListener(`pointerup`,o),!0}),C(this,`clearSelectionIfNotUsingSelection`,()=>{this.state.activeTool.type!==`selection`&&this.setState({selectedElementIds:O({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null})}),C(this,`handleSelectionOnPointerDown`,(e,t)=>{if(this.state.activeTool.type===`selection`){let n=this.scene.getNonDeletedElements(),r=this.scene.getNonDeletedElementsMap(),i=this.scene.getSelectedElements(this.state);if(i.length===1&&!this.state.editingLinearElement&&!B(i[0])&&!(this.state.selectedLinearElement&&this.state.selectedLinearElement.hoverPointIndex!==-1)){let r=Po(n,this.state,t.origin.x,t.origin.y,this.state.zoom,e.pointerType,this.scene.getNonDeletedElementsMap(),this.device);r!=null&&(r.transformHandleType===`rotation`?(this.setState({resizingElement:r.element}),t.resize.handleType=r.transformHandleType):(this.state.croppingElementId||this.setState({resizingElement:r.element}),t.resize.handleType=r.transformHandleType))}else i.length>1&&(t.resize.handleType=tt(Ts(i),t.origin.x,t.origin.y,this.state.zoom,e.pointerType,this.device));if(t.resize.handleType)t.resize.isResizing=!0,t.resize.offset=ws(ro(t.resize.handleType,i,r,t.origin.x,t.origin.y)),i.length===1&&fc(i[0])&&i[0].points.length===2&&(t.resize.arrowDirection=Uo(t.resize.handleType,i[0]));else{if(this.state.selectedLinearElement){let n=this.state.editingLinearElement||this.state.selectedLinearElement,r=F.handlePointerDown(e,this,this.store,t.origin,n,this.scene);if(r.hitElement&&(t.hit.element=r.hitElement),r.linearElementEditor&&(this.setState({selectedLinearElement:r.linearElementEditor}),this.state.editingLinearElement&&this.setState({editingLinearElement:r.linearElementEditor})),r.didAddPoint)return!0}if(t.hit.element=t.hit.element??this.getElementAtPosition(t.origin.x,t.origin.y),this.hitLinkElement=this.getElementLinkAtPosition(t.origin,t.hit.element),this.hitLinkElement)return!0;if(this.state.croppingElementId&&t.hit.element?.id!==this.state.croppingElementId&&this.finishImageCropping(),t.hit.element&&this.getElementLinkAtPosition({x:t.origin.x,y:t.origin.y},t.hit.element))return!1;t.hit.allHitElements=this.getElementsAtPosition(t.origin.x,t.origin.y);let n=t.hit.element,r=t.hit.allHitElements.some(e=>this.isASelectedElement(e));if((n===null||!r)&&!e.shiftKey&&!t.hit.hasHitCommonBoundingBoxOfSelectedElements&&this.clearSelection(n),this.state.editingLinearElement)this.setState({selectedElementIds:O({[this.state.editingLinearElement.elementId]:!0},this.state)});else if(n!=null){if(e[D.CTRL_OR_CMD])return this.state.selectedElementIds[n.id]||(t.hit.wasAddedToSelection=!0),this.setState(e=>({...Qn(e,n),previousSelectedElementIds:this.state.selectedElementIds})),!1;this.state.selectedElementIds[n.id]||(this.state.editingGroupId&&!Xi(n,this.state.editingGroupId)&&this.setState({selectedElementIds:O({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null}),!r&&!t.hit.hasHitCommonBoundingBoxOfSelectedElements&&(this.setState(e=>{let t={...e.selectedElementIds,[n.id]:!0},r=[];if(Object.keys(e.selectedElementIds).forEach(e=>{let t=this.scene.getElement(e);t&&r.push(t)}),M(n))Mt(r,n.id).forEach(e=>{delete t[e.id]});else if(n.frameId)t[n.frameId]&&delete t[n.id];else{let e=n.groupIds,i=new Set(e.flatMap(e=>jo(this.scene.getNonDeletedElements(),e)).filter(e=>M(e)).map(e=>e.id));i.size>0&&r.forEach(e=>{e.frameId&&i.has(e.frameId)&&(delete t[e.id],e.groupIds.flatMap(e=>jo(this.scene.getNonDeletedElements(),e)).forEach(e=>{delete t[e.id]}))})}return e.openDialog?.name===`elementLinkSelector`&&(n.groupIds.some(t=>e.selectedGroupIds[t])||(t={[n.id]:!0})),{...Rl({editingGroupId:e.editingGroupId,selectedElementIds:t},this.scene.getNonDeletedElements(),e,this),showHyperlinkPopup:n.link||Fn(n)?`info`:!1}}),t.hit.wasAddedToSelection=!0))}this.setState({previousSelectedElementIds:this.state.selectedElementIds})}}return!1}),C(this,`handleTextOnPointerDown`,(e,t)=>{if(this.state.editingTextElement)return;let n=t.origin.x,r=t.origin.y,i=this.getElementAtPosition(n,r,{includeBoundTextElement:!0}),a=this.getTextBindableContainerAtPosition(n,r);Ou(i)&&(a=i,n=i.x+i.width/2,r=i.y+i.height/2),this.startTextEditing({sceneX:n,sceneY:r,insertAtParentCenter:!e.altKey,container:a,autoEdit:!1}),_l(this.interactiveCanvas),this.state.activeTool.locked||this.setState({activeTool:fo(this.state,{type:`selection`})})}),C(this,`handleFreeDrawElementOnPointerDown`,(e,t,n)=>{let[r,i]=Lr(n.origin.x,n.origin.y,null),a=this.getTopLayerFrameAtSceneCoords({x:r,y:i}),o=e.pressure===.5,s=yc({type:t,x:r,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:null,simulatePressure:o,locked:!1,frameId:a?a.id:null,points:[I(0,0)],pressures:o?[]:[e.pressure]});this.scene.insertElement(s),this.setState(e=>{let t={...e.selectedElementIds};return delete t[s.id],{selectedElementIds:O(t,e)}});let c=on(n.origin,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom);this.setState({newElement:s,startBoundElement:c,suggestedBindings:[]})}),C(this,`insertIframeElement`,({sceneX:e,sceneY:t,width:n,height:r})=>{let[i,a]=Lr(e,t,this.lastPointerDownEvent?.[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),o=Yu({type:`iframe`,x:i,y:a,strokeColor:`transparent`,backgroundColor:`transparent`,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,roundness:this.getCurrentItemRoundness(`iframe`),opacity:this.state.currentItemOpacity,locked:!1,width:n,height:r});return this.scene.insertElement(o),o}),C(this,`insertEmbeddableElement`,({sceneX:e,sceneY:t,link:n})=>{let[r,i]=Lr(e,t,this.lastPointerDownEvent?.[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=Ji(n);if(!a)return;a.error instanceof URIError&&this.setToast({message:q(`toast.unrecognizedLinkFormat`),closable:!0});let o=kn({type:`embeddable`,x:r,y:i,strokeColor:`transparent`,backgroundColor:`transparent`,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,roundness:this.getCurrentItemRoundness(`embeddable`),opacity:this.state.currentItemOpacity,locked:!1,width:a.intrinsicSize.w,height:a.intrinsicSize.h,link:n});return this.scene.insertElement(o),o}),C(this,`createImageElement`,({sceneX:e,sceneY:t,addToFrameUnderCursor:n=!0})=>{let[r,i]=Lr(e,t,this.lastPointerDownEvent?.[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=n?this.getTopLayerFrameAtSceneCoords({x:r,y:i}):null;return Vc({type:`image`,x:r,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,roundness:null,opacity:this.state.currentItemOpacity,locked:!1,frameId:a?a.id:null})}),C(this,`handleLinearElementOnPointerDown`,(e,t,n)=>{if(this.state.multiElement){let{multiElement:e}=this.state;if(e.type===`line`&&jt(e.points,this.state.zoom.value)){W(e,{lastCommittedPoint:e.points[e.points.length-1]}),this.actionManager.executeAction(Wv);return}if(B(e)&&e.points.length>1){W(e,{lastCommittedPoint:e.points[e.points.length-1]}),this.actionManager.executeAction(Wv);return}let{x:t,y:r,lastCommittedPoint:i}=e;if(e.points.length>1&&i&&Ce(I(n.origin.x-t,n.origin.y-r),i)<8){this.actionManager.executeAction(Wv);return}this.setState(t=>({selectedElementIds:O({...t.selectedElementIds,[e.id]:!0},t)})),W(e,{lastCommittedPoint:e.points[e.points.length-1]}),z(this.interactiveCanvas,T.POINTER)}else{let[r,i]=Lr(n.origin.x,n.origin.y,e[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),a=this.getTopLayerFrameAtSceneCoords({x:r,y:i}),{currentItemStartArrowhead:o,currentItemEndArrowhead:s}=this.state,[c,l]=t===`arrow`?[o,s]:[null,null],u=t===`arrow`?Fi({type:t,x:r,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:this.state.currentItemArrowType===nu.round?{type:Pc.PROPORTIONAL_RADIUS}:null,startArrowhead:c,endArrowhead:l,locked:!1,frameId:a?a.id:null,elbowed:this.state.currentItemArrowType===nu.elbow,fixedSegments:this.state.currentItemArrowType===nu.elbow?[]:null}):lr({type:t,x:r,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:this.state.currentItemRoundness===`round`?{type:Pc.PROPORTIONAL_RADIUS}:null,locked:!1,frameId:a?a.id:null});this.setState(e=>{let t={...e.selectedElementIds};return delete t[u.id],{selectedElementIds:O(t,e)}}),W(u,{points:[...u.points,I(0,0)]});let d=on(n.origin,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom,B(u),B(u));this.scene.insertElement(u),this.setState({newElement:u,startBoundElement:d,suggestedBindings:[]})}}),C(this,`createGenericElementOnPointerDown`,(e,t)=>{let[n,r]=Lr(t.origin.x,t.origin.y,this.lastPointerDownEvent?.[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),i=this.getTopLayerFrameAtSceneCoords({x:n,y:r}),a={x:n,y:r,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,roundness:this.getCurrentItemRoundness(e),locked:!1,frameId:i?i.id:null},o;o=e===`embeddable`?kn({type:`embeddable`,...a}):ni({type:e,...a}),o.type===`selection`?this.setState({selectionElement:o}):(this.scene.insertElement(o),this.setState({multiElement:null,newElement:o}))}),C(this,`createFrameElementOnPointerDown`,(e,t)=>{let[n,r]=Lr(e.origin.x,e.origin.y,this.lastPointerDownEvent?.[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),i={x:n,y:r,opacity:this.state.currentItemOpacity,locked:!1,...Ue},a=t===$u.magicframe?Mr(i):os(i);this.scene.insertElement(a),this.setState({multiElement:null,newElement:a})}),C(this,`restoreReadyToEraseElements`,()=>{this.elementsPendingErasure=new Set,this.triggerRender()}),C(this,`eraseElements`,()=>{let e=!1,t=this.scene.getElementsIncludingDeleted().map(t=>this.elementsPendingErasure.has(t.id)||t.frameId&&this.elementsPendingErasure.has(t.frameId)||Ba(t)&&this.elementsPendingErasure.has(t.containerId)?(e=!0,A(t,{isDeleted:!0})):t);this.elementsPendingErasure=new Set,e&&(this.store.shouldCaptureIncrement(),this.scene.replaceAllElements(t))}),C(this,`initializeImage`,async({imageFile:e,imageElement:t,showCursorImagePreview:n=!1})=>{if(!ba(e))throw Error(q(`errors.unsupportedFileType`));let r=e.type;if(z(this.interactiveCanvas,`wait`),r===rn.svg)try{e=tc(Oi(await e.text()),e.name)}catch(e){throw console.warn(e),Error(q(`errors.svgImageInsertError`))}let i=await(this.props.generateIdForFile?.(e)||yl(e));if(!i)throw console.warn("Couldn't generate file id or the supplied `generateIdForFile` didn't resolve to one."),Error(q(`errors.imageInsertError`));if(!this.files[i]?.dataURL){try{e=await Ca(e,{maxWidthOrHeight:dt})}catch(e){console.error(`Error trying to resizing image file on insertion`,e)}if(e.size>4194304)throw Error(q(`errors.fileTooBig`,{maxSize:`${Math.trunc(qo/1024/1024)}MB`}))}if(n){let t=this.files[i]?.dataURL,n=t&&xi(t);this.setImagePreviewCursor(n||e)}let a=this.files[i]?.dataURL||await ld(e),o=W(t,{fileId:i},!1);return new Promise(async(e,t)=>{try{this.addMissingFiles([{mimeType:r,id:i,dataURL:a,created:Date.now(),lastRetrieved:Date.now()}]);let t=this.imageCache.get(i);t||(this.addNewImagesToImageCache(),await this.updateImageCache([o])),t?.image instanceof Promise&&await t.image,this.state.pendingImageElementId!==o.id&&this.state.newElement?.id!==o.id&&this.initializeImageDimensions(o,!0),e(o)}catch(e){console.error(e),t(Error(q(`errors.imageInsertError`)))}finally{n||_l(this.interactiveCanvas)}})}),C(this,`insertImageElement`,async(e,t,n)=>{if(!this.isToolSupported(`image`)){this.setState({errorMessage:q(`errors.imageToolNotSupported`)});return}this.scene.insertElement(e);try{return await this.initializeImage({imageFile:t,imageElement:e,showCursorImagePreview:n})}catch(t){return W(e,{isDeleted:!0}),this.actionManager.executeAction(Wv),this.setState({errorMessage:t.message||q(`errors.imageInsertError`)}),null}}),C(this,`setImagePreviewCursor`,async e=>{let t;try{t=await Ca(e,{maxWidthOrHeight:96})}catch(e){throw e.cause===`UNSUPPORTED`?Error(q(`errors.unsupportedFileType`)):e}let n=await ld(t);if(e.type===rn.svg){let e=await Zc(n),t=Math.min(e.height,96),r=t*(e.width/e.height);r>96&&(r=96,t=r*(e.height/e.width));let i=document.createElement(`canvas`);i.height=t,i.width=r,i.getContext(`2d`).drawImage(e,0,0,r,t),n=i.toDataURL(rn.svg)}this.state.pendingImageElementId&&z(this.interactiveCanvas,`url(${n}) 4 4, auto`)}),C(this,`onImageAction`,async({insertOnCanvasDirectly:e})=>{try{let{x:t,y:n}=Fs({clientX:this.state.width/2+this.state.offsetLeft,clientY:this.state.height/2+this.state.offsetTop},this.state),r=await sn({description:`Image`,extensions:Object.keys(Mc)}),i=this.createImageElement({sceneX:t,sceneY:n,addToFrameUnderCursor:!1});e?(this.insertImageElement(i,r),this.initializeImageDimensions(i),this.setState({selectedElementIds:O({[i.id]:!0},this.state)},()=>{this.actionManager.executeAction(Wv)})):this.setState({pendingImageElementId:i.id},()=>{this.insertImageElement(i,r,!0)})}catch(e){e.name===`AbortError`?console.warn(e):console.error(e),this.setState({pendingImageElementId:null,newElement:null,activeTool:fo(this.state,{type:`selection`})},()=>{this.actionManager.executeAction(Wv)})}}),C(this,`initializeImageDimensions`,(e,t=!1)=>{let n=qe(e)&&this.imageCache.get(e.fileId)?.image;if(!n||n instanceof Promise){if(e.width<10/this.state.zoom.value&&e.height<10/this.state.zoom.value){let t=100/this.state.zoom.value;W(e,{x:e.x-t/2,y:e.y-t/2,width:t,height:t})}return}if(t||e.width<10/this.state.zoom.value&&e.height<10/this.state.zoom.value){let t=Math.max(this.state.height-120,160),r=Math.min(t,Math.floor(this.state.height*.5)/this.state.zoom.value),i=Math.min(n.naturalHeight,r),a=i*(n.naturalWidth/n.naturalHeight);W(e,{x:e.x+e.width/2-a/2,y:e.y+e.height/2-i/2,width:a,height:i,crop:null})}}),C(this,`updateImageCache`,async(e,t=this.files)=>{let{updatedFiles:n,erroredFiles:r}=await Qa({imageCache:this.imageCache,fileIds:e.map(e=>e.fileId),files:t});if(n.size||r.size)for(let t of e)n.has(t.fileId)&&We.delete(t);return r.size&&this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().map(e=>qe(e)&&r.has(e.fileId)?A(e,{status:`error`}):e)),{updatedFiles:n,erroredFiles:r}}),C(this,`addNewImagesToImageCache`,async(e=eu(this.scene.getNonDeletedElements()),t=this.files)=>{let n=e.filter(e=>!e.isDeleted&&!this.imageCache.has(e.fileId));if(n.length){let{updatedFiles:e}=await this.updateImageCache(n,t);e.size&&this.scene.triggerUpdate()}}),C(this,`scheduleImageRefresh`,(0,_g.default)(()=>{this.addNewImagesToImageCache()},500)),C(this,`updateBindingEnabledOnPointerMove`,e=>{let t=nt(e);this.state.isBindingEnabled!==t&&this.setState({isBindingEnabled:t})}),C(this,`maybeSuggestBindingAtCursor`,(e,t)=>{let n=on(e,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom,!1,t);this.setState({suggestedBindings:n==null?[]:[n]})}),C(this,`maybeSuggestBindingsForLinearElementAtCoords`,(e,t,n)=>{if(!t.length)return;let r=t.reduce((t,r)=>{let i=on(r,this.scene.getNonDeletedElements(),this.scene.getNonDeletedElementsMap(),this.state.zoom,B(e),B(e));return i!=null&&!yo(e,n?.id,i)&&t.push(i),t},[]);this.setState({suggestedBindings:r})}),C(this,`handleInteractiveCanvasRef`,e=>{e===null?(this.interactiveCanvas?.removeEventListener(`touchstart`,this.onTouchStart),this.interactiveCanvas?.removeEventListener(`touchend`,this.onTouchEnd)):(this.interactiveCanvas=e,this.interactiveCanvas.addEventListener(`touchstart`,this.onTouchStart,{passive:!1}),this.interactiveCanvas.addEventListener(`touchend`,this.onTouchEnd))}),C(this,`handleAppOnDrop`,async e=>{let{file:t,fileHandle:n}=await lt(e),{x:r,y:i}=Fs(e,this.state);try{if(ba(t)&&this.isToolSupported(`image`)){if(t?.type===rn.png||t?.type===rn.svg)try{let e=await Uc(t,this.state,this.scene.getElementsIncludingDeleted(),n);this.syncActionResult({...e,appState:{...e.appState||this.state,isLoading:!1},replaceFiles:!0,captureUpdate:N.IMMEDIATELY});return}catch(e){if(e.name!==`EncodingError`)throw Error(q(`alerts.couldNotLoadInvalidFile`))}let e=this.createImageElement({sceneX:r,sceneY:i});this.insertImageElement(e,t),this.initializeImageDimensions(e),this.setState({selectedElementIds:O({[e.id]:!0},this.state)});return}}catch(e){return this.setState({isLoading:!1,errorMessage:e.message})}let a=e.dataTransfer.getData(rn.excalidrawlib);if(a&&typeof a==`string`){try{let t=Ao(a);this.addElementsFromPasteOrLibrary({elements:Eb(t),position:e,files:null})}catch(e){this.setState({errorMessage:e.message})}return}if(t&&await this.loadFileToCanvas(t,n),e.dataTransfer?.types?.includes(`text/plain`)){let t=e.dataTransfer?.getData(`text`);if(t&&mr(t,this.props.validateEmbeddable)&&(/^(http|https):\/\/[^\s/$.?#].[^\s]*$/.test(t)||Ji(t)?.type===`video`)){let e=this.insertEmbeddableElement({sceneX:r,sceneY:i,link:Sn(t)});e&&this.setState({selectedElementIds:{[e.id]:!0}})}}}),C(this,`loadFileToCanvas`,async(e,t)=>{e=await zc(e);try{let n=this.scene.getElementsIncludingDeleted(),r;try{r=await $i(e,this.state,n,t)}catch(e){let t=e instanceof vn;if(t&&e.code===`IMAGE_NOT_CONTAINS_SCENE_DATA`&&!this.isToolSupported(`image`)){this.setState({isLoading:!1,errorMessage:q(`errors.imageToolNotSupported`)});return}let n=q(t?`alerts.cannotRestoreFromImage`:`alerts.couldNotLoadInvalidFile`);this.setState({isLoading:!1,errorMessage:n})}if(!r)return;r.type===rn.excalidraw?(eo(n.concat(r.data.elements)),this.store.updateSnapshot(P(n),this.state),this.setState({isLoading:!0}),this.syncActionResult({...r.data,appState:{...r.data.appState||this.state,isLoading:!1},replaceFiles:!0,captureUpdate:N.IMMEDIATELY})):r.type===rn.excalidrawlib&&await this.library.updateLibrary({libraryItems:e,merge:!0,openLibraryMenu:!0}).catch(e=>{console.error(e),this.setState({errorMessage:q(`errors.importLibraryError`)})})}catch(e){this.setState({isLoading:!1,errorMessage:e.message})}}),C(this,`handleCanvasContextMenu`,e=>{if(e.preventDefault(),(`pointerType`in e.nativeEvent&&e.nativeEvent.pointerType===`touch`||`pointerType`in e.nativeEvent&&e.nativeEvent.pointerType===`pen`&&e.button!==Tr.SECONDARY)&&this.state.activeTool.type!==`selection`)return;let{x:t,y:n}=Fs(e,this.state),r=this.getElementAtPosition(t,n,{preferSelected:!0,includeLockedElements:!0}),i=this.scene.getSelectedElements(this.state),a=this.isHittingCommonBoundingBoxOfSelectedElements({x:t,y:n},i),o=r||a?`element`:`canvas`,{top:s,left:c}=this.excalidrawContainerRef.current.getBoundingClientRect(),l=e.clientX-c,u=e.clientY-s;Y(`contextMenu`,`openContextMenu`,o),this.setState({...r&&!this.state.selectedElementIds[r.id]?{...this.state,...Rl({editingGroupId:this.state.editingGroupId,selectedElementIds:{[r.id]:!0}},this.scene.getNonDeletedElements(),this.state,this),selectedLinearElement:fc(r)?new F(r):null}:this.state,showHyperlinkPopup:!1},()=>{this.setState({contextMenu:{top:u,left:l,items:this.getContextMenuItems(o)}})})}),C(this,`maybeDragNewGenericElement`,(e,t,n=!0)=>{let r=this.state.selectionElement,i=e.lastCoords;if(r&&this.state.activeTool.type!==`eraser`){_n({newElement:r,elementType:this.state.activeTool.type,originX:e.origin.x,originY:e.origin.y,x:i.x,y:i.y,width:Da(e.origin.x,i.x),height:Da(e.origin.y,i.y),shouldMaintainAspectRatio:ls(t),shouldResizeFromCenter:Ei(t),zoom:this.state.zoom.value,informMutation:n});return}let a=this.state.newElement;if(!a)return;let[o,s]=Lr(i.x,i.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),c=qe(a)&&this.imageCache.get(a.fileId)?.image,l=c&&!(c instanceof Promise)?c.width/c.height:null;this.maybeCacheReferenceSnapPoints(t,[a]);let{snapOffset:u,snapLines:d}=Ic(a,this,t,{x:e.originInGrid.x+(this.state.originSnapOffset?.x??0),y:e.originInGrid.y+(this.state.originSnapOffset?.y??0)},{x:o-e.originInGrid.x,y:s-e.originInGrid.y},this.scene.getNonDeletedElementsMap());o+=u.x,s+=u.y,this.setState({snapLines:d}),_n({newElement:a,elementType:this.state.activeTool.type,originX:e.originInGrid.x,originY:e.originInGrid.y,x:o,y:s,width:Da(e.originInGrid.x,o),height:Da(e.originInGrid.y,s),shouldMaintainAspectRatio:De(a)?!ls(t):ls(t),shouldResizeFromCenter:Ei(t),zoom:this.state.zoom.value,widthAspectRatio:l,originOffset:this.state.originSnapOffset,informMutation:n}),this.setState({newElement:a}),(this.state.activeTool.type===$u.frame||this.state.activeTool.type===$u.magicframe)&&this.setState({elementsToHighlight:ol(this.scene.getNonDeletedElements(),a,this.state,this.scene.getNonDeletedElementsMap())})}),C(this,`maybeHandleCrop`,(e,t)=>{if(!this.state.croppingElementId)return!1;let n=e.resize.handleType,r=e.lastCoords,[i,a]=Lr(r.x-e.resize.offset.x,r.y-e.resize.offset.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),o=this.scene.getNonDeletedElementsMap().get(this.state.croppingElementId);if(n&&o&&De(o)){let s=e.originalElements.get(o.id),c=qe(o)&&this.imageCache.get(o.fileId)?.image;if(s&&De(s)&&c&&!(c instanceof Promise)){let[l,u]=Lr(r.x,r.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),d={x:l-e.originInGrid.x,y:u-e.originInGrid.y};this.maybeCacheReferenceSnapPoints(t,[o]);let{snapOffset:f,snapLines:p}=Xe([o],[s],this,t,d,n);W(o,hr(o,n,c.naturalWidth,c.naturalHeight,i+f.x,a+f.y,t.shiftKey?s.width/s.height:void 0)),ao(o,this.scene.getNonDeletedElementsMap(),{newSize:{width:o.width,height:o.height}}),this.setState({isCropping:n&&n!==`rotation`,snapLines:p})}return!0}return!1}),C(this,`maybeHandleResize`,(e,t)=>{let n=this.scene.getSelectedElements(this.state),r=n.filter(e=>M(e)),i=e.resize.handleType;if(r.length>0&&i===`rotation`||n.length===1&&B(n[0])||this.state.croppingElementId)return!1;this.setState({isResizing:i&&i!==`rotation`,isRotating:i===`rotation`,activeEmbeddable:null});let a=e.lastCoords,[o,s]=Lr(a.x-e.resize.offset.x,a.y-e.resize.offset.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),c=new Map;if(r.forEach(e=>{Mt(this.scene.getNonDeletedElements(),e.id).forEach(t=>{c.set(e.id+t.id,{x:t.x-e.x,y:t.y-e.y})})}),!this.state.selectedElementsAreBeingDragged){let[r,c]=Lr(a.x,a.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),l={x:r-e.originInGrid.x,y:c-e.originInGrid.y},u=[...e.originalElements.values()];this.maybeCacheReferenceSnapPoints(t,n);let{snapOffset:d,snapLines:f}=Xe(n,V(u,this.state),this,t,l,i);o+=d.x,s+=d.y,this.setState({snapLines:f})}if(xa(e.originalElements,i,n,this.scene.getElementsMapIncludingDeleted(),this.scene,ft(t),Ei(t),n.some(e=>De(e))?!ls(t):ls(t),o,s,e.resize.center.x,e.resize.center.y)){let e=na(n,this.scene.getNonDeletedElementsMap(),this.state.zoom),t=new Set;return r.forEach(e=>{ol(this.scene.getNonDeletedElements(),e,this.state,this.scene.getNonDeletedElementsMap()).forEach(e=>t.add(e))}),this.setState({elementsToHighlight:[...t],suggestedBindings:e}),!0}return!1}),C(this,`getContextMenuItems`,e=>{let t=[];return t.push(Iy,Fy),e===`canvas`?this.state.viewModeEnabled?[...t,Ry,zy,qT,Vy]:[Ny,yS,Iy,Fy,Ly,yS,l_,db,yS,Ry,By,zy,qT,Vy]:(t.push(Ly),this.state.viewModeEnabled?[My,...t]:[yS,Py,My,Ny,yS,YT,XT,ZT,yS,aS,yS,...t,yS,sy,cy,yS,fy,rD,Hy,Uy,Ky,py,yS,by,yS,a_,o_,s_,c_,yS,Oy,ky,yS,rS,yS,cb,Jx,yS,p_,ub,yS,Wg])}),C(this,`handleWheel`,aE(e=>{if(!(e.target instanceof HTMLCanvasElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLIFrameElement)){e[D.CTRL_OR_CMD]&&e.preventDefault();return}if(e.preventDefault(),kD)return;let{deltaX:t,deltaY:n}=e;if(e.metaKey||e.ctrlKey){let e=Math.sign(n),t=Sa*100,r=Math.abs(n),i=n;r>t&&(i=t*e);let a=this.state.zoom.value-i/100;a+=Math.log10(Math.max(1,this.state.zoom.value))*-e*Math.min(1,r/20),this.translateCanvas(e=>({...Av({viewportX:this.lastViewportPosition.x,viewportY:this.lastViewportPosition.y,nextZoom:Ne(a)},e),shouldCacheIgnoreZoom:!0})),this.resetShouldCacheIgnoreZoomDebounced();return}if(e.shiftKey){this.translateCanvas(({zoom:e,scrollX:r})=>({scrollX:r-(n||t)/e.value}));return}this.translateCanvas(({zoom:e,scrollX:r,scrollY:i})=>({scrollX:r-t/e.value,scrollY:i-n/e.value}))})),C(this,`savePointer`,(e,t,n)=>{if(!e||!t)return;let{x:r,y:i}=Fs({clientX:e,clientY:t},this.state),a={x:r,y:i,tool:this.state.activeTool.type===`laser`?`laser`:`pointer`};this.props.onPointerUpdate?.({pointer:a,button:n,pointersMap:$.pointers})}),C(this,`resetShouldCacheIgnoreZoomDebounced`,jl(()=>{this.unmounted||this.setState({shouldCacheIgnoreZoom:!1})},300)),C(this,`updateDOMRect`,e=>{if(this.excalidrawContainerRef?.current){let{width:t,height:n,left:r,top:i}=this.excalidrawContainerRef.current.getBoundingClientRect(),{width:a,height:o,offsetTop:s,offsetLeft:c}=this.state;if(t===a&&n===o&&r===c&&i===s){e&&e();return}this.setState({width:t,height:n,offsetLeft:r,offsetTop:i},()=>{e&&e()})}}),C(this,`refresh`,()=>{this.setState({...this.getCanvasOffsets()})});let n=Ii(),{excalidrawAPI:r,viewModeEnabled:i=!1,zenModeEnabled:a=!1,gridModeEnabled:o=!1,objectsSnapModeEnabled:l=!1,theme:u=n.theme,name:d=`${q(`labels.untitled`)}-${ul()}`}=t;if(this.state={...n,theme:u,isLoading:!0,...this.getCanvasOffsets(),viewModeEnabled:i,zenModeEnabled:a,objectsSnapModeEnabled:l,gridModeEnabled:o??n.gridModeEnabled,name:d,width:window.innerWidth,height:window.innerHeight},this.id=s(),this.library=new Tb(this),this.actionManager=new mS(this.syncActionResult,()=>this.state,()=>this.scene.getElementsIncludingDeleted(),this),this.scene=new Zs,this.canvas=document.createElement(`canvas`),this.rc=Fa.canvas(this.canvas),this.renderer=new WE(this.scene),this.visibleElements=[],this.store=new ku,this.history=new sS,r){let e={updateScene:this.updateScene,updateLibrary:this.library.updateLibrary,addFiles:this.addFiles,resetScene:this.resetScene,getSceneElementsIncludingDeleted:this.getSceneElementsIncludingDeleted,history:{clear:this.resetHistory},scrollToContent:this.scrollToContent,getSceneElements:this.getSceneElements,getAppState:()=>this.state,getFiles:()=>this.files,getName:this.getName,registerAction:e=>{this.actionManager.registerAction(e)},refresh:this.refresh,setToast:this.setToast,id:this.id,setActiveTool:this.setActiveTool,setCursor:this.setCursor,resetCursor:this.resetCursor,updateFrameRendering:this.updateFrameRendering,toggleSidebar:this.toggleSidebar,onChange:e=>this.onChangeEmitter.on(e),onPointerDown:e=>this.onPointerDownEmitter.on(e),onPointerUp:e=>this.onPointerUpEmitter.on(e),onScrollChange:e=>this.onScrollChangeEmitter.on(e),onUserFollow:e=>this.onUserFollowEmitter.on(e)};typeof r==`function`?r(e):console.error(`excalidrawAPI should be a function!`)}this.excalidrawContainerValue={container:this.excalidrawContainerRef.current,id:this.id},this.fonts=new Qu(this.scene),this.history=new sS,this.actionManager.registerAll(zr),this.actionManager.registerAction(dS(this.history,this.store)),this.actionManager.registerAction(fS(this.history,this.store))}onWindowMessage(e){if(e.origin!==`https://player.vimeo.com`&&e.origin!==`https://www.youtube.com`)return;let t=null;try{t=JSON.parse(e.data)}catch{}if(t)switch(e.origin){case`https://player.vimeo.com`:if(t.method===`paused`){let n=null,r=document.body.querySelectorAll(`iframe.excalidraw__embeddable`);if(!r)break;for(let t of r)t.contentWindow===e.source&&(n=t.contentWindow);n?.postMessage(JSON.stringify({method:t.value?`play`:`pause`,value:!0}),`*`)}break;case`https://www.youtube.com`:if(t.event===`infoDelivery`&&t.info&&t.id&&typeof t.info.playerState==`number`){let e=t.id,n=t.info.playerState;Object.values(rs).includes(n)&&PD.set(e,n)}break}}cacheEmbeddableRef(e,t){t&&this.iFrameRefs.set(e.id,t)}getHTMLIFrameElement(e){return this.iFrameRefs.get(e.id)}handleEmbeddableCenterClick(e){if(this.state.activeEmbeddable?.element===e&&this.state.activeEmbeddable?.state===`active`||(setTimeout(()=>{this.setState({activeEmbeddable:{element:e,state:`active`},selectedElementIds:{[e.id]:!0},newElement:null,selectionElement:null})},100),Xl(e)))return;let t=this.getHTMLIFrameElement(e);if(t?.contentWindow){if(t.src.includes(`youtube`)){let n=PD.get(e.id);switch(n||(PD.set(e.id,rs.UNSTARTED),t.contentWindow.postMessage(JSON.stringify({event:`listening`,id:e.id}),`*`)),n){case rs.PLAYING:case rs.BUFFERING:t.contentWindow?.postMessage(JSON.stringify({event:`command`,func:`pauseVideo`,args:``}),`*`);break;default:t.contentWindow?.postMessage(JSON.stringify({event:`command`,func:`playVideo`,args:``}),`*`)}}t.src.includes(`player.vimeo.com`)&&t.contentWindow.postMessage(JSON.stringify({method:`paused`}),`*`)}}isIframeLikeElementCenter(e,t,n,r){return e&&!t.altKey&&!t.shiftKey&&!t.metaKey&&!t.ctrlKey&&(this.state.activeEmbeddable?.element!==e||this.state.activeEmbeddable?.state===`hover`||!this.state.activeEmbeddable)&&n>=e.x+e.width/3&&n<=e.x+2*e.width/3&&r>=e.y+e.height/3&&r<=e.y+2*e.height/3}renderEmbeddables(){let e=this.state.zoom.value,t=this.state.width,n=this.state.height;return(0,K.jsx)(K.Fragment,{children:this.scene.getNonDeletedElements().filter(e=>Fn(e)&&this.embedsValidationStatus.get(e.id)===!0||Xl(e)).map(r=>{let{x:i,y:a}=ga({sceneX:r.x,sceneY:r.y},this.state),o=Ku(r,t,n,this.state,this.scene.getNonDeletedElementsMap()),s=this.initializedEmbeds.has(r.id);if(o&&!s&&this.initializedEmbeds.add(r.id),!(o||s))return null;let c;if(Xl(r)){c=null;let e=(r.customData?.generationData??this.magicGenerations.get(r.id))||{status:`error`,message:`No generation data`,code:`ERR_NO_GENERATION_DATA`};if(e.status===`done`){let t=e.html;c={intrinsicSize:{w:r.width,h:r.height},type:`document`,srcdoc:()=>t}}else if(e.status===`pending`)c={intrinsicSize:{w:r.width,h:r.height},type:`document`,srcdoc:()=>cc(`
                    <style>
                      html, body {
                        width: 100%;
                        height: 100%;
                        color: ${this.state.theme===R.DARK?`white`:`black`};
                      }
                      body {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-direction: column;
                        gap: 1rem;
                      }

                      .Spinner {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-left: auto;
                        margin-right: auto;
                      }

                      .Spinner svg {
                        animation: rotate 1.6s linear infinite;
                        transform-origin: center center;
                        width: 40px;
                        height: 40px;
                      }

                      .Spinner circle {
                        stroke: currentColor;
                        animation: dash 1.6s linear 0s infinite;
                        stroke-linecap: round;
                      }

                      @keyframes rotate {
                        100% {
                          transform: rotate(360deg);
                        }
                      }

                      @keyframes dash {
                        0% {
                          stroke-dasharray: 1, 300;
                          stroke-dashoffset: 0;
                        }
                        50% {
                          stroke-dasharray: 150, 300;
                          stroke-dashoffset: -200;
                        }
                        100% {
                          stroke-dasharray: 1, 300;
                          stroke-dashoffset: -280;
                        }
                      }
                    </style>
                    <div class="Spinner">
                      <svg
                        viewBox="0 0 100 100"
                      >
                        <circle
                          cx="50"
                          cy="50"
                          r="46"
                          stroke-width="8"
                          fill="none"
                          stroke-miter-limit="10"
                        />
                      </svg>
                    </div>
                    <div>Generating...</div>
                  `)};else{let t;t=e.code===`ERR_GENERATION_INTERRUPTED`?`Generation was interrupted...`:e.message||`Generation failed`,c={intrinsicSize:{w:r.width,h:r.height},type:`document`,srcdoc:()=>cc(`
                    <style>
                    html, body {
                      height: 100%;
                    }
                      body {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        color: ${Dt.red[3]};
                      }
                      h1, h3 {
                        margin-top: 0;
                        margin-bottom: 0.5rem;
                      }
                    </style>
                    <h1>Error!</h1>
                    <h3>${t}</h3>
                  `)}}}else c=Ji(gu(r.link||``));let l=this.state.activeEmbeddable?.element===r&&this.state.activeEmbeddable?.state===`active`,u=this.state.activeEmbeddable?.element===r&&this.state.activeEmbeddable?.state===`hover`;return(0,K.jsx)(`div`,{className:L(`excalidraw__embeddable-container`,{"is-hovered":u}),style:{transform:o?`translate(${i-this.state.offsetLeft}px, ${a-this.state.offsetTop}px) scale(${e})`:`none`,display:o?`block`:`none`,opacity:Ai(r,Ml(r,this.scene.getNonDeletedElementsMap()),this.elementsPendingErasure,null,this.state.openDialog?.name===`elementLinkSelector`?bc:1),"--embeddable-radius":`${xl(Math.min(r.width,r.height),r)}px`},children:(0,K.jsxs)(`div`,{className:`excalidraw__embeddable-container__inner`,style:{width:o?`${r.width}px`:0,height:o?`${r.height}px`:0,transform:o?`rotate(${r.angle}rad)`:`none`,pointerEvents:l?Zu.enabled:Zu.disabled},children:[u&&(0,K.jsx)(`div`,{className:`excalidraw__embeddable-hint`,children:q(`buttons.embeddableInteractionButton`)}),(0,K.jsx)(`div`,{className:`excalidraw__embeddable__outer`,style:{padding:`${r.strokeWidth}px`},children:(Fn(r)?this.props.renderEmbeddable?.(r,this.state):null)??(0,K.jsx)(`iframe`,{ref:e=>this.cacheEmbeddableRef(r,e),className:`excalidraw__embeddable`,srcDoc:c?.type===`document`?c.srcdoc(this.state.theme):void 0,src:c?.type===`document`?void 0:c?.link??``,scrolling:`no`,referrerPolicy:`no-referrer-when-downgrade`,title:`Excalidraw Embedded Content`,allow:`accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture`,allowFullScreen:!0,sandbox:`${c?.sandbox?.allowSameOrigin?`allow-same-origin`:``} allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation allow-downloads`})})]})},r.id)})})}toggleOverscrollBehavior(e){document.documentElement.style.overscrollBehaviorX=e.type===`pointerenter`?`none`:`auto`}render(){let e=this.scene.getSelectedElements(this.state),{renderTopRightUI:t,renderCustomStats:n}=this.props,r=this.scene.getSceneNonce(),{elementsMap:i,visibleElements:a}=this.renderer.getRenderableElements({sceneNonce:r,zoom:this.state.zoom,offsetLeft:this.state.offsetLeft,offsetTop:this.state.offsetTop,scrollX:this.state.scrollX,scrollY:this.state.scrollY,height:this.state.height,width:this.state.width,editingTextElement:this.state.editingTextElement,newElementId:this.state.newElement?.id,pendingImageElementId:this.state.pendingImageElementId});this.visibleElements=a;let o=this.scene.getNonDeletedElementsMap(),s=`setPointerCapture`in HTMLElement.prototype?!1:this.state.selectionElement||this.state.newElement||this.state.selectedElementsAreBeingDragged||this.state.resizingElement||this.state.activeTool.type===`laser`&&this.state.cursorButton===`down`,c=e[0];return(0,K.jsx)(`div`,{className:L(`excalidraw excalidraw-container`,{"excalidraw--view-mode":this.state.viewModeEnabled||this.state.openDialog?.name===`elementLinkSelector`,"excalidraw--mobile":this.device.editor.isMobile}),style:{"--ui-pointerEvents":s?Zu.disabled:Zu.enabled,"--right-sidebar-width":`302px`},ref:this.excalidrawContainerRef,onDrop:this.handleAppOnDrop,tabIndex:0,onKeyDown:this.props.handleKeyboardGlobally?void 0:this.onKeyDown,onPointerEnter:this.toggleOverscrollBehavior,onPointerLeave:this.toggleOverscrollBehavior,children:(0,K.jsx)(lD.Provider,{value:this,children:(0,K.jsx)(uD.Provider,{value:this.props,children:(0,K.jsx)(pD.Provider,{value:this.excalidrawContainerValue,children:(0,K.jsx)(fD.Provider,{value:this.device,children:(0,K.jsx)(gD.Provider,{value:this.setAppState,children:(0,K.jsx)(hD.Provider,{value:this.state,children:(0,K.jsxs)(mD.Provider,{value:this.scene.getNonDeletedElements(),children:[(0,K.jsxs)(_D.Provider,{value:this.actionManager,children:[(0,K.jsx)(WT,{canvas:this.canvas,appState:this.state,files:this.files,setAppState:this.setAppState,actionManager:this.actionManager,elements:this.scene.getNonDeletedElements(),onLockToggle:this.toggleLock,onPenModeToggle:this.togglePenMode,onHandToolToggle:this.onHandToolToggle,langCode:Fg().code,renderTopRightUI:t,renderCustomStats:n,showExitZenModeBtn:typeof this.props?.zenModeEnabled>`u`&&this.state.zenModeEnabled,UIOptions:this.props.UIOptions,onExportImage:this.onExportImage,renderWelcomeScreen:!this.state.isLoading&&this.state.showWelcomeScreen&&this.state.activeTool.type===`selection`&&!this.state.zenModeEnabled&&!this.scene.getElementsIncludingDeleted().length,app:this,isCollaborating:this.props.isCollaborating,generateLinkForSelection:this.props.generateLinkForSelection,children:this.props.children}),(0,K.jsx)(`div`,{className:`excalidraw-textEditorContainer`}),(0,K.jsx)(`div`,{className:`excalidraw-contextMenuContainer`}),(0,K.jsx)(`div`,{className:`excalidraw-eye-dropper-container`}),(0,K.jsx)(GE,{trails:[this.laserTrails,this.eraserTrail]}),e.length===1&&this.state.openDialog?.name!==`elementLinkSelector`&&this.state.showHyperlinkPopup&&(0,K.jsx)(eb,{element:c,elementsMap:o,setAppState:this.setAppState,onLinkOpen:this.props.onLinkOpen,setToast:this.setToast,updateEmbedValidationStatus:this.updateEmbedValidationStatus},c.id),this.props.aiEnabled!==!1&&e.length===1&&Ro(c)&&(0,K.jsx)(JE,{element:c,elementsMap:i,children:(0,K.jsx)(XE,{title:q(`labels.convertToCode`),icon:uo,checked:!1,onChange:()=>this.onMagicFrameGenerate(c,`button`)})}),e.length===1&&Xl(c)&&c.customData?.generationData?.status===`done`&&(0,K.jsxs)(JE,{element:c,elementsMap:i,children:[(0,K.jsx)(XE,{title:q(`labels.copySource`),icon:hc,checked:!1,onChange:()=>this.onIframeSrcCopy(c)}),(0,K.jsx)(XE,{title:`Enter fullscreen`,icon:cu,checked:!1,onChange:()=>{let e=this.getHTMLIFrameElement(c);if(e)try{e.requestFullscreen(),this.setState({activeEmbeddable:{element:c,state:`active`},selectedElementIds:{[c.id]:!0},newElement:null,selectionElement:null})}catch(e){console.warn(e),this.setState({errorMessage:`Couldn't enter fullscreen`})}}})]}),this.state.toast!==null&&(0,K.jsx)(KT,{message:this.state.toast.message,onClose:()=>this.setToast(null),duration:this.state.toast.duration,closable:this.state.toast.closable}),this.state.contextMenu&&(0,K.jsx)(bS,{items:this.state.contextMenu.items,top:this.state.contextMenu.top,left:this.state.contextMenu.left,actionManager:this.actionManager,onClose:e=>{this.setState({contextMenu:null},()=>{this.focusContainer(),e?.()})}}),(0,K.jsx)(UE,{canvas:this.canvas,rc:this.rc,elementsMap:i,allElementsMap:o,visibleElements:a,sceneNonce:r,selectionNonce:this.state.selectionElement?.versionNonce,scale:window.devicePixelRatio,appState:this.state,renderConfig:{imageCache:this.imageCache,isExporting:!1,renderGrid:Oo(this),canvasBackgroundColor:this.state.viewBackgroundColor,embedsValidationStatus:this.embedsValidationStatus,elementsPendingErasure:this.elementsPendingErasure,pendingFlowchartNodes:this.flowChartCreator.pendingNodes}}),this.state.newElement&&(0,K.jsx)(cD,{appState:this.state,scale:window.devicePixelRatio,rc:this.rc,elementsMap:i,allElementsMap:o,renderConfig:{imageCache:this.imageCache,isExporting:!1,renderGrid:!1,canvasBackgroundColor:this.state.viewBackgroundColor,embedsValidationStatus:this.embedsValidationStatus,elementsPendingErasure:this.elementsPendingErasure,pendingFlowchartNodes:null}}),(0,K.jsx)(BE,{containerRef:this.excalidrawContainerRef,canvas:this.interactiveCanvas,elementsMap:i,visibleElements:a,allElementsMap:o,selectedElements:e,sceneNonce:r,selectionNonce:this.state.selectionElement?.versionNonce,scale:window.devicePixelRatio,appState:this.state,device:this.device,renderInteractiveSceneCallback:this.renderInteractiveSceneCallback,handleCanvasRef:this.handleInteractiveCanvasRef,onContextMenu:this.handleCanvasContextMenu,onPointerMove:this.handleCanvasPointerMove,onPointerUp:this.handleCanvasPointerUp,onPointerCancel:this.removePointer,onTouchMove:this.handleTouchMove,onPointerDown:this.handleCanvasPointerDown,onDoubleClick:this.handleCanvasDoubleClick}),this.state.userToFollow&&(0,K.jsx)(ZE,{width:this.state.width,height:this.state.height,userToFollow:this.state.userToFollow,onDisconnect:this.maybeUnfollowRemoteUser}),this.renderFrameNames()]}),this.renderEmbeddables()]})})})})})})})})}setPlugins(e){Object.assign(this.plugins,e)}async onMagicFrameGenerate(e,t){let n=this.plugins.diagramToCode?.generate;if(!n){this.setState({errorMessage:`No diagram to code plugin found`});return}let r=Ha(this.scene.getNonDeletedElements(),e).filter(e=>!Ro(e));if(!r.length){t===`button`?(this.setState({errorMessage:`Cannot generate from an empty frame`}),Y(`ai`,`generate (no-children)`,`d2c`)):this.setActiveTool({type:`magicframe`});return}let i=this.insertIframeElement({sceneX:e.x+e.width+30,sceneY:e.y,width:e.width,height:e.height});if(i){this.updateMagicGeneration({frameElement:i,data:{status:`pending`}}),this.setState({selectedElementIds:{[i.id]:!0}}),Y(`ai`,`generate (start)`,`d2c`);try{let{html:t}=await n({frame:e,children:r});if(Y(`ai`,`generate (success)`,`d2c`),!t.trim()){this.updateMagicGeneration({frameElement:i,data:{status:`error`,code:`ERR_OAI`,message:`Nothing genereated :(`}});return}let a=t.includes(`<!DOCTYPE html>`)&&t.includes(`</html>`)?t.slice(t.indexOf(`<!DOCTYPE html>`),t.indexOf(`</html>`)+7):t;this.updateMagicGeneration({frameElement:i,data:{status:`done`,html:a}})}catch(e){Y(`ai`,`generate (failed)`,`d2c`),this.updateMagicGeneration({frameElement:i,data:{status:`error`,code:`ERR_OAI`,message:e.message||`Unknown error during generation`}})}}}onIframeSrcCopy(e){e.customData?.generationData?.status===`done`&&(Gt(e.customData.generationData.html),this.setToast({message:`copied to clipboard`,closable:!1,duration:1500}))}clearImageShapeCache(e){let t=e??this.files;this.scene.getNonDeletedElements().forEach(e=>{qe(e)&&t[e.fileId]&&(this.imageCache.delete(e.fileId),We.delete(e))})}async componentDidMount(){this.unmounted=!1,this.excalidrawContainerValue.container=this.excalidrawContainerRef.current,(pe.MODE===Nl.TEST||pe.DEV)&&(this.setState.bind(this),Object.defineProperties(window.h,{state:{configurable:!0,get:()=>this.state},setState:{configurable:!0,value:(...e)=>this.setState(...e)},app:{configurable:!0,value:this},history:{configurable:!0,value:this.history},store:{configurable:!0,value:this.store},fonts:{configurable:!0,value:this.fonts}})),this.store.onStoreIncrementEmitter.on(e=>{this.history.record(e.elementsChange,e.appStateChange)}),this.scene.onUpdate(this.triggerRender),this.addEventListeners(),this.props.autoFocus&&this.excalidrawContainerRef.current&&this.focusContainer(),Nt()||(this.refreshViewportBreakpoints(),this.refreshEditorBreakpoints()),Us&&this.excalidrawContainerRef.current&&(this.resizeObserver=new ResizeObserver(()=>{this.refreshEditorBreakpoints(),this.updateDOMRect()}),this.resizeObserver?.observe(this.excalidrawContainerRef.current)),new URLSearchParams(window.location.search.slice(1)).has(`web-share-target`)?this.restoreFileFromShare():this.updateDOMRect(this.initializeScene),en()&&!yn()&&this.setState({errorMessage:(0,K.jsx)(QT,{})})}componentWillUnmount(){window.launchQueue?.setConsumer(()=>{}),this.renderer.destroy(),this.scene.destroy(),this.scene=new Zs,this.fonts=new Qu(this.scene),this.renderer=new WE(this.scene),this.files={},this.imageCache.clear(),this.resizeObserver?.disconnect(),this.unmounted=!0,this.removeEventListeners(),this.library.destroy(),this.laserTrails.stop(),this.eraserTrail.stop(),this.onChangeEmitter.clear(),this.store.onStoreIncrementEmitter.clear(),We.destroy(),qr.destroy(),clearTimeout(MD),js.clearCache(),Rl.clearCache(),MD=0,document.documentElement.style.overscrollBehaviorX=``}removeEventListeners(){this.onRemoveEventListenersEmitter.trigger()}addEventListeners(){this.removeEventListeners(),this.props.handleKeyboardGlobally&&this.onRemoveEventListenersEmitter.once(tl(document,`keydown`,this.onKeyDown,!1)),this.onRemoveEventListenersEmitter.once(tl(this.excalidrawContainerRef.current,`wheel`,this.handleWheel,{passive:!1}),tl(window,`message`,this.onWindowMessage,!1),tl(document,`pointerup`,this.removePointer,{passive:!1}),tl(document,`copy`,this.onCopy,{passive:!1}),tl(document,`keyup`,this.onKeyUp,{passive:!0}),tl(document,`pointermove`,this.updateCurrentCursorPosition,{passive:!1}),tl(document.fonts,`loadingdone`,e=>{let t=e.fontfaces;this.fonts.onLoaded(t)},{passive:!1}),tl(document,`gesturestart`,this.onGestureStart,!1),tl(document,`gesturechange`,this.onGestureChange,!1),tl(document,`gestureend`,this.onGestureEnd,!1),tl(window,`focus`,()=>{this.maybeCleanupAfterMissingPointerUp(null),this.triggerRender(!0)},{passive:!1})),!this.state.viewModeEnabled&&(this.onRemoveEventListenersEmitter.once(tl(document,`fullscreenchange`,this.onFullscreenChange,{passive:!1}),tl(document,`paste`,this.pasteFromClipboard,{passive:!1}),tl(document,`cut`,this.onCut,{passive:!1}),tl(window,`resize`,this.onResize,!1),tl(window,`unload`,this.onUnload,!1),tl(window,`blur`,this.onBlur,!1),tl(this.excalidrawContainerRef.current,`wheel`,this.handleWheel,{passive:!1}),tl(this.excalidrawContainerRef.current,`dragover`,this.disableEvent,!1),tl(this.excalidrawContainerRef.current,`drop`,this.disableEvent,!1)),this.props.detectScroll&&this.onRemoveEventListenersEmitter.once(tl(cn(this.excalidrawContainerRef.current),`scroll`,this.onScroll,{passive:!1})))}componentDidUpdate(e,t){this.updateEmbeddables();let n=this.scene.getElementsIncludingDeleted(),r=this.scene.getElementsMapIncludingDeleted(),i=this.scene.getNonDeletedElementsMap();!this.state.showWelcomeScreen&&!n.length&&this.setState({showWelcomeScreen:!0}),e.UIOptions.dockedSidebarBreakpoint!==this.props.UIOptions.dockedSidebarBreakpoint&&this.refreshEditorBreakpoints(),t.userToFollow&&!this.state.collaborators.has(t.userToFollow.socketId)&&this.maybeUnfollowRemoteUser(),(t.zoom.value!==this.state.zoom.value||t.scrollX!==this.state.scrollX||t.scrollY!==this.state.scrollY)&&(this.props?.onScrollChange?.(this.state.scrollX,this.state.scrollY,this.state.zoom),this.onScrollChangeEmitter.trigger(this.state.scrollX,this.state.scrollY,this.state.zoom)),t.userToFollow!==this.state.userToFollow&&(t.userToFollow&&this.onUserFollowEmitter.trigger({userToFollow:t.userToFollow,action:`UNFOLLOW`}),this.state.userToFollow&&this.onUserFollowEmitter.trigger({userToFollow:this.state.userToFollow,action:`FOLLOW`})),Object.keys(this.state.selectedElementIds).length&&aa(this.state)&&this.setState({activeTool:fo(this.state,{type:`selection`})}),this.state.activeTool.type===`eraser`&&t.theme!==this.state.theme&&Ys(this.interactiveCanvas,this.state.theme),t.activeTool.type===`selection`&&this.state.activeTool.type!==`selection`&&this.state.showHyperlinkPopup&&this.setState({showHyperlinkPopup:!1}),e.langCode!==this.props.langCode&&this.updateLanguage(),aa(t)&&!aa(this.state)&&this.eraserTrail.endPath(),e.viewModeEnabled!==this.props.viewModeEnabled&&this.setState({viewModeEnabled:!!this.props.viewModeEnabled}),t.viewModeEnabled!==this.state.viewModeEnabled&&(this.addEventListeners(),this.deselectElements()),(t.openDialog?.name===`elementLinkSelector`||this.state.openDialog?.name===`elementLinkSelector`)&&t.openDialog?.name!==this.state.openDialog?.name&&(this.deselectElements(),this.setState({hoveredElementIds:{}})),e.zenModeEnabled!==this.props.zenModeEnabled&&this.setState({zenModeEnabled:!!this.props.zenModeEnabled}),e.theme!==this.props.theme&&this.props.theme&&this.setState({theme:this.props.theme}),this.excalidrawContainerRef.current?.classList.toggle(`theme--dark`,this.state.theme===R.DARK),this.state.editingLinearElement&&!this.state.selectedElementIds[this.state.editingLinearElement.elementId]&&setTimeout(()=>{this.state.editingLinearElement&&this.actionManager.executeAction(Wv)}),this.state.editingTextElement?.isDeleted&&this.setState({editingTextElement:null}),this.state.selectedLinearElement&&!this.state.selectedElementIds[this.state.selectedLinearElement.elementId]&&this.setState({selectedLinearElement:null});let{multiElement:a}=t;t.activeTool!==this.state.activeTool&&a!=null&&wt(this.state)&&Zi(a,!1)&&br(a,this.state,ws(F.getPointAtIndexGlobalCoordinates(a,-1,i)),this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements()),this.store.commit(r,this.state),this.state.isLoading||(this.props.onChange?.(n,this.state,this.files),this.onChangeEmitter.trigger(n,this.state,this.files))}static resetTapTwice(){ED=!1}async addElementsFromMixedContentPaste(e,{isPlainPaste:t,sceneX:n,sceneY:r}){if(!t&&e.some(e=>e.type===`imageUrl`)&&this.isToolSupported(`image`)){let t=e.filter(e=>e.type===`imageUrl`).map(e=>e.value),i=await Promise.all(t.map(async e=>{try{return{file:await _c(e)}}catch(e){let t=e.message;return e.cause===`FETCH_ERROR`?t=q(`errors.failedToFetchImage`):e.cause===`UNSUPPORTED`&&(t=q(`errors.unsupportedFileType`)),{errorMessage:t}}})),a=r,o=!1,s={};for(let e of i)if(e.file){let t=this.createImageElement({sceneX:n,sceneY:a}),r=await this.insertImageElement(t,e.file);r&&(o||(o=!0,a-=r.height/2),W(r,{y:a},!1),a=t.y+t.height+25,s[t.id]=!0)}this.setState({selectedElementIds:O(s,this.state)});let c=i.find(e=>!!e.errorMessage);c&&c.errorMessage&&this.setState({errorMessage:c.errorMessage})}else{let n=e.filter(e=>e.type===`text`);n.length&&this.addTextFromPaste(n.map(e=>e.value).join(`

`),t)}}addTextFromPaste(e,t=!1){let{x:n,y:r}=Fs({clientX:this.lastViewportPosition.x,clientY:this.lastViewportPosition.y},this.state),i={x:n,y:r,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roundness:null,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,text:e,fontSize:this.state.currentItemFontSize,fontFamily:this.state.currentItemFontFamily,textAlign:Ta,verticalAlign:`top`,locked:!1},a=Cs({fontSize:i.fontSize,fontFamily:i.fontFamily}),o=mu(i.fontFamily),[s,,c]=Ss(this.state),l=Math.max(Math.min((c-s)*.5,800),200),u=r,d=t?[e]:e.split(`
`),f=d.reduce((e,t,r)=>{let s=Hr(t).trim();if(s.length){let t=this.getTopLayerFrameAtSceneCoords({x:n,y:u}),r=Nn(s,a,o),c=r.width>l,d=c?Ps(s,a,l):s;r=c?Nn(d,a,o):r;let f=n-r.width/2,p=u-r.height/2,m=yt({...i,x:f,y:p,text:d,originalText:s,lineHeight:o,autoResize:!c,frameId:t?t.id:null});e.push(m),u+=m.height+10}else d[r-1]?.trim()&&(u+=Ki(i.fontSize,o)+10);return e},[]);f.length!==0&&(this.scene.insertElements(f),this.setState({selectedElementIds:O(Object.fromEntries(f.map(e=>[e.id,!0])),this.state)}),!t&&f.length>1&&LD===!1&&!this.device.editor.isMobile&&(this.setToast({message:q(`toast.pasteAsSingleElement`,{shortcut:k(`CtrlOrCmd+Shift+V`)}),duration:5e3}),LD=!0),this.store.shouldCaptureIncrement())}handleTextWysiwyg(e,{isExistingElement:t=!1}){let n=this.scene.getElementsMapIncludingDeleted(),r=(t,r)=>{this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted().map(i=>i.id===e.id&&H(i)?A(i,{originalText:t,isDeleted:r??i.isDeleted,...hn(i,ai(i,n),n,t)}):i)])};nD({id:e.id,canvas:this.canvas,getViewportCoords:(e,t)=>{let{x:n,y:r}=ga({sceneX:e,sceneY:t},this.state);return[n-this.state.offsetLeft,r-this.state.offsetTop]},onChange:aE(t=>{r(t,!1),el(e)&&ao(e,this.scene.getNonDeletedElementsMap())}),onSubmit:aE(({viaKeyboard:n,nextOriginalText:i})=>{let a=!i.trim();if(r(i,a),!a&&n){let t=e.containerId?e.containerId:e.id;(0,dg.flushSync)(()=>{this.setState(e=>({selectedElementIds:O({...e.selectedElementIds,[t]:!0},e)}))})}a&&_i(this.scene.getNonDeletedElements(),[e]),(!a||t)&&this.store.shouldCaptureIncrement(),(0,dg.flushSync)(()=>{this.setState({newElement:null,editingTextElement:null})}),this.state.activeTool.locked&&Ul(this.interactiveCanvas,this.state),this.focusContainer()}),element:e,excalidrawContainer:this.excalidrawContainerRef.current,app:this,autoSelect:!this.device.isTouchScreen}),this.deselectElements(),r(e.originalText,!1)}deselectElements(){this.setState({selectedElementIds:O({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null})}getTextElementAtPosition(e,t){let n=this.getElementAtPosition(e,t,{includeBoundTextElement:!0});return n&&H(n)&&!n.isDeleted?n:null}getElementAtPosition(e,t,n){let r=this.getElementsAtPosition(e,t,n?.includeBoundTextElement,n?.includeLockedElements);if(r.length>1){if(n?.preferSelected){for(let e=r.length-1;e>-1;e--)if(this.state.selectedElementIds[r[e].id])return r[e]}let i=r[r.length-1];return ea({x:e,y:t,element:i,shape:ye(i,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold()/2,frameNameBound:M(i)?this.frameNameBoundsCache.get(i):null})?i:r[r.length-2]}return r.length===1?r[0]:null}getElementsAtPosition(e,t,n=!1,r=!1){let i=[],a=this.scene.getNonDeletedElementsMap();return(n&&r?this.scene.getNonDeletedElements():this.scene.getNonDeletedElements().filter(e=>(r||!e.locked)&&(n||!(H(e)&&e.containerId)))).filter(n=>this.hitElement(e,t,n)).filter(n=>{let r=Ml(n,a);return r&&this.state.frameRendering.enabled&&this.state.frameRendering.clip?Ot({x:e,y:t},r,a):!0}).filter(e=>Xl(e)?(i.push(e),!1):!0).concat(i)}getElementHitThreshold(){return Ke/this.state.zoom.value}hitElement(e,t,n,r=!0){if(r&&this.state.selectedElementIds[n.id]&&Ec([n],this.state)){let r=xo(n,this.scene.getNonDeletedElementsMap(),De(n)?0:this.getElementHitThreshold());if(oc(I(e,t),r))return!0}return ji(e,t,Bn(n,this.scene.getNonDeletedElementsMap()))?!0:ea({x:e,y:t,element:n,shape:ye(n,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold(),frameNameBound:M(n)?this.frameNameBoundsCache.get(n):null})}getTextBindableContainerAtPosition(e,t){let n=this.scene.getNonDeletedElements(),r=this.scene.getSelectedElements(this.state);if(r.length===1)return Hu(r[0],!1)?r[0]:null;let i=null;for(let r=n.length-1;r>=0;--r){if(n[r].isDeleted)continue;let[a,o,s,c]=Le(n[r],this.scene.getNonDeletedElementsMap());if(Lc(n[r])&&ea({x:e,y:t,element:n[r],shape:ye(n[r],this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold()})){i=n[r];break}else if(a<e&&e<s&&o<t&&t<c){i=n[r];break}}return Hu(i,!1)?i:null}handleHoverSelectedLinearElement(e,t,n){let r=this.scene.getNonDeletedElementsMap(),i=F.getElement(e.elementId,r);if(i)if(this.state.selectedLinearElement){let a=-1,o=null;ea({x:t,y:n,element:i,shape:ye(i,this.scene.getNonDeletedElementsMap())})?(a=F.getPointIndexUnderCursor(i,r,this.state.zoom,t,n),o=F.getSegmentMidpointHitCoords(e,{x:t,y:n},this.state,this.scene.getNonDeletedElementsMap()),(B(i)?a===0||a===i.points.length-1:a>=0)||o?z(this.interactiveCanvas,T.POINTER):this.hitElement(t,n,i)&&z(this.interactiveCanvas,T.MOVE)):this.hitElement(t,n,i)&&(!B(i)||!(i.startBinding||i.endBinding))&&z(this.interactiveCanvas,T.MOVE),this.state.selectedLinearElement.hoverPointIndex!==a&&this.setState({selectedLinearElement:{...this.state.selectedLinearElement,hoverPointIndex:a}}),F.arePointsEqual(this.state.selectedLinearElement.segmentMidPointHoveredCoords,o)||this.setState({selectedLinearElement:{...this.state.selectedLinearElement,segmentMidPointHoveredCoords:o}})}else z(this.interactiveCanvas,T.AUTO)}updateGestureOnPointerDown(e){$.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),$.pointers.size===2&&($.lastCenter=hS($.pointers),$.initialScale=this.state.zoom.value,$.initialDistance=gS(Array.from($.pointers.values())))}initialPointerDownState(e){let t=Fs(e,this.state),n=this.scene.getSelectedElements(this.state),[r,i,a,o]=Ts(n),s=n.findIndex(B)===0;return{origin:t,withCmdOrCtrl:e[D.CTRL_OR_CMD],originInGrid:ws(Lr(t.x,t.y,e[D.CTRL_OR_CMD]||s?null:this.getEffectiveGridSize())),scrollbars:nC(jD,e.clientX-this.state.offsetLeft,e.clientY-this.state.offsetTop),lastCoords:{...t},originalElements:this.scene.getNonDeletedElements().reduce((e,t)=>(e.set(t.id,Ge(t)),e),new Map),resize:{handleType:!1,isResizing:!1,offset:{x:0,y:0},arrowDirection:`origin`,center:{x:(a+r)/2,y:(o+i)/2}},hit:{element:null,allHitElements:[],wasAddedToSelection:!1,hasBeenDuplicated:!1,hasHitCommonBoundingBoxOfSelectedElements:this.isHittingCommonBoundingBoxOfSelectedElements(t,n)},drag:{hasOccurred:!1,offset:null},eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null},boxSelection:{hasOccurred:!1}}}handleDraggingScrollBar(e,t){if(!(t.scrollbars.isOverEither&&!this.state.multiElement))return!1;AD=!0,t.lastCoords.x=e.clientX,t.lastCoords.y=e.clientY;let n=oE(e=>{e.target instanceof HTMLElement&&this.handlePointerMoveOverScrollbars(e,t)}),r=aE(()=>{RD=null,AD=!1,Ul(this.interactiveCanvas,this.state),this.setState({cursorButton:`up`}),this.savePointer(e.clientX,e.clientY,`up`),window.removeEventListener(`pointermove`,n),window.removeEventListener(`pointerup`,r),n.flush()});return RD=r,window.addEventListener(`pointermove`,n),window.addEventListener(`pointerup`,r),!0}isASelectedElement(e){return e!=null&&this.state.selectedElementIds[e.id]}isHittingCommonBoundingBoxOfSelectedElements(e,t){if(t.length<2)return!1;let n=this.getElementHitThreshold(),[r,i,a,o]=Ts(t);return e.x>r-n&&e.x<a+n&&e.y>i-n&&e.y<o+n}getCurrentItemRoundness(e){return this.state.currentItemRoundness===`round`?{type:Ar(e)?Pc.ADAPTIVE_RADIUS:Pc.PROPORTIONAL_RADIUS}:null}maybeCacheReferenceSnapPoints(e,t,n=!1){Di({event:e,app:this,selectedElements:t})&&(n||!qr.getReferenceSnapPoints())&&qr.setReferenceSnapPoints(fr(this.scene.getNonDeletedElements(),t,this.state,this.scene.getNonDeletedElementsMap()))}maybeCacheVisibleGaps(e,t,n=!1){Di({event:e,app:this,selectedElements:t})&&(n||!qr.getVisibleGaps())&&qr.setVisibleGaps(Yl(this.scene.getNonDeletedElements(),t,this.state,this.scene.getNonDeletedElementsMap()))}onKeyDownFromPointerDownHandler(e){return aE(t=>{this.maybeHandleResize(e,t)||this.maybeDragNewGenericElement(e,t)})}onKeyUpFromPointerDownHandler(e){return aE(t=>{t.key===D.ALT&&t.preventDefault(),!this.maybeHandleResize(e,t)&&this.maybeDragNewGenericElement(e,t)})}onPointerMoveFromPointerDownHandler(e){return oE(t=>{if(this.state.openDialog?.name===`elementLinkSelector`)return;let n=Fs(t,this.state);if(this.state.selectedLinearElement&&this.state.selectedLinearElement.elbowed&&this.state.selectedLinearElement.pointerDownState.segmentMidpoint.index){let[e,r]=Lr(n.x,n.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),i=this.state.selectedLinearElement.pointerDownState.segmentMidpoint.index;if(i<0){let t=F.getSegmentMidpointHitCoords({...this.state.selectedLinearElement,segmentMidPointHoveredCoords:null},{x:e,y:r},this.state,this.scene.getNonDeletedElementsMap());i=t?F.getSegmentMidPointIndex(this.state.selectedLinearElement,this.state,t,this.scene.getNonDeletedElementsMap()):-1}let a=F.moveFixedSegment(this.state.selectedLinearElement,i,e,r,this.scene.getNonDeletedElementsMap());(0,dg.flushSync)(()=>{this.state.selectedLinearElement&&this.setState({selectedLinearElement:{...this.state.selectedLinearElement,segmentMidPointHoveredCoords:a.segmentMidPointHoveredCoords,pointerDownState:a.pointerDownState}})});return}let r=this.lastPointerMoveCoords??e.origin;if(this.lastPointerMoveCoords=n,e.drag.offset===null&&(e.drag.offset=ws(it(this.scene.getSelectedElements(this.state),e.origin.x,e.origin.y))),!(t.target instanceof HTMLElement)||this.handlePointerMoveOverScrollbars(t,e))return;if(aa(this.state)){this.handleEraser(t,e,n);return}this.state.activeTool.type===`laser`&&this.laserTrails.addPointToPath(n.x,n.y);let[i,a]=Lr(n.x,n.y,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize());if(!e.drag.hasOccurred&&(this.state.activeTool.type===`arrow`||this.state.activeTool.type===`line`)&&Ce(I(n.x,n.y),I(e.origin.x,e.origin.y))<10)return;if(e.resize.isResizing&&(e.lastCoords.x=n.x,e.lastCoords.y=n.y,this.maybeHandleCrop(e,t)||this.maybeHandleResize(e,t)))return!0;let o=this.scene.getNonDeletedElementsMap();if(this.state.selectedLinearElement){let r=this.state.editingLinearElement||this.state.selectedLinearElement;if(F.shouldAddMidpoint(this.state.selectedLinearElement,n,this.state,o)){let e=F.addMidpoint(this.state.selectedLinearElement,n,this,!t[D.CTRL_OR_CMD],o);if(!e)return;(0,dg.flushSync)(()=>{this.state.selectedLinearElement&&this.setState({selectedLinearElement:{...this.state.selectedLinearElement,pointerDownState:e.pointerDownState,selectedPointsIndices:e.selectedPointsIndices}}),this.state.editingLinearElement&&this.setState({editingLinearElement:{...this.state.editingLinearElement,pointerDownState:e.pointerDownState,selectedPointsIndices:e.selectedPointsIndices}})});return}else if(r.pointerDownState.segmentMidpoint.value!==null&&!r.pointerDownState.segmentMidpoint.added)return;if(F.handlePointDragging(t,this,n.x,n.y,(e,t)=>{this.maybeSuggestBindingsForLinearElementAtCoords(e,t)},r,this.scene)){e.lastCoords.x=n.x,e.lastCoords.y=n.y,e.drag.hasOccurred=!0,this.state.editingLinearElement&&!this.state.editingLinearElement.isDragging&&this.setState({editingLinearElement:{...this.state.editingLinearElement,isDragging:!0}}),this.state.selectedLinearElement.isDragging||this.setState({selectedLinearElement:{...this.state.selectedLinearElement,isDragging:!0}});return}}let s=e.hit.allHitElements.some(e=>this.isASelectedElement(e)),c=this.state.editingLinearElement&&t.shiftKey&&this.state.editingLinearElement.elementId===e.hit.element?.id;if((s||e.hit.hasHitCommonBoundingBoxOfSelectedElements)&&!c){let i=this.scene.getSelectedElements(this.state);if(i.every(e=>e.locked))return;let a=i.find(e=>M(e)),s=this.getTopLayerFrameAtSceneCoords(n),c=s&&!a?s:null;if(this.state.frameToHighlight!==c&&(0,dg.flushSync)(()=>{this.setState({frameToHighlight:c})}),e.drag.hasOccurred=!0,i.length>0&&!e.withCmdOrCtrl&&!this.state.editingTextElement&&this.state.activeEmbeddable?.state!==`active`){let a={x:n.x-e.origin.x,y:n.y-e.origin.y},s=[...e.originalElements.values()],c=t.shiftKey;if(c){let e=Math.abs(a.x),t=Math.abs(a.y),n=c&&e<t,r=c&&e>t;n&&(a.x=0),r&&(a.y=0)}if(this.state.croppingElementId){let t=this.scene.getNonDeletedElementsMap().get(this.state.croppingElementId);if(t&&De(t)&&t.crop!==null&&e.hit.element===t){let e=t.crop,i=qe(t)&&this.imageCache.get(t.fileId)?.image;if(i&&!(i instanceof Promise)){let a=Fo(Cr(n.x-r.x,n.y-r.y),Math.max(this.state.zoom.value,2)),[s,c,l,u,d,f]=Le(t,o),p=et(Ia(I(s,c),I(d,f),t.angle)),m=et(Ia(I(l,c),I(d,f),t.angle)),h=et(Ia(I(s,u),I(d,f),t.angle)),g=us(xn(m,p)),_=us(xn(h,p)),v=Cr(jr(a,g),jr(a,_));W(t,{crop:{...e,x:Be(e.x-v[0]*Math.sign(t.scale[0]),0,i.naturalWidth-e.width),y:Be(e.y-v[1]*Math.sign(t.scale[1]),0,i.naturalHeight-e.height)}});return}}}this.maybeCacheVisibleGaps(t,i),this.maybeCacheReferenceSnapPoints(t,i);let{snapOffset:l,snapLines:u}=ql(s,a,this,t,this.scene.getNonDeletedElementsMap());if(this.setState({snapLines:u}),this.state.editingFrame||ts(e,i,a,this.scene,l,t[D.CTRL_OR_CMD]?null:this.getEffectiveGridSize()),this.setState({selectedElementsAreBeingDragged:!0,selectionElement:null}),(i.length!==1||!B(i[0]))&&this.setState({suggestedBindings:na(i,this.scene.getNonDeletedElementsMap(),this.state.zoom)}),t.altKey&&!e.hit.hasBeenDuplicated){e.hit.hasBeenDuplicated=!0;let n=[],r=[],a=new Map,o=new Map,s=e.hit.element,c=new Set(this.scene.getSelectedElements({selectedElementIds:this.state.selectedElementIds,includeBoundTextElement:!0,includeElementsInFrames:!0}).map(e=>e.id)),l=this.scene.getElementsIncludingDeleted();for(let t of l){let i=c.has(t.id)||t.id===s?.id&&e.hit.wasAddedToSelection;if(Math.abs(t.x)>1e7||Math.abs(t.x)>1e7||Math.abs(t.width)>1e7||Math.abs(t.height)>1e7){console.error(`Alt+dragging element in scene with invalid dimensions`,t.x,t.y,t.width,t.height,i);return}if(i){let i=ru(this.state.editingGroupId,a,t);if(Math.abs(i.x)>1e7||Math.abs(i.x)>1e7||Math.abs(i.width)>1e7||Math.abs(i.height)>1e7){console.error(`Alt+dragging duplicated element with invalid dimensions`,i.x,i.y,i.width,i.height);return}let s=e.originalElements.get(t.id);if(Math.abs(s.x)>1e7||Math.abs(s.x)>1e7||Math.abs(s.width)>1e7||Math.abs(s.height)>1e7){console.error(`Alt+dragging duplicated element with invalid dimensions`,s.x,s.y,s.width,s.height);return}W(i,{x:s.x,y:s.y}),e.originalElements.set(i.id,i),n.push(i),r.push(t),o.set(t.id,i.id)}else n.push(t)}let u=[...n,...r];u=this.props.onDuplicate?.(u,l)||u,Rt(u,P(r)),Bi(n,r,o),Qc(u,r,o,`duplicatesServeAsOld`),Co(u,r,o),this.scene.replaceAllElements(u),this.maybeCacheVisibleGaps(t,i,!0),this.maybeCacheReferenceSnapPoints(t,i,!0)}return}}if(this.state.selectionElement)e.lastCoords.x=n.x,e.lastCoords.y=n.y,this.maybeDragNewGenericElement(e,t);else{let r=this.state.newElement;if(!r)return;if(r.type===`freedraw`){let e=r.points,i=n.x-r.x,a=n.y-r.y,o=e.length>0&&e[e.length-1];if(!(o&&o[0]===i&&o[1]===a)){let n=r.simulatePressure?r.pressures:[...r.pressures,t.pressure];W(r,{points:[...e,I(i,a)],pressures:n},!1),this.setState({newElement:r})}}else if(fc(r)){e.drag.hasOccurred=!0;let o=r.points,s=i-r.x,c=a-r.y;ft(t)&&o.length===2&&({width:s,height:c}=dl(r.x,r.y,n.x,n.y)),o.length===1?W(r,{points:[...o,I(s,c)]},!1):(o.length===2||o.length>1&&B(r))&&W(r,{points:[...o.slice(0,-1),I(s,c)]},!1,{isDragging:!0}),this.setState({newElement:r}),Zi(r,!1)&&this.maybeSuggestBindingsForLinearElementAtCoords(r,[n],this.state.startBoundElement)}else e.lastCoords.x=n.x,e.lastCoords.y=n.y,this.maybeDragNewGenericElement(e,t,!1)}if(this.state.activeTool.type===`selection`){e.boxSelection.hasOccurred=!0;let n=this.scene.getNonDeletedElements();if(this.state.editingLinearElement)F.handleBoxSelection(t,this.state,this.setState.bind(this),this.scene.getNonDeletedElementsMap());else{let r=!0;!t.shiftKey&&js(n,this.state)&&(e.withCmdOrCtrl&&e.hit.element?this.setState(t=>Rl({...t,selectedElementIds:{[e.hit.element.id]:!0}},this.scene.getNonDeletedElements(),t,this)):r=!1);let i=this.state.selectionElement?Oc(n,this.state.selectionElement,this.scene.getNonDeletedElementsMap(),!1):[];this.setState(t=>{let n={...r&&t.selectedElementIds,...i.reduce((e,t)=>(e[t.id]=!0,e),{})};return e.hit.element&&(i.length?delete n[e.hit.element.id]:n[e.hit.element.id]=!0),t=r?t:{...t,selectedGroupIds:{},editingGroupId:null},{...Rl({editingGroupId:t.editingGroupId,selectedElementIds:n},this.scene.getNonDeletedElements(),t,this),selectedLinearElement:i.length===1&&fc(i[0])?new F(i[0]):null,showHyperlinkPopup:i.length===1&&(i[0].link||Fn(i[0]))?`info`:!1}})}}})}handlePointerMoveOverScrollbars(e,t){if(t.scrollbars.isOverHorizontal){let n=e.clientX,r=n-t.lastCoords.x;return this.translateCanvas({scrollX:this.state.scrollX-r/this.state.zoom.value}),t.lastCoords.x=n,!0}if(t.scrollbars.isOverVertical){let n=e.clientY,r=n-t.lastCoords.y;return this.translateCanvas({scrollY:this.state.scrollY-r/this.state.zoom.value}),t.lastCoords.y=n,!0}return!1}onPointerUpFromPointerDownHandler(e){return aE(t=>{this.removePointer(t),e.eventListeners.onMove&&e.eventListeners.onMove.flush();let{newElement:n,resizingElement:r,croppingElementId:i,multiElement:a,activeTool:o,isResizing:s,isRotating:c,isCropping:l}=this.state;this.setState(e=>({isResizing:!1,isRotating:!1,isCropping:!1,resizingElement:null,selectionElement:null,frameToHighlight:null,elementsToHighlight:null,cursorButton:`up`,snapLines:Rc(e.snapLines,[]),originSnapOffset:null})),this.lastPointerMoveCoords=null,qr.setReferenceSnapPoints(null),qr.setVisibleGaps(null),this.savePointer(t.clientX,t.clientY,`up`),this.setState({selectedElementsAreBeingDragged:!1});let u=this.scene.getNonDeletedElementsMap();if(e.drag.hasOccurred&&e.hit?.element?.id){let t=u.get(e.hit.element.id);vl(t)&&t.boundElements?.filter(e=>e.type===`arrow`).map(e=>u.get(e.id)).filter(e=>B(e)).forEach(e=>{e&&W(e,{},!0)})}if(this.state.editingLinearElement)if(!e.boxSelection.hasOccurred&&e.hit?.element?.id!==this.state.editingLinearElement.elementId)this.actionManager.executeAction(Wv);else{let e=F.handlePointerUp(t,this.state.editingLinearElement,this.state,this.scene);e!==this.state.editingLinearElement&&this.setState({editingLinearElement:e,suggestedBindings:[]})}else if(this.state.selectedLinearElement){if(this.state.selectedLinearElement.elbowed){let e=F.getElement(this.state.selectedLinearElement.elementId,this.scene.getNonDeletedElementsMap());e&&W(e,{},!0)}if(e.hit?.element?.id!==this.state.selectedLinearElement.elementId)this.scene.getSelectedElements(this.state).length>1&&this.setState({selectedLinearElement:null});else{let e=F.handlePointerUp(t,this.state.selectedLinearElement,this.state,this.scene),{startBindingElement:n,endBindingElement:r}=e,i=this.scene.getElement(e.elementId);Zi(i)&&Kn(i,n,r,u,this.scene),e!==this.state.selectedLinearElement&&this.setState({selectedLinearElement:{...e,selectedPointsIndices:null},suggestedBindings:[]})}}if(this.missingPointerEventCleanupEmitter.clear(),window.removeEventListener(`pointermove`,e.eventListeners.onMove),window.removeEventListener(`pointerup`,e.eventListeners.onUp),window.removeEventListener(`keydown`,e.eventListeners.onKeyDown),window.removeEventListener(`keyup`,e.eventListeners.onKeyUp),this.state.pendingImageElementId&&this.setState({pendingImageElementId:null}),this.props?.onPointerUp?.(o,e),this.onPointerUpEmitter.trigger(this.state.activeTool,e,t),n?.type===`freedraw`){let e=Fs(t,this.state),r=n.points,i=e.x-n.x,a=e.y-n.y;i===r[0][0]&&a===r[0][1]&&(a+=1e-4,i+=1e-4);let o=n.simulatePressure?[]:[...n.pressures,t.pressure];W(n,{points:[...r,I(i,a)],pressures:o,lastCommittedPoint:I(i,a)}),this.actionManager.executeAction(Wv);return}if(De(n)){let e=n;try{this.initializeImageDimensions(e),this.setState({selectedElementIds:O({[e.id]:!0},this.state)},()=>{this.actionManager.executeAction(Wv)})}catch(t){console.error(t),this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().filter(t=>t.id!==e.id)),this.actionManager.executeAction(Wv)}return}if(fc(n)){n.points.length>1&&this.store.shouldCaptureIncrement();let r=Fs(t,this.state);!e.drag.hasOccurred&&n&&!a?(W(n,{points:[...n.points,I(r.x-n.x,r.y-n.y)]}),this.setState({multiElement:n,newElement:n})):e.drag.hasOccurred&&!a&&(wt(this.state)&&Zi(n,!1)&&br(n,this.state,r,this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements()),this.setState({suggestedBindings:[],startBoundElement:null}),o.locked?this.setState(e=>({newElement:null})):(_l(this.interactiveCanvas),this.setState(e=>({newElement:null,activeTool:fo(this.state,{type:`selection`}),selectedElementIds:O({...e.selectedElementIds,[n.id]:!0},e),selectedLinearElement:new F(n)}))),this.scene.triggerUpdate());return}if(H(n)){let e=cr(Cs({fontSize:n.fontSize,fontFamily:n.fontFamily}),n.lineHeight);n.width<e&&W(n,{autoResize:!0}),this.resetCursor(),this.handleTextWysiwyg(n,{isExistingElement:!0})}if(o.type!==`selection`&&n&&es(n)){this.updateScene({elements:this.scene.getElementsIncludingDeleted().filter(e=>e.id!==n.id),appState:{newElement:null},captureUpdate:N.NEVER});return}if(M(n)){let e=Ct(this.scene.getElementsIncludingDeleted(),n,this.scene.getNonDeletedElementsMap());this.scene.replaceAllElements(wu(this.scene.getElementsMapIncludingDeleted(),e,n,this.state))}if(n&&(W(n,ut(n)),this.scene.triggerUpdate()),e.drag.hasOccurred){let e=Fs(t,this.state);if(this.state.selectedLinearElement&&this.state.selectedLinearElement.isDragging){let e=this.scene.getElement(this.state.selectedLinearElement.elementId);if(e?.frameId){let t=Ml(e,u);t&&e&&(Qi(e,t,this.scene.getNonDeletedElementsMap())||(W(e,{groupIds:[]}),Pu([e],this.scene.getNonDeletedElementsMap()),this.scene.triggerUpdate()))}}else{let t=this.getTopLayerFrameAtSceneCoords(e),n=this.scene.getSelectedElements(this.state),r=this.scene.getElementsMapIncludingDeleted(),i=e=>{if(e.length>0){for(let t of e){let e=t.groupIds.indexOf(this.state.editingGroupId);W(t,{groupIds:t.groupIds.slice(0,e)},!1)}r.forEach(e=>{e.groupIds.length&&jo(r,e.groupIds[e.groupIds.length-1]).length<2&&W(e,{groupIds:[]},!1)}),this.setState({editingGroupId:null})}};if(t&&!this.state.selectedElementIds[t.id]){let e=n.filter(e=>e.frameId!==t.id&&dd(e,r,this.state));this.state.editingGroupId&&i(e),r=wu(r,e,t,this.state)}else !t&&this.state.editingGroupId&&i(n.filter(e=>e.frameId&&!dd(e,r,this.state)));r=ja(r,this.state,this),this.scene.replaceAllElements(r)}}if(r&&this.store.shouldCaptureIncrement(),r&&es(r)&&this.updateScene({elements:this.scene.getElementsIncludingDeleted().filter(e=>e.id!==r.id),captureUpdate:N.NEVER}),e.resize.isResizing){let e=ja(this.scene.getElementsIncludingDeleted(),this.state,this),t=this.scene.getSelectedElements(this.state).filter(e=>M(e));for(let n of t)e=Un(e,ol(this.scene.getElementsIncludingDeleted(),n,this.state,u),n,this);this.scene.replaceAllElements(e)}let d=e.hit.element;this.state.selectedLinearElement?.elementId!==d?.id&&fc(d)&&this.scene.getSelectedElements(this.state).length===1&&this.setState({selectedLinearElement:new F(d)}),(!i||i&&(!d&&!l||d&&d.id!==i))&&this.finishImageCropping();let f=this.lastPointerDownEvent,p=this.lastPointerUpEvent||this.lastPointerMoveEvent;if(aa(this.state)&&f&&p){if(this.eraserTrail.endPath(),Ce(I(f.clientX,f.clientY),I(p.clientX,p.clientY))===0){let e=Fs({clientX:p.clientX,clientY:p.clientY},this.state);this.getElementsAtPosition(e.x,e.y).forEach(e=>this.elementsPendingErasure.add(e.id))}this.eraseElements();return}else this.elementsPendingErasure.size&&this.restoreReadyToEraseElements();if(d&&!e.drag.hasOccurred&&!e.hit.wasAddedToSelection&&(!this.state.editingLinearElement||!e.boxSelection.hasOccurred)&&(t.shiftKey&&!this.state.editingLinearElement?this.state.selectedElementIds[d.id]?od(this.state,d)?this.setState(e=>{let t={...e.selectedElementIds};for(let e of d.groupIds.flatMap(e=>jo(this.scene.getNonDeletedElements(),e)))delete t[e.id];return{selectedGroupIds:{...e.selectedElementIds,...d.groupIds.map(e=>({[e]:!1})).reduce((e,t)=>({...e,...t}),{})},selectedElementIds:O(t,e)}}):this.state.selectedLinearElement?.isDragging||this.setState(e=>{let t={...e.selectedElementIds};delete t[d.id];let n=V(this.scene.getNonDeletedElements(),{selectedElementIds:t});return{...Rl({editingGroupId:e.editingGroupId,selectedElementIds:t},this.scene.getNonDeletedElements(),e,this),selectedLinearElement:n.length===1&&fc(n[0])?new F(n[0]):e.selectedLinearElement}}):d.frameId&&this.state.selectedElementIds[d.frameId]?this.setState(e=>{let t={...e.selectedElementIds,[d.id]:!0};return delete t[d.frameId],(this.scene.getElement(d.frameId)?.groupIds??[]).flatMap(e=>jo(this.scene.getNonDeletedElements(),e)).forEach(e=>{delete t[e.id]}),{...Rl({editingGroupId:e.editingGroupId,selectedElementIds:t},this.scene.getNonDeletedElements(),e,this),showHyperlinkPopup:d.link||Fn(d)?`info`:!1}}):this.setState(e=>({selectedElementIds:O({...e.selectedElementIds,[d.id]:!0},e)})):this.setState(e=>({...Rl({editingGroupId:e.editingGroupId,selectedElementIds:{[d.id]:!0}},this.scene.getNonDeletedElements(),e,this),selectedLinearElement:fc(d)&&e.selectedLinearElement?.elementId!==d.id?new F(d):e.selectedLinearElement}))),!(d&&B(d))&&!e.drag.hasOccurred&&!this.state.isResizing&&(d&&tu({x:e.origin.x,y:e.origin.y,element:d,shape:ye(d,this.scene.getNonDeletedElementsMap()),threshold:this.getElementHitThreshold(),frameNameBound:M(d)?this.frameNameBoundsCache.get(d):null},u)||!d&&e.hit.hasHitCommonBoundingBoxOfSelectedElements)){this.state.editingLinearElement?this.setState({editingLinearElement:null}):this.setState({selectedElementIds:O({},this.state),selectedGroupIds:{},editingGroupId:null,activeEmbeddable:null}),z(this.interactiveCanvas,T.AUTO);return}if(!o.locked&&o.type!==`freedraw`&&n&&this.setState(e=>({selectedElementIds:O({...e.selectedElementIds,[n.id]:!0},e),showHyperlinkPopup:Fn(n)&&!n.link?`editor`:e.showHyperlinkPopup})),(o.type!==`selection`||js(this.scene.getNonDeletedElements(),this.state)||!ca(this.state.previousSelectedElementIds,this.state.selectedElementIds))&&this.store.shouldCaptureIncrement(),(e.drag.hasOccurred||s||c||l)&&Js(this.scene.getSelectedElements(this.state).filter(fc),this.scene.getNonDeletedElementsMap(),this.scene.getNonDeletedElements(),this.scene,wt(this.state),this.state.selectedLinearElement?.selectedPointsIndices??[],this.state.zoom),o.type===`laser`){this.laserTrails.endPath();return}!o.locked&&o.type!==`freedraw`?(_l(this.interactiveCanvas),this.setState({newElement:null,suggestedBindings:[],activeTool:fo(this.state,{type:`selection`})})):this.setState({newElement:null,suggestedBindings:[]}),d&&this.lastPointerUpEvent&&this.lastPointerDownEvent&&this.lastPointerUpEvent.timeStamp-this.lastPointerDownEvent.timeStamp<300&&$.pointers.size<=1&&er(d)&&this.isIframeLikeElementCenter(d,this.lastPointerUpEvent,e.origin.x,e.origin.y)&&this.handleEmbeddableCenterClick(d)})}clearSelection(e){this.setState(t=>({selectedElementIds:O({},t),activeEmbeddable:null,selectedGroupIds:{},editingGroupId:t.editingGroupId&&e!=null&&Xi(e,t.editingGroupId)?t.editingGroupId:null})),this.setState({selectedElementIds:O({},this.state),activeEmbeddable:null,previousSelectedElementIds:this.state.selectedElementIds})}getTextWysiwygSnappedToCenterPosition(e,t,n,r){if(r){let i=r.x+r.width/2,a=r.y+r.height/2,o=Me(r,n,this.scene.getNonDeletedElementsMap());if(o&&(i=o.x,a=o.y),Math.hypot(e-i,t-a)<30){let{x:e,y:t}=ga({sceneX:i,sceneY:a},n);return{viewportX:e,viewportY:t,elementCenterX:i,elementCenterY:a}}}}getCanvasOffsets(){if(this.excalidrawContainerRef?.current){let{left:e,top:t}=this.excalidrawContainerRef.current.getBoundingClientRect();return{offsetLeft:e,offsetTop:t}}return{offsetLeft:0,offsetTop:0}}async updateLanguage(){await Pg(Ag.find(e=>e.code===this.props.langCode)||kg),this.setAppState({})}};(pe.MODE===Nl.TEST||pe.DEV)&&(window.h=window.h||{},Object.defineProperties(window.h,{elements:{configurable:!0,get(){return this.app?.scene.getElementsIncludingDeleted()},set(e){return this.app?.scene.replaceAllElements(eo(e))}},scene:{configurable:!0,get(){return this.app?.scene}}}));var BD=zD,VD=()=>{Array.prototype.at||Object.defineProperty(Array.prototype,`at`,{value:function(e){if(e=Math.trunc(e)||0,e<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]},writable:!0,enumerable:!1,configurable:!0}),Element.prototype.replaceChildren||(Element.prototype.replaceChildren=function(...e){this.innerHTML=``,this.append(...e)})},HD=({children:e})=>{let{FooterCenterTunnel:t}=Mx(),n=L_();return(0,K.jsx)(t.In,{children:(0,K.jsx)(`div`,{className:L(`footer-center zen-mode-transition`,{"layer-ui__wrapper__footer-left--transition-bottom":n.zenModeEnabled}),children:e})})};HD.displayName=`FooterCenter`;var UD=()=>(0,K.jsx)(`svg`,{viewBox:`0 0 40 40`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`,className:`ExcalidrawLogo-icon`,children:(0,K.jsx)(`path`,{d:`M39.9 32.889a.326.326 0 0 0-.279-.056c-2.094-3.083-4.774-6-7.343-8.833l-.419-.472a.212.212 0 0 0-.056-.139.586.586 0 0 0-.167-.111l-.084-.083-.056-.056c-.084-.167-.28-.278-.475-.167-.782.39-1.507.973-2.206 1.528-.92.722-1.842 1.445-2.708 2.25a8.405 8.405 0 0 0-.977 1.028c-.14.194-.028.361.14.444-.615.611-1.23 1.223-1.843 1.861a.315.315 0 0 0-.084.223c0 .083.056.166.111.194l1.09.833v.028c1.535 1.528 4.244 3.611 7.12 5.861.418.334.865.667 1.284 1 .195.223.39.473.558.695.084.11.28.139.391.055.056.056.14.111.196.167a.398.398 0 0 0 .167.056.255.255 0 0 0 .224-.111.394.394 0 0 0 .055-.167c.029 0 .028.028.056.028a.318.318 0 0 0 .224-.084l5.082-5.528a.309.309 0 0 0 0-.444Zm-14.63-1.917a.485.485 0 0 0 .111.14c.586.5 1.2 1 1.843 1.555l-2.569-1.945-.251-.166c-.056-.028-.112-.084-.168-.111l-.195-.167.056-.056.055-.055.112-.111c.866-.861 2.346-2.306 3.1-3.028-.81.805-2.43 3.167-2.095 3.944Zm8.767 6.89-2.122-1.612a44.713 44.713 0 0 0-2.625-2.5c1.145.861 2.122 1.611 2.262 1.75 1.117.972 1.06.806 1.815 1.445l.921.666a1.06 1.06 0 0 1-.251.25Zm.558.416-.056-.028c.084-.055.168-.111.252-.194l-.196.222ZM1.089 5.75c.055.361.14.722.195 1.056.335 1.833.67 3.5 1.284 4.75l.252.944c.084.361.223.806.363.917 1.424 1.25 3.602 3.11 5.947 4.889a.295.295 0 0 0 .363 0s0 .027.028.027a.254.254 0 0 0 .196.084.318.318 0 0 0 .223-.084c2.988-3.305 5.221-6.027 6.813-8.305.112-.111.14-.278.14-.417.111-.111.195-.25.307-.333.111-.111.111-.306 0-.39l-.028-.027c0-.055-.028-.139-.084-.167-.698-.666-1.2-1.138-1.731-1.638-.922-.862-1.871-1.75-3.881-3.75l-.028-.028c-.028-.028-.056-.056-.112-.056-.558-.194-1.703-.389-3.127-.639C6.087 2.223 3.21 1.723.614.944c0 0-.168 0-.196.028l-.083.084c-.028.027-.056.055-.224.11h.056-.056c.028.167.028.278.084.473 0 .055.112.5.112.555l.782 3.556Zm15.496 3.278-.335-.334c.084.112.196.195.335.334Zm-3.546 4.666-.056.056c0-.028.028-.056.056-.056Zm-2.038-10c.168.167.866.834 1.033.973-.726-.334-2.54-1.167-3.379-1.445.838.167 1.983.334 2.346.472ZM1.424 2.306c.419.722.754 3.222 1.089 5.666-.196-.778-.335-1.555-.503-2.278-.251-1.277-.503-2.416-.838-3.416.056 0 .14 0 .252.028Zm-.168-.584c-.112 0-.223-.028-.307-.028 0-.027 0-.055-.028-.055.14 0 .223.028.335.083Zm-1.089.222c0-.027 0-.027 0 0ZM39.453 1.333c.028-.11-.558-.61-.363-.639.42-.027.42-.666 0-.666-.558.028-1.144.166-1.675.25-.977.194-1.982.389-2.96.61-2.205.473-4.383.973-6.561 1.557-.67.194-1.424.333-2.066.666-.224.111-.196.333-.084.472-.056.028-.084.028-.14.056-.195.028-.363.056-.558.083-.168.028-.252.167-.224.334 0 .027.028.083.028.11-1.173 1.556-2.485 3.195-3.909 4.945-1.396 1.611-2.876 3.306-4.356 5.056-4.719 5.5-10.052 11.75-15.943 17.25a.268.268 0 0 0 0 .389c.028.027.056.055.084.055-.084.084-.168.14-.252.222-.056.056-.084.111-.084.167a.605.605 0 0 0-.111.139c-.112.111-.112.305.028.389.111.11.307.11.39-.028.029-.028.029-.056.056-.056a.44.44 0 0 1 .615 0c.335.362.67.723.977 1.028l-.698-.583c-.112-.111-.307-.083-.39.028-.113.11-.085.305.027.389l7.427 6.194c.056.056.112.056.196.056s.14-.028.195-.084l.168-.166c.028.027.083.027.111.027.084 0 .14-.027.196-.083 10.052-10.055 18.15-17.639 27.42-24.417.083-.055.111-.166.111-.25.112 0 .196-.083.251-.194 1.704-5.194 2.039-9.806 2.15-12.083v-.028c0-.028.028-.056.028-.083.028-.056.028-.084.028-.084a1.626 1.626 0 0 0-.111-1.028ZM21.472 9.5c.446-.5.893-1.028 1.34-1.5-2.876 3.778-7.65 9.583-14.408 16.5 4.607-5.083 9.242-10.333 13.068-15ZM5.193 35.778h.084-.084Zm3.462 3.194c-.027-.028-.027-.028 0-.028v.028Zm4.16-3.583c.224-.25.448-.472.699-.722 0 0 0 .027.028.027-.252.223-.475.445-.726.695Zm1.146-1.111c.14-.14.279-.334.446-.5l.028-.028c1.648-1.694 3.351-3.389 5.082-5.111l.028-.028c.419-.333.921-.694 1.368-1.028a379.003 379.003 0 0 0-6.952 6.695ZM24.794 6.472c-.921 1.195-1.954 2.778-2.82 4.028-2.736 3.944-11.532 13.583-11.727 13.75a1976.983 1976.983 0 0 1-8.042 7.639l-.167.167c-.14-.167-.14-.417.028-.556C14.49 19.861 22.03 10.167 25.074 5.917c-.084.194-.14.36-.28.555Zm4.83 5.695c-1.116-.64-1.646-1.64-1.34-2.611l.084-.334c.028-.083.084-.194.14-.277.307-.5.754-.917 1.257-1.167.027 0 .055 0 .083-.028-.028-.056-.028-.139-.028-.222.028-.167.14-.278.335-.278.335 0 1.369.306 1.76.639.111.083.223.194.335.305.14.167.363.445.474.667.056.028.112.306.196.445.056.222.111.472.084.694-.028.028 0 .194-.028.194a2.668 2.668 0 0 1-.363 1.028c-.028.028-.028.056-.056.084l-.028.027c-.14.223-.335.417-.53.556-.643.444-1.369.583-2.095.389 0 0-.195-.084-.28-.111Zm8.154-.834a39.098 39.098 0 0 1-.893 3.167c0 .028-.028.083 0 .111-.056 0-.084.028-.14.056-2.206 1.61-4.356 3.305-6.506 5.028 1.843-1.64 3.686-3.306 5.613-4.945.558-.5.949-1.139 1.06-1.861l.28-1.667v-.055c.14-.334.67-.195.586.166Z`,fill:`currentColor`})}),WD=()=>(0,K.jsxs)(`svg`,{viewBox:`0 0 450 55`,xmlns:`http://www.w3.org/2000/svg`,fill:`none`,className:`ExcalidrawLogo-text`,children:[(0,K.jsx)(`path`,{d:`M429.27 96.74c2.47-1.39 4.78-3.02 6.83-4.95 1.43-1.35 2.73-2.86 3.81-4.51-.66.9-1.4 1.77-2.23 2.59-2.91 2.84-5.72 5.09-8.42 6.87h.01ZM343.6 69.36c.33 3.13.58 6.27.79 9.4.09 1.37.18 2.75.25 4.12-.12-4.46-.27-8.93-.5-13.39-.11-2.08-.24-4.16-.4-6.24-.06 1.79-.11 3.85-.13 6.11h-.01ZM378.47 98.34c.01-.37.07-1.13.01-6.51-.11 1.9-.22 3.81-.31 5.71-.07 1.42-.22 2.91-.16 4.35.39.03.78.07 1.17.1-.92-.85-.76-2.01-.72-3.66l.01.01ZM344.09 86.12c-.09-2.41-.22-4.83-.39-7.24v12.21c.15-.05.32-.09.47-.14.05-1.61-.03-3.23-.09-4.83h.01ZM440.69 66.79c-.22-.34-.45-.67-.69-.99-3.71-4.87-9.91-7.14-15.65-8.55-1.05-.26-2.12-.49-3.18-.71 2.29.59 4.48 1.26 6.64 2.02 7.19 2.54 10.57 5.41 12.88 8.23ZM305.09 72.46l1.2 3.6c.84 2.53 1.67 5.06 2.46 7.61.24.78.5 1.57.73 2.36.22-.04.44-.08.67-.12a776.9 776.9 0 0 1-5.01-13.57c-.02.04-.03.09-.05.13v-.01ZM345.49 90.25v.31c1.48-.42 3.05-.83 4.66-1.2-1.56.25-3.12.52-4.66.89ZM371.02 90.22c0-.57-.04-1.14-.11-1.71-.06-.02-.12-.04-.19-.05-.21-.05-.43-.08-.65-.11.42.16.74.88.95 1.87ZM398.93 54.23c-.13 0-.27-.01-.4-.02l.03.4c.11-.15.23-.27.37-.38ZM401.57 62.28v-.15c-1.22-.24-2.86-.61-3.23-1.25-.09-.15-.18-.51-.27-.98-.09.37-.2.73-.33 1.09 1.24.56 2.52.98 3.83 1.29ZM421.73 88.68c-2.97 1.65-6.28 3.12-9.69 3.68v.18c4.72-.14 11.63-3.85 16.33-8.38-2.04 1.75-4.33 3.24-6.63 4.53l-.01-.01ZM411.28 80.92c-.05-1.2-.09-2.4-.15-3.6-.21 5.66-.46 11.38-.47 14.51.24-.02.48-.04.71-.07.15-3.61.05-7.23-.09-10.83v-.01Z`,transform:`translate(-144.023 -51.76)`}),(0,K.jsx)(`path`,{d:`M425.38 67.41c-3.5-1.45-7.19-2.57-14.06-3.62.09 1.97.06 4.88-.03 8.12.03.04.06.09.06.15.19 1.36.28 2.73.37 4.1.25 3.77.39 7.55.41 11.33 0 1.38-.01 2.76-.07 4.13 1.4-.25 2.78-.65 4.12-1.15 4.07-1.5 7.94-3.78 11.28-6.54 2.33-1.92 5.13-4.49 5.88-7.58.63-3.53-2.45-6.68-7.97-8.96l.01.02ZM411.35 92.53v-.06l-.34.03c.11.01.22.03.34.03ZM314.26 64.06c-.23-.59-.47-1.17-.7-1.75.57 1.62 1.11 3.25 1.6 4.9l.15.54 2.35 6.05c.32.82.66 1.64.98 2.46-1.38-4.1-2.83-8.17-4.39-12.2h.01ZM156.82 103.07c-.18.13-.38.23-.58.33 1.32-.03 2.66-.2 3.93-.34.86-.09 1.72-.22 2.58-.33-2.12.1-4.12.17-5.94.34h.01ZM210.14 68.88s.03.04.05.07c.18-.31.39-.64.58-.96-.21.3-.42.6-.64.89h.01ZM201.65 82.8c-.5.77-1.02 1.56-1.49 2.37 1.11-1.55 2.21-3.1 3.2-4.59-.23.23-.49.51-.75.79-.32.47-.65.95-.96 1.43ZM194.03 98.66c-.33-.4-.65-.84-1.05-1.17-.24-.2-.07-.49.17-.56-.23-.26-.42-.5-.63-.75 1.51-2.55 3.93-5.87 6.4-9.28-.17-.08-.29-.28-.2-.49.04-.09.09-.17.13-.26-1.21 1.78-2.42 3.55-3.61 5.33-.87 1.31-1.74 2.64-2.54 4-.29.5-.63 1.04-.87 1.61.81.65 1.63 1.27 2.47 1.88-.09-.11-.18-.21-.27-.32v.01ZM307.79 82.93c-1-3.17-2.05-6.32-3.1-9.48-1.62 4.08-3.69 9.17-6.16 15.19 3.32-1.04 6.77-1.87 10.27-2.5-.32-1.08-.67-2.15-1.01-3.21ZM149.5 80.7c.05-1.71.04-3.43 0-5.14-.1 2.26-.16 4.51-.22 6.77-.02.73-.03 1.46-.04 2.19.14-1.27.2-2.55.24-3.82h.02ZM228.98 98.3c.39 1.25.91 3.03.94 3.91.06-.03.12-.07.17-.1.08-1.29-.55-2.65-1.11-3.81ZM307.72 53.36c.81.5 1.53 1.04 2.07 1.49-.38-.8-.78-1.58-1.21-2.35-.17.03-.34.06-.51.11-.43.12-.86.26-1.29.41.35-.01.53.1.94.34ZM283.69 96.14c3.91-7.25 6.89-13.35 8.88-18.15l1.1-2.66c-1.27 2.64-2.56 5.27-3.83 7.9-1.53 3.15-3.06 6.31-4.58 9.47-.87 1.81-1.76 3.62-2.54 5.47.04.02.07.04.11.07.05.05.1.09.15.14.05-.73.27-1.48.71-2.24ZM289.92 103.23s-.04.01-.05.03c0-.02.04-.03.05-.04.05-.05.11-.1.16-.15l.21-.21c-.55 0-1.5-.27-2.55-.72.4.26.8.51 1.22.74.24.13.48.26.73.37.05.02.1.03.14.05a.27.27 0 0 1 .08-.07h.01ZM269.23 68.49c-.39-.19-.82-.48-1.33-.87-3.06-1.56-6.31-2.78-9.36-2.35-3.5.49-5.7 1.11-7.74 2.44 5.71-2.6 12.82-2.07 18.44.79l-.01-.01ZM177.87 53.69l1.06.03c-.96-.22-2-.25-2.89-.3-4.95-.26-9.99.33-14.86 1.19-2.44.43-4.88.95-7.28 1.59 9.09-1.76 15.69-2.77 23.97-2.51ZM219.85 55.51c-.18.12-.36.27-.56.45-.45.53-.86 1.11-1.26 1.66-1.91 2.61-3.71 5.31-5.57 7.95l-.12.18 8.05-10.11c-.18-.05-.36-.1-.55-.13h.01ZM510.71 54.1c.12-.15.29-.3.53-.45.69-.4 3.72-.63 5.87-.74-.36-.02-.73-.04-1.09-.05-1.84-.03-3.67.09-5.49.35.05.3.12.59.18.88v.01ZM510.76 86.02c1.37-3.07 2.49-6.27 3.57-9.46.55-1.64 1.12-3.3 1.6-4.97-1.59 4.01-3.67 9.14-6.2 15.3.24-.08.5-.14.74-.22.1-.22.19-.44.29-.65ZM566.95 75.76c.11-.02.23.03.31.11-.05-.13-.09-.26-.14-.39-.05.09-.11.18-.17.28ZM511.33 86.41c3.08-.89 6.24-1.62 9.46-2.14-1.51-3.98-2.98-7.96-4.39-11.87-.05.15-.09.31-.14.46-1.02 3.32-2.15 6.61-3.39 9.85-.48 1.25-.98 2.49-1.53 3.7h-.01ZM578.24 74.45c.11-.44.23-.87.35-1.31-.31.7-.64 1.39-.97 2.08.09.21.19.4.28.61.12-.46.23-.92.35-1.38h-.01ZM520.62 53.11c-.09 0-.18-.01-.28-.02.38.34.29 1.08.93 2.53l6.65 17.15c2.2 5.68 4.69 11.36 7.41 16.87l1.06 2.17c-2.95-7.05-5.92-14.08-8.87-21.13-1.58-3.79-3.16-7.59-4.7-11.4-.78-1.92-1.73-3.89-2.25-5.91-.03-.1 0-.19.04-.26h.01ZM578.78 77.87c1.45-5.77 3.07-10.43 3.58-13.36.05-.34.16-.88.31-1.55-.67 1.79-1.37 3.56-2.08 5.33-.12.43-.23.86-.35 1.29-.65 2.43-1.29 4.86-1.9 7.3.14.33.29.65.43 1l.01-.01ZM545.3 94.66c.02-.44.03-.83.05-1.12.02-1.01.05-2.02.11-3.02.03-6.66-.46-14.33-1.46-22.8-.13-.42-.27-1.24-.56-2.89 0-.02 0-.04-.01-.06.62 6.61.95 13.25 1.32 19.87.17 3.08.33 6.16.52 9.23.02.25.03.52.04.78l-.01.01ZM580.77 102.81c.13.2.27.38.37.49.27-.11.53-.22.8-.32-.43.09-.82.05-1.17-.16v-.01ZM530.48 104.07h.33c-.36-.13-.71-.32-1.04-.56.14.24.3.47.45.7.06-.08.14-.13.26-.13v-.01ZM542.63 58.82c.06.23.11.47.15.71.14-.33.36-.62.7-.86-.28.05-.57.11-.85.15ZM583.81 57.87c.15-.7.29-1.41.42-2.11-.14.45-.28.9-.42 1.34-.46 1.44-.89 2.89-1.31 4.34.44-1.19.88-2.37 1.31-3.57ZM523.62 91.48c-4.66 1.17-9.05 2.89-14.02 5.27 4.65-1.84 9.48-3.29 14.28-4.63-.09-.22-.17-.41-.26-.64ZM460.64 78.3c-.04-2.9-.11-5.81-.28-8.71-.1-1.68-.17-3.43-.5-5.09-.07.02-.14.03-.2.05.3 6.54.45 12.17.51 17.12.17-.07.34-.14.51-.2 0-1.06-.01-2.11-.03-3.17h-.01ZM470.63 63.24c-3.38-.26-6.81.32-10.1 1.1.41 2.01.47 4.14.57 6.18.18 3.55.25 7.11.27 10.67 3.31-1.38 6.5-3.12 9.3-5.35 1.96-1.56 3.86-3.41 5.02-5.66.73-1.41 1.19-3.22.26-4.65-1.09-1.7-3.46-2.14-5.32-2.29ZM460.29 63.68c1-.24 2.01-.46 3.04-.65-1.15.16-2.37.38-3.71.69v.13c.07-.02.15-.04.22-.05.11-.13.3-.18.45-.11v-.01ZM457.24 100.96c.43-.03.86-.07 1.29-.11.14-.49.27-.99.38-1.49-.44.7-1 1.23-1.67 1.6ZM482.88 104.98c-.18.23-.36.38-.55.47.14.09.27.19.4.28a70.76 70.76 0 0 0 4.37-4.63c.76-.89 1.52-1.81 2.19-2.77-.3-.27-.61-.53-.92-.79-.07 1.94-4.62 6.32-5.49 7.45v-.01Z`,transform:`translate(-144.023 -51.76)`}),(0,K.jsx)(`path`,{d:`M474.36 63.31c-.4-.16-.84-.27-1.29-.37 1.56.42 3.08 1.22 3.76 2.74.62 1.4.32 2.95-.28 4.32.7-1.22.94-2.34.74-3.47-.24-1.33-1.19-2.54-2.93-3.21v-.01ZM477.34 89.18c-1.2-.81-2.4-1.62-3.6-2.42-.14.1-.26.19-.4.29 1.4.67 2.73 1.39 4 2.13ZM465.88 93.85c.37.25.74.5 1.1.75.46.32.92.65 1.38.97-1.57-1.2-2.01-1.61-2.49-1.72h.01ZM574.92 90.06c-2.28-5.21-4.93-11.13-5.67-12.26-.1-.15-1.57-3.01-1.63-3.08 0 0-.01.02-.02.02.4 1.37 1.09 2.69 1.65 3.99 2.14 4.95 4.36 9.86 6.67 14.73.6 1.26 1.21 2.52 1.83 3.78-.75-2.01-1.64-4.45-2.83-7.18ZM448.73 65.29c.1.2.22.38.34.57.22-.02.43-.06.65-.08v-.08c-.14-.05-.25 0-.99-.41ZM460.16 94.81c-.02.31-.06.59-.1.89-.03 1.71-.33 3.43-.79 5.07.15-.02.3-.03.45-.05.01-.04.02-.08.03-.11.09-.34.15-.69.2-1.03.17-1.07.25-2.16.33-3.24.05-.69.08-1.39.12-2.08-.27.1-.27.26-.24.57v-.02Z`,transform:`translate(-144.023 -51.76)`}),(0,K.jsx)(`path`,{d:`m328.67 98.12-3.22-6.58c-1.29-2.63-2.53-5.29-3.72-7.97-.25-.85-.52-1.69-.79-2.53-.81-2.57-1.67-5.12-2.55-7.67-1.92-5.53-3.9-11.08-6.32-16.41-.72-1.58-1.46-3.44-2.63-4.79-.03-.17-.16-.29-.34-.36a.282.282 0 0 0-.23-.04c-.06-.01-.12 0-.18.01-.74.06-1.5.38-2.19.61-2.22.77-4.4 1.64-6.63 2.38-.03-.08-.06-.16-.09-.25-.15-.42-.82-.24-.67.19.03.09.07.19.1.28l-.18.06c-.36.11-.28.6 0 .68.18 1.18.63 2.36.98 3.49.03.09.06.17.08.26-.08.23-.17.46-.24.64-.37.98-.79 1.94-1.21 2.9-1.27 2.89-2.62 5.75-3.98 8.6-3.18 6.67-6.44 13.31-9.64 19.97-1.08 2.25-2.2 4.5-3.15 6.81-.13.32.24.5.5.37 1.34 1.33 2.84 2.5 4.4 3.57.65.44 1.31.87 2.01 1.24.4.22.86.48 1.33.5.24.01.35-.19.33-.37.11-.1.21-.21.28-.28.41-.41.81-.84 1.2-1.26.85-.92 1.69-1.87 2.5-2.84 6.31-2.34 12.6-4.31 18.71-5.84 2.14 5.3 3.43 8.43 3.97 9.58.55 1.05 1.15 1.88 1.82 2.52 1.32.56 6.96-.03 9.23-1.96.87-1.28 1.19-2.67.93-4.15-.09-.5-.22-.95-.4-1.33l-.01-.03Zm-20.09-45.61c.43.77.83 1.56 1.21 2.35-.54-.45-1.27-.99-2.07-1.49-.42-.24-.6-.35-.94-.34.43-.15.85-.29 1.29-.41.17-.05.34-.08.51-.11Zm-25.86 45.66c.78-1.85 1.67-3.66 2.54-5.47 1.51-3.16 3.05-6.31 4.58-9.47 1.28-2.63 2.56-5.26 3.83-7.9l-1.1 2.66c-1.99 4.79-4.97 10.9-8.88 18.15-.43.76-.66 1.51-.71 2.24-.05-.05-.1-.09-.15-.14a.259.259 0 0 0-.11-.07Zm6.24 4.71c-.42-.23-.82-.48-1.22-.74 1.05.45 2 .72 2.55.72l-.21.21c-.05.05-.11.1-.16.15-.01.01-.04.03-.05.04 0-.02.03-.02.05-.03a.27.27 0 0 0-.08.07c-.05-.02-.1-.03-.14-.05-.25-.1-.49-.24-.73-.37h-.01Zm15.73-29.43c1.05 3.15 2.1 6.31 3.1 9.48.34 1.06.69 2.13 1.01 3.21-3.5.63-6.95 1.46-10.27 2.5 2.48-6.03 4.54-11.11 6.16-15.19Zm4.79 12.57c-.23-.79-.49-1.58-.73-2.36-.79-2.54-1.63-5.08-2.46-7.61l-1.2-3.6c.02-.04.04-.09.05-.13 1.6 4.45 3.28 9 5.01 13.57l-.67.12v.01Zm5.83-18.27-.15-.54c-.49-1.64-1.03-3.28-1.6-4.9.23.58.47 1.17.7 1.75 1.56 4.03 3.01 8.1 4.39 12.2-.33-.82-.67-1.64-.98-2.46l-2.35-6.05h-.01ZM390.43 79.37c-.13-10.43-.22-17.5-.24-19.97-.24-1.6.21-2.88-.65-3.65-.14-.13-.32-.23-.52-.32h.03c.45 0 .45-.69 0-.7-1.75-.03-3.5-.04-5.25-.14-1.38-.08-2.76-.21-4.15-.31-.07 0-.12.01-.17.04-.21-.07-.47.03-.45.31l.03.45c-.11.14-.19.3-.22.5-.21 1.26-.32 13.67-.36 23.59-.32 5.79-.67 11.57-.97 17.36-.09 1.73-.29 3.54-.21 5.3-.39.02-.38.64.04.69v.12c.05.44.74.45.7 0v-.06c1.1.09 2.2.21 3.3.3 1.14.19 2.44.2 3.29.17 1.73-.05 2.92-.05 3.8-.37.45-.05.9-.11 1.35-.17.44-.06.25-.73-.19-.67h-.01c.24-.32.45-.72.62-1.25.66-1.84.41-6.36.34-11.33l-.13-9.9.02.01Zm-12.26 18.17c.09-1.91.2-3.81.31-5.71.06 5.38 0 6.14-.01 6.51-.05 1.65-.21 2.81.72 3.66-.39-.04-.78-.07-1.17-.1-.06-1.44.09-2.93.16-4.35l-.01-.01ZM588.97 53.85c-2.06-.25-3.17-.51-3.76-.6a.3.3 0 0 1 .04-.08c.22-.39-.39-.75-.6-.35-.56 1.02-.9 2.19-1.26 3.29-.61 1.88-1.17 3.78-1.72 5.68-.63 2.19-1.24 4.39-1.83 6.59-.81 2.03-1.67 4.05-2.61 6.03-1.7-3.64-3.11-6.04-4.03-7.57-2.26-3.74-2.85-5.48-3.57-6.08l.31-.09c.43-.12.25-.8-.19-.67-1.06.3-2.12.6-3.17.95-.93.32-1.85.69-2.76 1.07-.13.05-.19.16-.22.27-.04.02-.08.05-.11.07-.04-.06-.07-.12-.11-.18a.354.354 0 0 0-.48-.12c-.16.09-.22.32-.13.48l.33.54c0 .09.02.18.06.28.51 1.16.78 1.38.72 1.47-2.42 3.44-5.41 7.86-6.2 9.1-1.27 1.97-2.01 3.14-2.45 3.84l-.91-6.56-.43-4.1c-.19-1.85-.37-3.23-.53-4.13-.19-1.1-.3-2.15-.45-3.16-.2-1.36-.29-2.06-.47-2.42h.04c.45.02.45-.68 0-.7-3.43-.16-6.81.94-10.17 1.48-.24-.22-.73-.04-.58.32.24.59.33 1.25.43 1.87.17 1.06.29 2.13.4 3.2.32 3.09.53 6.2.74 9.3.44 6.75.77 13.51 1.17 20.26.11 1.95.13 3.96.46 5.89.05.3.37.31.55.14.74 1.71 2.87 1.27 6.13 1.27 1.34 0 2.39.04 2.99-.11.02.32.48.53.63.18 3.61-8.26 7.41-16.46 12.05-24.2.03-.05.04-.1.05-.15.3.73.64 1.45.94 2.16.97 2.26 1.97 4.52 2.98 6.76 2.26 5.03 4.54 10.07 7.09 14.96.47.9.94 1.79 1.47 2.65.2.32.4.67.66.96-.18.25 0 .68.34.54.91-.38 1.82-.75 2.76-1.07 1.04-.35 2.11-.65 3.17-.95.39-.11.28-.66-.07-.68.62-.4.95-.96.87-1.91-.3-3.34.72-7.47.86-8.52l2.14-11.43c1.75-10.74 3.13-17.51 3.23-20.86.02-.49.08-2.84.13-3.24.17-1.25.48-1-4.96-1.65l.03-.02Zm-46.19 5.67c-.04-.24-.09-.48-.15-.71l.85-.15c-.34.24-.56.53-.7.86Zm1.95 25.12c-.36-6.63-.7-13.26-1.32-19.87 0 .02 0 .04.01.06.29 1.65.44 2.47.56 2.89 1 8.46 1.5 16.14 1.46 22.8-.06.99-.1 2-.11 3.02-.01.29-.03.68-.05 1.12-.01-.26-.03-.53-.04-.78-.19-3.08-.35-6.16-.52-9.23l.01-.01Zm36.4 18.66c-.11-.11-.24-.29-.37-.49.35.21.74.26 1.17.16-.27.11-.53.22-.8.32v.01Zm-.89-33.72c.12-.43.23-.86.35-1.29.71-1.77 1.41-3.55 2.08-5.33-.15.68-.26 1.22-.31 1.55-.5 2.94-2.13 7.59-3.58 13.36-.15-.35-.29-.66-.43-1 .61-2.44 1.25-4.87 1.9-7.3l-.01.01Zm3.56-12.48c.14-.44.28-.89.42-1.34-.13.7-.27 1.41-.42 2.11-.43 1.19-.86 2.38-1.31 3.57.42-1.45.85-2.9 1.31-4.34Zm-5.22 16.05c-.11.44-.23.87-.35 1.31-.12.46-.23.92-.35 1.38-.1-.22-.19-.4-.28-.61.34-.69.66-1.38.97-2.08h.01Zm-11.64 2.62c.06-.1.12-.19.17-.28.05.13.09.26.14.39a.398.398 0 0 0-.31-.11Zm2.3 2.98c-.56-1.3-1.25-2.63-1.65-3.99 0 0 .01-.02.02-.02.06.08 1.52 2.93 1.63 3.08.73 1.13 3.38 7.04 5.67 12.26 1.2 2.73 2.08 5.17 2.83 7.18-.62-1.25-1.23-2.51-1.83-3.78-2.31-4.87-4.53-9.78-6.67-14.73ZM275.92 87.03c-1.06-2.18-1.13-3.45-2.44-2.93-1.52.57-2.94 1.3-4.5 2.1-1.4.72-2.68 1.44-3.92 2.12.01-.25-.24-.5-.51-.34-4.8 2.93-12.41 4.7-17.28 1.31-1.98-1.77-3.32-4.15-3.97-5.78-.29-.95-.49-1.94-.63-2.93-.14-3.34 1.58-6.53 3.9-9.12.8-.79 1.68-1.51 2.66-2.12 3.7-2.3 8.22-3.07 12.51-2.51 2.71.35 5.32 1.24 7.71 2.55.39.22.75-.39.35-.6-.18-.1-.37-.18-.55-.27.56.27 1.03.33 1.51.19l-.48.39c-.15.11-.23.3-.13.48.09.15.33.24.48.13 1.3-.97 2.46-2.09 3.45-3.37.37-.29.64-.6.65-.97v-.02c.08-.33-.03-.7-.21-1.08-.31-.87-.98-2.01-2.19-3.26-2.43-2.52-3.79-3.45-5.68-4.26-1.14-.49-3.12-1.06-4.42-1.23-3.28-.42-10.64-1.21-18.18 4.11-7.74 5.46-11.94 12.3-12.23 20.61-.08 2.06.04 3.98.34 5.71.74 4.18 2.57 8 5.44 11.34 4.26 4.99 9.76 7.52 16.34 7.52 4.85 0 9.69-1.77 14.89-4.62.23-.12.45-.23.68-.35 2.19-1.1 4.37-2.23 6.46-3.5.49-.3 1.03-.61 1.5-.98 1.47-.87 1.11-1.12.49-2.95-.39-1.14-.76-2.7-2.06-5.36l.02-.01Zm-17.38-21.76c3.05-.42 6.31.79 9.36 2.35.51.39.94.68 1.33.87-5.61-2.86-12.72-3.39-18.44-.79 2.05-1.33 4.24-1.95 7.74-2.44l.01.01ZM443.67 72.67c-.4-2.2-1.15-4.33-2.37-6.22-1.49-2.32-3.58-4.19-5.91-5.64-6.17-3.81-13.75-5.11-20.83-6.01-3.23-.41-6.47-.69-9.72-.92l-1.39-.12c-.85-.07-1.52-.1-2.05-.1-1.08-.06-2.17-.12-3.25-.17-.08 0-.14.02-.19.05-.1.05-.18.14-.16.3.27 2.55-.01 5.12-.92 7.52-.15.38.4.56.62.28 1.32.59 2.68 1.05 4.08 1.37 0 2.78-.14 7.58-.33 12.91 0 0 0 .02-.01.03-.61 3.66-.79 7.42-1 11.12-.23 4.01-.43 8.03-.44 12.05 0 .64 0 1.28.03 1.93.02.31 0 .68.15.96.06.11.14.16.24.17-.2.17-.21.54.11.59 3.83.67 7.78.71 11.68.25 2.3-.19 4.87-.65 7.65-1.56 1.85-.54 3.67-1.18 5.43-1.91 7.2-3.02 14.31-8.07 17.35-15.53.76-1.86 1.17-3.8 1.31-5.75.3-1.93.28-3.82-.09-5.58l.01-.02Zm-19.32-15.42c5.74 1.41 11.94 3.68 15.65 8.55.25.32.47.65.69.99-2.3-2.82-5.68-5.69-12.88-8.23-2.16-.76-4.35-1.43-6.64-2.02 1.06.21 2.13.45 3.18.71Zm-25.82-3.04c.13 0 .27.01.4.02-.14.1-.26.23-.37.38 0-.13-.02-.26-.03-.4Zm34.82 22.17c-.75 3.09-3.55 5.66-5.88 7.58-3.35 2.76-7.21 5.03-11.28 6.54-1.33.49-2.71.9-4.12 1.15.06-1.38.08-2.76.07-4.13-.02-3.78-.16-7.56-.41-11.33-.09-1.37-.18-2.74-.37-4.1 0-.06-.03-.11-.06-.15.09-3.25.12-6.16.03-8.12 6.86 1.05 10.56 2.17 14.06 3.62 5.52 2.28 8.59 5.44 7.97 8.96l-.01-.02Zm-22 16.15c-.12 0-.23-.02-.34-.03l.34-.03v.06Zm-.69-.7c0-3.13.26-8.84.47-14.51.06 1.2.11 2.41.15 3.6.15 3.6.25 7.23.09 10.83-.24.03-.48.05-.71.07v.01Zm-12.33-30.94c.37.63 2.01 1.01 3.23 1.25v.15c-1.31-.31-2.59-.73-3.83-1.29.12-.36.23-.72.33-1.09.08.48.18.84.27.98Zm13.7 31.65v-.18c3.41-.56 6.71-2.02 9.69-3.68 2.31-1.28 4.59-2.78 6.63-4.53-4.69 4.53-11.61 8.24-16.33 8.38l.01.01Zm24.07-.75c-2.05 1.93-4.37 3.56-6.83 4.95 2.7-1.78 5.52-4.03 8.42-6.87.82-.82 1.56-1.69 2.23-2.59-1.08 1.65-2.38 3.16-3.81 4.51h-.01ZM187.16 92.14c-.79-2.47-2.1-7.12-3.1-6.87-.19-.01-2.09.77-4.08 1.54-3.06 1.18-5.91 2.13-10.09 2.82-2.74.42-5.87 1.01-10.61 1.06.04-3.34.05-6.01.05-7.99 7.97-.65 12.33-2.11 16.37-3.55 1.11-.39 2.69-1.01 2.63-1.8-.08-.35-.55-1.39-1.17-2.61-.47-1.16-.98-2.31-1.61-3.38-.42-.71-1.04-1.69-1.86-2.06-.11-.08-.22-.13-.29-.12-.02 0-.04 0-.07.01-.19-.04-.39-.05-.6-.01-.17.03-.24.15-.25.28-.04.02-.09.04-.14.05-4.33 1.48-8.85 2.33-13.24 3.61a499.1 499.1 0 0 0-.31-8.19c4.51-.99 8.88-1.38 13.11-1.82 3.68-.38 6.28.12 7.47.34.59.11.9.16 1.16.18h.1c-.1.37.44.66.62.28.02-.04.03-.08.05-.13.15.2.53.22.62-.1.17-.58.19-1.21.21-1.81v-.36c.03-.15.05-.3.07-.45.52-2.47.33-5.09-.64-7.44-.11-.27-.44-.28-.6-.14-.08-.21-.15-.42-.24-.62-.19-.41-.79-.05-.6.35.03.07.05.15.09.22-.98-.42-2.15-.54-3.17-.63-2.17-.19-4.37-.14-6.54 0-5.7.35-11.4 1.3-16.91 2.79-2.08.56-4.13 1.22-6.14 2-4.54 1.05-3.79 1.51-2.17 6.07.18.51.46 1.68.54 1.94.82 2.47 1.08 2.13 3.1 2.13s0 .05 0 .08h.52c-.48 2.66-.51 5.45-.62 8.13-.15 3.48-.22 6.96-.28 10.45 0 .41-.01.82-.02 1.23-.16.29-.33.57-.51.85-.05.38-.09.77-.14 1.18-.42 3.52-.59 6.48-.52 8.8v.34c.02.47.05.76.06.87.16 1.57-.26 3.47 1.35 3.79 1.61.32 3.5.55 4.85.55.11 0 .22-.02.33-.02 1.79.24 3.67.05 5.45-.12 2.85-.28 5.69-.7 8.51-1.19 3.03-.53 6.05-1.14 9.04-1.86 2.4-.58 4.82-1.19 7.13-2.06.51-.19 1.73-.57 2.46-1.14 1.81-.68 2.18-1 1.57-2.67-.23-.62-.48-1.49-.91-2.78l-.03-.02Zm-11.12-38.71c.89.05 1.93.08 2.89.3-.33 0-.68-.02-1.06-.03-8.28-.26-14.88.75-23.97 2.51 2.41-.64 4.85-1.16 7.28-1.59 4.87-.86 9.91-1.45 14.86-1.19Zm-26.53 22.13c.03 1.71.04 3.43 0 5.14-.04 1.27-.11 2.55-.24 3.82 0-.73.02-1.46.04-2.19.05-2.26.12-4.51.22-6.77h-.02Zm6.73 27.85c.2-.1.4-.21.58-.33 1.82-.17 3.82-.24 5.94-.34-.86.11-1.72.24-2.58.33-1.27.14-2.61.31-3.93.34h-.01ZM534.48 85.44c-3.52-8.38-7.07-16.75-10.5-25.17-.63-1.54-1.25-3.09-1.86-4.65-.31-.8-.65-1.6-.87-2.43-.04-.17-.17-.24-.31-.25.1-.2 0-.51-.29-.53-1.59-.08-3.18-.22-4.78-.25-1.96-.03-3.91.13-5.84.42-.31.05-.31.38-.13.56-.03.06-.05.14-.04.22.23 1.54.63 3.06 1.16 4.53.13.35.27.7.41 1.06l-2.68 6.18c-.11.03-.2.09-.25.22-.67 1.9-1.52 3.73-2.34 5.56a536.85 536.85 0 0 1-3.9 8.45c-2.64 5.64-5.34 11.25-7.91 16.93-.44.97-.88 1.94-1.29 2.93-.2.48-.47 1-.55 1.52v.05c-.02.12.02.26.16.34 1.19.73 2.41 1.41 3.66 2.05 1.2.62 2.45 1.25 3.76 1.61.43.12.62-.55.19-.67-1.13-.31-2.2-.83-3.24-1.36 1.09.36 2.1.69 2.75.93 2.82 1.01 2.38 1.1 4.3-3.75 2.1-1.09 4.34-1.96 6.53-2.79 4.35-1.64 8.8-3.03 13.27-4.29.82 2.01 1.77 3.97 2.72 5.92.35.83.62 1.45.79 1.82.22.42.45.8.69 1.15.17.33.33.67.5 1 .42.8.84 1.63 1.4 2.35.23.29.6 0 .55-.31 1.53-.02 3.06-.07 4.58-.27.92-.12 1.82-.32 2.71-.54 1.39-.27 3.85-1.11 3.74-1.42-.67-1.96-1.55-3.87-2.34-5.78-1.57-3.78-3.16-7.56-4.75-11.33v-.01Zm-11.65-26.16c1.54 3.81 3.12 7.6 4.7 11.4 2.94 7.05 5.91 14.09 8.87 21.13l-1.06-2.17c-2.71-5.51-5.2-11.19-7.41-16.87l-6.65-17.15c-.65-1.45-.55-2.19-.93-2.53.09 0 .18.01.28.02a.29.29 0 0 0-.04.26c.52 2.02 1.47 3.98 2.25 5.91h-.01Zm-6.58 13.58c.05-.15.09-.31.14-.46 1.41 3.92 2.88 7.9 4.39 11.87-3.22.52-6.38 1.25-9.46 2.14.55-1.22 1.05-2.46 1.53-3.7 1.24-3.24 2.37-6.53 3.39-9.85h.01Zm-.23-20c.36 0 .73.03 1.09.05-2.15.1-5.18.33-5.87.74-.24.15-.41.3-.53.45-.06-.29-.13-.58-.18-.88 1.82-.26 3.65-.39 5.49-.35v-.01Zm-.09 18.72c-.49 1.67-1.05 3.33-1.6 4.97-1.07 3.19-2.19 6.38-3.57 9.46-.09.21-.19.43-.29.65-.25.07-.5.14-.74.22 2.53-6.16 4.61-11.29 6.2-15.3Zm-6.34 25.16c4.97-2.38 9.37-4.1 14.02-5.27l.26.64c-4.8 1.35-9.63 2.8-14.28 4.63Zm20.17 6.76c.33.23.68.42 1.04.56h-.33c-.12 0-.21.06-.26.13-.15-.23-.31-.45-.45-.7v.01ZM226.57 91.75c-3.55-4.74-6.68-9.11-9.31-12.99 9.2-15.25 10.05-17.81 10.35-18.38.17-.34 1.09-2.27.64-2.53-1.13-.65-1.03-.65-2.97-1.71-1.19-.65-3.04-1.61-4.53-2.12-1.71-.59-1.24-.36-3 2.77-.06.1-.11.2-.17.3-.75 1.02-1.48 2.05-2.2 3.09-1.88 2.71-3.73 5.45-5.69 8.1-3.68-4.91-6.88-8.76-9.51-11.43-.15-.15-.3-.29-.46-.42-1.27-1.28-7.24 3.53-7.93 5.58-.09.09-.19.16-.28.25-.27.26.03.64.33.58.19.65.5 1.29.94 1.91 3.85 5.06 7.19 9.76 9.94 14-1.23 2.61-3.06 5-4.67 7.38l-2.28 3.33c-.5.66-.93 1.23-1.29 1.69-.67.93-2.09 2.61-2.3 3.87-.51.85-1.16 1.84-1.29 2.83-.06.44.61.63.67.19.01-.08.04-.15.06-.22 1.36 1.08 2.76 2.11 4.19 3.11 1.3.91 2.62 1.85 4.04 2.56.21.1.4 0 .48-.17.24.07.48.14.72.2.44.1.62-.57.19-.67-2.02-.48-3.77-1.57-5.23-3.02-.47-.46-.9-.96-1.32-1.46 1.74 1.35 4.2 2.89 5.89 4.14 1.39 1.03 2.85-2.27 4.22-4.2 1.86-2.64 3.96-5.86 5.52-8.29l10.39 14.51c.67.81 1.14 1.21 1.57 1.36-.05.24.12.51.41.4 1.53-.58 3.05-1.19 4.54-1.87 1.52-.69 3.06-1.45 4.36-2.5a.28.28 0 0 0 .12-.23c1.66-1.1.81-1.74-1.41-4.91-1.13-1.58-1.71-2.36-3.7-5.01l-.03-.02Zm2.41 6.54c.56 1.15 1.19 2.52 1.11 3.81-.06.04-.12.07-.17.1-.03-.88-.55-2.66-.94-3.91Zm-16.51-32.73c1.86-2.65 3.65-5.35 5.57-7.95.4-.55.81-1.13 1.26-1.66.19-.18.38-.33.56-.45.18.03.36.08.55.13l-8.05 10.11.12-.18h-.01ZM192.7 95.48c.79-1.37 1.66-2.69 2.54-4 1.19-1.79 2.4-3.56 3.61-5.33-.04.09-.09.17-.13.26-.1.22.03.41.2.49-2.47 3.42-4.89 6.73-6.4 9.28.21.24.4.48.63.75-.24.07-.4.36-.17.56.4.33.72.77 1.05 1.17.09.11.18.21.27.32-.84-.61-1.66-1.24-2.47-1.88.24-.57.58-1.11.87-1.61v-.01Zm7.46-10.32c.47-.81.98-1.59 1.49-2.37.31-.48.64-.95.96-1.43.26-.29.52-.56.75-.79-.99 1.48-2.09 3.03-3.2 4.59Zm10.03-16.22s-.03-.05-.05-.07c.22-.29.43-.59.64-.89-.2.32-.4.65-.58.96h-.01ZM371.54 87.96c-.01-.08-.01-.16-.03-.23-.06-.38-.58-.29-.66.03-.3-.05-.6-.08-.81-.11-1.14-.15-2.29-.19-3.44-.2 1.04-.09 2.09-.18 3.14-.23.45-.02.45-.72 0-.7-6.57.35-13.14 1.23-19.65 2.11-1.53.21-3.05.42-4.57.68-.01 0-.02.01-.04.01-.04-3.33-.13-6.66-.24-9.99-.19-5.7-.4-11.41-.88-17.1-.13-1.51-.23-3.07-.49-4.58 0-.25 0-.48-.02-.68-.06-1.19-.04-2.61-.68-2.78-.16-.07-.72-.16-1.5-.24.22-.17.16-.62-.2-.63-1.19-.04-2.39.09-3.57.23-1.2.14-2.41.32-3.59.6-.16-.1-.41-.06-.5.12-.06.02-.13.03-.19.05-.35.1-.29.55-.03.66-.26.6-.19 2.27-.21 3-.02.66-.66 33.73-.9 40.3-.03.65.06 1.12.04 1.45-.16 3.05.87 4.96 6.34 3.93 1.09-.08 2.75-.77 5.36-1.43 4.13-1.04 5.78-1.52 6.2-1.65 6.43-1.69 6.78-1.97 11.72-2.43.55-.05 4.8-.38 6.03-.3.64.04 1.19.07 1.65.1.09 0 .16-.03.24-.05.1.27.56.33.66-.02.39-1.32.61-2.71.78-4.08.2-1.61.29-3.24.15-4.86.24.03.52-.23.38-.53-.09-.2-.27-.33-.49-.43v-.02Zm-.63.56c.07.57.11 1.14.11 1.71-.21-.99-.53-1.71-.95-1.87.22.03.44.06.65.11.06.01.12.04.19.05Zm-25.41 1.73c1.54-.36 3.1-.64 4.66-.89-1.61.37-3.18.77-4.66 1.2v-.31Zm-.86-7.37c-.07-1.37-.16-2.75-.25-4.12-.21-3.13-.45-6.27-.79-9.4.02-2.25.08-4.31.13-6.11.16 2.08.29 4.16.4 6.24.23 4.46.38 8.93.5 13.39h.01Zm-.94-4c.16 2.41.29 4.83.39 7.24.06 1.6.14 3.22.09 4.83-.15.05-.32.09-.47.14V78.88h-.01ZM483.72 92.83c-3.05-2.28-6.22-4.4-9.38-6.51 8.86-6.49 13.49-12.95 13.73-19.23.04-.76 0-1.5-.13-2.2-.67-3.82-3.5-6.68-8.39-8.48.13.04.27.08.4.13 3.92 1.39 7.74 4.23 8.5 8.56.34 1.95-.05 3.96-.98 5.69-.21.4.39.75.6.35 1.86-3.46 1.46-7.55-.97-10.63-3.53-4.47-9.76-5.88-15.16-6.16-2.32-.12-4.64-.04-6.95.19-6 .32-12.71 1.68-17.63 3.21-.37.11-.67.23-.92.35-.2-.17-.62.02-.57.37v.03c-.64.68-.18 1.64.48 3.21.38.91.67 1.89 1.15 2.58.32.76.68 1.51 1.13 2.19.14.21.38.19.53.07.19-.02.38-.05.57-.08v1.57c-.06.06-.1.13-.11.23-.27 4.18-.34 8.38-.48 12.57l-.3 9.03c-.24 3.91-.44 6.77-.46 7.26-.05.88-.11 1.95.07 2.81-.01.22-.02.43-.04.65 0 .11-.02.23-.03.35 0 .05-.03.27-.01.16-.05.4.5.59.64.28.05.04.12.08.2.08 1.75.13 3.5.28 5.25.3 1.69.02 3.38-.12 5.06-.32.08.23.36.39.55.15.06-.08.11-.17.16-.26.18-.09.24-.32.18-.48.05-.2.1-.4.13-.6.16-.86.25-1.74.33-2.62.11-1.17.17-2.34.23-3.51.15-.01.32-.03.52-.04.36-.03 1.73-.15 2.06-.15.39 0 .7-.02.95-.04 1.76 1.11 3.45 2.35 5.14 3.55 2.83 2.01 5.64 4.04 8.47 6.04 1.42 1 2.85 2 4.29 2.97.1.06.19.07.27.04.08 0 .17-.02.25-.1 1.61-1.56 3.15-3.18 4.6-4.88.75-.88 1.49-1.78 2.15-2.73.01.01.03.02.04.03.34.3.83-.2.49-.49-2.16-1.9-4.34-3.76-6.64-5.48l.03-.01Zm-6.38-3.65a55.72 55.72 0 0 0-4-2.13c.14-.1.26-.19.4-.29 1.2.81 2.4 1.61 3.6 2.42Zm-20.1 11.78c.67-.37 1.23-.91 1.67-1.6-.11.5-.24 1-.38 1.49-.43.04-.86.08-1.29.11Zm2.38-37.24c1.34-.31 2.56-.52 3.71-.69-1.03.19-2.04.41-3.04.65-.14-.07-.34-.02-.45.11-.07.02-.15.04-.22.05v-.13.01Zm.04.84c.07-.02.14-.03.2-.05.34 1.66.41 3.41.5 5.09.17 2.9.24 5.81.28 8.71l.03 3.17c-.17.07-.34.14-.51.2-.06-4.96-.21-10.58-.51-17.12h.01Zm16.04 5.62c-1.16 2.25-3.06 4.1-5.02 5.66-2.8 2.23-5.99 3.97-9.3 5.35-.01-3.56-.09-7.12-.27-10.67-.1-2.04-.16-4.16-.57-6.18 3.3-.78 6.72-1.36 10.1-1.1 1.85.14 4.23.59 5.32 2.29.92 1.43.46 3.24-.26 4.65Zm.85-.18c.6-1.37.9-2.92.28-4.32-.67-1.52-2.2-2.32-3.76-2.74.46.1.89.21 1.29.37 1.74.67 2.69 1.88 2.93 3.21.2 1.13-.05 2.25-.74 3.47V70Zm-27.47-4.14c-.12-.19-.23-.38-.34-.57.74.42.85.36.99.41v.08c-.22.03-.43.06-.65.08Zm11.21 30.46c-.08 1.08-.16 2.17-.33 3.24-.05.35-.11.69-.2 1.03 0 .04-.02.07-.03.11-.15.02-.3.04-.45.05.45-1.64.76-3.36.79-5.07.03-.29.08-.57.1-.89-.03-.31-.03-.47.24-.57-.04.69-.07 1.39-.12 2.08v.02Zm5.6-2.47c.48.11.92.52 2.49 1.72-.46-.32-.92-.65-1.38-.97-.37-.25-.73-.5-1.1-.75h-.01Zm21.23 7.24a70.76 70.76 0 0 1-4.37 4.63c-.14-.09-.27-.19-.4-.28.19-.09.37-.24.55-.47.87-1.14 5.43-5.51 5.49-7.45.31.26.62.53.92.79-.67.97-1.42 1.88-2.19 2.77v.01Z`,fill:`currentColor`,transform:`translate(-144.023 -51.76)`})]}),GD=({style:e,size:t=`small`,withText:n})=>(0,K.jsxs)(`div`,{className:`ExcalidrawLogo is-${t}`,style:e,children:[(0,K.jsx)(UD,{}),n&&(0,K.jsx)(WD,{})]}),KD=({icon:e,shortcut:t,children:n})=>{let r=bD();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(`div`,{className:`welcome-screen-menu-item__icon`,children:e}),(0,K.jsx)(`div`,{className:`welcome-screen-menu-item__text`,children:n}),t&&!r.editor.isMobile&&(0,K.jsx)(`div`,{className:`welcome-screen-menu-item__shortcut`,children:t})]})};KD.displayName=`WelcomeScreenMenuItemContent`;var qD=({onSelect:e,children:t,icon:n,shortcut:r,className:i=``,...a})=>(0,K.jsx)(`button`,{...a,type:`button`,className:`welcome-screen-menu-item ${i}`,onClick:e,children:(0,K.jsx)(KD,{icon:n,shortcut:r,children:t})});qD.displayName=`WelcomeScreenMenuItem`;var JD=({children:e,href:t,icon:n,shortcut:r,className:i=``,...a})=>(0,K.jsx)(`a`,{...a,className:`welcome-screen-menu-item ${i}`,href:t,target:`_blank`,rel:`noreferrer`,children:(0,K.jsx)(KD,{icon:n,shortcut:r,children:e})});JD.displayName=`WelcomeScreenMenuItemLink`;var YD=({children:e})=>{let{WelcomeScreenCenterTunnel:t}=Mx();return(0,K.jsx)(t.In,{children:(0,K.jsx)(`div`,{className:`welcome-screen-center`,children:e||(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(XD,{}),(0,K.jsx)(ZD,{children:q(`welcomeScreen.defaults.center_heading`)}),(0,K.jsxs)(QD,{children:[(0,K.jsx)(eO,{}),(0,K.jsx)($D,{})]})]})})})};YD.displayName=`Center`;var XD=({children:e})=>(0,K.jsx)(`div`,{className:`welcome-screen-center__logo excalifont welcome-screen-decor`,children:e||(0,K.jsx)(GD,{withText:!0})});XD.displayName=`Logo`;var ZD=({children:e})=>(0,K.jsx)(`div`,{className:`welcome-screen-center__heading welcome-screen-decor excalifont`,children:e});ZD.displayName=`Heading`;var QD=({children:e})=>(0,K.jsx)(`div`,{className:`welcome-screen-menu`,children:e});QD.displayName=`Menu`;var $D=()=>{let e=TD();return(0,K.jsx)(qD,{onSelect:()=>e.executeAction(ly),shortcut:`?`,icon:Wt,children:q(`helpDialog.title`)})};$D.displayName=`MenuItemHelp`;var eO=()=>{let e=L_(),t=TD();return e.viewModeEnabled?null:(0,K.jsx)(qD,{onSelect:()=>t.executeAction(iy),shortcut:Ex(`loadScene`),icon:wr,children:q(`buttons.load`)})};eO.displayName=`MenuItemLoadScene`;var tO=({onSelect:e})=>{let{t}=Rg();return(0,K.jsx)(qD,{shortcut:null,onSelect:e,icon:Ni,children:t(`labels.liveCollaboration`)})};tO.displayName=`MenuItemLiveCollaborationTrigger`,YD.Logo=XD,YD.Heading=ZD,YD.Menu=QD,YD.MenuItem=qD,YD.MenuItemLink=JD,YD.MenuItemHelp=$D,YD.MenuItemLoadScene=eO,YD.MenuItemLiveCollaborationTrigger=tO;var nO=({children:e})=>{let{WelcomeScreenMenuHintTunnel:t}=Mx();return(0,K.jsx)(t.In,{children:(0,K.jsxs)(`div`,{className:`excalifont welcome-screen-decor welcome-screen-decor-hint welcome-screen-decor-hint--menu`,children:[ed,(0,K.jsx)(`div`,{className:`welcome-screen-decor-hint__label`,children:e||q(`welcomeScreen.defaults.menuHint`)})]})})};nO.displayName=`MenuHint`;var rO=({children:e})=>{let{WelcomeScreenToolbarHintTunnel:t}=Mx();return(0,K.jsx)(t.In,{children:(0,K.jsxs)(`div`,{className:`excalifont welcome-screen-decor welcome-screen-decor-hint welcome-screen-decor-hint--toolbar`,children:[(0,K.jsx)(`div`,{className:`welcome-screen-decor-hint__label`,children:e||q(`welcomeScreen.defaults.toolbarHint`)}),Tn]})})};rO.displayName=`ToolbarHint`;var iO=({children:e})=>{let{WelcomeScreenHelpHintTunnel:t}=Mx();return(0,K.jsx)(t.In,{children:(0,K.jsxs)(`div`,{className:`excalifont welcome-screen-decor welcome-screen-decor-hint welcome-screen-decor-hint--help`,children:[(0,K.jsx)(`div`,{children:e||q(`welcomeScreen.defaults.helpHint`)}),ur]})})};iO.displayName=`HelpHint`;var aO=e=>(0,K.jsx)(K.Fragment,{children:e.children||(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(YD,{}),(0,K.jsx)(nO,{}),(0,K.jsx)(rO,{}),(0,K.jsx)(iO,{})]})});aO.displayName=`WelcomeScreen`,aO.Center=YD,aO.Hints={MenuHint:nO,ToolbarHint:rO,HelpHint:iO};var oO=({isCollaborating:e,onSelect:t,...n})=>{let r=L_(),i=r.width<830;return(0,K.jsxs)(Cx,{...n,className:L(`collab-button`,{active:e}),type:`button`,onSelect:t,style:{position:`relative`,width:i?void 0:`auto`},title:q(`labels.liveCollaboration`),children:[i?Rr:q(`labels.share`),r.collaborators.size>0&&(0,K.jsx)(`div`,{className:`CollabButton-collaborators`,children:r.collaborators.size})]})};oO.displayName=`LiveCollaborationTrigger`,(0,yg.default)((e,t,n)=>{(pe.DEV||pe.MODE===Nl.TEST||window?.DEBUG_FRACTIONAL_INDICES)&&Re(eo(e.map(e=>({...e}))),{shouldThrow:pe.DEV||pe.MODE===Nl.TEST,includeBoundTextValidation:!0,reconciliationContext:{localElements:t,remoteElements:n}})},1e3*60,{leading:!0,trailing:!1});var sO=({children:e,icon:t})=>{let{TTDDialogTriggerTunnel:n}=Mx(),r=wD();return(0,K.jsx)(n.In,{children:(0,K.jsxs)(X.Item,{onSelect:()=>{Y(`ai`,`dialog open`,`ttd`),r({openDialog:{name:`ttd`,tab:`text-to-diagram`}})},icon:t??ll,children:[e??q(`labels.textToDiagram`),(0,K.jsx)(X.Item.Badge,{children:`AI`})]})})};sO.displayName=`TTDDialogTrigger`,VD();var cO=G.memo(e=>{let{onChange:t,initialData:n,excalidrawAPI:r,isCollaborating:i=!1,onPointerUpdate:a,renderTopRightUI:o,langCode:s=kg.code,viewModeEnabled:l,zenModeEnabled:u,gridModeEnabled:d,libraryReturnUrl:f,theme:p,name:m,renderCustomStats:h,onPaste:g,detectScroll:_=!0,handleKeyboardGlobally:v=!1,onLibraryChange:y,autoFocus:b=!1,generateIdForFile:x,onLinkOpen:S,generateLinkForSelection:ee,onPointerDown:te,onPointerUp:ne,onScrollChange:re,onDuplicate:ie,children:ae,validateEmbeddable:oe,renderEmbeddable:se,aiEnabled:ce,showDeprecatedFonts:le}=e,ue=e.UIOptions?.canvasActions,de={...e.UIOptions,canvasActions:{...Zr.canvasActions,...ue},tools:{image:e.UIOptions?.tools?.image??!0}};return ue?.export&&(de.canvasActions.export.saveFileToDisk=ue.export?.saveFileToDisk??Zr.canvasActions.export.saveFileToDisk),de.canvasActions.toggleTheme===null&&typeof p>`u`&&(de.canvasActions.toggleTheme=!0),(0,G.useEffect)(()=>{(async()=>{await c(()=>import(`./roundRect-Br9J0BSF.js`),[])})();let e=e=>{typeof e.scale==`number`&&e.scale!==1&&e.preventDefault()};return document.addEventListener(`touchmove`,e,{passive:!1}),()=>{document.removeEventListener(`touchmove`,e)}},[]),(0,K.jsx)(Tg,{store:Eg,children:(0,K.jsx)(Vg,{langCode:s,theme:p,children:(0,K.jsx)(BD,{onChange:t,initialData:n,excalidrawAPI:r,isCollaborating:i,onPointerUpdate:a,renderTopRightUI:o,langCode:s,viewModeEnabled:l,zenModeEnabled:u,gridModeEnabled:d,libraryReturnUrl:f,theme:p,name:m,renderCustomStats:h,UIOptions:de,onPaste:g,detectScroll:_,handleKeyboardGlobally:v,onLibraryChange:y,autoFocus:b,generateIdForFile:x,onLinkOpen:S,generateLinkForSelection:ee,onPointerDown:te,onPointerUp:ne,onScrollChange:re,onDuplicate:ie,validateEmbeddable:oe,renderEmbeddable:se,aiEnabled:ce!==!1,showDeprecatedFonts:le,children:ae})})})},(e,t)=>{if(e.children!==t.children)return!1;let{initialData:n,UIOptions:r={},...i}=e,{initialData:a,UIOptions:o={},...s}=t,c=Object.keys(r),l=Object.keys(o);return c.length===l.length?c.every(e=>e===`canvasActions`?Object.keys(r.canvasActions).every(e=>e===`export`&&r?.canvasActions?.export&&o?.canvasActions?.export?r.canvasActions.export.saveFileToDisk===o.canvasActions.export.saveFileToDisk:r?.canvasActions?.[e]===o?.canvasActions?.[e]):r[e]===o[e])&&ca(i,s):!1});cO.displayName=`Excalidraw`;var lO=!1;function uO(e){return{elements:e?.elements??[],files:e?.files,appState:e?.appState}}function dO(e){return JSON.stringify({elements:e.elements??[],files:e.files??void 0})}function fO({initialValue:e,onChange:t,saveStatus:n,onSaveClick:r,showSaveStatus:i}){let{t:a}=u(),o=(0,G.useMemo)(()=>uO(e),[e]),s=(0,G.useRef)(null),c=(0,G.useRef)(o),l=f(t),{openExcalidrawAssistant:d}=bd({sceneRef:c,excalidrawRef:s,onChange:l});xd({sceneRef:c,excalidrawRef:s,onChange:l});let p=(0,G.useCallback)((e,t,n)=>{let r={elements:e,files:n,appState:t};c.current=r,l(r)},[l]);return(0,K.jsx)(`div`,{className:`h-full w-full flex flex-col bg-background overflow-hidden`,children:(0,K.jsx)(`div`,{className:`flex-1 relative flex min-h-0 overflow-hidden`,children:(0,K.jsxs)(`div`,{className:`flex-1 relative min-w-0 overflow-hidden`,children:[(0,K.jsxs)(`div`,{className:`absolute inset-0`,children:[i&&(0,K.jsx)(ie,{children:(0,K.jsxs)(`div`,{className:`absolute right-3 top-1/2 -translate-y-1/2 z-20 flex flex-col items-center gap-2`,children:[(0,K.jsxs)(b,{children:[(0,K.jsx)(te,{asChild:!0,children:(0,K.jsx)(`div`,{className:`flex items-center justify-center w-8 h-8 rounded-full bg-background/80 border border-border/60 text-muted-foreground`,children:(()=>n===ue.SAVING?(0,K.jsx)(oe,{className:`h-4 w-4 animate-spin`}):n===ue.DIRTY?(0,K.jsx)(vd,{className:`h-4 w-4`}):n===ue.ERROR?(0,K.jsx)(re,{className:`h-4 w-4 text-destructive`}):(0,K.jsx)(v,{className:`h-4 w-4 text-green-600`}))()})}),(0,K.jsx)(S,{children:(()=>n===ue.SAVING?a(`excalidraw.saving`):n===ue.DIRTY?a(`excalidraw.edited`):n===ue.ERROR?a(`excalidraw.saveError`):a(`excalidraw.saved`))()})]}),r&&(0,K.jsxs)(b,{children:[(0,K.jsx)(te,{asChild:!0,children:(0,K.jsx)(h,{variant:`ghost`,size:`icon`,className:`h-8 w-8 rounded-full bg-background/80 border border-border/60 hover:bg-background`,onClick:r,children:(0,K.jsx)(yd,{className:`h-4 w-4`})})}),(0,K.jsx)(S,{children:a(`excalidraw.saveNow`)})]})]})}),(0,K.jsx)(cO,{initialData:{...o,scrollToContent:!0},excalidrawAPI:e=>{s.current=e},onChange:p,aiEnabled:!1})]}),lO]})})})}export{fO as ExcalidrawAICanvas,dO as buildSceneSnapshot,uO as normalizeSceneValue};