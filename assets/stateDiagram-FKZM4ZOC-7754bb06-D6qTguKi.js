import{s as e}from"./rolldown-runtime-B6ubh40S.js";import{N as t,P as n,w as r}from"./chakra-ui-DL3iEWi3.js";import{k as i}from"./react-utils-C9u-5Qte.js";import{t as a}from"./vendor-Ddcx14uX.js";import"./common-utils-6spi2Ajg.js";import"./monaco-BOU7eshl.js";import"./react-markdown-CyVVEHR3.js";import"./remark-gfm-DTA0tSXW.js";import{Dn as o,Qn as s,_n as c,ar as l,c as u,en as d,hi as f,j as p,or as m,rr as h,sr as g,st as _,xn as v,yt as y}from"./app-HD19YyAJ.js";import"./_baseUniq-214847ec-gYkodkzP.js";import"./_basePickBy-f749536a-DMdLDBu1.js";import{t as b}from"./graph-355e244d-CtTgE9d0.js";import"./chunk-55IACEB6-b2733bca-C2MRuSQT.js";import"./chunk-QN33PNHL-d51d5666-Ct49TVWz.js";import{t as x}from"./layout-7ea0beed-8PH-dp64.js";import{n as S,r as C,t as w}from"./chunk-DI55MBZ5-0b913128-BsKHv9Og.js";t(),n(),a(),r(),i(),g(),m(),f(),l();var T=c(e=>e.append(`circle`).attr(`class`,`start-state`).attr(`r`,s().state.sizeUnit).attr(`cx`,s().state.padding+s().state.sizeUnit).attr(`cy`,s().state.padding+s().state.sizeUnit),`drawStartState`),E=c(e=>e.append(`line`).style(`stroke`,`grey`).style(`stroke-dasharray`,`3`).attr(`x1`,s().state.textHeight).attr(`class`,`divider`).attr(`x2`,s().state.textHeight*2).attr(`y1`,0).attr(`y2`,0),`drawDivider`),D=c((e,t)=>{let n=e.append(`text`).attr(`x`,2*s().state.padding).attr(`y`,s().state.textHeight+2*s().state.padding).attr(`font-size`,s().state.fontSize).attr(`class`,`state-title`).text(t.id),r=n.node().getBBox();return e.insert(`rect`,`:first-child`).attr(`x`,s().state.padding).attr(`y`,s().state.padding).attr(`width`,r.width+2*s().state.padding).attr(`height`,r.height+2*s().state.padding).attr(`rx`,s().state.radius),n},`drawSimpleState`),O=c((e,t)=>{let n=c(function(e,t,n){let r=e.append(`tspan`).attr(`x`,2*s().state.padding).text(t);n||r.attr(`dy`,s().state.textHeight)},`addTspan`),r=e.append(`text`).attr(`x`,2*s().state.padding).attr(`y`,s().state.textHeight+1.3*s().state.padding).attr(`font-size`,s().state.fontSize).attr(`class`,`state-title`).text(t.descriptions[0]).node().getBBox(),i=r.height,a=e.append(`text`).attr(`x`,s().state.padding).attr(`y`,i+s().state.padding*.4+s().state.dividerMargin+s().state.textHeight).attr(`class`,`state-description`),o=!0,l=!0;t.descriptions.forEach(function(e){o||(n(a,e,l),l=!1),o=!1});let u=e.append(`line`).attr(`x1`,s().state.padding).attr(`y1`,s().state.padding+i+s().state.dividerMargin/2).attr(`y2`,s().state.padding+i+s().state.dividerMargin/2).attr(`class`,`descr-divider`),d=a.node().getBBox(),f=Math.max(d.width,r.width);return u.attr(`x2`,f+3*s().state.padding),e.insert(`rect`,`:first-child`).attr(`x`,s().state.padding).attr(`y`,s().state.padding).attr(`width`,f+2*s().state.padding).attr(`height`,d.height+i+2*s().state.padding).attr(`rx`,s().state.radius),e},`drawDescrState`),k=c((e,t,n)=>{let r=s().state.padding,i=2*s().state.padding,a=e.node().getBBox(),o=a.width,c=a.x,l=e.append(`text`).attr(`x`,0).attr(`y`,s().state.titleShift).attr(`font-size`,s().state.fontSize).attr(`class`,`state-title`).text(t.id),u=l.node().getBBox().width+i,d=Math.max(u,o);d===o&&(d+=i);let f,p=e.node().getBBox();t.doc,f=c-r,u>o&&(f=(o-d)/2+r),Math.abs(c-p.x)<r&&u>o&&(f=c-(u-o)/2);let m=1-s().state.textHeight;return e.insert(`rect`,`:first-child`).attr(`x`,f).attr(`y`,m).attr(`class`,n?`alt-composit`:`composit`).attr(`width`,d).attr(`height`,p.height+s().state.textHeight+s().state.titleShift+1).attr(`rx`,`0`),l.attr(`x`,f+r),u<=o&&l.attr(`x`,c+(d-i)/2-u/2+r),e.insert(`rect`,`:first-child`).attr(`x`,f).attr(`y`,s().state.titleShift-s().state.textHeight-s().state.padding).attr(`width`,d).attr(`height`,s().state.textHeight*3).attr(`rx`,s().state.radius),e.insert(`rect`,`:first-child`).attr(`x`,f).attr(`y`,s().state.titleShift-s().state.textHeight-s().state.padding).attr(`width`,d).attr(`height`,p.height+3+2*s().state.textHeight).attr(`rx`,s().state.radius),e},`addTitleAndBox`),A=c(e=>(e.append(`circle`).attr(`class`,`end-state-outer`).attr(`r`,s().state.sizeUnit+s().state.miniPadding).attr(`cx`,s().state.padding+s().state.sizeUnit+s().state.miniPadding).attr(`cy`,s().state.padding+s().state.sizeUnit+s().state.miniPadding),e.append(`circle`).attr(`class`,`end-state-inner`).attr(`r`,s().state.sizeUnit).attr(`cx`,s().state.padding+s().state.sizeUnit+2).attr(`cy`,s().state.padding+s().state.sizeUnit+2)),`drawEndState`),j=c((e,t)=>{let n=s().state.forkWidth,r=s().state.forkHeight;if(t.parentId){let e=n;n=r,r=e}return e.append(`rect`).style(`stroke`,`black`).style(`fill`,`black`).attr(`width`,n).attr(`height`,r).attr(`x`,s().state.padding).attr(`y`,s().state.padding)},`drawForkJoinState`),M=c((e,t,n,r)=>{let i=0,a=r.append(`text`);a.style(`text-anchor`,`start`),a.attr(`class`,`noteText`);let o=e.replace(/\r\n/g,`<br/>`);o=o.replace(/\n/g,`<br/>`);let c=o.split(h.lineBreakRegex),l=1.25*s().state.noteMargin;for(let e of c){let r=e.trim();if(r.length>0){let e=a.append(`tspan`);if(e.text(r),l===0){let t=e.node().getBBox();l+=t.height}i+=l,e.attr(`x`,t+s().state.noteMargin),e.attr(`y`,n+i+1.25*s().state.noteMargin)}}return{textWidth:a.node().getBBox().width,textHeight:i}},`_drawLongText`),N=c((e,t)=>{t.attr(`class`,`state-note`);let n=t.append(`rect`).attr(`x`,0).attr(`y`,s().state.padding),{textWidth:r,textHeight:i}=M(e,0,0,t.append(`g`));return n.attr(`height`,i+2*s().state.noteMargin),n.attr(`width`,r+s().state.noteMargin*2),n},`drawNote`),P=c(function(e,t){let n=t.id,r={id:n,label:t.id,width:0,height:0},i=e.append(`g`).attr(`id`,n).attr(`class`,`stateGroup`);t.type===`start`&&T(i),t.type===`end`&&A(i),(t.type===`fork`||t.type===`join`)&&j(i,t),t.type===`note`&&N(t.note.text,i),t.type===`divider`&&E(i),t.type===`default`&&t.descriptions.length===0&&D(i,t),t.type===`default`&&t.descriptions.length>0&&O(i,t);let a=i.node().getBBox();return r.width=a.width+2*s().state.padding,r.height=a.height+2*s().state.padding,r},`drawState`),F=0,I=c(function(e,t,n){let r=c(function(e){switch(e){case S.relationType.AGGREGATION:return`aggregation`;case S.relationType.EXTENSION:return`extension`;case S.relationType.COMPOSITION:return`composition`;case S.relationType.DEPENDENCY:return`dependency`}},`getRelationType`);t.points=t.points.filter(e=>!Number.isNaN(e.y));let i=t.points,a=y().x(function(e){return e.x}).y(function(e){return e.y}).curve(o),l=e.append(`path`).attr(`d`,a(i)).attr(`id`,`edge`+F).attr(`class`,`transition`),d=``;if(s().state.arrowMarkerAbsolute&&(d=v(!0)),l.attr(`marker-end`,`url(`+d+`#`+r(S.relationType.DEPENDENCY)+`End)`),n.title!==void 0){let r=e.append(`g`).attr(`class`,`stateLabel`),{x:i,y:a}=u.calcLabelPosition(t.points),o=h.getRows(n.title),c=0,l=[],d=0,f=0;for(let e=0;e<=o.length;e++){let t=r.append(`text`).attr(`text-anchor`,`middle`).text(o[e]).attr(`x`,i).attr(`y`,a+c),n=t.node().getBBox();d=Math.max(d,n.width),f=Math.min(f,n.x),_.info(n.x,i,a+c),c===0&&(c=t.node().getBBox().height,_.info(`Title height`,c,a)),l.push(t)}let p=c*o.length;if(o.length>1){let e=(o.length-1)*c*.5;l.forEach((t,n)=>t.attr(`y`,a+n*c-e)),p=c*o.length}let m=r.node().getBBox();r.insert(`rect`,`:first-child`).attr(`class`,`box`).attr(`x`,i-d/2-s().state.padding/2).attr(`y`,a-p/2-s().state.padding/2-3.5).attr(`width`,d+s().state.padding).attr(`height`,p+s().state.padding),_.info(m)}F++},`drawEdge`),L,R={},z=c(function(){},`setConf`),B=c(function(e){e.append(`defs`).append(`marker`).attr(`id`,`dependencyEnd`).attr(`refX`,19).attr(`refY`,7).attr(`markerWidth`,20).attr(`markerHeight`,28).attr(`orient`,`auto`).append(`path`).attr(`d`,`M 19,7 L9,13 L14,7 L9,1 Z`)},`insertMarkers`),V=c(function(e,t,n,r){L=s().state;let i=s().securityLevel,a;i===`sandbox`&&(a=d(`#i`+t));let o=d(i===`sandbox`?a.nodes()[0].contentDocument.body:`body`),c=i===`sandbox`?a.nodes()[0].contentDocument:document;_.debug(`Rendering diagram `+e);let l=o.select(`[id='${t}']`);B(l),U(r.db.getRootDoc(),l,void 0,!1,o,c,r);let u=L.padding,f=l.node().getBBox(),m=f.width+u*2,h=f.height+u*2;p(l,h,m*1.75,L.useMaxWidth),l.attr(`viewBox`,`${f.x-L.padding}  ${f.y-L.padding} `+m+` `+h)},`draw`),H=c(e=>e?e.length*L.fontSizeFactor:1,`getLabelWidth`),U=c((e,t,n,r,i,a,o)=>{let s=new b({compound:!0,multigraph:!0}),c,l=!0;for(c=0;c<e.length;c++)if(e[c].stmt===`relation`){l=!1;break}n?s.setGraph({rankdir:`LR`,multigraph:!0,compound:!0,ranker:`tight-tree`,ranksep:l?1:L.edgeLengthFactor,nodeSep:l?1:50,isMultiGraph:!0}):s.setGraph({rankdir:`TB`,multigraph:!0,compound:!0,ranksep:l?1:L.edgeLengthFactor,nodeSep:l?1:50,ranker:`tight-tree`,isMultiGraph:!0}),s.setDefaultEdgeLabel(function(){return{}});let u=o.db.getStates(),d=o.db.getRelations(),f=Object.keys(u);for(let e of f){let c=u[e];n&&(c.parentId=n);let l;if(c.doc){let e=t.append(`g`).attr(`id`,c.id).attr(`class`,`stateGroup`);l=U(c.doc,e,c.id,!r,i,a,o);{e=k(e,c,r);let t=e.node().getBBox();l.width=t.width,l.height=t.height+L.padding/2,R[c.id]={y:L.compositTitleSize}}}else l=P(t,c,s);if(c.note){let e=P(t,{descriptions:[],id:c.id+`-note`,note:c.note,type:`note`},s);c.note.position===`left of`?(s.setNode(l.id+`-note`,e),s.setNode(l.id,l)):(s.setNode(l.id,l),s.setNode(l.id+`-note`,e)),s.setParent(l.id,l.id+`-group`),s.setParent(l.id+`-note`,l.id+`-group`)}else s.setNode(l.id,l)}_.debug(`Count=`,s.nodeCount(),s);let p=0;d.forEach(function(e){p++,_.debug(`Setting edge`,e),s.setEdge(e.id1,e.id2,{relation:e,width:H(e.title),height:L.labelHeight*h.getRows(e.title).length,labelpos:`c`},`id`+p)}),x(s),_.debug(`Graph after layout`,s.nodes());let m=t.node();s.nodes().forEach(function(e){e!==void 0&&s.node(e)!==void 0?(_.warn(`Node `+e+`: `+JSON.stringify(s.node(e))),i.select(`#`+m.id+` #`+e).attr(`transform`,`translate(`+(s.node(e).x-s.node(e).width/2)+`,`+(s.node(e).y+(R[e]?R[e].y:0)-s.node(e).height/2)+` )`),i.select(`#`+m.id+` #`+e).attr(`data-x-shift`,s.node(e).x-s.node(e).width/2),a.querySelectorAll(`#`+m.id+` #`+e+` .divider`).forEach(e=>{let t=e.parentElement,n=0,r=0;t&&(t.parentElement&&(n=t.parentElement.getBBox().width),r=parseInt(t.getAttribute(`data-x-shift`),10),Number.isNaN(r)&&(r=0)),e.setAttribute(`x1`,0-r+8),e.setAttribute(`x2`,n-r-8)})):_.debug(`No Node `+e+`: `+JSON.stringify(s.node(e)))});let g=m.getBBox();s.edges().forEach(function(e){e!==void 0&&s.edge(e)!==void 0&&(_.debug(`Edge `+e.v+` -> `+e.w+`: `+JSON.stringify(s.edge(e))),I(t,s.edge(e),s.edge(e).relation))}),g=m.getBBox();let v={id:n||`root`,label:n||`root`,width:0,height:0};return v.width=g.width+2*L.padding,v.height=g.height+2*L.padding,_.debug(`Doc rendered`,v,s),v},`renderDoc`),W={parser:w,get db(){return new S(1)},renderer:{setConf:z,draw:V},styles:C,init:c(e=>{e.state||={},e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},`init`)};export{W as diagram};